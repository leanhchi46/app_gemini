2025-10-13 08:41:49,391 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:49,425 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.646292681737
2025-10-13 08:41:49,429 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:49,430 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.646292681737
2025-10-13 08:41:49,443 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.646292681737, 'asia': 24728.646292681737, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:49,444 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:49,445 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.55822501159
2025-10-13 08:41:49,445 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:49,445 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.360506163503
2025-10-13 08:41:49,446 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:49,446 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.747537093757
2025-10-13 08:41:49,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:49,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.25726275562
2025-10-13 08:41:49,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:49,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.92780415231
2025-10-13 08:41:49,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:49,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.05649349498
2025-10-13 08:41:49,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:49,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.90536236516
2025-10-13 08:41:49,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:49,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.614280970032
2025-10-13 08:41:49,451 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.55822501159, 'ema200': 24711.360506163503}, 'M5': {'ema50': 24697.747537093757, 'ema200': 24620.25726275562}, 'M15': {'ema50': 24677.92780415231, 'ema200': 24881.05649349498}, 'H1': {'ema50': 24846.90536236516, 'ema200': 24939.614280970032}}
2025-10-13 08:41:49,451 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:49,452 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.436937831893232, TRs count: 179
2025-10-13 08:41:49,452 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:49,453 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.01711821861355, TRs count: 119
2025-10-13 08:41:49,453 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:49,454 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:49,454 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:49,455 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:49,456 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.436937831893232, 'M1': 8.01711821861355, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:49,456 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:49,457 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.05, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:49,466 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:49,489 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:49,490 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:49,491 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:49,492 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6773.999999999796
2025-10-13 08:41:49,492 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24427.999999999884
2025-10-13 08:41:49,493 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1099.4999999998981
2025-10-13 08:41:49,493 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7545.000000000073
2025-10-13 08:41:49,494 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:49,494 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6773.999999999796}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24427.999999999884}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1099.4999999998981}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7545.000000000073}]
2025-10-13 08:41:49,495 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:49,495 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:49,496 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:49,496 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:49,497 - APP.services.mt5_service - DEBUG - Position in day range: 0.5581223238356985
2025-10-13 08:41:49,497 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:49+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:49,497 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:49+07:00
2025-10-13 08:41:49,498 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:49+07:00 trong DST: True
2025-10-13 08:41:49,498 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:49,500 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:49,501 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:49,501 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,502 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:49,502 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '500', 'price': 24704.05, 'distance_pips': 0.0}, {'level': '525', 'price': 24704.05, 'distance_pips': 0.25}, {'level': '550', 'price': 24704.06, 'distance_pips': 0.5}, {'level': '575', 'price': 24704.06, 'distance_pips': 0.75}]
2025-10-13 08:41:49,503 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:49,503 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,504 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:49,504 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:49,505 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.05
2025-10-13 08:41:49,506 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:49,506 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:49,507 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:49,508 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:49,508 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:49,509 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.05
2025-10-13 08:41:49,509 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:49,509 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:49,510 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:49,511 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:49,511 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:49,512 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.05
2025-10-13 08:41:49,513 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:49,513 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:49,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:49,515 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:49,516 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:49,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.05
2025-10-13 08:41:49,517 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:49,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:49,519 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:49,520 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:49,526 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,556 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:49,556 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:49,557 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:49,558 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:49,558 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:49,560 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:49,560 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:49,561 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:49,561 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:49,561 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:49,562 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:49,562 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:49,563 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:49,563 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:49,563 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:49,564 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:49,564 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:49,564 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,565 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:49,565 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:49,566 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:49,566 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:49,567 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:49,567 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:49,569 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:49,571 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,572 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:49,573 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.05, 'ask': 24704.05, 'last': 0.0, 'time': 1760344909}
2025-10-13 08:41:49,573 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:49,573 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:49,576 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:49,576 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:49,577 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:49,577 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,577 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:49,578 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,578 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:49,578 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:49,579 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:49,579 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.05
2025-10-13 08:41:49,581 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6773.999999999796}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24427.999999999884}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1099.4999999998981}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7545.000000000073}]
2025-10-13 08:41:49,582 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:49,608 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-13 08:41:49,703 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:49,703 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:49,704 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 115.28, 'free_margin': 110.78, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:49,705 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.05, 'profit': -0.09, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.05, 'profit': -0.1, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:49,706 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:49,759 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:49,773 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:49,774 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:49,777 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:49,778 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:49,779 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:49,779 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:49,780 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:41:49,789 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:49,790 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:49,790 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:49,791 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:49,791 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:49,792 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:49,792 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:49,793 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:49,807 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:50,294 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:50,314 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:50,317 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:50,317 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:50,318 - APP.services.mt5_service - DEBUG - Current price (cp): 24703.98
2025-10-13 08:41:50,322 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:50,372 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:50,427 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:50,429 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:50,433 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:50,435 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:50,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:50,437 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:50,441 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:50,442 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:50,442 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:50,445 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:50,447 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:50,447 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:50,448 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:50,448 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:50,450 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:50,451 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:50,451 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:50,451 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:50,454 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:50,455 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:50,455 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:50,456 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:50,456 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:49+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:50,457 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:49+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:50,457 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:49+07:00
2025-10-13 08:41:50,457 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:49+07:00 trong DST: True
2025-10-13 08:41:50,458 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:50,458 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:50,458 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:50,492 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:50,493 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64486172907
2025-10-13 08:41:50,495 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:50,496 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64486172907
2025-10-13 08:41:50,499 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.64486172907, 'asia': 24728.64486172907, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:50,500 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:50,500 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.555479913553
2025-10-13 08:41:50,501 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:50,502 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.35980964609
2025-10-13 08:41:50,503 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:50,503 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.74479199572
2025-10-13 08:41:50,504 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:50,504 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.256566238204
2025-10-13 08:41:50,504 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:50,505 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.925059054272
2025-10-13 08:41:50,505 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:50,506 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.055796977565
2025-10-13 08:41:50,506 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:50,506 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.902617267122
2025-10-13 08:41:50,507 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:50,507 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.613584452618
2025-10-13 08:41:50,508 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.555479913553, 'ema200': 24711.35980964609}, 'M5': {'ema50': 24697.74479199572, 'ema200': 24620.256566238204}, 'M15': {'ema50': 24677.925059054272, 'ema200': 24881.055796977565}, 'H1': {'ema50': 24846.902617267122, 'ema200': 24939.613584452618}}
2025-10-13 08:41:50,508 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:50,509 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.436937831893232, TRs count: 179
2025-10-13 08:41:50,510 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:50,510 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.01711821861355, TRs count: 119
2025-10-13 08:41:50,511 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:50,511 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:50,511 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:50,512 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:50,512 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.436937831893232, 'M1': 8.01711821861355, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:50,513 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:50,513 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24703.98, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:50,513 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:50,514 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:50,514 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:50,515 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:50,515 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6766.999999999825
2025-10-13 08:41:50,515 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24420.999999999913
2025-10-13 08:41:50,516 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1092.4999999999272
2025-10-13 08:41:50,516 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7538.000000000102
2025-10-13 08:41:50,517 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:50,518 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6766.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24420.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1092.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7538.000000000102}]
2025-10-13 08:41:50,519 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:50,520 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:50,526 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:50,527 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:50,541 - APP.services.mt5_service - DEBUG - Position in day range: 0.5577522863033217
2025-10-13 08:41:50,544 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:49+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:50,545 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:49+07:00
2025-10-13 08:41:50,549 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:49+07:00 trong DST: True
2025-10-13 08:41:50,549 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:50,550 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:50,551 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:50,551 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,551 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:50,552 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9800', 'price': 24703.98, 'distance_pips': 0.0}, {'level': '9825', 'price': 24703.98, 'distance_pips': 0.25}, {'level': '9850', 'price': 24703.99, 'distance_pips': 0.5}, {'level': '9875', 'price': 24703.99, 'distance_pips': 0.75}]
2025-10-13 08:41:50,552 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:50,553 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,554 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:50,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:50,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24703.98
2025-10-13 08:41:50,556 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:50,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:50,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:50,558 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:50,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:50,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24703.98
2025-10-13 08:41:50,559 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:50,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:50,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:50,561 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:50,561 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:50,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24703.98
2025-10-13 08:41:50,562 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:50,563 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:50,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:50,565 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:50,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:50,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24703.98
2025-10-13 08:41:50,566 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:50,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:50,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:50,567 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:50,568 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,568 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:50,569 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:50,569 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:50,570 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:50,570 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:50,570 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:50,570 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:50,571 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:50,571 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:50,571 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:50,572 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:50,572 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:50,572 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:50,573 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:50,573 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:50,574 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:50,574 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:50,575 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,575 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:50,575 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:50,576 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:50,576 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:50,576 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:50,577 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:50,578 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:50,582 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,589 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:50,590 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:50,601 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24703.98, 'ask': 24703.98, 'last': 0.0, 'time': 1760344909}
2025-10-13 08:41:50,618 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:50,619 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:50,620 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:50,621 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:50,622 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:50,623 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:50,624 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:50,624 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:50,625 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24703.98
2025-10-13 08:41:50,625 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6766.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24420.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1092.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7538.000000000102}]
2025-10-13 08:41:50,625 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:50,627 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-13 08:41:50,678 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:50,689 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:50,690 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.96, 'free_margin': 110.46, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:50,692 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24703.98, 'profit': -0.09, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24703.98, 'profit': -0.1, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:50,693 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:50,777 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:50,778 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:50,779 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:50,781 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:50,782 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:50,784 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:50,784 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:50,785 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:41:50,794 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:50,795 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:50,795 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:50,796 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:50,838 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:50,935 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:50,938 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:50,940 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:50,944 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:51,446 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:51,448 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:51,450 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:51,450 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:51,451 - APP.services.mt5_service - DEBUG - Current price (cp): 24704.6
2025-10-13 08:41:51,455 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:51,505 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:51,506 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:51,506 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:51,508 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:51,509 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:51,509 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:51,510 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:51,513 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:51,513 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:51,514 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:51,514 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:51,516 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:51,516 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:51,518 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:51,518 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:51,529 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:51,550 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:51,550 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:51,551 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:51,554 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:51,555 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:51,555 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:51,556 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:51,556 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:51+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:51,557 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:51+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:51,557 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:51+07:00
2025-10-13 08:41:51,557 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:51+07:00 trong DST: True
2025-10-13 08:41:51,558 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:51,558 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:51,558 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:51,560 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:51,560 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64279252487
2025-10-13 08:41:51,561 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:51,562 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64279252487
2025-10-13 08:41:51,564 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.64279252487, 'asia': 24728.64279252487, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:51,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:51,565 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.579793639045
2025-10-13 08:41:51,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:51,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.365978800317
2025-10-13 08:41:51,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:51,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.76910572121
2025-10-13 08:41:51,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:51,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.262735392433
2025-10-13 08:41:51,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:51,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.949372779764
2025-10-13 08:41:51,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:51,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.061966131794
2025-10-13 08:41:51,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:51,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.926930992613
2025-10-13 08:41:51,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:51,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.619753606847
2025-10-13 08:41:51,571 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.579793639045, 'ema200': 24711.365978800317}, 'M5': {'ema50': 24697.76910572121, 'ema200': 24620.262735392433}, 'M15': {'ema50': 24677.949372779764, 'ema200': 24881.061966131794}, 'H1': {'ema50': 24846.926930992613, 'ema200': 24939.619753606847}}
2025-10-13 08:41:51,571 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:51,572 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.436937831893232, TRs count: 179
2025-10-13 08:41:51,573 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:51,573 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.01711821861355, TRs count: 119
2025-10-13 08:41:51,573 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:51,574 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:51,574 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:51,575 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:51,575 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.436937831893232, 'M1': 8.01711821861355, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:51,576 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:51,576 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.6, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:51,577 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:51,577 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:51,577 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:51,578 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:51,578 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6828.9999999997235
2025-10-13 08:41:51,578 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24482.99999999981
2025-10-13 08:41:51,579 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1154.4999999998254
2025-10-13 08:41:51,580 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7600.0
2025-10-13 08:41:51,581 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:51,581 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6828.9999999997235}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24482.99999999981}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1154.4999999998254}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7600.0}]
2025-10-13 08:41:51,582 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:51,590 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:51,597 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:51,600 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:51,609 - APP.services.mt5_service - DEBUG - Position in day range: 0.5610297615900954
2025-10-13 08:41:51,610 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:51+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:51,611 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:51+07:00
2025-10-13 08:41:51,612 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:51+07:00 trong DST: True
2025-10-13 08:41:51,614 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:51,615 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:51,615 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:51,616 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,616 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:51,617 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6000', 'price': 24704.6, 'distance_pips': 0.0}, {'level': '6025', 'price': 24704.6, 'distance_pips': 0.25}, {'level': '6050', 'price': 24704.61, 'distance_pips': 0.5}, {'level': '6075', 'price': 24704.61, 'distance_pips': 0.75}]
2025-10-13 08:41:51,617 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:51,617 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,618 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:51,618 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:51,619 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.6
2025-10-13 08:41:51,619 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:51,620 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:51,621 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:51,621 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:51,622 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:51,622 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.6
2025-10-13 08:41:51,623 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:51,623 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:51,624 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:51,624 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:51,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:51,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.6
2025-10-13 08:41:51,626 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:51,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:51,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:51,628 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:51,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:51,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.6
2025-10-13 08:41:51,629 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:51,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:51,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:51,630 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:51,631 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,631 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:51,632 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:51,632 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:51,632 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:51,633 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:51,633 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:51,634 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:51,634 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:51,635 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:51,635 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:51,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:51,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:51,636 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:51,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:51,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:51,637 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:51,637 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:51,637 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,638 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:51,638 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:51,638 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:51,639 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:51,639 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:51,640 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:51,641 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:51,653 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,654 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:51,655 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:51,670 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.6, 'ask': 24704.6, 'last': 0.0, 'time': 1760344911}
2025-10-13 08:41:51,681 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:51,682 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:51,683 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:51,683 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:51,684 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,684 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:51,684 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,685 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:51,686 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:51,686 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:51,686 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.6
2025-10-13 08:41:51,687 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6828.9999999997235}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24482.99999999981}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1154.4999999998254}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7600.0}]
2025-10-13 08:41:51,687 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:51,689 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.91s
2025-10-13 08:41:51,734 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:51,741 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:51,742 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.95, 'free_margin': 110.45, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:51,743 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.6, 'profit': -0.11, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.6, 'profit': -0.11, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:51,744 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:51,780 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:51,805 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:51,807 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:51,809 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:51,811 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:51,812 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:51,812 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:51,813 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:51,823 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:51,824 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:51,824 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:51,825 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:51,825 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:51,826 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:51,826 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:51,827 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:51,845 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:52,328 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:52,330 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:52,330 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:52,331 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:52,331 - APP.services.mt5_service - DEBUG - Current price (cp): 24704.93
2025-10-13 08:41:52,335 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:52,393 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:52,394 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:52,396 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:52,399 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:52,429 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:52,432 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:52,433 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:52,438 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:52,438 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:52,439 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:52,439 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:52,441 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:52,442 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:52,442 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:52,443 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:52,445 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:52,445 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:52,446 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:52,446 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:52,449 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:52,449 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:52,450 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:52,450 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:52,451 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:52+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:52,451 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:52+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:52,452 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:52+07:00
2025-10-13 08:41:52,452 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:52+07:00 trong DST: True
2025-10-13 08:41:52,452 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:52,453 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:52,453 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:52,454 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:52,455 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64174576258
2025-10-13 08:41:52,456 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:52,457 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64174576258
2025-10-13 08:41:52,465 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.64174576258, 'asia': 24728.64174576258, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:52,491 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:52,494 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.592734815513
2025-10-13 08:41:52,495 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:52,495 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.369262382406
2025-10-13 08:41:52,496 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:52,496 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.78204689768
2025-10-13 08:41:52,497 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:52,498 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.266018974522
2025-10-13 08:41:52,498 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:52,498 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.96231395623
2025-10-13 08:41:52,499 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:52,499 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.065249713884
2025-10-13 08:41:52,500 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:52,500 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.93987216908
2025-10-13 08:41:52,501 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:52,501 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.623037188936
2025-10-13 08:41:52,502 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.592734815513, 'ema200': 24711.369262382406}, 'M5': {'ema50': 24697.78204689768, 'ema200': 24620.266018974522}, 'M15': {'ema50': 24677.96231395623, 'ema200': 24881.065249713884}, 'H1': {'ema50': 24846.93987216908, 'ema200': 24939.623037188936}}
2025-10-13 08:41:52,502 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:52,503 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.446223546179016, TRs count: 179
2025-10-13 08:41:52,504 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:52,505 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.026403932899337, TRs count: 119
2025-10-13 08:41:52,505 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:52,505 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:52,506 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:52,506 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:52,506 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.446223546179016, 'M1': 8.026403932899337, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:52,507 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:52,507 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.93, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:52,507 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:52,508 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:52,508 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:52,509 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:52,509 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6861.999999999898
2025-10-13 08:41:52,509 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24515.999999999985
2025-10-13 08:41:52,510 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1187.5
2025-10-13 08:41:52,510 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7633.000000000175
2025-10-13 08:41:52,511 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:52,511 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6861.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24515.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1187.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7633.000000000175}]
2025-10-13 08:41:52,511 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:52,512 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:52,513 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:52,513 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:52,514 - APP.services.mt5_service - DEBUG - Position in day range: 0.5627742242427451
2025-10-13 08:41:52,514 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:52+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:52,514 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:52+07:00
2025-10-13 08:41:52,515 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:52+07:00 trong DST: True
2025-10-13 08:41:52,515 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:52,515 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:52,516 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:52,516 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,516 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:52,517 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9300', 'price': 24704.93, 'distance_pips': 0.0}, {'level': '9325', 'price': 24704.93, 'distance_pips': 0.25}, {'level': '9350', 'price': 24704.94, 'distance_pips': 0.5}, {'level': '9375', 'price': 24704.94, 'distance_pips': 0.75}]
2025-10-13 08:41:52,517 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:52,518 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,520 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:52,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:52,554 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.93
2025-10-13 08:41:52,556 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:52,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:52,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:52,560 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:52,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:52,561 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.93
2025-10-13 08:41:52,561 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:52,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:52,563 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:52,563 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:52,563 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:52,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.93
2025-10-13 08:41:52,566 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:52,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:52,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:52,567 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:52,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:52,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.93
2025-10-13 08:41:52,569 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:52,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:52,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:52,570 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:52,570 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,571 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:52,571 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:52,572 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:52,572 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:52,573 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:52,573 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:52,574 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:52,574 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:52,574 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:52,575 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:52,575 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:52,576 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:52,577 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:52,577 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:52,577 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:52,578 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:52,578 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:52,579 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,582 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:52,582 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:52,615 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:52,617 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:52,623 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:52,627 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:52,629 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:52,632 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,633 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:52,633 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.93, 'ask': 24704.93, 'last': 0.0, 'time': 1760344912}
2025-10-13 08:41:52,634 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:52,634 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:52,636 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:52,637 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:52,638 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:52,638 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,638 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:52,639 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,639 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:52,640 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:52,640 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:52,641 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.93
2025-10-13 08:41:52,641 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6861.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24515.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1187.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7633.000000000175}]
2025-10-13 08:41:52,641 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:52,644 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-13 08:41:52,693 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:52,694 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:52,694 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 115.19, 'free_margin': 110.69, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:52,695 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.93, 'profit': -0.11, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.93, 'profit': -0.12, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:52,696 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:52,810 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:52,811 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:52,812 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:52,814 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:52,815 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:52,816 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:52,817 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:52,818 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:41:52,826 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:52,826 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:52,827 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:52,827 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:52,828 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:52,828 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:52,829 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:52,830 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:52,900 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:53,332 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:53,334 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:53,335 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:53,336 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:53,336 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.41
2025-10-13 08:41:53,340 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:53,389 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 295, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:53,390 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:53,390 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:53,393 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:53,393 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:53,394 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:53,395 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:53,404 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:53,424 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:53,425 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:53,426 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:53,429 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:53,430 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:53,430 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:53,431 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:53,433 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:53,433 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:53,434 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:53,434 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:53,437 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:53,438 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:53,438 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:53,439 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:53,439 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:52+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:53,440 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:52+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:53,440 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:52+07:00
2025-10-13 08:41:53,440 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:52+07:00 trong DST: True
2025-10-13 08:41:53,441 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:53,441 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:53,441 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:53,443 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:53,443 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64106701399
2025-10-13 08:41:53,445 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:53,445 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64106701399
2025-10-13 08:41:53,447 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.64106701399, 'asia': 24728.64106701399, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:53,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:53,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.611558344925
2025-10-13 08:41:53,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:53,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.37403850181
2025-10-13 08:41:53,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:53,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.80087042709
2025-10-13 08:41:53,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:53,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.270795093926
2025-10-13 08:41:53,451 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:53,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981137485644
2025-10-13 08:41:53,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:53,452 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070025833287
2025-10-13 08:41:53,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:53,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.958695698493
2025-10-13 08:41:53,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:53,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.62781330834
2025-10-13 08:41:53,454 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.611558344925, 'ema200': 24711.37403850181}, 'M5': {'ema50': 24697.80087042709, 'ema200': 24620.270795093926}, 'M15': {'ema50': 24677.981137485644, 'ema200': 24881.070025833287}, 'H1': {'ema50': 24846.958695698493, 'ema200': 24939.62781330834}}
2025-10-13 08:41:53,454 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:53,456 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.4805092604647, TRs count: 179
2025-10-13 08:41:53,456 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:53,457 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.06068964718502, TRs count: 119
2025-10-13 08:41:53,458 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:53,491 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:53,492 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:53,493 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:53,495 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.4805092604647, 'M1': 8.06068964718502, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:53,496 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:53,496 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.41, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:53,497 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:53,497 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:53,498 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:53,499 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:53,499 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6909.9999999998545
2025-10-13 08:41:53,499 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24563.99999999994
2025-10-13 08:41:53,500 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1235.4999999999563
2025-10-13 08:41:53,501 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7681.000000000131
2025-10-13 08:41:53,502 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:53,502 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6909.9999999998545}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24563.99999999994}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1235.4999999999563}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7681.000000000131}]
2025-10-13 08:41:53,503 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:53,503 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:53,504 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:53,504 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:53,505 - APP.services.mt5_service - DEBUG - Position in day range: 0.5653116244647655
2025-10-13 08:41:53,505 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:52+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:53,506 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:52+07:00
2025-10-13 08:41:53,506 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:52+07:00 trong DST: True
2025-10-13 08:41:53,506 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:53,507 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:53,507 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:53,508 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,508 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:53,508 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4100', 'price': 24705.41, 'distance_pips': 0.0}, {'level': '4125', 'price': 24705.41, 'distance_pips': 0.25}, {'level': '4150', 'price': 24705.42, 'distance_pips': 0.5}, {'level': '4175', 'price': 24705.42, 'distance_pips': 0.75}]
2025-10-13 08:41:53,509 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:53,509 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,510 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:53,510 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:53,511 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.41
2025-10-13 08:41:53,511 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:53,511 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:53,512 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:53,513 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:53,513 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:53,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.41
2025-10-13 08:41:53,514 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:53,515 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:53,515 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:53,516 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:53,516 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:53,518 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.41
2025-10-13 08:41:53,519 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:53,519 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:53,520 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:53,521 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:53,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:53,526 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.41
2025-10-13 08:41:53,559 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:53,561 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:53,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:53,565 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:53,566 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,566 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:53,566 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:53,567 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:53,567 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:53,567 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:53,568 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:53,568 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:53,569 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:53,570 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:53,570 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:53,571 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:53,571 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:53,572 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:53,572 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:53,572 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:53,573 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:53,573 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:53,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:53,575 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:53,575 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:53,575 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:53,575 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:53,576 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:53,577 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:53,580 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,582 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:53,582 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:53,589 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.41, 'ask': 24705.41, 'last': 0.0, 'time': 1760344912}
2025-10-13 08:41:53,618 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:53,620 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:53,621 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:53,622 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:53,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:53,624 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,625 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:53,625 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:53,625 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:53,626 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.41
2025-10-13 08:41:53,626 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6909.9999999998545}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24563.99999999994}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1235.4999999999563}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7681.000000000131}]
2025-10-13 08:41:53,627 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:53,630 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-13 08:41:53,665 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:53,678 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:53,679 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.95, 'free_margin': 110.45, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:53,680 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.41, 'profit': -0.12, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.41, 'profit': -0.13, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:53,682 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:53,814 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:53,815 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:53,817 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:53,819 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:53,820 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:53,822 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:53,822 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:53,823 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:53,848 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:53,860 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:53,861 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:53,861 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:53,862 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:53,864 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:53,864 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:53,865 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:53,883 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:54,366 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:54,368 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:54,369 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:54,369 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:54,369 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.22
2025-10-13 08:41:54,373 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:54,421 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:54,421 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:54,422 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:54,424 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:54,425 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:54,425 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:54,426 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:54,435 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:54,454 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:54,456 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:54,457 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:54,458 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:54,459 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:54,460 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:54,460 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:54,463 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:54,463 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:54,464 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:54,465 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:54,468 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:54,468 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:54,469 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:54,469 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:54,470 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:54+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:54,470 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:54+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:54,471 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:54+07:00
2025-10-13 08:41:54,471 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:54+07:00 trong DST: True
2025-10-13 08:41:54,472 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:54,472 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:54,472 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:54,473 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:54,474 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.639423188768
2025-10-13 08:41:54,475 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:54,475 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.639423188768
2025-10-13 08:41:54,478 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.639423188768, 'asia': 24728.639423188768, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:54,478 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:54,479 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.604107364532
2025-10-13 08:41:54,479 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:54,480 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.372147954546
2025-10-13 08:41:54,480 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:54,480 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.793419446698
2025-10-13 08:41:54,481 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:54,481 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.26890454666
2025-10-13 08:41:54,482 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:54,482 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.97368650525
2025-10-13 08:41:54,482 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:54,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.068135286023
2025-10-13 08:41:54,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:54,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.9512447181
2025-10-13 08:41:54,484 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:54,484 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.625922761075
2025-10-13 08:41:54,484 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.604107364532, 'ema200': 24711.372147954546}, 'M5': {'ema50': 24697.793419446698, 'ema200': 24620.26890454666}, 'M15': {'ema50': 24677.97368650525, 'ema200': 24881.068135286023}, 'H1': {'ema50': 24846.9512447181, 'ema200': 24939.625922761075}}
2025-10-13 08:41:54,485 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:54,486 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.4805092604647, TRs count: 179
2025-10-13 08:41:54,486 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:54,487 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.06068964718502, TRs count: 119
2025-10-13 08:41:54,487 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:54,487 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:54,488 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:54,488 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:54,489 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.4805092604647, 'M1': 8.06068964718502, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:54,490 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:54,521 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.22, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:54,523 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:54,524 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:54,525 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:54,525 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:54,526 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6890.999999999985
2025-10-13 08:41:54,527 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24545.000000000073
2025-10-13 08:41:54,527 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1216.5000000000873
2025-10-13 08:41:54,528 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7662.000000000262
2025-10-13 08:41:54,528 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:54,528 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6890.999999999985}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24545.000000000073}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1216.5000000000873}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7662.000000000262}]
2025-10-13 08:41:54,529 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:54,530 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:54,530 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:54,531 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:54,531 - APP.services.mt5_service - DEBUG - Position in day range: 0.5643072368768884
2025-10-13 08:41:54,531 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:54+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:54,532 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:54+07:00
2025-10-13 08:41:54,533 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:54+07:00 trong DST: True
2025-10-13 08:41:54,533 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:54,534 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:54,534 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:54,534 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,535 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:54,535 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2200', 'price': 24705.22, 'distance_pips': 0.0}, {'level': '2225', 'price': 24705.22, 'distance_pips': 0.25}, {'level': '2250', 'price': 24705.23, 'distance_pips': 0.5}, {'level': '2275', 'price': 24705.23, 'distance_pips': 0.75}]
2025-10-13 08:41:54,536 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:54,536 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,537 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:54,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:54,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.22
2025-10-13 08:41:54,538 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:54,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:54,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:54,541 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:54,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:54,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.22
2025-10-13 08:41:54,542 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:54,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:54,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:54,543 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:54,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:54,545 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.22
2025-10-13 08:41:54,545 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:54,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:54,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:54,548 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:54,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:54,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.22
2025-10-13 08:41:54,553 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:54,588 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:54,592 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:54,593 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:54,594 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,595 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:54,596 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:54,596 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:54,597 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:54,597 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:54,597 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:54,599 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:54,600 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:54,601 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:54,601 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:54,602 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:54,602 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:54,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:54,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:54,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:54,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:54,604 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:54,606 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,606 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:54,607 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:54,607 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:54,607 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:54,608 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:54,609 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:54,610 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:54,615 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,631 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:54,631 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:54,652 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.22, 'ask': 24705.22, 'last': 0.0, 'time': 1760344914}
2025-10-13 08:41:54,656 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:54,656 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:54,657 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:54,657 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:54,658 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,658 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:54,658 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,659 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:54,659 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:54,659 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:54,660 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.22
2025-10-13 08:41:54,660 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6890.999999999985}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24545.000000000073}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1216.5000000000873}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7662.000000000262}]
2025-10-13 08:41:54,661 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:54,663 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-13 08:41:54,724 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:54,725 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:54,726 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.94, 'free_margin': 110.44, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:54,727 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.22, 'profit': -0.12, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.22, 'profit': -0.12, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:54,727 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:54,820 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:54,832 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:54,834 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:54,836 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:54,840 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:54,841 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:54,842 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:54,843 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:54,852 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:54,853 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:54,853 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:54,854 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:54,854 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:54,855 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:54,855 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:54,856 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:54,939 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:55,357 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:55,358 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:55,359 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:55,359 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:55,360 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.93
2025-10-13 08:41:55,367 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:55,423 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 295, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:55,424 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:55,425 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:55,428 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:55,429 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:55,429 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:55,454 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:55,460 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:55,461 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:55,462 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:55,462 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:55,464 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:55,465 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:55,466 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:55,466 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:55,468 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:55,469 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:55,469 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:55,470 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:55,472 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:55,473 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:55,473 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:55,474 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:55,474 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:55+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:55,474 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:55+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:55,475 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:55+07:00
2025-10-13 08:41:55,475 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:55+07:00 trong DST: True
2025-10-13 08:41:55,475 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:55,476 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:55,476 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:55,477 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:55,477 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.636581746723
2025-10-13 08:41:55,479 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:55,480 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.636581746723
2025-10-13 08:41:55,482 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.636581746723, 'asia': 24728.636581746723, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:55,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:55,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.63195050179
2025-10-13 08:41:55,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:55,484 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.379212631164
2025-10-13 08:41:55,484 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:55,485 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.821262583955
2025-10-13 08:41:55,485 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:55,487 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27596922328
2025-10-13 08:41:55,487 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:55,488 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.001529642508
2025-10-13 08:41:55,488 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:55,488 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.07519996264
2025-10-13 08:41:55,495 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:55,521 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.979087855358
2025-10-13 08:41:55,522 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:55,523 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.632987437693
2025-10-13 08:41:55,523 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.63195050179, 'ema200': 24711.379212631164}, 'M5': {'ema50': 24697.821262583955, 'ema200': 24620.27596922328}, 'M15': {'ema50': 24678.001529642508, 'ema200': 24881.07519996264}, 'H1': {'ema50': 24846.979087855358, 'ema200': 24939.632987437693}}
2025-10-13 08:41:55,523 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:55,524 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:41:55,525 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:55,528 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.13140393289942, TRs count: 119
2025-10-13 08:41:55,528 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:55,529 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:55,529 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:55,530 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:55,531 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 8.13140393289942, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:55,531 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:55,532 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.93, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:55,532 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:55,533 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:55,533 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:55,534 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:55,534 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6961.999999999898
2025-10-13 08:41:55,535 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24615.999999999985
2025-10-13 08:41:55,535 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1287.5
2025-10-13 08:41:55,535 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7733.000000000175
2025-10-13 08:41:55,536 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:55,536 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6961.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24615.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1287.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7733.000000000175}]
2025-10-13 08:41:55,536 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:55,537 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:55,538 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:55,538 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:55,538 - APP.services.mt5_service - DEBUG - Position in day range: 0.5680604747052922
2025-10-13 08:41:55,539 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:55+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:55,539 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:55+07:00
2025-10-13 08:41:55,539 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:55+07:00 trong DST: True
2025-10-13 08:41:55,540 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:55,540 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:55,541 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:55,541 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,541 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:55,542 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9300', 'price': 24705.93, 'distance_pips': 0.0}, {'level': '9325', 'price': 24705.93, 'distance_pips': 0.25}, {'level': '9350', 'price': 24705.94, 'distance_pips': 0.5}, {'level': '9375', 'price': 24705.94, 'distance_pips': 0.75}]
2025-10-13 08:41:55,542 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:55,543 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,543 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:55,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:55,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.93
2025-10-13 08:41:55,544 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:55,545 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:55,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:55,546 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:55,547 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:55,547 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.93
2025-10-13 08:41:55,548 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:55,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:55,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:55,551 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:55,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:55,589 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.93
2025-10-13 08:41:55,592 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:55,593 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:55,594 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:55,595 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:55,595 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:55,596 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.93
2025-10-13 08:41:55,597 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:55,597 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:55,598 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:55,599 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:55,599 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,600 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:55,601 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:55,601 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:55,602 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:55,602 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:55,602 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:55,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:55,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:55,604 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:55,604 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:55,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:55,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:55,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:55,606 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:55,607 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:55,607 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:55,608 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:55,608 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:55,609 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:55,609 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:55,610 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:55,610 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:55,611 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:55,619 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:55,653 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:55,653 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:55,659 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,662 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:55,665 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.93, 'ask': 24705.93, 'last': 0.0, 'time': 1760344915}
2025-10-13 08:41:55,665 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:55,666 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:55,667 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:55,667 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,668 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:55,668 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,668 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:55,669 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:55,669 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:55,670 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.93
2025-10-13 08:41:55,670 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6961.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24615.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1287.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7733.000000000175}]
2025-10-13 08:41:55,671 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:55,676 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-13 08:41:55,818 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:55,819 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:55,820 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.91, 'free_margin': 110.41, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:55,821 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.93, 'profit': -0.13, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.93, 'profit': -0.14, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:55,821 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:55,838 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:55,867 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:55,869 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:55,872 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:55,875 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:55,878 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:55,879 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:55,880 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:55,946 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:56,193 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:56,194 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:56,195 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:56,196 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:56,196 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:56,197 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:56,197 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:56,198 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:56,699 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:56,701 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:56,702 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:56,703 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:56,703 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.69
2025-10-13 08:41:56,710 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:56,771 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 295, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:56,772 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:56,773 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:56,776 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:56,776 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:56,777 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:56,778 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:56,810 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:56,812 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:56,813 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:56,813 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:56,815 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:56,816 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:56,817 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:56,818 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:56,821 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:56,821 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:56,821 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:56,821 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:56,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:56,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:56,825 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:56,825 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:56,826 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:56+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:56,826 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:56+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:56,827 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:56+07:00
2025-10-13 08:41:56,827 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:56+07:00 trong DST: True
2025-10-13 08:41:56,828 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:56,828 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:56,828 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:56,830 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:56,830 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.633595028132
2025-10-13 08:41:56,833 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:56,833 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.633595028132
2025-10-13 08:41:56,843 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.633595028132, 'asia': 24728.633595028132, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:56,864 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:56,865 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.622538737083
2025-10-13 08:41:56,866 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:56,867 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.37682457146
2025-10-13 08:41:56,868 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:56,869 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.81185081925
2025-10-13 08:41:56,870 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:56,870 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:56,872 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:56,872 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.273581163576
2025-10-13 08:41:56,873 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:56,873 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:56,875 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:56,876 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.992117877802
2025-10-13 08:41:56,876 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:56,877 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:56,877 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:56,878 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.072811902937
2025-10-13 08:41:56,879 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:56,879 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.96967609065
2025-10-13 08:41:56,879 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:56,880 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.63059937799
2025-10-13 08:41:56,880 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.622538737083, 'ema200': 24711.37682457146}, 'M5': {'ema50': 24697.81185081925, 'ema200': 24620.273581163576}, 'M15': {'ema50': 24677.992117877802, 'ema200': 24881.072811902937}, 'H1': {'ema50': 24846.96967609065, 'ema200': 24939.63059937799}}
2025-10-13 08:41:56,880 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:56,881 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:41:56,881 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:56,882 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.13140393289942, TRs count: 119
2025-10-13 08:41:56,882 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:56,883 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:56,883 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:56,883 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:56,884 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 8.13140393289942, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:56,884 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:56,884 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.69, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:56,885 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:56,885 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:56,885 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:56,886 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:56,887 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6937.999999999738
2025-10-13 08:41:56,888 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24591.999999999825
2025-10-13 08:41:56,888 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1263.49999999984
2025-10-13 08:41:56,889 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7709.000000000015
2025-10-13 08:41:56,889 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:56,889 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6937.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24591.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1263.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7709.000000000015}]
2025-10-13 08:41:56,890 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:56,890 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:56,891 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:56,891 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:56,892 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:56,946 - APP.services.mt5_service - DEBUG - Position in day range: 0.5667917745942724
2025-10-13 08:41:56,984 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:56+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:57,062 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:56+07:00
2025-10-13 08:41:57,076 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:56+07:00 trong DST: True
2025-10-13 08:41:57,077 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:57,079 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:57,083 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:57,115 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,117 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:57,121 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6900', 'price': 24705.69, 'distance_pips': 0.0}, {'level': '6925', 'price': 24705.69, 'distance_pips': 0.25}, {'level': '6950', 'price': 24705.7, 'distance_pips': 0.5}, {'level': '6975', 'price': 24705.7, 'distance_pips': 0.75}]
2025-10-13 08:41:57,122 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:57,125 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,125 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:57,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:57,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.69
2025-10-13 08:41:57,192 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:57,194 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:57,195 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:57,196 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:57,197 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:57,199 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.69
2025-10-13 08:41:57,199 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:57,200 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:57,202 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:57,202 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:57,205 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:57,205 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.69
2025-10-13 08:41:57,207 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:57,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:57,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:57,260 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:57,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:57,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.69
2025-10-13 08:41:57,263 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:57,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:57,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:57,266 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:57,267 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,267 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:57,268 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:57,269 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:57,270 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:57,336 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:57,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:57,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:57,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:57,389 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:57,390 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:57,390 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:57,390 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:57,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:57,391 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:57,392 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:57,394 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:57,395 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:57,397 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,399 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:57,400 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:57,432 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:57,437 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:57,439 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:57,442 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:57,445 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:57,448 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:57,448 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:57,450 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,452 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:57,453 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.69, 'ask': 24705.69, 'last': 0.0, 'time': 1760344916}
2025-10-13 08:41:57,453 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:57,454 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:57,457 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:57,457 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,458 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:57,498 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,498 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:57,499 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:57,499 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:57,500 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.69
2025-10-13 08:41:57,501 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6937.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24591.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1263.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7709.000000000015}]
2025-10-13 08:41:57,501 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:57,502 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.64s
2025-10-13 08:41:57,575 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:57,593 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:57,594 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.96, 'free_margin': 110.46, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:57,596 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.69, 'profit': -0.13, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.69, 'profit': -0.13, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:57,597 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:57,873 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:57,873 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:57,875 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:57,877 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:57,878 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:57,879 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:57,880 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:57,881 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:57,899 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:58,166 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:58,167 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:58,168 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:58,168 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:41:58,169 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:41:58,170 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:41:58,170 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:41:58,171 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:41:58,651 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:41:58,651 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:41:58,672 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:41:58,674 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:41:58,675 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.02s
2025-10-13 08:41:58,676 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:41:58,677 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:41:58,677 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.74
2025-10-13 08:41:58,683 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:41:58,730 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 295, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:41:58,731 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:41:58,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:58,734 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:41:58,734 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:58,734 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:41:58,735 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:41:58,738 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:41:58,739 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:58,739 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:41:58,740 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:41:58,747 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:41:58,764 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:41:58,766 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:58,767 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:41:58,772 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:41:58,805 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:41:58,806 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:58,807 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:41:58,807 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:41:58,840 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:58,873 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:41:58,874 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:41:58,875 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:41:58,876 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:41:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:41:58,877 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:58,877 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:58+07:00
2025-10-13 08:41:58,878 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:58+07:00 trong DST: True
2025-10-13 08:41:58,878 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:58,879 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:58,881 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:58,882 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:58,883 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:58,883 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:41:58,884 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:58,886 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:58,886 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:58,887 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.63183279296
2025-10-13 08:41:58,887 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:58,889 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:41:58,890 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.63183279296
2025-10-13 08:41:58,892 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.63183279296, 'asia': 24728.63183279296, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:41:58,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:58,894 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.624499521397
2025-10-13 08:41:58,895 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:58,895 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.3773220839
2025-10-13 08:41:58,896 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:41:58,896 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.813811603562
2025-10-13 08:41:58,928 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:41:58,928 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.274078676015
2025-10-13 08:41:58,929 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:41:58,929 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.994078662115
2025-10-13 08:41:58,930 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:41:58,930 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.073309415377
2025-10-13 08:41:58,931 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:41:58,931 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.971636874965
2025-10-13 08:41:58,932 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:41:58,932 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.63109689043
2025-10-13 08:41:58,933 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.624499521397, 'ema200': 24711.3773220839}, 'M5': {'ema50': 24697.813811603562, 'ema200': 24620.274078676015}, 'M15': {'ema50': 24677.994078662115, 'ema200': 24881.073309415377}, 'H1': {'ema50': 24846.971636874965, 'ema200': 24939.63109689043}}
2025-10-13 08:41:58,934 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:41:58,935 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:41:58,935 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:58,936 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.13140393289942, TRs count: 119
2025-10-13 08:41:58,936 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:41:58,936 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:41:58,937 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:41:58,937 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:41:58,938 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 8.13140393289942, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:41:58,938 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:41:58,938 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.74, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:41:58,939 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:41:58,940 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:41:58,940 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:41:58,940 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:41:58,941 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6943.000000000029
2025-10-13 08:41:58,941 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24597.000000000116
2025-10-13 08:41:58,942 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1268.500000000131
2025-10-13 08:41:58,942 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7714.000000000306
2025-10-13 08:41:58,942 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:41:58,943 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6943.000000000029}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24597.000000000116}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1268.500000000131}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7714.000000000306}]
2025-10-13 08:41:58,943 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:41:58,943 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:41:58,944 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:41:58,944 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:41:58,945 - APP.services.mt5_service - DEBUG - Position in day range: 0.5670560871174152
2025-10-13 08:41:58,945 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:41:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:41:58,946 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:41:58+07:00
2025-10-13 08:41:58,946 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:41:58+07:00 trong DST: True
2025-10-13 08:41:58,946 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:41:58,947 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:41:58,947 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:41:58,947 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:58,948 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:58,948 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7400', 'price': 24705.74, 'distance_pips': 0.0}, {'level': '7425', 'price': 24705.74, 'distance_pips': 0.25}, {'level': '7450', 'price': 24705.75, 'distance_pips': 0.5}, {'level': '7475', 'price': 24705.75, 'distance_pips': 0.75}]
2025-10-13 08:41:58,949 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:41:58,949 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:58,949 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:58,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:58,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.74
2025-10-13 08:41:58,951 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:58,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:58,952 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:58,952 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:41:58,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:41:58,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.74
2025-10-13 08:41:58,954 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:58,954 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:41:58,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:58,956 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:41:58,956 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:41:58,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.74
2025-10-13 08:41:58,958 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:58,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:41:58,959 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:58,972 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:58,995 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:41:59,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:41:59,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.74
2025-10-13 08:41:59,213 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:41:59,239 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:41:59,338 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:41:59,416 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:41:59,495 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:59,497 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:59,497 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:59,498 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:59,499 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:59,499 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:59,500 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:59,500 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:59,500 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:59,501 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:59,502 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:41:59,503 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:41:59,503 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:41:59,504 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:41:59,504 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:41:59,504 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:41:59,505 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:41:59,505 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:41:59,506 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:59,506 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:59,507 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:41:59,507 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:41:59,507 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:41:59,508 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:41:59,509 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:59,510 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:41:59,513 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:59,515 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:41:59,515 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:41:59,515 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.74, 'ask': 24705.74, 'last': 0.0, 'time': 1760344918}
2025-10-13 08:41:59,517 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:41:59,518 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:41:59,518 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:41:59,518 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:41:59,519 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:59,519 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:59,520 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:59,520 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:41:59,520 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:41:59,524 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:59,525 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.74
2025-10-13 08:41:59,615 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6943.000000000029}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24597.000000000116}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1268.500000000131}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7714.000000000306}]
2025-10-13 08:41:59,670 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:41:59,678 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.80s
2025-10-13 08:41:59,695 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:41:59,696 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:41:59,696 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.16, 'free_margin': 109.66, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:41:59,697 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.74, 'profit': -0.13, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.74, 'profit': -0.13, 'comment': 'AI Trade TP2'}]
2025-10-13 08:41:59,698 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:41:59,881 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:59,882 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:41:59,883 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:41:59,885 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:41:59,886 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:41:59,888 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:41:59,888 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:41:59,889 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:41:59,899 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:00,161 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,162 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:00,164 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,165 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,165 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:00,166 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,166 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:00,167 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:00,668 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:00,669 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:00,670 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:00,671 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:00,671 - APP.services.mt5_service - DEBUG - Current price (cp): 24704.98
2025-10-13 08:42:00,675 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:00,728 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:00,731 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:00,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:00,734 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:00,735 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:00,735 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:00,736 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:00,740 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:00,741 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:00,747 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-13 08:42:00,766 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:00,767 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.autorun.guard' vào nhóm 'ui.autorun' (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-13 08:42:00,767 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:00,768 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.autorun.guard vào group ui.autorun (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-13 08:42:00,768 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-13 08:42:00,771 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:00,802 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-13 08:42:00,802 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:00,803 - APP.utils.threading_utils - DEBUG - Task 'ui.autorun.guard' (group=ui.autorun) hoàn tất sau 0.03s
2025-10-13 08:42:00,804 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:00,806 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:00,808 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:00,808 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:00,809 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:00,809 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:00,813 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:00,814 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:00,814 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:00,815 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:00,815 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:00+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:00,816 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:00+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:00,816 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:00+07:00
2025-10-13 08:42:00,816 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:00+07:00 trong DST: True
2025-10-13 08:42:00,817 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:00,817 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:00,817 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:00,819 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:00,819 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.74676388548
2025-10-13 08:42:00,821 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:00,821 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.74676388548
2025-10-13 08:42:00,824 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.74676388548, 'asia': 24728.74676388548, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:00,824 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:00,825 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.030574188488
2025-10-13 08:42:00,825 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:00,826 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.791235825607
2025-10-13 08:42:00,826 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:00,826 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.788713564347
2025-10-13 08:42:00,827 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:00,827 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.26771051681
2025-10-13 08:42:00,828 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:00,828 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.9689806229
2025-10-13 08:42:00,829 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:00,829 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.066941256173
2025-10-13 08:42:00,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:00,832 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.94653883575
2025-10-13 08:42:00,832 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:00,833 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.624728731225
2025-10-13 08:42:00,861 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.030574188488, 'ema200': 24711.791235825607}, 'M5': {'ema50': 24697.788713564347, 'ema200': 24620.26771051681}, 'M15': {'ema50': 24677.9689806229, 'ema200': 24881.066941256173}, 'H1': {'ema50': 24846.94653883575, 'ema200': 24939.624728731225}}
2025-10-13 08:42:00,865 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:00,867 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:00,867 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:00,868 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:00,869 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:00,869 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:00,870 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:00,870 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:00,871 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:00,872 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:00,872 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.98, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:00,873 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:00,873 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:00,873 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:00,873 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:00,874 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6866.999999999825
2025-10-13 08:42:00,874 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24520.999999999913
2025-10-13 08:42:00,874 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1192.4999999999272
2025-10-13 08:42:00,875 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7638.000000000102
2025-10-13 08:42:00,875 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:00,876 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6866.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24520.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1192.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7638.000000000102}]
2025-10-13 08:42:00,876 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:00,877 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:00,877 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:00,878 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:00,878 - APP.services.mt5_service - DEBUG - Position in day range: 0.5630385367658687
2025-10-13 08:42:00,879 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:00+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:00,879 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:00+07:00
2025-10-13 08:42:00,879 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:00+07:00 trong DST: True
2025-10-13 08:42:00,880 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _request_autorun_start
2025-10-13 08:42:00,880 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:00,880 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:00,881 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:00,882 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,882 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:00,883 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:00,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:00,884 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,884 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:00,885 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:00,885 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9800', 'price': 24704.98, 'distance_pips': 0.0}, {'level': '9825', 'price': 24704.98, 'distance_pips': 0.25}, {'level': '9850', 'price': 24704.99, 'distance_pips': 0.5}, {'level': '9875', 'price': 24704.99, 'distance_pips': 0.75}]
2025-10-13 08:42:00,886 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:00,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:00,887 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:00,887 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,887 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:00,888 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:00,889 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.98
2025-10-13 08:42:00,890 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:00,890 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:00,891 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-13 08:42:00,891 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:00,891 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-13 08:42:00,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:00,893 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-13 08:42:00,896 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:00,902 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251013-084200' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251013-084200', 'priority': 'autorun'})
2025-10-13 08:42:00,927 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-13 08:42:00,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:00,930 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251013-084200 (priority=autorun)
2025-10-13 08:42:00,930 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-13 08:42:00,933 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-13 08:42:00,934 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-13 08:42:00,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.98
2025-10-13 08:42:00,935 - APP.ui.app_ui - INFO - Autorun autorun-20251013-084200 bắt đầu ngay lập tức.
2025-10-13 08:42:00,936 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-13 08:42:00,937 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-13 08:42:00,939 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:00,941 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:42:00,941 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:00,942 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-13 08:42:00,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:00,944 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-13 08:42:00,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:00,949 - APP.ui.app_ui - INFO - Phiên autorun-20251013-084200 bắt đầu (priority=autorun, source=autorun).
2025-10-13 08:42:00,950 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:00,951 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-13 08:42:00,951 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:00,952 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:00,953 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-13 08:42:00,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.98
2025-10-13 08:42:00,958 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (TaskGroup analysis.upload).
2025-10-13 08:42:00,995 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:01,001 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-13 08:42:01,002 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:01,003 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-13 08:42:01,003 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:01,005 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-13 15:42:01.005033+07:00 với timezone Asia/Ho_Chi_Minh
2025-10-13 08:42:01,006 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:01.005033+07:00, Target TZ: None
2025-10-13 08:42:01,008 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:01,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:01,076 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 8 mục.
2025-10-13 08:42:01,077 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:01.005033+07:00
2025-10-13 08:42:01,078 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:01,080 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:01,106 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251013-084200.0' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251013-084200', 'index': 0})
2025-10-13 08:42:01,120 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251013-084200.1' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251013-084200', 'index': 1})
2025-10-13 08:42:01,128 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.17s
2025-10-13 08:42:01,130 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:01,131 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:01.005033+07:00 trong DST: True
2025-10-13 08:42:01,132 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251013-084200.2' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251013-084200', 'index': 2})
2025-10-13 08:42:01,133 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-13 08:42:01,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:01,135 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:01,136 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:01,137 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-13 08:42:01,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.98
2025-10-13 08:42:01,139 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251013-084200.3' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251013-084200', 'index': 3})
2025-10-13 08:42:01,139 - APP.services.mt5_service - DEBUG - Đang trong killzone london
2025-10-13 08:42:01,140 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.20s
2025-10-13 08:42:01,155 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:01,158 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_H1.png: 29330:1760344920:53f87f91c8a51c1a
2025-10-13 08:42:01,190 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_M1.png: 36267:1760344920:b3ce176e66cc9bbe
2025-10-13 08:42:01,195 - APP.core.trading.conditions - DEBUG - Điều kiện NO-RUN được thỏa mãn. Lý do: Đang chạy trong london.
2025-10-13 08:42:01,197 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:01,261 - APP.analysis.image_processor - DEBUG - Cache hit cho USTEC_H1.png, nhưng chữ ký không khớp.
2025-10-13 08:42:01,309 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_M15.png: 27935:1760344921:50e244545215721a
2025-10-13 08:42:01,309 - APP.analysis.image_processor - DEBUG - Cache hit cho USTEC_M1.png, nhưng chữ ký không khớp.
2025-10-13 08:42:01,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:01,415 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: USTEC_H1.png, Tối ưu hóa: False
2025-10-13 08:42:01,419 - APP.analysis.image_processor - DEBUG - Cache hit cho USTEC_M15.png, nhưng chữ ký không khớp.
2025-10-13 08:42:01,422 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: USTEC_M1.png, Tối ưu hóa: False
2025-10-13 08:42:01,454 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:01,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:01,463 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-13 08:42:01,465 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: USTEC_M15.png, Tối ưu hóa: False
2025-10-13 08:42:01,467 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-13 08:42:01,472 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:01,473 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:01,474 - APP.analysis.image_processor - INFO - Đang tải 'USTEC_H1.png' lên Gemini File API...
2025-10-13 08:42:01,480 - APP.analysis.context_builder - DEBUG - Bắt đầu xây dựng ngữ cảnh lịch sử với budget: 2000 chars.
2025-10-13 08:42:01,553 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-13 08:42:01,566 - APP.analysis.image_processor - INFO - Đang tải 'USTEC_M1.png' lên Gemini File API...
2025-10-13 08:42:01,668 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:01,754 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:01,759 - APP.analysis.context_builder - DEBUG - Parsing last 20 context files from: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\Reports
2025-10-13 08:42:01,764 - APP.analysis.image_processor - INFO - Đang tải 'USTEC_M15.png' lên Gemini File API...
2025-10-13 08:42:01,764 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:02,100 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:02,103 - APP.analysis.context_builder - WARNING - Thư mục báo cáo không tồn tại: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\Reports
2025-10-13 08:42:02,294 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:42:02,296 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:02,400 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:02,501 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:02,502 - APP.analysis.context_builder - DEBUG - Bắt đầu tóm tắt xu hướng checklist từ 0 items.
2025-10-13 08:42:02,739 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:02,742 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:42:02,861 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:02,926 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-13 08:42:02,940 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:02,974 - APP.analysis.context_builder - DEBUG - Không có items, trả về trend 'unknown'.
2025-10-13 08:42:03,045 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:03,157 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:03,354 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-13 08:42:03,378 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 4 tên file.
2025-10-13 08:42:03,413 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:03,512 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-13 08:42:03,519 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:03,706 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_H1.png
2025-10-13 08:42:03,834 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:04,371 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:04,430 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'H1' cho 'USTEC_H1.png' bằng pattern đã biên dịch.
2025-10-13 08:42:04,499 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:04,506 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_M1.png
2025-10-13 08:42:04,510 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:04,511 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:04,511 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:04,521 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M1' cho 'USTEC_M1.png' bằng pattern đã biên dịch.
2025-10-13 08:42:04,594 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:42:04,637 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:04,638 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:04,647 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_M15.png
2025-10-13 08:42:04,648 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M15' cho 'USTEC_M15.png' bằng pattern đã biên dịch.
2025-10-13 08:42:04,649 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_M5.png
2025-10-13 08:42:04,650 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:04,650 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.54
2025-10-13 08:42:04,695 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:04,719 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M5' cho 'USTEC_M5.png' bằng pattern đã biên dịch.
2025-10-13 08:42:04,736 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:04,873 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {'USTEC_H1.png': 'H1', 'USTEC_M1.png': 'M1', 'USTEC_M15.png': 'M15', 'USTEC_M5.png': 'M5'}
2025-10-13 08:42:04,883 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:04,906 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:42:04,946 - APP.analysis.context_builder - DEBUG - Ngữ cảnh lịch sử có kích thước 602 chars (trong budget).
2025-10-13 08:42:04,949 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:04,951 - APP.utils.threading_utils - DEBUG - Task song song 'build_historical_context_async' hoàn tất thành công.
2025-10-13 08:42:04,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:04,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:04,954 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:04,955 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:04,955 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:05,014 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 293, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:05,026 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:05,026 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:05,027 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:05,028 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:05,028 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:05,033 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:05,035 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:05,036 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:05,037 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:05,038 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:05,040 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:05,041 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:05,045 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:05,049 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:05,053 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:05,053 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:05,108 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:05,168 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:05,171 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:05,177 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.98, 'ask': 24704.98, 'last': 0.0, 'time': 1760344920}
2025-10-13 08:42:05,178 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:05,179 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:05,180 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:05,181 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:05,182 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:05,185 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:05,188 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:05,189 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:05,190 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:05,191 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:05,192 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:05,195 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:05,197 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:05,198 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:05,199 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:05,200 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:05,205 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:05,207 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:05,256 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/rea0bnt5oew1. Đang chờ trạng thái ACTIVE.
2025-10-13 08:42:05,263 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:05,343 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:05,359 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:05,361 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.98
2025-10-13 08:42:05,414 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:05,598 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6866.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24520.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1192.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7638.000000000102}]
2025-10-13 08:42:05,605 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:05,606 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:02+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:05,609 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:05,609 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:02+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:05,672 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 5.79s
2025-10-13 08:42:05,674 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:02+07:00
2025-10-13 08:42:05,760 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:05,796 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:05,797 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:02+07:00 trong DST: True
2025-10-13 08:42:05,840 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:05,842 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_M5.png: 31954:1760344920:2cc5ef1564d10c80
2025-10-13 08:42:05,847 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:05,850 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:05,853 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.55, 'free_margin': 110.05, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:05,856 - APP.analysis.image_processor - DEBUG - Cache hit cho USTEC_M5.png, nhưng chữ ký không khớp.
2025-10-13 08:42:05,858 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:05,858 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:05,860 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: USTEC_M5.png, Tối ưu hóa: False
2025-10-13 08:42:05,860 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.98, 'profit': -0.11, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.98, 'profit': -0.12, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:05,861 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:05,861 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:05,862 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-13 08:42:05,913 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:05,917 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.12s
2025-10-13 08:42:05,919 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:05,920 - APP.analysis.image_processor - INFO - Đang tải 'USTEC_M5.png' lên Gemini File API...
2025-10-13 08:42:05,921 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:05,922 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:05,997 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:06,003 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:06,008 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:06,011 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:06,012 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:06,013 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:06,015 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:06,016 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:06,041 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/g8ehg57rpzq3. Đang chờ trạng thái ACTIVE.
2025-10-13 08:42:06,085 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'USTEC_M1.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-13 08:42:06,099 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:06,104 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'USTEC_M1.png'.
2025-10-13 08:42:06,107 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:06,108 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_M1.png: 36267:1760344920:b3ce176e66cc9bbe
2025-10-13 08:42:06,110 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:06,111 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật USTEC_M1.png trong cache với tên từ xa files/rea0bnt5oew1.
2025-10-13 08:42:06,115 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251013-084200.1' (group=analysis.upload) hoàn tất sau 4.97s
2025-10-13 08:42:06,171 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:06,211 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:06,221 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:06,241 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:06,291 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:06,304 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:42:06,353 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:06,467 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:06,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:06,485 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:06,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:06,670 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:06,673 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/ubsegxfdbx5v. Đang chờ trạng thái ACTIVE.
2025-10-13 08:42:06,674 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:06,678 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:06,723 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:06,793 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:42:06,794 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:06,795 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'USTEC_H1.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-13 08:42:06,796 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:06,796 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:06,797 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'USTEC_H1.png'.
2025-10-13 08:42:06,798 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:06,799 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:06,906 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:06,913 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_H1.png: 29330:1760344920:53f87f91c8a51c1a
2025-10-13 08:42:06,922 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:06,997 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:07,002 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật USTEC_H1.png trong cache với tên từ xa files/g8ehg57rpzq3.
2025-10-13 08:42:07,003 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:07,004 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:07,005 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251013-084200.0' (group=analysis.upload) hoàn tất sau 5.87s
2025-10-13 08:42:07,005 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:07,007 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:07,009 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:07,010 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:07,011 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:07,012 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:07,013 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.54, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:07,014 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:07,016 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:07,016 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:07,016 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:07,017 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:07,018 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:07,022 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:07,073 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:07,075 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:07,144 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.14s
2025-10-13 08:42:07,147 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:07,148 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:07,152 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:07,200 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-13 08:42:07,247 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:07,255 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6922.999999999956
2025-10-13 08:42:07,259 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:07,262 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24577.000000000044
2025-10-13 08:42:07,262 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1248.5000000000582
2025-10-13 08:42:07,263 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7694.000000000233
2025-10-13 08:42:07,263 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:07,264 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6922.999999999956}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24577.000000000044}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1248.5000000000582}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7694.000000000233}]
2025-10-13 08:42:07,265 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:07,358 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'USTEC_M15.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-13 08:42:07,361 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:07,386 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'USTEC_M15.png'.
2025-10-13 08:42:07,523 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_M15.png: 27935:1760344921:50e244545215721a
2025-10-13 08:42:07,532 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật USTEC_M15.png trong cache với tên từ xa files/ubsegxfdbx5v.
2025-10-13 08:42:07,622 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251013-084200.2' (group=analysis.upload) hoàn tất sau 6.43s
2025-10-13 08:42:07,772 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:07,782 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:07,787 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:07,790 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:07,853 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:07,854 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:07,866 - APP.services.mt5_service - DEBUG - Current price (cp): 24706.21
2025-10-13 08:42:07,919 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:07,925 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:07,926 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:08,037 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:08,048 - APP.services.mt5_service - DEBUG - Position in day range: 0.565998837024902
2025-10-13 08:42:08,049 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:08,069 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:02+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:08,116 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:08,118 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:08,122 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:02+07:00
2025-10-13 08:42:08,123 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:08,124 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:08,125 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:02+07:00 trong DST: True
2025-10-13 08:42:08,125 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:08,128 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:08,129 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:08,132 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:08,133 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:08,135 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-13 08:42:08,136 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:08,136 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:08,137 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:08,138 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:08,138 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:08,138 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:08,143 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:08,150 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:08,196 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:42:08,207 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:08,209 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:08,267 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5400', 'price': 24705.54, 'distance_pips': 0.0}, {'level': '5425', 'price': 24705.54, 'distance_pips': 0.25}, {'level': '5450', 'price': 24705.55, 'distance_pips': 0.5}, {'level': '5475', 'price': 24705.55, 'distance_pips': 0.75}]
2025-10-13 08:42:08,324 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:08,376 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:08,386 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:08,403 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:08,435 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:08,449 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:08,493 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:08,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:08,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:08,504 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.54
2025-10-13 08:42:08,508 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:08,519 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:42:08,554 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:08,558 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:08,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:08,571 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:08,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:08,576 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:08,577 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:08,578 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:08,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:08,757 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:08,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.54
2025-10-13 08:42:09,040 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:09,119 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:09,171 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:09,180 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:09,183 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:09,184 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:09,185 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:09,186 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:09,187 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:09,187 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:07+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:09,189 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:09,189 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:09,190 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:07+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:09,191 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:09,191 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:09,192 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:07+07:00
2025-10-13 08:42:09,193 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:09,193 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.54
2025-10-13 08:42:09,194 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:07+07:00 trong DST: True
2025-10-13 08:42:09,195 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:09,196 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:09,197 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:09,197 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:09,198 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:09,198 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:09,199 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:09,201 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:09,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:09,203 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:09,204 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.54
2025-10-13 08:42:09,205 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:09,206 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:09,284 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:09,385 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:09,433 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/eywu0r8p3mjm. Đang chờ trạng thái ACTIVE.
2025-10-13 08:42:09,439 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:09,457 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:09,516 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:09,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:09,577 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:09,645 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:09,649 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:09,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:09,700 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:09,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:09,755 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:09,760 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:09,764 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:09,766 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:09,766 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:09,767 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:09,772 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:09,805 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:42:09,815 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:09,822 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:09,827 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:09,872 - APP.services.fmp_service - INFO - Lấy thành công 476 sự kiện từ investpy cho 7 ngày tới.
2025-10-13 08:42:09,881 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:09,882 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:09,887 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 8.95s
2025-10-13 08:42:09,890 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:09,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:09,923 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:09,930 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:09,951 - APP.ui.app_ui - DEBUG - Callback nhận được 156 sự kiện tin tức mới.
2025-10-13 08:42:09,951 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:09,952 - APP.services.news_service - INFO - NewsService làm mới cache (156 sự kiện, priority=autorun, source=network, latency=9.04s)
2025-10-13 08:42:09,952 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:09,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:09,954 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 9.05s
2025-10-13 08:42:09,954 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:09,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:09,956 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:09,959 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:09,992 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:09,993 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:09,993 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:09,994 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:09,995 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:09,996 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:09,997 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:09,999 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:09,999 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,000 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,002 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:10,003 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:10,004 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:10,005 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:10,006 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:10,007 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:10,007 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:10,008 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:10,008 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:10,009 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:10,010 - APP.utils.threading_utils - DEBUG - Task song song 'get_market_data_async' hoàn tất thành công.
2025-10-13 08:42:10,010 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:42:10,011 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:10,016 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:10,017 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:10,018 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-13 08:42:10,021 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24706.21, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:10,021 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-13 08:42:10,034 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,051 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:10,055 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-13 08:42:10,056 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:10,057 - APP.utils.safe_data - DEBUG - Get top-level key 'symbol': USTEC
2025-10-13 08:42:10,058 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:10,058 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:10,059 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:10,060 - APP.utils.safe_data - DEBUG - Get top-level key 'volatility_regime': trending
2025-10-13 08:42:10,060 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6989.999999999782
2025-10-13 08:42:10,061 - APP.utils.safe_data - DEBUG - Get top-level key 'ict_patterns': {'liquidity_h1': {'swing_highs_BSL': [{'price': 25220.61, 'bar_index': -16}, {'price': 25217.02, 'bar_index': 21}, {'price': 25195.66, 'bar_index': -9}, {'price': 25185.95, 'bar_index': 10}, {'price': 25184.71, 'bar_index': 14}], 'swing_lows_SSL': [{'price': 24019.21, 'bar_index': 28}, {'price': 24601.99, 'bar_index': 34}, {'price': 24808.88, 'bar_index': -46}, {'price': 24813.47, 'bar_index': -43}, {'price': 24852.33, 'bar_index': -32}]}, 'fvgs_h1': [{'type': 'Bullish', 'top': 24697.72, 'bottom': 24692.45}, {'type': 'Bearish', 'top': 24995.64, 'bottom': 24912.58}], 'order_blocks_h1': [{'type': 'Bullish', 'top': 24594.83, 'bottom': 24459.77, 'bar_index': 109}, {'type': 'Bearish', 'top': 25217.02, 'bottom': 25124.34, 'bar_index': 101}], 'liquidity_voids_h1': [{'type': 'Bearish', 'top': 24750.15, 'bottom': 24697.72, 'bar_index': 89}, {'type': 'Bullish', 'top': 24660.65, 'bottom': 24612.23, 'bar_index': 85}, {'type': 'Bearish', 'top': 24693.37, 'bottom': 24644.22, 'bar_index': 83}], 'premium_discount_h1': {'high': 25217.02, 'low': 24601.99, 'equilibrium': 24909.505, 'status': 'Discount'}, 'mss_h1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 24601.99, 'break_bar_index': 104}, 'liquidity_m15': {'swing_highs_BSL': [{'price': 25217.02, 'bar_index': -80}, {'price': 25186.06, 'bar_index': -76}, {'price': 25172.65, 'bar_index': -100}, {'price': 25164.97, 'bar_index': -87}, {'price': 24787.64, 'bar_index': -13}], 'swing_lows_SSL': [{'price': 24019.21, 'bar_index': -52}, {'price': 24219.07, 'bar_index': -56}, {'price': 24432.27, 'bar_index': -67}, {'price': 24495.35, 'bar_index': -47}, {'price': 24500.81, 'bar_index': -73}]}, 'fvgs_m15': [{'type': 'Bullish', 'top': 24656.84, 'bottom': 24653.64}, {'type': 'Bearish', 'top': 24754.05, 'bottom': 24750.15}], 'order_blocks_m15': [{'type': 'Bullish', 'top': 24257.97, 'bottom': 24019.21, 'bar_index': 48}, {'type': 'Bearish', 'top': 25177.31, 'bottom': 25145.07, 'bar_index': 23}], 'liquidity_voids_m15': [{'type': 'Bearish', 'top': 24750.15, 'bottom': 24722.46, 'bar_index': 39}, {'type': 'Bullish', 'top': 24653.64, 'bottom': 24634.22, 'bar_index': 32}, {'type': 'Bullish', 'top': 24660.65, 'bottom': 24636.81, 'bar_index': 26}], 'premium_discount_m15': {'high': 24787.64, 'low': 24495.35, 'equilibrium': 24641.495, 'status': 'Premium'}, 'mss_m15': None, 'liquidity_m5': {'swing_highs_BSL': [{'price': 24787.64, 'bar_index': 145}, {'price': 24750.15, 'bar_index': 152}, {'price': 24738.37, 'bar_index': 155}, {'price': 24696.4, 'bar_index': 73}, {'price': 24693.46, 'bar_index': 78}], 'swing_lows_SSL': [{'price': 24019.21, 'bar_index': 30}, {'price': 24219.07, 'bar_index': 19}, {'price': 24280.49, 'bar_index': 15}, {'price': 24403.83, 'bar_index': 6}, {'price': 24432.27, 'bar_index': -15}]}, 'fvgs_m5': [{'type': 'Bullish', 'top': 24675.24, 'bottom': 24673.38}, {'type': 'Bearish', 'top': 24754.05, 'bottom': 24749.68}], 'order_blocks_m5': [{'type': 'Bullish', 'top': 24708.49, 'bottom': 24673.46, 'bar_index': 159}, {'type': 'Bearish', 'top': 24748.41, 'bottom': 24729.48, 'bar_index': 171}], 'liquidity_voids_m5': [{'type': 'Bearish', 'top': 24722.15, 'bottom': 24698.89, 'bar_index': 178}, {'type': 'Bearish', 'top': 24756.18, 'bottom': 24743.15, 'bar_index': 168}, {'type': 'Bullish', 'top': 24740.01, 'bottom': 24713.05, 'bar_index': 161}], 'premium_discount_m5': {'high': 24738.37, 'low': 24019.21, 'equilibrium': 24378.79, 'status': 'Premium'}, 'mss_m5': {'type': 'Bullish', 'event': 'CHoCH', 'price_level': 24738.37, 'break_bar_index': 162}, 'liquidity_m1': {'swing_highs_BSL': [{'price': 24787.64, 'bar_index': -32}, {'price': 24780.62, 'bar_index': -28}, {'price': 24771.08, 'bar_index': -22}, {'price': 24750.15, 'bar_index': 2}, {'price': 24749.12, 'bar_index': -44}], 'swing_lows_SSL': [{'price': 24656.84, 'bar_index': -77}, {'price': 24673.46, 'bar_index': -59}, {'price': 24675.24, 'bar_index': -68}, {'price': 24697.72, 'bar_index': 37}, {'price': 24697.75, 'bar_index': 26}]}, 'fvgs_m1': [{'type': 'Bullish', 'top': 24704.89, 'bottom': 24703.7}, {'type': 'Bearish', 'top': 24712.09, 'bottom': 24707.35}], 'order_blocks_m1': [{'type': 'Bullish', 'top': 24703.7, 'bottom': 24697.72, 'bar_index': 117}, {'type': 'Bearish', 'top': 24748.41, 'bottom': 24740.83, 'bar_index': 81}], 'liquidity_voids_m1': [{'type': 'Bullish', 'top': 24706.4, 'bottom': 24697.75, 'bar_index': 88}, {'type': 'Bearish', 'top': 24712.02, 'bottom': 24702.6, 'bar_index': 83}, {'type': 'Bearish', 'top': 24722.15, 'bottom': 24712.09, 'bar_index': 82}], 'premium_discount_m1': {'high': 24750.15, 'low': 24697.72, 'equilibrium': 24723.935, 'status': 'Discount'}, 'mss_m1': {'type': 'Bearish', 'event': 'BOS', 'price_level': 24697.72, 'break_bar_index': 3}}
2025-10-13 08:42:10,062 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24643.99999999987
2025-10-13 08:42:10,063 - APP.utils.safe_data - DEBUG - Get top-level key 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_13/10/2025_10:00_CPI (MoM)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 0, tzinfo=<UTC>), 'title': 'CPI (MoM)  (Sep)', 'country': 'serbia', 'impact': 'low', 'source': 'investpy', 'actual': None, 'forecast': 0.1, 'previous': 0.2, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 17m'}, {'id': 'investpy_13/10/2025_10:00_CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 0, tzinfo=<UTC>), 'title': 'CPI (YoY)  (Sep)', 'country': 'serbia', 'impact': 'low', 'source': 'investpy', 'actual': None, 'forecast': None, 'previous': 4.7, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 17m'}, {'id': 'investpy_13/10/2025_10:30_CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 30, tzinfo=<UTC>), 'title': 'CPI (YoY)  (Sep)', 'country': 'india', 'impact': 'medium', 'source': 'investpy', 'actual': None, 'forecast': 1.7, 'previous': 2.07, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 47m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 13, 8, 42, 0, 909185, tzinfo=<UTC>), 'latency_sec': 9.040935500059277}
2025-10-13 08:42:10,064 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1315.4999999998836
2025-10-13 08:42:10,064 - APP.utils.safe_data - DEBUG - Get top-level key 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_13/10/2025_10:00_CPI (MoM)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 0, tzinfo=<UTC>), 'title': 'CPI (MoM)  (Sep)', 'country': 'serbia', 'impact': 'low', 'source': 'investpy', 'actual': None, 'forecast': 0.1, 'previous': 0.2, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 17m'}, {'id': 'investpy_13/10/2025_10:00_CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 0, tzinfo=<UTC>), 'title': 'CPI (YoY)  (Sep)', 'country': 'serbia', 'impact': 'low', 'source': 'investpy', 'actual': None, 'forecast': None, 'previous': 4.7, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 17m'}, {'id': 'investpy_13/10/2025_10:30_CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 30, tzinfo=<UTC>), 'title': 'CPI (YoY)  (Sep)', 'country': 'india', 'impact': 'medium', 'source': 'investpy', 'actual': None, 'forecast': 1.7, 'previous': 2.07, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 47m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 13, 8, 42, 0, 909185, tzinfo=<UTC>), 'latency_sec': 9.040935500059277}
2025-10-13 08:42:10,065 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7761.000000000058
2025-10-13 08:42:10,065 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-13 08:42:10,066 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:10,066 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-13 08:42:10,067 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6989.999999999782}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24643.99999999987}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1315.4999999998836}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7761.000000000058}]
2025-10-13 08:42:10,068 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:10,069 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:10,072 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,073 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:10,073 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.54, 'ask': 24705.54, 'last': 0.0, 'time': 1760344922}
2025-10-13 08:42:10,074 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:10,074 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:10,075 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:10,076 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:10,077 - APP.services.mt5_service - DEBUG - Position in day range: 0.5695406248347992
2025-10-13 08:42:10,077 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:07+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:10,078 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,078 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:07+07:00
2025-10-13 08:42:10,079 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,079 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:07+07:00 trong DST: True
2025-10-13 08:42:10,080 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,080 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:10,081 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,139 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:10,145 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,145 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:10,146 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:10,148 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.54
2025-10-13 08:42:10,150 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,156 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6922.999999999956}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24577.000000000044}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1248.5000000000582}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7694.000000000233}]
2025-10-13 08:42:10,158 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,178 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_2_logic' hoàn tất thành công.
2025-10-13 08:42:10,179 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,182 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2100', 'price': 24706.21, 'distance_pips': 0.0}, {'level': '2125', 'price': 24706.21, 'distance_pips': 0.25}, {'level': '2150', 'price': 24706.22, 'distance_pips': 0.5}, {'level': '2175', 'price': 24706.22, 'distance_pips': 0.75}]
2025-10-13 08:42:10,183 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:10,184 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,184 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:10,185 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,186 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'USTEC_M5.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-13 08:42:10,188 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:10,188 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:10,189 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'USTEC_M5.png'.
2025-10-13 08:42:10,190 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:10,191 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24706.21
2025-10-13 08:42:10,193 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:10,194 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:10,194 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:10,194 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho USTEC_M5.png: 31954:1760344920:2cc5ef1564d10c80
2025-10-13 08:42:10,195 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:10,196 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:10,197 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật USTEC_M5.png trong cache với tên từ xa files/eywu0r8p3mjm.
2025-10-13 08:42:10,198 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:10,198 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251013-084200.3' (group=analysis.upload) hoàn tất sau 4.46s
2025-10-13 08:42:10,199 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:10,199 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 8 mục.
2025-10-13 08:42:10,199 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:10,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24706.21
2025-10-13 08:42:10,202 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:10,202 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-13 08:42:10,202 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:10,203 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_3_logic' hoàn tất thành công.
2025-10-13 08:42:10,204 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:10,204 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:10,205 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:10,206 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24706.21
2025-10-13 08:42:10,206 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:10,207 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 4: Gọi Model AI
2025-10-13 08:42:10,209 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:10,211 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:10,228 - APP.ui.components.prompt_manager - DEBUG - Đang lấy nội dung prompts từ UI.
2025-10-13 08:42:10,248 - APP.ui.components.prompt_manager - DEBUG - Đang lấy nội dung prompts từ UI.
2025-10-13 08:42:10,250 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:10,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:10,257 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.23, 'profit': -0.12, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.23, 'profit': -0.12, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:10,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24706.21
2025-10-13 08:42:10,259 - APP.analysis.prompt_builder - DEBUG - Có vị thế đang mở, chọn prompt 'no_entry' (đã được cập nhật để quản lý lệnh).
2025-10-13 08:42:10,260 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:10,261 - APP.analysis.prompt_builder - DEBUG - Bắt đầu xây dựng prompt cuối cùng.
2025-10-13 08:42:10,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:10,263 - APP.analysis.prompt_builder - DEBUG - Đã xây dựng xong prompt cuối cùng.
2025-10-13 08:42:10,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:10,264 - APP.core.analysis_worker - DEBUG - --- PROMPT FINAL GỬI ĐẾN AI ---
VAI TRÒ & BỐI CẢNH
- Bạn là một nhà giao dịch ICT chuyên nghiệp và một nhà quản lý rủi ro.
- Nhiệm vụ của bạn là phân tích thị trường theo phương pháp Top-Down VÀ quản lý các lệnh đang mở một cách hiệu quả.
- Bạn phải suy luận logic, dựa trên bằng chứng từ dữ liệu thị trường.

---
### NHIỆM VỤ 1: XÁC ĐỊNH BỐI CẢNH VÀ HÀNH ĐỘNG CẦN THIẾT

**DỰA VÀO `CONTEXT.HAS_ACTIVE_POSITIONS`, HÃY CHỌN MỘT TRONG HAI LUỒNG SAU:**

---
#### LUỒNG A: CHƯA CÓ LỆNH (HAS_ACTIVE_POSITIONS = false)

**A1. QUY TRÌNH PHÂN TÍCH TOP-DOWN 4 BƯỚC**
   - Thực hiện phân tích Top-Down (H1 -> M15 -> M5) để tìm kiếm cơ hội giao dịch chất lượng cao.
   - **Bằng chứng**: Luôn trích dẫn dữ liệu cụ thể từ `EXTRACT_JSON` và `CONCEPT_VALUE_TABLE`.
   - **Kết quả**: Xây dựng một "câu chuyện thị trường", xếp hạng setup (`A+`, `B`, `C`), và lập kế hoạch giao dịch chi tiết nếu phù hợp.

**A2. TẠO ĐỐI TƯỢNG JSON - ĐÁNH GIÁ SETUP**
   - Tổng hợp kết quả phân tích vào đối tượng JSON sau. **Đây phải là phần đầu tiên trong phản hồi của bạn.**
   ```json
   {
     "cycle": "[ĐIỀN THỜI GIAN HIỆN TẠI]",
     "symbol": "[LẤY TỪ DỮ LIỆU]",
     "mode": "expert_setup_evaluation",
     "market_narrative": "[CÂU CHUYỆN THỊ TRƯỜNG TỪ BƯỚC A1]",
     "setup_grade": "[A+/B/C/Không có]",
     "reasoning_summary": "[GIẢI THÍCH NGẮN GỌN VÌ SAO XẾP HẠNG SETUP NHƯ VẬY]",
     "top_down_analysis": {
       "h1_context": { "order_flow": "[...]", "draw_on_liquidity": "[...]" },
       "m15_poi": { "type": "[...]", "price_zone": "[...]", "quality_assessment": "[...]" },
       "m5_m1_confirmation": { "status": "[...]", "signal": "[...]" }
     },
     "proposed_plan": {
       "direction": "[long/short hoặc null]",
       "entry": "[Giá hoặc 0.0]",
       "sl": "[Giá hoặc 0.0]",
       "tp1": "[Giá hoặc 0.0]",
       "tp2": "[Giá hoặc 0.0]",
       "risk_multiplier": "[1.0 cho A+, 0.5 cho B, 0.0 cho các trường hợp khác]"
     }
   }
   ```

---
#### LUỒNG B: ĐANG CÓ LỆNH (HAS_ACTIVE_POSITIONS = true)

**B1. PHÂN TÍCH BỐI CẢNH ĐỂ QUẢN LÝ LỆNH**
   - **Đánh giá lại Draw on Liquidity (H1)**: Mục tiêu giá ban đầu còn hợp lệ không? Có mục tiêu nào mới xuất hiện không?
   - **Phân tích cấu trúc M5/M1**: Cấu trúc thị trường gần nhất (`EXTRACT_JSON.tf.M5.mss_bos`) đang ủng hộ hay chống lại lệnh hiện tại?
   - **Tìm kiếm các vùng cản/hỗ trợ mới**: Có FVG hoặc Order Block nào mới hình thành có thể ảnh hưởng đến lệnh không?

**B2. TẠO ĐỐI TƯỢNG JSON - KẾ HOẠCH QUẢN LÝ**
   - Dựa trên phân tích ở B1, hãy tạo kế hoạch quản lý cho TỪNG lệnh đang mở.
   - **Đây phải là phần đầu tiên trong phản hồi của bạn.**
   ```json
   {
     "cycle": "[ĐIỀN THỜI GIAN HIỆN TẠI]",
     "symbol": "[LẤY TỪ DỮ LIỆU]",
     "mode": "trade_management",
     "market_narrative": "[TÓM TẮT BỐI CẢNH THỊ TRƯỜNG HIỆN TẠI ẢNH HƯỞNG ĐẾN LỆNH]",
     "reasoning_summary": "[GIẢI THÍCH NGẮN GỌN CHO CÁC HÀNH ĐỘNG QUẢN LÝ]",
     "management_plan": {
       "[TICKET_LỆNH_1]": {
         "action": "[HOLD/CLOSE_PARTIAL/MOVE_SL_TO_ENTRY/TRAIL_SL]",
         "percentage": "[50 nếu CLOSE_PARTIAL, ngược lại 0]",
         "sl": "[Giá SL mới, 'entry', 'last_swing_low_m5', 'last_swing_high_m5' hoặc null nếu không đổi]",
         "tp": "[Giá TP mới hoặc null nếu không đổi]",
         "reason": "[Lý do ngắn gọn cho hành động này]"
       },
       "[TICKET_LỆNH_2]": {
         "...": "..."
       },
       "ALL": {
         "action": "[HOLD/CLOSE_ALL]",
         "reason": "[Áp dụng nếu muốn thực hiện hành động cho tất cả lệnh]"
       }
     }
   }
   ```

---
### NHIỆM VỤ 2: VIẾT BÁO CÁO PHÂN TÍCH CHI TIẾT

Dựa vào đối tượng JSON bạn vừa tạo (từ Luồng A hoặc B), hãy viết một báo cáo chuyên nghiệp.

A) **TÓM TẮT NHANH (7 DÒNG):**
   - **(Luồng A)**: Trình bày tóm tắt về cơ hội giao dịch như prompt cũ.
   - **(Luồng B)**: Trình bày tóm tắt về các hành động quản lý được đề xuất cho mỗi lệnh.

B) **PHÂN TÍCH CHUYÊN SÂU:**
   - Diễn giải chi tiết về `market_narrative`.
   - Giải thích lý do đằng sau `setup_grade` (Luồng A) hoặc các quyết định trong `management_plan` (Luồng B), luôn sử dụng bằng chứng từ dữ liệu.

---
**Dữ liệu thị trường và tài khoản (MT5):**
```json
{'symbol': 'USTEC', 'generated_at': '2025-10-13 15:42:09', 'broker_time': '2025-10-13T15:42:02+07:00', 'timezone': 'Asia/Ho_Chi_Minh', 'account': {'balance': 116.06, 'equity': 114.63, 'free_margin': 110.13, 'currency': 'USD', 'leverage': 2000}, 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.23, 'profit': -0.12, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.23, 'profit': -0.12, 'comment': 'AI Trade TP2'}], 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}, 'symbol_rules': {'volume_min': 0.01, 'volume_max': 500.0, 'volume_step': 0.01, 'trade_tick_value': 0.01, 'trade_tick_size': 0.01, 'stop_level_points': 0, 'freeze_level_points': 0, 'margin_initial': 0.0, 'margin_maintenance': 0.0}, 'pip': {'points_per_pip': 1, 'value_per_point': 0.01, 'pip_value_per_lot': 0.01}, 'tick': {'bid': 24705.54, 'ask': 24705.54, 'last': 0.0, 'time': 1760344922}, 'tick_stats_5m': {'ticks_per_min': 236, 'median_spread': 0.0, 'p90_spread': 0}, 'tick_stats_30m': {'ticks_per_min': 293, 'median_spread': 0, 'p90_spread': 0}, 'levels': {'daily': {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, 'prev_day': {'high': 24636.31, 'low': 24459.77}, 'weekly': {'open': 24628.6, 'high': 24787.64, 'low': 24598.47}, 'prev_week': {'high': 25220.61, 'low': 24019.21}, 'monthly': {'open': 24641.49, 'high': 25220.61, 'low': 24019.21}}, 'day_open': 24628.6, 'prev_day_close': 24628.62, 'adr': {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}, 'day_range': 189.16999999999825, 'day_range_pct_of_adr20': 68.49617635131156, 'position_in_day_range': 0.565998837024902, 'sessions_today': {'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, 'session_liquidity': {'asia_high': 24787.64, 'asia_low': 24627.22}, 'volatility': {'ATR': {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}}, 'volatility_regime': 'trending', 'trend_refs': {'EMA': {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}}, 'vwap': {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}, 'kills': {'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, 'is_silver_bullet_window': False, 'killzone_active': 'london', 'mins_to_next_killzone': None, 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6922.999999999956}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24577.000000000044}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1248.5000000000582}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7694.000000000233}], 'round_levels': [{'level': '5400', 'price': 24705.54, 'distance_pips': 0.0}, {'level': '5425', 'price': 24705.54, 'distance_pips': 0.25}, {'level': '5450', 'price': 24705.55, 'distance_pips': 0.5}, {'level': '5475', 'price': 24705.55, 'distance_pips': 0.75}], 'atr_norm': {'spread_as_pct_of_atr_m5': None}, 'ict_patterns': {'liquidity_h1': {'swing_highs_BSL': [{'price': 25220.61, 'bar_index': -16}, {'price': 25217.02, 'bar_index': 21}, {'price': 25195.66, 'bar_index': -9}, {'price': 25185.95, 'bar_index': 10}, {'price': 25184.71, 'bar_index': 14}], 'swing_lows_SSL': [{'price': 24019.21, 'bar_index': 28}, {'price': 24601.99, 'bar_index': 34}, {'price': 24808.88, 'bar_index': -46}, {'price': 24813.47, 'bar_index': -43}, {'price': 24852.33, 'bar_index': -32}]}, 'fvgs_h1': [{'type': 'Bullish', 'top': 24697.72, 'bottom': 24692.45}, {'type': 'Bearish', 'top': 24995.64, 'bottom': 24912.58}], 'order_blocks_h1': [{'type': 'Bullish', 'top': 24594.83, 'bottom': 24459.77, 'bar_index': 109}, {'type': 'Bearish', 'top': 25217.02, 'bottom': 25124.34, 'bar_index': 101}], 'liquidity_voids_h1': [{'type': 'Bearish', 'top': 24750.15, 'bottom': 24697.72, 'bar_index': 89}, {'type': 'Bullish', 'top': 24660.65, 'bottom': 24612.23, 'bar_index': 85}, {'type': 'Bearish', 'top': 24693.37, 'bottom': 24644.22, 'bar_index': 83}], 'premium_discount_h1': {'high': 25217.02, 'low': 24601.99, 'equilibrium': 24909.505, 'status': 'Discount'}, 'mss_h1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 24601.99, 'break_bar_index': 104}, 'liquidity_m15': {'swing_highs_BSL': [{'price': 25217.02, 'bar_index': -80}, {'price': 25186.06, 'bar_index': -76}, {'price': 25172.65, 'bar_index': -100}, {'price': 25164.97, 'bar_index': -87}, {'price': 24787.64, 'bar_index': -13}], 'swing_lows_SSL': [{'price': 24019.21, 'bar_index': -52}, {'price': 24219.07, 'bar_index': -56}, {'price': 24432.27, 'bar_index': -67}, {'price': 24495.35, 'bar_index': -47}, {'price': 24500.81, 'bar_index': -73}]}, 'fvgs_m15': [{'type': 'Bullish', 'top': 24656.84, 'bottom': 24653.64}, {'type': 'Bearish', 'top': 24754.05, 'bottom': 24750.15}], 'order_blocks_m15': [{'type': 'Bullish', 'top': 24257.97, 'bottom': 24019.21, 'bar_index': 48}, {'type': 'Bearish', 'top': 25177.31, 'bottom': 25145.07, 'bar_index': 23}], 'liquidity_voids_m15': [{'type': 'Bearish', 'top': 24750.15, 'bottom': 24722.46, 'bar_index': 39}, {'type': 'Bullish', 'top': 24653.64, 'bottom': 24634.22, 'bar_index': 32}, {'type': 'Bullish', 'top': 24660.65, 'bottom': 24636.81, 'bar_index': 26}], 'premium_discount_m15': {'high': 24787.64, 'low': 24495.35, 'equilibrium': 24641.495, 'status': 'Premium'}, 'mss_m15': None, 'liquidity_m5': {'swing_highs_BSL': [{'price': 24787.64, 'bar_index': 145}, {'price': 24750.15, 'bar_index': 152}, {'price': 24738.37, 'bar_index': 155}, {'price': 24696.4, 'bar_index': 73}, {'price': 24693.46, 'bar_index': 78}], 'swing_lows_SSL': [{'price': 24019.21, 'bar_index': 30}, {'price': 24219.07, 'bar_index': 19}, {'price': 24280.49, 'bar_index': 15}, {'price': 24403.83, 'bar_index': 6}, {'price': 24432.27, 'bar_index': -15}]}, 'fvgs_m5': [{'type': 'Bullish', 'top': 24675.24, 'bottom': 24673.38}, {'type': 'Bearish', 'top': 24754.05, 'bottom': 24749.68}], 'order_blocks_m5': [{'type': 'Bullish', 'top': 24708.49, 'bottom': 24673.46, 'bar_index': 159}, {'type': 'Bearish', 'top': 24748.41, 'bottom': 24729.48, 'bar_index': 171}], 'liquidity_voids_m5': [{'type': 'Bearish', 'top': 24722.15, 'bottom': 24698.89, 'bar_index': 178}, {'type': 'Bearish', 'top': 24756.18, 'bottom': 24743.15, 'bar_index': 168}, {'type': 'Bullish', 'top': 24740.01, 'bottom': 24713.05, 'bar_index': 161}], 'premium_discount_m5': {'high': 24738.37, 'low': 24019.21, 'equilibrium': 24378.79, 'status': 'Premium'}, 'mss_m5': {'type': 'Bullish', 'event': 'CHoCH', 'price_level': 24738.37, 'break_bar_index': 162}, 'liquidity_m1': {'swing_highs_BSL': [{'price': 24787.64, 'bar_index': -32}, {'price': 24780.62, 'bar_index': -28}, {'price': 24771.08, 'bar_index': -22}, {'price': 24750.15, 'bar_index': 2}, {'price': 24749.12, 'bar_index': -44}], 'swing_lows_SSL': [{'price': 24656.84, 'bar_index': -77}, {'price': 24673.46, 'bar_index': -59}, {'price': 24675.24, 'bar_index': -68}, {'price': 24697.72, 'bar_index': 37}, {'price': 24697.75, 'bar_index': 26}]}, 'fvgs_m1': [{'type': 'Bullish', 'top': 24704.89, 'bottom': 24703.7}, {'type': 'Bearish', 'top': 24712.09, 'bottom': 24707.35}], 'order_blocks_m1': [{'type': 'Bullish', 'top': 24703.7, 'bottom': 24697.72, 'bar_index': 117}, {'type': 'Bearish', 'top': 24748.41, 'bottom': 24740.83, 'bar_index': 81}], 'liquidity_voids_m1': [{'type': 'Bullish', 'top': 24706.4, 'bottom': 24697.75, 'bar_index': 88}, {'type': 'Bearish', 'top': 24712.02, 'bottom': 24702.6, 'bar_index': 83}, {'type': 'Bearish', 'top': 24722.15, 'bottom': 24712.09, 'bar_index': 82}], 'premium_discount_m1': {'high': 24750.15, 'low': 24697.72, 'equilibrium': 24723.935, 'status': 'Discount'}, 'mss_m1': {'type': 'Bearish', 'event': 'BOS', 'price_level': 24697.72, 'break_bar_index': 3}}, 'risk_model': {}, 'rr_projection': {}, 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_13/10/2025_10:00_CPI (MoM)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 0, tzinfo=<UTC>), 'title': 'CPI (MoM)  (Sep)', 'country': 'serbia', 'impact': 'low', 'source': 'investpy', 'actual': None, 'forecast': 0.1, 'previous': 0.2, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 17m'}, {'id': 'investpy_13/10/2025_10:00_CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 0, tzinfo=<UTC>), 'title': 'CPI (YoY)  (Sep)', 'country': 'serbia', 'impact': 'low', 'source': 'investpy', 'actual': None, 'forecast': None, 'previous': 4.7, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 17m'}, {'id': 'investpy_13/10/2025_10:30_CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 13, 10, 30, tzinfo=<UTC>), 'title': 'CPI (YoY)  (Sep)', 'country': 'india', 'impact': 'medium', 'source': 'investpy', 'actual': None, 'forecast': 1.7, 'previous': 2.07, 'unit': None, 'surprise_score': None, 'when_local': datetime.datetime(2025, 10, 13, 17, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '1h 47m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 13, 8, 42, 0, 909185, tzinfo=<UTC>), 'latency_sec': 9.040935500059277}, 'concept_value_table': '| Khái niệm (Concept) | Giá trị (Value) |\n|---|---|\n| Symbol | USTEC |\n| Killzone Hiện tại | london |\n| Chế độ Biến động | trending |\n| H1 Order Flow | Bearish |\n| M15 Structure | Không rõ |\n| Trong Cửa sổ Tin tức | False |\n| Tin tức Sắp tới | 1h 17m - CPI (MoM)  (Sep) |\n'}
```

---
**Bối cảnh bổ sung từ các báo cáo trước:**


[CONTEXT_COMPOSED]
{"CONTEXT_COMPOSED": {"cycle": "2025-10-13 08:42:04", "trend_checklist": {"trend": "unknown", "enough_ratio": null}, "latest_plan": null, "latest_summary_lines": null, "recent_history_summary": null, "run_meta": {"analysis_id": "2025-10-13T08:42:03Z", "folder_signature": "sha1:b6998c081b037ac262a26d381446ba46def79da5", "images_tf_map": {"USTEC_H1.png": "H1", "USTEC_M1.png": "M1", "USTEC_M15.png": "M15", "USTEC_M5.png": "M5"}}, "running_stats": {"backtest_results": {"status": "not_implemented"}}, "risk_rules": {"max_risk_per_trade_pct": 1.0, "daily_loss_limit_pct": 3.0, "max_trades_per_day": 3}}}

---
**Phân tích các hình ảnh được cung cấp.**
--- KẾT THÚC PROMPT ---
2025-10-13 08:42:10,265 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:10,270 - APP.services.gemini_service - DEBUG - Bắt đầu stream tới Gemini API với 5 lần thử.
2025-10-13 08:42:10,288 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,309 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,321 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,357 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:10,395 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:10,404 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:10,459 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:10,484 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:10,543 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:10,547 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:10,547 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:10,548 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:10,552 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:10,583 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,586 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:10,587 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,589 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:10,590 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:10,592 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:10,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:10,643 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:10,653 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,656 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,659 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:10,660 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:10,662 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:10,665 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:10,667 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:10,669 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:10,674 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:10,677 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,678 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:10,729 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24706.21, 'ask': 24706.21, 'last': 0.0, 'time': 1760344927}
2025-10-13 08:42:10,732 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:10,733 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:10,733 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:10,734 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:10,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,739 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,787 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:10,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:10,840 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:10,844 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24706.21
2025-10-13 08:42:10,852 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6989.999999999782}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24643.99999999987}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1315.4999999998836}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7761.000000000058}]
2025-10-13 08:42:10,853 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:10,855 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,855 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 4.06s
2025-10-13 08:42:10,856 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,857 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,857 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:10,858 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:10,859 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.71, 'free_margin': 110.21, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:10,860 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24706.21, 'profit': -0.14, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24706.21, 'profit': -0.14, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:10,861 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:11,189 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:11,190 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:11,191 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:11,193 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:11,194 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:11,196 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:11,198 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:11,199 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:11,227 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:11,237 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:11,239 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:11,240 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:11,241 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:11,244 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:11,245 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:11,245 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:11,263 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:11,747 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:11,748 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:11,749 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:11,750 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:11,750 - APP.services.mt5_service - DEBUG - Current price (cp): 24707.31
2025-10-13 08:42:11,755 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:11,800 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:11,803 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:11,804 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:11,807 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:11,807 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:11,808 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:11,808 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:11,814 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:11,815 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:11,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:11,816 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:11,819 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:11,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:11,819 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:11,820 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:11,823 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:11,823 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:11,823 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:11,824 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:11,827 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:11,827 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:11,828 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:11,828 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:11,828 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:11+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:11,829 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:11+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:11,829 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:11+07:00
2025-10-13 08:42:11,830 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:11+07:00 trong DST: True
2025-10-13 08:42:11,830 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:11,830 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:11,831 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:11,832 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:11,833 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:11,840 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:11,865 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:11,869 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:11,870 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:11,871 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:11,871 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:11,872 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:11,872 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:11,873 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:11,873 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:11,873 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:11,874 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:11,874 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:11,874 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:11,875 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:11,875 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:11,876 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:11,877 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:11,877 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:11,877 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:11,878 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:11,878 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:11,879 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:11,879 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:11,879 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:11,880 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:11,880 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:11,881 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:11,881 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:11,881 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:11,882 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24707.31, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:11,883 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:11,883 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:11,883 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:11,884 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:11,884 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7100.0
2025-10-13 08:42:11,884 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24754.000000000087
2025-10-13 08:42:11,885 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1425.5000000001019
2025-10-13 08:42:11,885 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7871.0000000002765
2025-10-13 08:42:11,885 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:11,886 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7100.0}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24754.000000000087}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1425.5000000001019}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7871.0000000002765}]
2025-10-13 08:42:11,886 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:11,886 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:11,887 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:11,887 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:11,888 - APP.services.mt5_service - DEBUG - Position in day range: 0.5753555003436124
2025-10-13 08:42:11,888 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:11+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:11,888 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:11+07:00
2025-10-13 08:42:11,889 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:11+07:00 trong DST: True
2025-10-13 08:42:11,889 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:11,890 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:11,890 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:11,890 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:11,891 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:11,891 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3100', 'price': 24707.31, 'distance_pips': 0.0}, {'level': '3125', 'price': 24707.31, 'distance_pips': 0.25}, {'level': '3150', 'price': 24707.32, 'distance_pips': 0.5}, {'level': '3175', 'price': 24707.32, 'distance_pips': 0.75}]
2025-10-13 08:42:11,891 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:11,892 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:11,892 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:11,893 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:11,894 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24707.31
2025-10-13 08:42:11,895 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:11,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:11,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:11,927 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:11,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:11,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24707.31
2025-10-13 08:42:11,930 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:11,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:11,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:11,934 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:11,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:11,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24707.31
2025-10-13 08:42:11,936 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:11,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:11,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:11,940 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:11,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:11,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24707.31
2025-10-13 08:42:11,942 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:11,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:11,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:11,944 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:11,945 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:11,945 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:11,946 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:11,946 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:11,947 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:11,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:11,948 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:11,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:11,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:11,949 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:11,949 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:11,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:11,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:11,951 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:11,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:11,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:11,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:11,953 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:11,953 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:11,954 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:11,954 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:11,954 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:11,955 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:11,955 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:11,956 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:11,957 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:11,960 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:11,966 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:11,967 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:11,999 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:12,000 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24707.31, 'ask': 24707.31, 'last': 0.0, 'time': 1760344931}
2025-10-13 08:42:12,001 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:12,002 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:12,002 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:12,003 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:12,004 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:12,004 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:12,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:12,005 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:12,005 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:12,006 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24707.31
2025-10-13 08:42:12,007 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7100.0}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24754.000000000087}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1425.5000000001019}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7871.0000000002765}]
2025-10-13 08:42:12,007 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:12,009 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-13 08:42:12,103 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:12,104 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:12,105 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.83, 'free_margin': 110.33, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:12,106 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24707.31, 'profit': -0.16, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24707.31, 'profit': -0.16, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:12,107 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:12,194 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:12,210 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:12,212 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:12,215 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:12,219 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:12,222 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:12,222 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:12,224 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:12,234 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:12,235 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:12,236 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:12,236 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:12,237 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:12,238 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:12,239 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:12,240 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:12,315 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:12,742 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:12,744 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:12,749 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:12,792 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:12,845 - APP.services.mt5_service - DEBUG - Current price (cp): 24707.48
2025-10-13 08:42:12,860 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:12,913 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 293, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:12,914 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:12,914 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:12,918 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:12,918 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:12,919 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:12,919 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:12,923 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:12,924 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:12,924 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:12,925 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:12,934 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:12,955 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:12,960 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:12,992 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:12,997 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:13,000 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:13,001 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:13,005 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:13,008 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:13,009 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:13,009 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:13,010 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:13,011 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:12+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:13,012 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:12+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:13,012 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:12+07:00
2025-10-13 08:42:13,012 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:12+07:00 trong DST: True
2025-10-13 08:42:13,013 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:13,013 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:13,014 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:13,015 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:13,016 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:13,018 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:13,018 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:13,022 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:13,056 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:13,057 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:13,059 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:13,061 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:13,062 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:13,062 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:13,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:13,063 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:13,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:13,064 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:13,064 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:13,065 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:13,065 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:13,066 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:13,067 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:13,068 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:13,068 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:13,069 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:13,069 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:13,070 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:13,070 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:13,071 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:13,072 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:13,073 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:13,074 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:13,074 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:13,075 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:13,075 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24707.48, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:13,076 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:13,076 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:13,076 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:13,077 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:13,077 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7116.999999999825
2025-10-13 08:42:13,078 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24770.999999999913
2025-10-13 08:42:13,079 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1442.4999999999272
2025-10-13 08:42:13,080 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7888.000000000102
2025-10-13 08:42:13,080 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:13,081 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7116.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24770.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1442.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7888.000000000102}]
2025-10-13 08:42:13,081 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:13,084 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:13,119 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:13,121 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:13,122 - APP.services.mt5_service - DEBUG - Position in day range: 0.5762541629222361
2025-10-13 08:42:13,122 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:12+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:13,123 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:12+07:00
2025-10-13 08:42:13,123 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:12+07:00 trong DST: True
2025-10-13 08:42:13,124 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:13,125 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:13,125 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:13,126 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,126 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:13,127 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4800', 'price': 24707.48, 'distance_pips': 0.0}, {'level': '4825', 'price': 24707.48, 'distance_pips': 0.25}, {'level': '4850', 'price': 24707.49, 'distance_pips': 0.5}, {'level': '4875', 'price': 24707.49, 'distance_pips': 0.75}]
2025-10-13 08:42:13,127 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:13,128 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,128 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:13,128 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:13,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24707.48
2025-10-13 08:42:13,130 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:13,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:13,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:13,131 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:13,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:13,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24707.48
2025-10-13 08:42:13,133 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:13,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:13,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:13,135 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:13,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:13,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24707.48
2025-10-13 08:42:13,136 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:13,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:13,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:13,138 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:13,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:13,139 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24707.48
2025-10-13 08:42:13,140 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:13,141 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:13,141 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:13,142 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:13,142 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,143 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:13,143 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:13,145 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:13,146 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:13,146 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:13,147 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:13,147 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:13,164 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:13,165 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:13,169 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:13,184 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:13,184 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:13,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:13,185 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:13,186 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:13,186 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:13,188 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:13,189 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,192 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:13,194 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:13,195 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:13,195 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:13,196 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:13,197 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:13,198 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:13,201 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,203 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:13,204 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24707.48, 'ask': 24707.48, 'last': 0.0, 'time': 1760344932}
2025-10-13 08:42:13,204 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:13,204 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:13,207 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:13,209 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:13,215 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,216 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:13,226 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:13,239 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,241 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:13,241 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:13,243 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:13,243 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:13,244 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:13,245 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:13,246 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24707.48
2025-10-13 08:42:13,247 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:13,250 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7116.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24770.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1442.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7888.000000000102}]
2025-10-13 08:42:13,250 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:13,252 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:13,252 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:13,254 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.04s
2025-10-13 08:42:13,272 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:13,428 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:13,429 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:13,430 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.69, 'free_margin': 110.19, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:13,431 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24707.48, 'profit': -0.16, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24707.48, 'profit': -0.17, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:13,432 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:13,653 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:13,654 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:13,655 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-13 08:42:13,728 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:42:14,237 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:14,238 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:14,240 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:14,243 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:14,244 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:14,247 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:14,247 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:14,248 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:14,281 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:14,285 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:14,286 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:14,287 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:14,288 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:14,289 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:14,290 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:14,291 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:14,348 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:14,792 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:14,794 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:14,795 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:14,795 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:14,796 - APP.services.mt5_service - DEBUG - Current price (cp): 24709.23
2025-10-13 08:42:14,802 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:14,857 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 293, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:14,857 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:14,858 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:14,861 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:14,861 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:14,862 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:14,862 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:14,873 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:14,891 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:14,892 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:14,893 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:14,968 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:14,971 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:14,975 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:14,977 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:14,981 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:14,981 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:14,982 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:14,982 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:14,986 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:14,987 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:14,987 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:15,034 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:15,037 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:14+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:15,038 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:14+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:15,038 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:14+07:00
2025-10-13 08:42:15,039 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:14+07:00 trong DST: True
2025-10-13 08:42:15,039 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:15,040 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:15,042 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:15,044 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:15,045 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:15,046 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:15,047 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:15,051 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:15,054 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:15,083 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:15,084 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:15,085 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:15,086 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:15,086 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:15,088 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:15,089 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:15,089 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:15,090 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:15,090 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:15,091 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:15,091 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:15,091 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:15,092 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:15,092 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:15,094 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:15,094 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:15,095 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:15,095 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:15,096 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:15,096 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:15,097 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:15,097 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:15,098 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:15,099 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:15,099 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:15,100 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24709.23, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:15,100 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:15,101 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:15,101 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:15,102 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:15,102 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7291.999999999825
2025-10-13 08:42:15,102 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24945.999999999913
2025-10-13 08:42:15,103 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1617.4999999999272
2025-10-13 08:42:15,103 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8063.000000000102
2025-10-13 08:42:15,104 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:15,104 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7291.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24945.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1617.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8063.000000000102}]
2025-10-13 08:42:15,105 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:15,105 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:15,106 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:15,106 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:15,107 - APP.services.mt5_service - DEBUG - Position in day range: 0.5855051012316933
2025-10-13 08:42:15,107 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:14+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:15,107 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:14+07:00
2025-10-13 08:42:15,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:14+07:00 trong DST: True
2025-10-13 08:42:15,108 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:15,109 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:15,109 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:15,110 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,110 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:15,110 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2300', 'price': 24709.23, 'distance_pips': 0.0}, {'level': '2325', 'price': 24709.23, 'distance_pips': 0.25}, {'level': '2350', 'price': 24709.24, 'distance_pips': 0.5}, {'level': '2375', 'price': 24709.24, 'distance_pips': 0.75}]
2025-10-13 08:42:15,111 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:15,111 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,112 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:15,112 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:15,113 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.23
2025-10-13 08:42:15,113 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:15,115 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:15,115 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:15,116 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:15,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:15,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24709.23
2025-10-13 08:42:15,118 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:15,151 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:15,153 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:15,154 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:15,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:15,157 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24709.23
2025-10-13 08:42:15,158 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:15,158 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:15,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:15,160 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:15,160 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:15,161 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.23
2025-10-13 08:42:15,161 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:15,162 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:15,163 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:15,164 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:15,164 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,165 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:15,165 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:15,166 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:15,167 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:15,167 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:15,167 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:15,168 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:15,168 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:15,169 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:15,169 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:15,169 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:15,170 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:15,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:15,171 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:15,171 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:15,171 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:15,172 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:15,172 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,172 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:15,173 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:15,173 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:15,174 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:15,174 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:15,175 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:15,179 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:15,215 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,217 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:15,217 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:15,218 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24709.23, 'ask': 24709.23, 'last': 0.0, 'time': 1760344934}
2025-10-13 08:42:15,220 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:15,221 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:15,221 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:15,222 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:15,223 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,224 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:15,224 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,224 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:15,225 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:15,225 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:15,226 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24709.23
2025-10-13 08:42:15,226 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7291.999999999825}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24945.999999999913}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1617.4999999999272}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8063.000000000102}]
2025-10-13 08:42:15,227 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:15,228 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.99s
2025-10-13 08:42:15,247 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:15,275 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:15,277 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:15,281 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:15,282 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:15,282 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:15,283 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:15,284 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:15,285 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.75, 'free_margin': 110.25, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:15,285 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:15,286 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:15,288 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24709.23, 'profit': -0.2, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24709.23, 'profit': -0.2, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:15,289 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:15,290 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:15,629 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:15,630 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:15,631 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:15,632 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:15,632 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:15,633 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:15,633 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:15,634 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:16,135 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:16,137 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:16,138 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:16,138 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:16,138 - APP.services.mt5_service - DEBUG - Current price (cp): 24708.92
2025-10-13 08:42:16,144 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:16,197 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 293, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:16,197 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:16,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:16,202 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:16,202 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:16,203 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:16,204 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:16,208 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:16,210 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:16,236 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:16,237 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:16,240 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:16,241 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:16,248 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:16,267 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:16,271 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:16,271 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:16,273 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:16,273 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:16,281 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:16,307 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:16,316 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:16,337 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:16,337 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:16,338 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:16,339 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:16,340 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:16,341 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:15+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:16,354 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:16,369 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:15+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:16,371 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-13 08:42:16,372 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:15+07:00
2025-10-13 08:42:16,373 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:15+07:00 trong DST: True
2025-10-13 08:42:16,374 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:16,374 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:16,405 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:16,408 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:16,408 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:16,432 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:16,441 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:16,568 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:16,669 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:16,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:16,715 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:16,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:16,777 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:16,795 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:16,799 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:16,801 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:16,834 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:16,846 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:16,848 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:16,856 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:16,901 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:16,905 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:16,909 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:16,913 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:16,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:16,921 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:16,924 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:16,970 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:16,974 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:16,976 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:16,978 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:16,980 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:16,981 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:16,983 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:16,984 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:16,988 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:17,029 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24708.92, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:17,041 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:17,047 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:17,047 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:17,049 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:17,050 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7260.999999999694
2025-10-13 08:42:17,053 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24914.99999999978
2025-10-13 08:42:17,062 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1586.4999999997963
2025-10-13 08:42:17,078 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8031.999999999971
2025-10-13 08:42:17,079 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:17,079 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7260.999999999694}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24914.99999999978}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1586.4999999997963}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8031.999999999971}]
2025-10-13 08:42:17,081 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:17,109 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:17,157 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:17,162 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:17,166 - APP.services.mt5_service - DEBUG - Position in day range: 0.5838663635882968
2025-10-13 08:42:17,166 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:15+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:17,168 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:15+07:00
2025-10-13 08:42:17,169 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:15+07:00 trong DST: True
2025-10-13 08:42:17,171 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:17,172 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:17,175 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:17,177 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:17,211 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:17,215 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9200', 'price': 24708.92, 'distance_pips': 0.0}, {'level': '9225', 'price': 24708.92, 'distance_pips': 0.25}, {'level': '9250', 'price': 24708.93, 'distance_pips': 0.5}, {'level': '9275', 'price': 24708.93, 'distance_pips': 0.75}]
2025-10-13 08:42:17,219 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:17,220 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:17,223 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:17,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:17,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24708.92
2025-10-13 08:42:17,231 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:17,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:17,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:17,237 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:17,241 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:17,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24708.92
2025-10-13 08:42:17,296 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:17,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:17,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:17,301 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:17,303 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:17,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24708.92
2025-10-13 08:42:17,366 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:17,409 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:17,417 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:17,418 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:17,421 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:17,423 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:17,425 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:17,429 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:17,471 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:17,475 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-13 08:42:17,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:17,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24708.92
2025-10-13 08:42:17,487 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:17,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:17,568 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:17,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:17,972 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:18,066 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:18,070 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:18,205 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:18,210 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:18,215 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:18,216 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:18,219 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:18,220 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:18,223 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:18,239 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:18,309 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:18,315 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:18,319 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:18,323 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:18,328 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:18,330 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:18,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:18,341 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:18,485 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:18,545 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:18,594 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:18,605 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:18,650 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:18,703 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:18,706 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:18,739 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:18,750 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:18,754 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24708.92, 'ask': 24708.92, 'last': 0.0, 'time': 1760344935}
2025-10-13 08:42:18,754 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:18,755 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:18,756 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:18,762 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:18,765 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:18,766 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:18,768 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:18,819 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:18,820 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:18,820 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:18,822 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:18,823 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:18,824 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24708.92
2025-10-13 08:42:18,824 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7260.999999999694}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24914.99999999978}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1586.4999999997963}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8031.999999999971}]
2025-10-13 08:42:18,825 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:18,828 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.55s
2025-10-13 08:42:18,877 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:18,879 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:18,880 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.79, 'free_margin': 110.29, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:18,882 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24708.92, 'profit': -0.19, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24708.92, 'profit': -0.2, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:18,884 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:18,886 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:18,887 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:18,888 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:18,891 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:18,892 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:18,893 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:18,894 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:18,895 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:18,933 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:18,938 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:18,942 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:18,942 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:18,944 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:18,945 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:18,946 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:18,946 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:18,987 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:19,447 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:19,449 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:19,450 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:19,450 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:19,451 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.09
2025-10-13 08:42:19,454 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:19,505 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:19,506 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:19,507 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:19,509 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:19,509 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:19,510 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:19,510 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:19,515 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:19,516 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:19,516 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:19,517 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:19,519 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:19,522 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:19,522 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:19,523 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:19,551 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:19,553 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:19,554 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:19,554 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:19,564 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:19,583 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:19,583 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:19,584 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:19,585 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:19+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:19,586 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:19+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:19,587 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:19+07:00
2025-10-13 08:42:19,616 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:19+07:00 trong DST: True
2025-10-13 08:42:19,621 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:19,650 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:19,685 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:19,722 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:19,758 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:19,830 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:19,834 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:19,845 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:19,882 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:19,885 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:19,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:19,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:19,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:19,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:19,891 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:19,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:19,894 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:19,896 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:19,898 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:19,947 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:19,952 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:19,953 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:19,953 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:19,954 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:19,955 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-13 08:42:19,955 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:19,956 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:19,957 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:19,958 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:19,958 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:19,959 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:19,960 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:19,962 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:20,005 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:20,030 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:20,043 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:20,103 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:20,157 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:20,249 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:20,335 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:20,400 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:20,402 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:20,409 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.09, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:20,413 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:20,416 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:20,417 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:20,467 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:20,483 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7377.999999999884
2025-10-13 08:42:20,530 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25031.99999999997
2025-10-13 08:42:20,540 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1703.4999999999854
2025-10-13 08:42:20,542 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8149.00000000016
2025-10-13 08:42:20,543 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:20,544 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7377.999999999884}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25031.99999999997}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1703.4999999999854}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8149.00000000016}]
2025-10-13 08:42:20,545 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:20,547 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:20,549 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:20,550 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:20,552 - APP.services.mt5_service - DEBUG - Position in day range: 0.5900512766294868
2025-10-13 08:42:20,555 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:19+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:20,560 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:19+07:00
2025-10-13 08:42:20,584 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:19+07:00 trong DST: True
2025-10-13 08:42:20,592 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:20,593 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:20,594 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:20,595 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,596 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:20,598 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '900', 'price': 24710.09, 'distance_pips': 0.0}, {'level': '925', 'price': 24710.09, 'distance_pips': 0.25}, {'level': '950', 'price': 24710.1, 'distance_pips': 0.5}, {'level': '975', 'price': 24710.1, 'distance_pips': 0.75}]
2025-10-13 08:42:20,599 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:20,600 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,602 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:20,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:20,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.09
2025-10-13 08:42:20,607 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:20,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:20,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:20,616 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:20,655 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:20,668 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.09
2025-10-13 08:42:20,671 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:20,673 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:20,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:20,677 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:20,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:20,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.09
2025-10-13 08:42:20,729 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:20,777 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:20,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:20,785 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:20,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:20,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.09
2025-10-13 08:42:20,792 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:20,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:20,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:20,795 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:20,798 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:20,799 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:20,802 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:20,841 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:20,848 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:20,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:20,852 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:20,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:20,856 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:20,858 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:20,860 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:20,862 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:20,864 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:20,866 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:20,898 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:20,902 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:20,905 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:20,909 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,911 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:20,912 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:20,912 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:20,913 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:20,914 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:20,915 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:20,919 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:20,922 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,924 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:20,925 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:20,925 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.09, 'ask': 24710.09, 'last': 0.0, 'time': 1760344939}
2025-10-13 08:42:20,928 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:20,975 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:20,978 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:20,979 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:20,980 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,981 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:20,981 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,982 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:20,982 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:20,983 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:20,985 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.09
2025-10-13 08:42:20,985 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7377.999999999884}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25031.99999999997}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1703.4999999999854}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8149.00000000016}]
2025-10-13 08:42:20,986 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:20,987 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:20,987 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.10s
2025-10-13 08:42:20,990 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:21,040 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:21,089 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:21,090 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:21,092 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:21,093 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:21,094 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.11s
2025-10-13 08:42:21,095 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.67, 'free_margin': 110.17, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:21,097 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.09, 'profit': -0.21, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.09, 'profit': -0.22, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:21,098 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:21,099 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:21,993 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:21,994 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:21,996 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:21,998 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:21,999 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:22,000 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:22,001 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:22,002 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:22,020 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:22,334 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:22,335 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:22,336 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:22,337 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:22,337 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:22,338 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:22,339 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:22,339 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:22,841 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:22,843 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:22,843 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:22,844 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:22,844 - APP.services.mt5_service - DEBUG - Current price (cp): 24709.71
2025-10-13 08:42:22,849 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:22,914 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:22,915 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:22,916 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:22,918 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:22,919 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:22,919 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:22,920 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:22,923 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:22,923 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:22,923 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:22,924 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:22,925 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:22,926 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:22,927 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:22,930 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:22,966 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:22,968 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:22,968 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:22,969 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:22,971 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:22,972 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:22,972 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:22,973 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:22,974 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:22+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:22,974 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:22+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:22,975 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:22+07:00
2025-10-13 08:42:22,975 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:22+07:00 trong DST: True
2025-10-13 08:42:22,976 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:22,976 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:22,976 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:22,977 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:22,978 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:22,979 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:22,980 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:22,984 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:22,984 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:22,985 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:22,985 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:22,986 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:22,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:22,987 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:22,987 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:22,988 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:22,988 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:22,988 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:22,989 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:22,990 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:22,991 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:22,991 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:22,999 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:23,025 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:23,029 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:23,030 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:23,031 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:23,032 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:23,033 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:23,034 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:23,034 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:23,035 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:23,035 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:23,037 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:23,038 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:23,038 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:23,039 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:23,039 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:23,040 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:23,040 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:23,041 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:23,041 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24709.71, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:23,042 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:23,042 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:23,043 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:23,044 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:23,044 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7339.999999999782
2025-10-13 08:42:23,044 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24993.99999999987
2025-10-13 08:42:23,045 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1665.4999999998836
2025-10-13 08:42:23,045 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8111.000000000058
2025-10-13 08:42:23,046 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:23,046 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7339.999999999782}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24993.99999999987}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1665.4999999998836}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8111.000000000058}]
2025-10-13 08:42:23,046 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:23,047 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:23,048 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:23,048 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:23,049 - APP.services.mt5_service - DEBUG - Position in day range: 0.5880425014537135
2025-10-13 08:42:23,049 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:22+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:23,050 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:22+07:00
2025-10-13 08:42:23,050 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:22+07:00 trong DST: True
2025-10-13 08:42:23,050 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:23,051 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:23,051 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:23,052 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,052 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:23,054 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7100', 'price': 24709.71, 'distance_pips': 0.0}, {'level': '7125', 'price': 24709.71, 'distance_pips': 0.25}, {'level': '7150', 'price': 24709.72, 'distance_pips': 0.5}, {'level': '7175', 'price': 24709.72, 'distance_pips': 0.75}]
2025-10-13 08:42:23,054 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:23,054 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,083 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:23,084 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:23,085 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.71
2025-10-13 08:42:23,086 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:23,086 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:23,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:23,088 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:23,088 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:23,089 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24709.71
2025-10-13 08:42:23,090 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:23,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:23,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:23,091 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:23,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:23,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24709.71
2025-10-13 08:42:23,093 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:23,094 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:23,094 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:23,095 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:23,095 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:23,096 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.71
2025-10-13 08:42:23,097 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:23,097 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:23,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:23,098 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:23,099 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,099 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:23,099 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:23,099 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:23,100 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:23,100 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:23,101 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:23,101 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:23,101 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:23,102 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:23,102 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:23,102 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:23,103 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:23,103 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:23,103 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:23,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:23,104 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:23,104 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:23,104 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,105 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:23,105 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:23,106 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:23,106 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:23,106 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:23,107 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:23,108 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:23,111 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,113 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:23,113 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24709.71, 'ask': 24709.71, 'last': 0.0, 'time': 1760344942}
2025-10-13 08:42:23,113 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:23,116 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:23,117 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:23,139 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:23,144 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:23,144 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:23,214 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,271 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:23,303 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,337 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:23,343 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:23,347 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:23,350 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24709.71
2025-10-13 08:42:23,352 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7339.999999999782}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24993.99999999987}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1665.4999999998836}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8111.000000000058}]
2025-10-13 08:42:23,353 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:23,412 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.42s
2025-10-13 08:42:23,609 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:23,610 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:23,611 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.97, 'free_margin': 110.47, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:23,612 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24709.71, 'profit': -0.21, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24709.71, 'profit': -0.21, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:23,613 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:24,030 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:24,031 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:24,033 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:24,036 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:24,038 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:24,040 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:24,040 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:24,091 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:24,096 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-13 08:42:24,099 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:24,101 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:24,101 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:24,102 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:24,103 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:24,103 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:24,105 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:24,117 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:24,610 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:24,612 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:24,613 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:24,613 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:24,614 - APP.services.mt5_service - DEBUG - Current price (cp): 24709.69
2025-10-13 08:42:24,619 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:24,671 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:24,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:24,672 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:24,675 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:24,675 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:24,676 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:24,677 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:24,687 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:24,707 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:24,709 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:24,710 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:24,715 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:24,715 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:24,716 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:24,716 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:24,719 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:24,719 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:24,720 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:24,721 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:24,724 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:24,724 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:24,725 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:24,725 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:24,726 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:24+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:24,726 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:24+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:24,727 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:24+07:00
2025-10-13 08:42:24,727 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:24+07:00 trong DST: True
2025-10-13 08:42:24,728 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:24,728 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:24,729 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:24,730 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:24,730 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:24,731 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:24,732 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:24,734 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:24,735 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:24,735 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:24,735 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:24,736 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:24,737 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:24,737 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:24,737 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:24,738 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:24,738 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:24,738 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:24,739 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:24,740 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:24,740 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:24,741 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:24,742 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:24,742 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:24,748 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:24,776 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:24,779 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:24,780 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:24,781 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:24,782 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:24,782 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:24,783 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:24,783 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:24,784 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:24,784 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:24,785 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24709.69, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:24,786 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:24,786 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:24,786 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:24,787 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:24,788 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7337.999999999738
2025-10-13 08:42:24,788 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24991.999999999825
2025-10-13 08:42:24,788 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1663.49999999984
2025-10-13 08:42:24,789 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8109.000000000015
2025-10-13 08:42:24,789 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:24,790 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7337.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24991.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1663.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8109.000000000015}]
2025-10-13 08:42:24,790 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:24,791 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:24,792 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:24,792 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:24,793 - APP.services.mt5_service - DEBUG - Position in day range: 0.5879367764444603
2025-10-13 08:42:24,793 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:24+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:24,793 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:24+07:00
2025-10-13 08:42:24,794 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:24+07:00 trong DST: True
2025-10-13 08:42:24,794 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:24,795 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:24,795 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:24,795 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,796 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:24,796 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6900', 'price': 24709.69, 'distance_pips': 0.0}, {'level': '6925', 'price': 24709.69, 'distance_pips': 0.25}, {'level': '6950', 'price': 24709.7, 'distance_pips': 0.5}, {'level': '6975', 'price': 24709.7, 'distance_pips': 0.75}]
2025-10-13 08:42:24,797 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:24,797 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,798 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:24,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:24,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.69
2025-10-13 08:42:24,799 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:24,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:24,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:24,801 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:24,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:24,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24709.69
2025-10-13 08:42:24,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:24,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:24,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:24,805 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:24,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:24,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24709.69
2025-10-13 08:42:24,842 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:24,843 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:24,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:24,844 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:24,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:24,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.69
2025-10-13 08:42:24,846 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:24,846 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:24,847 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:24,848 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:24,849 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,849 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:24,849 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:24,850 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:24,850 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:24,850 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:24,851 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:24,851 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:24,851 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:24,852 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:24,852 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:24,852 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:24,853 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:24,853 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:24,853 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:24,854 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:24,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:24,855 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:24,856 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,856 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:24,857 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:24,857 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:24,857 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:24,858 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:24,859 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:24,861 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:24,863 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,866 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:24,866 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:24,867 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24709.69, 'ask': 24709.69, 'last': 0.0, 'time': 1760344944}
2025-10-13 08:42:24,881 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:24,902 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:24,903 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:24,904 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:24,905 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,905 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:24,906 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,907 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:24,907 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:24,908 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:24,908 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24709.69
2025-10-13 08:42:24,908 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7337.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24991.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1663.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8109.000000000015}]
2025-10-13 08:42:24,909 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:24,910 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-13 08:42:24,958 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:24,962 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:24,963 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.86, 'free_margin': 110.36, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:24,964 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24709.69, 'profit': -0.21, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24709.69, 'profit': -0.21, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:24,965 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:25,035 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:25,036 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:25,037 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:25,039 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:25,040 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:25,041 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:25,042 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:25,043 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:25,068 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:25,487 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:25,488 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:25,489 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:25,490 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:25,491 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:25,492 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:25,492 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:25,493 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:25,994 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:25,996 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:25,997 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:25,998 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:25,998 - APP.services.mt5_service - DEBUG - Current price (cp): 24709.76
2025-10-13 08:42:26,004 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:26,053 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:26,069 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:26,071 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:26,071 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:26,072 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:26,073 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:26,074 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:26,076 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:26,078 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:26,079 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:26,080 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:26,080 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:26,081 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:26,085 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:26,086 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:26,121 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:26,127 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:26,131 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:26,134 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:26,135 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:26,137 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:26,140 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:26,141 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:26,142 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:26,142 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:26,155 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:26,178 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:26,195 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:26,211 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:26,267 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:26,322 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:25+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:26,384 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:25+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:26,439 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:25+07:00
2025-10-13 08:42:26,496 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:25+07:00 trong DST: True
2025-10-13 08:42:26,509 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:26,514 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:26,518 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:26,521 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:26,555 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:26,573 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:26,616 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:26,635 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:26,644 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:26,699 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:26,702 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:26,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:26,711 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:26,763 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:26,765 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:26,767 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:26,768 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:26,769 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:26,826 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:26,882 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:26,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:26,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:26,886 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:26,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:26,889 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:26,930 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:26,942 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:26,945 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:26,946 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:26,946 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:26,947 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:26,949 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:26,952 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:26,954 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:26,956 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:26,960 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24709.76, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:26,998 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:26,999 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:27,001 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:27,002 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:27,006 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7344.999999999709
2025-10-13 08:42:27,008 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24998.999999999796
2025-10-13 08:42:27,009 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1670.4999999998108
2025-10-13 08:42:27,012 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8115.999999999985
2025-10-13 08:42:27,012 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:27,013 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7344.999999999709}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24998.999999999796}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1670.4999999998108}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8115.999999999985}]
2025-10-13 08:42:27,018 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:27,020 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:27,023 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:27,031 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:27,056 - APP.services.mt5_service - DEBUG - Position in day range: 0.588306813976837
2025-10-13 08:42:27,059 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:25+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:27,060 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:25+07:00
2025-10-13 08:42:27,061 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:25+07:00 trong DST: True
2025-10-13 08:42:27,063 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:27,064 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:27,065 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:27,067 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,068 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:27,068 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7600', 'price': 24709.76, 'distance_pips': 0.0}, {'level': '7625', 'price': 24709.76, 'distance_pips': 0.25}, {'level': '7650', 'price': 24709.77, 'distance_pips': 0.5}, {'level': '7675', 'price': 24709.77, 'distance_pips': 0.75}]
2025-10-13 08:42:27,068 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:27,069 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,069 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:27,070 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:27,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.76
2025-10-13 08:42:27,073 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:27,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:27,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:27,075 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:27,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:27,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24709.76
2025-10-13 08:42:27,077 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:27,078 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:27,079 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:27,080 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:27,080 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:27,081 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24709.76
2025-10-13 08:42:27,082 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:27,083 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:27,084 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:27,085 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:27,086 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:27,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24709.76
2025-10-13 08:42:27,092 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:27,125 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:27,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:27,130 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:27,130 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:27,133 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:27,133 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,134 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:27,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:27,136 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:27,137 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:27,137 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:27,138 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:27,139 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:27,139 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:27,140 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:27,140 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:27,141 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:27,141 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:27,141 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:27,142 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:27,142 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:27,143 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:27,144 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:27,144 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:27,144 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:27,145 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:27,147 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:27,147 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,148 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:27,155 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:27,181 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:27,182 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:27,183 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:27,184 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:27,187 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:27,190 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,193 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:27,193 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:27,193 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24709.76, 'ask': 24709.76, 'last': 0.0, 'time': 1760344945}
2025-10-13 08:42:27,197 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:27,197 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:27,198 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:27,198 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:27,199 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,200 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:27,201 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,202 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:27,202 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:27,203 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:27,203 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24709.76
2025-10-13 08:42:27,203 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7344.999999999709}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24998.999999999796}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1670.4999999998108}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8115.999999999985}]
2025-10-13 08:42:27,204 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:27,205 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.17s
2025-10-13 08:42:27,232 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:27,417 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:27,418 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:27,418 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.86, 'free_margin': 110.36, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:27,419 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24709.76, 'profit': -0.21, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24709.76, 'profit': -0.21, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:27,420 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:28,133 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:28,134 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:28,136 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:28,138 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:28,139 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:28,140 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:28,141 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:28,143 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:28,149 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:28,605 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:28,607 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:28,608 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:28,608 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:28,609 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:28,610 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:28,611 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:28,611 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:28,657 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:28,658 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:29,112 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:29,114 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:29,116 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.46s
2025-10-13 08:42:29,117 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:29,118 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:29,118 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.14
2025-10-13 08:42:29,129 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:29,139 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:29,168 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:29,178 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:42:29,219 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:29,229 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:29,231 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:29,232 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:29,232 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:29,233 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:29,234 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-13 08:42:29,237 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:29,239 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:29,239 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:29,240 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:29,250 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:29,271 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:29,272 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:29,273 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:29,276 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:29,278 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:29,278 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:29,279 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:29,282 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:29,283 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:29,283 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:29,284 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:29,288 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:29,288 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:29,289 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:29,290 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:29,290 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:28+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:29,291 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:28+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:29,291 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:28+07:00
2025-10-13 08:42:29,292 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:28+07:00 trong DST: True
2025-10-13 08:42:29,292 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:29,293 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:29,293 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:29,296 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:29,296 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:29,298 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:29,299 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:29,338 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:29,342 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:29,420 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:29,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:29,479 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:29,532 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:29,546 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:29,646 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:29,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:29,851 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:30,087 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:30,131 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:30,133 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:30,138 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:30,143 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:30,145 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:30,147 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:30,150 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:30,151 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:30,153 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:30,155 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:30,285 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:30,335 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:30,338 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:30,340 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:30,341 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:30,342 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:30,343 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:30,345 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:30,346 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:30,346 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:30,347 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:30,348 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:30,348 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:30,349 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:30,350 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.14, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:30,350 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:30,350 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:30,351 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:30,351 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:30,351 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7382.999999999811
2025-10-13 08:42:30,352 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25036.999999999898
2025-10-13 08:42:30,352 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1708.4999999999127
2025-10-13 08:42:30,353 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8154.000000000087
2025-10-13 08:42:30,353 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:30,353 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7382.999999999811}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25036.999999999898}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1708.4999999999127}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8154.000000000087}]
2025-10-13 08:42:30,354 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:30,355 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:30,355 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:30,355 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:30,356 - APP.services.mt5_service - DEBUG - Position in day range: 0.5903155891526103
2025-10-13 08:42:30,356 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:28+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:30,356 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:28+07:00
2025-10-13 08:42:30,357 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:28+07:00 trong DST: True
2025-10-13 08:42:30,357 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:30,358 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:30,358 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:30,358 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,359 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:30,359 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1400', 'price': 24710.14, 'distance_pips': 0.0}, {'level': '1425', 'price': 24710.14, 'distance_pips': 0.25}, {'level': '1450', 'price': 24710.15, 'distance_pips': 0.5}, {'level': '1475', 'price': 24710.15, 'distance_pips': 0.75}]
2025-10-13 08:42:30,360 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:30,360 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,361 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:30,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:30,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.14
2025-10-13 08:42:30,362 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:30,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:30,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:30,363 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:30,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:30,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.14
2025-10-13 08:42:30,367 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:30,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:30,368 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:30,374 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:30,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:30,403 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.14
2025-10-13 08:42:30,405 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:30,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:30,408 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:30,409 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:30,409 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:30,410 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.14
2025-10-13 08:42:30,411 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:30,412 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:30,413 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:30,413 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:30,414 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,414 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:30,415 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:30,415 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:30,416 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:30,416 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:30,417 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:30,417 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:30,417 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:30,418 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:30,418 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:30,419 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:30,419 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:30,420 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:30,420 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:30,421 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:30,421 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:30,421 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:30,422 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,422 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:30,423 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:30,423 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:30,423 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:30,424 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:30,424 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:30,426 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:30,438 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,447 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:30,463 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:30,464 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.14, 'ask': 24710.14, 'last': 0.0, 'time': 1760344948}
2025-10-13 08:42:30,464 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:30,482 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:30,520 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:30,579 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:30,582 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:30,618 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,664 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:30,668 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,671 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:30,675 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:30,675 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:30,680 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.14
2025-10-13 08:42:30,717 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7382.999999999811}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25036.999999999898}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1708.4999999999127}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8154.000000000087}]
2025-10-13 08:42:30,760 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:30,784 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.65s
2025-10-13 08:42:30,943 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:30,944 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:30,944 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.66, 'free_margin': 110.16, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:30,946 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.14, 'profit': -0.22, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.14, 'profit': -0.22, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:30,947 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:31,339 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:31,340 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:31,341 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:31,343 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:31,344 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:31,346 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:31,347 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:31,348 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:31,354 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:31,714 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:31,715 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:31,716 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:31,717 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:31,717 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:31,718 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:31,719 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:31,719 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:32,221 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:32,223 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:32,223 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:32,224 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:32,224 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.45
2025-10-13 08:42:32,230 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 242, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:32,282 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:32,283 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:32,283 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:32,285 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:32,286 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:32,286 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:32,287 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:32,290 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:32,291 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:32,291 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:32,292 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:32,294 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:32,294 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:32,295 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:32,295 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:32,298 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:32,299 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:32,299 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:32,300 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:32,302 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:32,304 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:32,304 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:32,305 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:32,305 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:31+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:32,306 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:31+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:32,306 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:31+07:00
2025-10-13 08:42:32,307 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:31+07:00 trong DST: True
2025-10-13 08:42:32,336 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:32,338 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:32,343 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:32,344 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:32,346 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:32,349 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:32,350 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:32,351 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:32,353 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:32,354 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:32,355 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:32,355 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:32,359 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:32,359 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:32,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:32,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:32,361 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:32,362 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:32,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:32,364 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:32,367 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:32,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:32,394 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:32,404 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:32,458 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:32,487 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:32,528 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:32,533 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:32,585 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:32,596 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:32,618 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:32,653 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:32,656 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:32,663 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:32,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:32,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:32,671 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:32,716 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:32,722 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:32,729 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:32,733 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:32,738 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:32,743 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.45, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:32,803 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:32,806 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:32,837 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:32,866 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:32,953 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7413.999999999942
2025-10-13 08:42:32,986 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25068.00000000003
2025-10-13 08:42:33,050 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1739.5000000000437
2025-10-13 08:42:33,065 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8185.000000000218
2025-10-13 08:42:33,066 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:33,067 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7413.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25068.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1739.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8185.000000000218}]
2025-10-13 08:42:33,070 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:33,071 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:33,073 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:33,073 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:33,079 - APP.services.mt5_service - DEBUG - Position in day range: 0.5919543267960068
2025-10-13 08:42:33,081 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:31+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:33,091 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:31+07:00
2025-10-13 08:42:33,122 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:31+07:00 trong DST: True
2025-10-13 08:42:33,129 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:33,130 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:33,133 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:33,136 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,136 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:33,139 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4500', 'price': 24710.45, 'distance_pips': 0.0}, {'level': '4525', 'price': 24710.45, 'distance_pips': 0.25}, {'level': '4550', 'price': 24710.46, 'distance_pips': 0.5}, {'level': '4575', 'price': 24710.46, 'distance_pips': 0.75}]
2025-10-13 08:42:33,139 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:33,146 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,189 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:33,192 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:33,194 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.45
2025-10-13 08:42:33,196 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:33,200 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:33,205 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:33,208 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:33,212 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:33,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.45
2025-10-13 08:42:33,254 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:33,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:33,256 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:33,256 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:33,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:33,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.45
2025-10-13 08:42:33,259 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:33,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:33,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:33,262 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:33,262 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:33,263 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.45
2025-10-13 08:42:33,264 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:33,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:33,267 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:33,268 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:33,268 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,269 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:33,269 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:33,269 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:33,270 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:33,270 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:33,272 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:33,311 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:33,313 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:33,314 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:33,315 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:33,316 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:33,316 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:33,317 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:33,318 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:33,319 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:33,321 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:33,322 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:33,323 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,323 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:33,324 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:33,324 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:33,325 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:33,325 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:33,327 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:33,329 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:33,332 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,336 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:33,337 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:33,349 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:33,337 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.45, 'ask': 24710.45, 'last': 0.0, 'time': 1760344951}
2025-10-13 08:42:33,375 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:33,377 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:33,377 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:33,378 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:33,380 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:33,381 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:33,382 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:33,383 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,384 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:33,384 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:33,385 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:33,385 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,386 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:33,387 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:33,388 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:33,388 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.45
2025-10-13 08:42:33,389 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7413.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25068.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1739.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8185.000000000218}]
2025-10-13 08:42:33,389 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:33,391 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.05s
2025-10-13 08:42:33,421 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:33,577 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:33,578 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:33,579 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.25, 'free_margin': 109.75, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:33,580 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.45, 'profit': -0.22, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.45, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:33,581 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:34,373 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:34,374 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:34,376 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:34,378 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:34,379 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:34,381 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:34,381 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:34,382 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:34,399 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:34,859 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:34,860 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:34,861 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:34,862 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:34,863 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:34,863 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:34,864 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:34,865 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:35,367 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:35,368 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:35,369 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:35,370 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:35,371 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.7
2025-10-13 08:42:35,375 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:35,386 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:35,433 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:35,440 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:35,463 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 291, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:35,464 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:35,468 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:35,469 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:35,470 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-13 08:42:35,471 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:35,476 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:35,476 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:35,477 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:35,477 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:35,481 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:35,481 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:35,482 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:35,482 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:35,484 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:35,485 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:35,485 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:35,485 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:35,488 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:35,488 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:35,489 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:35,489 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:35,494 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:35,502 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:35,510 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:35,512 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:35,515 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:34+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:35,519 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:34+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:35,524 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:34+07:00
2025-10-13 08:42:35,525 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:34+07:00 trong DST: True
2025-10-13 08:42:35,525 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:35,526 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:35,526 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:35,528 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:35,529 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:35,530 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:35,531 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:35,534 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:35,534 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:35,535 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:35,546 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:35,561 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:35,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:35,598 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:35,613 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:35,626 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:35,647 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:35,680 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:35,712 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:35,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:35,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:35,777 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:35,780 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:35,782 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:35,784 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:35,786 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:35,792 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:35,794 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:35,796 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:35,799 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:35,813 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:35,854 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:35,866 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:35,923 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:35,926 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:35,927 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:35,929 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.7, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:35,930 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:35,973 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:35,975 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:35,977 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:35,978 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7438.999999999942
2025-10-13 08:42:35,980 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25093.00000000003
2025-10-13 08:42:35,981 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1764.5000000000437
2025-10-13 08:42:35,982 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8210.000000000218
2025-10-13 08:42:35,985 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:35,986 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7438.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25093.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1764.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8210.000000000218}]
2025-10-13 08:42:35,988 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:35,990 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:36,065 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:36,083 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:36,127 - APP.services.mt5_service - DEBUG - Position in day range: 0.5932758894116434
2025-10-13 08:42:36,136 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:34+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:36,179 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:34+07:00
2025-10-13 08:42:36,185 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:34+07:00 trong DST: True
2025-10-13 08:42:36,187 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:36,194 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:36,194 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:36,196 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,200 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:36,201 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7000', 'price': 24710.7, 'distance_pips': 0.0}, {'level': '7025', 'price': 24710.7, 'distance_pips': 0.25}, {'level': '7050', 'price': 24710.71, 'distance_pips': 0.5}, {'level': '7075', 'price': 24710.71, 'distance_pips': 0.75}]
2025-10-13 08:42:36,207 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:36,249 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,255 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:36,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:36,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.7
2025-10-13 08:42:36,264 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:36,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:36,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:36,271 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:36,323 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:36,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.7
2025-10-13 08:42:36,331 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:36,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:36,334 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:36,373 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:36,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:36,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.7
2025-10-13 08:42:36,387 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:36,388 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:36,389 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:36,392 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:36,393 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:36,394 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.7
2025-10-13 08:42:36,395 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:36,395 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:36,398 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:36,400 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:36,456 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,461 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:36,462 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:36,465 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:36,466 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:36,592 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:36,593 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:36,594 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:36,595 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:36,596 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:36,597 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:36,600 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:36,602 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:36,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:36,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:36,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:36,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:36,606 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:36,608 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:36,608 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:36,609 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,609 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:36,610 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:36,613 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:36,614 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:36,614 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:36,615 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:36,616 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-13 08:42:36,620 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:36,659 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:36,661 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:36,666 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:36,675 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,678 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:36,678 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:36,681 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:36,721 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.7, 'ask': 24710.7, 'last': 0.0, 'time': 1760344954}
2025-10-13 08:42:36,722 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:36,733 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:36,789 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:36,800 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:36,806 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,907 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:36,926 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:36,989 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:37,028 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:37,045 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:37,105 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.7
2025-10-13 08:42:37,168 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7438.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25093.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1764.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8210.000000000218}]
2025-10-13 08:42:37,173 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:37,220 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.85s
2025-10-13 08:42:37,495 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:37,496 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:37,496 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.12, 'free_margin': 109.62, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:37,498 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.7, 'profit': -0.23, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.7, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:37,499 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:37,530 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:37,544 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:37,546 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:37,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:37,556 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:37,558 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:37,570 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:37,599 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:37,601 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:37,601 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-13 08:42:37,603 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:37,604 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:37,606 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:37,607 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:37,608 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:37,609 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:37,705 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:38,110 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:38,112 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:38,113 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:38,114 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:38,114 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.64
2025-10-13 08:42:38,118 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:38,170 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 291, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:38,170 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:38,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:38,173 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:38,174 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:38,174 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:38,175 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:38,189 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:38,209 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:38,210 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:38,210 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:38,213 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:38,213 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:38,214 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:38,215 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:38,218 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:38,218 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:38,219 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:38,219 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:38,224 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:38,224 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:38,225 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:38,225 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:38,226 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:37+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:38,226 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:37+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:38,227 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:37+07:00
2025-10-13 08:42:38,227 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:37+07:00 trong DST: True
2025-10-13 08:42:38,227 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:38,228 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:38,228 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:38,230 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:38,231 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:38,233 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:38,233 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:38,236 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:38,236 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:38,237 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:38,237 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:38,238 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:38,238 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:38,238 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:38,239 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:38,239 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:38,240 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:38,240 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:38,241 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:38,242 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:38,242 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:38,243 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:38,243 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:38,277 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:38,279 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:38,280 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:38,282 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:38,283 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:38,283 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:38,284 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:38,285 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:38,285 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:38,286 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:38,286 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:38,287 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:38,288 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.64, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:38,289 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:38,289 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:38,289 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:38,290 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:38,290 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7432.999999999811
2025-10-13 08:42:38,291 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25086.999999999898
2025-10-13 08:42:38,291 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1758.4999999999127
2025-10-13 08:42:38,292 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8204.000000000087
2025-10-13 08:42:38,292 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:38,292 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7432.999999999811}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25086.999999999898}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1758.4999999999127}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8204.000000000087}]
2025-10-13 08:42:38,293 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:38,293 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:38,294 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:38,295 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:38,296 - APP.services.mt5_service - DEBUG - Position in day range: 0.5929587143838837
2025-10-13 08:42:38,296 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:37+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:38,296 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:37+07:00
2025-10-13 08:42:38,297 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:37+07:00 trong DST: True
2025-10-13 08:42:38,297 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:38,298 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:38,298 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:38,298 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,299 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:38,299 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6400', 'price': 24710.64, 'distance_pips': 0.0}, {'level': '6425', 'price': 24710.64, 'distance_pips': 0.25}, {'level': '6450', 'price': 24710.65, 'distance_pips': 0.5}, {'level': '6475', 'price': 24710.65, 'distance_pips': 0.75}]
2025-10-13 08:42:38,300 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:38,300 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,301 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:38,301 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:38,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.64
2025-10-13 08:42:38,303 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:38,303 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:38,304 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:38,304 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:38,305 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:38,306 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.64
2025-10-13 08:42:38,307 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:38,335 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:38,339 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:38,340 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:38,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:38,342 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.64
2025-10-13 08:42:38,343 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:38,344 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:38,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:38,346 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:38,346 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:38,347 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.64
2025-10-13 08:42:38,349 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:38,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:38,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:38,351 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:38,351 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,352 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:38,352 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:38,353 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:38,353 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:38,354 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:38,354 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:38,354 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:38,355 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:38,355 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:38,355 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:38,356 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:38,356 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:38,357 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:38,357 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:38,358 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:38,358 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:38,359 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:38,359 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,360 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:38,360 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:38,360 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:38,361 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:38,361 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:38,362 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:38,363 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:38,368 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,402 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:38,405 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.64, 'ask': 24710.64, 'last': 0.0, 'time': 1760344957}
2025-10-13 08:42:38,407 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:38,408 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:38,408 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:38,409 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:38,410 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:38,412 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,412 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:38,413 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,413 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:38,414 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:38,414 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:38,414 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.64
2025-10-13 08:42:38,415 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7432.999999999811}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25086.999999999898}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1758.4999999999127}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8204.000000000087}]
2025-10-13 08:42:38,415 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:38,417 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-13 08:42:38,439 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:38,463 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:38,464 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 114.27, 'free_margin': 109.77, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:38,466 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.64, 'profit': -0.23, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.64, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:38,468 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:38,552 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:38,552 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:38,555 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:38,557 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:38,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:38,560 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:38,561 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:38,561 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:38,570 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:38,923 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:38,925 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:38,926 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:38,927 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:38,928 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:38,929 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:38,930 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:38,932 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:39,433 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:39,437 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:39,438 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:39,439 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:39,440 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.51
2025-10-13 08:42:39,445 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 234, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:39,536 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 291, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:39,539 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:39,540 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:39,543 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:39,545 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:39,546 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:39,548 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:39,552 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:39,552 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:39,563 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:39,592 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:39,594 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:39,595 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:39,596 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:39,600 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:39,602 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:39,604 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:39,605 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:39,606 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:39,607 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:39,607 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:39,611 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:39,611 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:39,612 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:39,613 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:39,671 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:39,733 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:39,788 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:39,799 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:39,805 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:39,895 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:39+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:39,935 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:39+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:39,951 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:39+07:00
2025-10-13 08:42:39,959 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:39+07:00 trong DST: True
2025-10-13 08:42:40,005 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:40,007 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:40,010 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:40,016 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:40,069 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:40,083 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:40,140 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:40,193 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:40,361 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:40,384 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:40,556 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:40,593 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:40,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:40,665 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:40,666 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:40,667 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:40,668 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:40,670 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:40,672 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:40,673 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:40,674 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:40,675 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:40,676 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:40,676 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:40,677 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:40,677 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:40,679 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:40,680 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:40,680 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:40,681 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:40,681 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:40,682 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:40,683 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:40,683 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:40,684 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:40,684 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:40,685 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:40,686 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:40,687 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:40,687 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:40,687 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:40,689 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.51, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:40,689 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:40,690 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:40,691 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:40,691 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:40,692 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7419.999999999709
2025-10-13 08:42:40,692 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25073.999999999796
2025-10-13 08:42:40,692 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1745.4999999998108
2025-10-13 08:42:40,693 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8190.999999999985
2025-10-13 08:42:40,693 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:40,773 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:40,888 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7419.999999999709}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25073.999999999796}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1745.4999999998108}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8190.999999999985}]
2025-10-13 08:42:40,971 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:41,025 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:41,036 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:41,093 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:41,114 - APP.services.mt5_service - DEBUG - Position in day range: 0.5922715018237472
2025-10-13 08:42:41,129 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:39+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:41,145 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:39+07:00
2025-10-13 08:42:41,180 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:39+07:00 trong DST: True
2025-10-13 08:42:41,188 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:41,204 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:41,206 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:41,208 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,210 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:41,219 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5100', 'price': 24710.51, 'distance_pips': 0.0}, {'level': '5125', 'price': 24710.51, 'distance_pips': 0.25}, {'level': '5150', 'price': 24710.52, 'distance_pips': 0.5}, {'level': '5175', 'price': 24710.52, 'distance_pips': 0.75}]
2025-10-13 08:42:41,245 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:41,250 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,256 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:41,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:41,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.51
2025-10-13 08:42:41,274 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:41,309 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:41,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:41,331 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:41,334 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:41,338 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.51
2025-10-13 08:42:41,377 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:41,378 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:41,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:41,383 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:41,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:41,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.51
2025-10-13 08:42:41,388 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:41,390 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:41,391 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:41,392 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:41,395 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:41,397 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.51
2025-10-13 08:42:41,399 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:41,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:41,441 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:41,447 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:41,449 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,450 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:41,452 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:41,454 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:41,488 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:41,506 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:41,512 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:41,514 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:41,516 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:41,516 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:41,518 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:41,520 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:41,521 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:41,521 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:41,526 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:41,566 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:41,574 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:41,578 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:41,579 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,579 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:41,582 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:41,582 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:41,584 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:41,588 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:41,621 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:41,628 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:41,641 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,642 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:41,645 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:41,645 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.51, 'ask': 24710.51, 'last': 0.0, 'time': 1760344959}
2025-10-13 08:42:41,657 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:41,683 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:41,685 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:41,688 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:41,690 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,692 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:41,694 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,698 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:41,702 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:41,702 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:41,703 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.51
2025-10-13 08:42:41,704 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7419.999999999709}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25073.999999999796}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1745.4999999998108}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8190.999999999985}]
2025-10-13 08:42:41,705 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:41,707 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.15s
2025-10-13 08:42:41,768 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:41,769 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:41,769 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.92, 'free_margin': 109.42, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:41,771 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.51, 'profit': -0.22, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.51, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:41,772 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:41,773 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:41,774 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:41,781 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:41,811 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:41,814 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:41,818 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:41,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:41,821 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:41,868 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:41,871 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:41,872 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:41,873 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:41,873 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:41,873 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:41,889 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:41,987 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:42,001 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:42,508 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:42,510 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:42,510 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:42,511 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:42,511 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.2
2025-10-13 08:42:42,515 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 232, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:42,565 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 291, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:42,566 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:42,567 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:42,570 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:42,571 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:42,571 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:42,572 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:42,578 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:42,579 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:42,579 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:42,580 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:42,582 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:42,582 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:42,583 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:42,583 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:42,586 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:42,587 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:42,587 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:42,588 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:42,614 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:42,615 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:42,616 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:42,617 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:42,618 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:39+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:42,619 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:39+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:42,626 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:39+07:00
2025-10-13 08:42:42,647 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:39+07:00 trong DST: True
2025-10-13 08:42:42,648 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:42,649 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:42,649 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:42,651 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:42,652 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:42,654 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:42,655 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:42,658 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:42,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:42,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:42,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:42,661 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:42,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:42,662 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:42,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:42,662 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:42,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:42,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:42,664 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:42,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:42,664 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:42,665 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:42,665 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:42,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:42,666 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:42,667 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:42,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:42,668 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:42,668 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:42,669 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:42,669 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:42,669 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:42,670 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:42,671 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:42,671 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:42,671 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.2, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:42,672 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:42,672 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:42,673 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:42,673 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:42,673 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7388.999999999942
2025-10-13 08:42:42,674 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25043.00000000003
2025-10-13 08:42:42,674 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1714.5000000000437
2025-10-13 08:42:42,675 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8160.000000000218
2025-10-13 08:42:42,675 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:42,675 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7388.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25043.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1714.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8160.000000000218}]
2025-10-13 08:42:42,676 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:42,677 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:42,677 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:42,678 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:42,678 - APP.services.mt5_service - DEBUG - Position in day range: 0.59063276418037
2025-10-13 08:42:42,679 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:39+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:42,679 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:39+07:00
2025-10-13 08:42:42,681 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:39+07:00 trong DST: True
2025-10-13 08:42:42,686 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:42,690 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:42,708 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:42,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,710 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:42,710 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2000', 'price': 24710.2, 'distance_pips': 0.0}, {'level': '2025', 'price': 24710.2, 'distance_pips': 0.25}, {'level': '2050', 'price': 24710.21, 'distance_pips': 0.5}, {'level': '2075', 'price': 24710.21, 'distance_pips': 0.75}]
2025-10-13 08:42:42,711 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:42,712 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,712 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:42,713 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:42,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.2
2025-10-13 08:42:42,715 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:42,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:42,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:42,717 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:42,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:42,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.2
2025-10-13 08:42:42,720 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:42,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:42,721 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:42,721 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:42,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:42,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.2
2025-10-13 08:42:42,724 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:42,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:42,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:42,726 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:42,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:42,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.2
2025-10-13 08:42:42,728 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:42,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:42,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:42,729 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:42,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,730 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:42,731 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:42,731 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:42,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:42,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:42,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:42,733 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:42,733 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:42,734 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:42,734 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:42,735 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:42,735 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:42,736 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:42,736 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:42,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:42,737 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:42,738 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:42,738 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,738 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:42,739 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:42,739 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:42,740 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:42,740 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:42,741 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:42,743 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:42,778 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,781 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:42,782 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:42,782 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.2, 'ask': 24710.2, 'last': 0.0, 'time': 1760344959}
2025-10-13 08:42:42,785 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:42,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:42,786 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:42,786 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:42,787 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,787 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:42,788 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,789 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:42,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:42,790 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:42,791 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.2
2025-10-13 08:42:42,791 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7388.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25043.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1714.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8160.000000000218}]
2025-10-13 08:42:42,792 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:42,793 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.02s
2025-10-13 08:42:42,812 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:42,843 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:42,844 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:42,847 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:42,850 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:42,852 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:42,854 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:42,855 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:42,859 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:42,859 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:42,860 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.6, 'free_margin': 109.1, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:42,861 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.2, 'profit': -0.22, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.2, 'profit': -0.22, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:42,863 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:42,864 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:43,222 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:43,223 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:43,223 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:43,224 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:43,225 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:43,226 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:43,226 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:43,227 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:43,660 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:43,661 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:43,738 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:43,748 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:43,750 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.09s
2025-10-13 08:42:43,751 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:43,753 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:43,753 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.59
2025-10-13 08:42:43,758 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 231, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:43,809 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:42:43,812 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 291, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:43,813 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:43,814 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:43,818 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:43,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:43,819 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:43,820 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:43,824 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:43,824 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:43,825 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:43,825 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:43,827 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:43,828 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:43,828 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:43,829 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:43,831 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:43,831 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:43,832 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:43,832 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:43,835 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:43,838 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:43,844 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:43,849 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:43,862 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:43,865 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:43,866 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:42+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:43,867 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:43,867 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:42+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:43,876 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:43,904 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:42+07:00
2025-10-13 08:42:43,906 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:43,908 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-13 08:42:43,908 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:42+07:00 trong DST: True
2025-10-13 08:42:43,910 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:43,911 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:43,912 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:43,914 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:43,914 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:43,915 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:43,930 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:43,993 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.745629963254
2025-10-13 08:42:44,015 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.745629963254, 'asia': 24728.745629963254, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:44,069 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:44,082 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.043123208095
2025-10-13 08:42:44,126 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:44,131 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.794419905207
2025-10-13 08:42:44,190 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:44,206 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.801262583955
2025-10-13 08:42:44,209 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:44,249 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.27089459641
2025-10-13 08:42:44,254 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:44,261 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24677.981529642508
2025-10-13 08:42:44,271 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:44,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.070125335773
2025-10-13 08:42:44,322 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:44,327 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24846.959087855357
2025-10-13 08:42:44,329 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:44,330 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.627912810825
2025-10-13 08:42:44,331 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.043123208095, 'ema200': 24711.794419905207}, 'M5': {'ema50': 24697.801262583955, 'ema200': 24620.27089459641}, 'M15': {'ema50': 24677.981529642508, 'ema200': 24881.070125335773}, 'H1': {'ema50': 24846.959087855357, 'ema200': 24939.627912810825}}
2025-10-13 08:42:44,332 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:44,333 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.551223546179102, TRs count: 179
2025-10-13 08:42:44,377 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:44,379 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.614967048140975, TRs count: 119
2025-10-13 08:42:44,380 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:44,381 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:44,383 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:44,384 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:44,385 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.551223546179102, 'M1': 7.614967048140975, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:44,386 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:44,387 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.59, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:44,389 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:44,390 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:44,391 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:44,392 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:44,392 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7427.999999999884
2025-10-13 08:42:44,393 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25081.99999999997
2025-10-13 08:42:44,394 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1753.4999999999854
2025-10-13 08:42:44,395 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8199.00000000016
2025-10-13 08:42:44,452 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:44,457 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7427.999999999884}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25081.99999999997}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1753.4999999999854}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8199.00000000016}]
2025-10-13 08:42:44,457 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:44,459 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:44,490 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:44,490 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:44,507 - APP.services.mt5_service - DEBUG - Position in day range: 0.5926944018607603
2025-10-13 08:42:44,541 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:42+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:44,580 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:42+07:00
2025-10-13 08:42:44,582 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:42+07:00 trong DST: True
2025-10-13 08:42:44,584 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:44,585 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:44,590 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:44,596 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,598 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:44,604 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5900', 'price': 24710.59, 'distance_pips': 0.0}, {'level': '5925', 'price': 24710.59, 'distance_pips': 0.25}, {'level': '5950', 'price': 24710.6, 'distance_pips': 0.5}, {'level': '5975', 'price': 24710.6, 'distance_pips': 0.75}]
2025-10-13 08:42:44,605 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:44,606 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:44,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:44,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.59
2025-10-13 08:42:44,660 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:44,664 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:44,670 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:44,671 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:44,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:44,673 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.59
2025-10-13 08:42:44,673 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:44,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:44,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:44,675 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:44,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:44,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.59
2025-10-13 08:42:44,720 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:44,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:44,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:44,731 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:44,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:44,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.59
2025-10-13 08:42:44,733 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:44,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:44,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:44,735 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:44,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:44,736 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:44,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:44,737 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:44,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:44,739 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:44,739 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:44,740 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:44,740 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:44,740 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:44,744 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:44,744 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:44,779 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:44,780 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:44,782 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:44,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:44,785 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:44,785 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,786 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:44,786 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:44,786 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:44,787 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:44,787 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:44,788 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:44,789 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:44,792 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,793 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:44,794 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.59, 'ask': 24710.59, 'last': 0.0, 'time': 1760344962}
2025-10-13 08:42:44,794 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:44,795 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:44,797 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:44,798 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:44,798 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:44,799 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,800 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:44,800 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,800 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:44,801 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:44,801 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:44,801 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.59
2025-10-13 08:42:44,802 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7427.999999999884}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25081.99999999997}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1753.4999999999854}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8199.00000000016}]
2025-10-13 08:42:44,802 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:44,804 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.96s
2025-10-13 08:42:44,864 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:44,865 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:44,867 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:44,869 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:44,875 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:44,879 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:44,903 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:44,906 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:44,907 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:44,908 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.53, 'free_margin': 109.03, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:44,908 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-13 08:42:44,910 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.59, 'profit': -0.22, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.59, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:44,911 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:44,912 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:45,148 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:45,149 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:45,150 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:45,150 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:45,151 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:45,152 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:45,152 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:45,153 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:45,655 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:45,673 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:45,744 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:45,754 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:45,757 - APP.services.mt5_service - DEBUG - Current price (cp): 24711.19
2025-10-13 08:42:45,763 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 230, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:45,900 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:45,906 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 291, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:45,915 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:45,915 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:45,926 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:45,956 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:46,000 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:46,010 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:46,016 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:46,017 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:46,019 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.11s
2025-10-13 08:42:46,020 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:46,021 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:46,032 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:46,034 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:46,067 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:46,068 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:46,069 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:46,072 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:46,199 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:46,265 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:46,281 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:46,421 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:46,519 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:46,561 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:46,607 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:46,646 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:46,678 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:46,734 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:46,736 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:46,736 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:45+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:46,738 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:45+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:46,802 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:45+07:00
2025-10-13 08:42:46,864 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:45+07:00 trong DST: True
2025-10-13 08:42:46,923 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:46,928 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:46,979 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:46,996 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:47,053 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.675565962953
2025-10-13 08:42:47,114 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:47,115 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:47,120 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.675565962953
2025-10-13 08:42:47,161 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:47,166 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.675565962953, 'asia': 24728.675565962953, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:47,166 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:47,167 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:47,168 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:47,169 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.29763301202
2025-10-13 08:42:47,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:47,170 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:47,171 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:47,171 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.858997019637
2025-10-13 08:42:47,172 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:47,172 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.055772387877
2025-10-13 08:42:47,173 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:47,173 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.33547171084
2025-10-13 08:42:47,173 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:47,174 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.23603944643
2025-10-13 08:42:47,174 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:47,175 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.134702450203
2025-10-13 08:42:47,175 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:47,176 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.21359765928
2025-10-13 08:42:47,176 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:47,177 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.692489925255
2025-10-13 08:42:47,177 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.29763301202, 'ema200': 24711.858997019637}, 'M5': {'ema50': 24698.055772387877, 'ema200': 24620.33547171084}, 'M15': {'ema50': 24678.23603944643, 'ema200': 24881.134702450203}, 'H1': {'ema50': 24847.21359765928, 'ema200': 24939.692489925255}}
2025-10-13 08:42:47,178 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:47,178 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.944794974750415, TRs count: 179
2025-10-13 08:42:47,179 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:47,181 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.052109905283759, TRs count: 119
2025-10-13 08:42:47,215 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:47,227 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:47,303 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:47,387 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:47,447 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:47,513 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.944794974750415, 'M1': 8.052109905283759, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:47,521 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:47,602 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24711.19, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:47,610 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:47,615 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:47,630 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:47,633 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:47,640 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7487.999999999738
2025-10-13 08:42:47,647 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25141.999999999825
2025-10-13 08:42:47,767 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1813.49999999984
2025-10-13 08:42:47,772 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8259.000000000015
2025-10-13 08:42:47,777 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:47,851 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7487.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25141.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1813.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8259.000000000015}]
2025-10-13 08:42:47,855 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:47,857 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:47,863 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:47,917 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:47,927 - APP.services.mt5_service - DEBUG - Position in day range: 0.5958661521382808
2025-10-13 08:42:47,986 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:45+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:47,990 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:45+07:00
2025-10-13 08:42:48,037 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:45+07:00 trong DST: True
2025-10-13 08:42:48,040 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:48,049 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:48,050 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:48,051 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:48,098 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:48,110 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1900', 'price': 24711.19, 'distance_pips': 0.0}, {'level': '1925', 'price': 24711.19, 'distance_pips': 0.25}, {'level': '1950', 'price': 24711.2, 'distance_pips': 0.5}, {'level': '1975', 'price': 24711.2, 'distance_pips': 0.75}]
2025-10-13 08:42:48,162 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:48,173 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:48,178 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:48,182 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:48,234 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:48,235 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:48,252 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:48,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:48,356 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:48,357 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.18s
2025-10-13 08:42:48,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24711.19
2025-10-13 08:42:48,363 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:48,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:48,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:48,366 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:48,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:48,413 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24711.19
2025-10-13 08:42:48,417 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:48,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:48,422 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:48,424 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:48,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:48,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24711.19
2025-10-13 08:42:48,426 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:48,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:48,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:48,428 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:48,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:48,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24711.19
2025-10-13 08:42:48,434 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:48,435 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:48,436 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:48,437 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:48,448 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:48,675 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:49,000 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:49,049 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:49,065 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:49,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:49,075 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:49,076 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:49,078 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:49,079 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:49,080 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:49,081 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:49,082 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:49,083 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:49,084 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:49,085 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:49,087 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:49,089 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:49,089 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:49,127 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:49,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:49,172 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:49,225 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:49,232 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:49,232 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:49,233 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:49,237 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:49,240 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:49,241 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:49,241 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24711.19, 'ask': 24711.19, 'last': 0.0, 'time': 1760344965}
2025-10-13 08:42:49,242 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:49,280 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:49,282 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:49,286 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:49,287 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:49,287 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:49,301 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:49,303 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:49,342 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:49,345 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:49,347 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:49,354 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24711.19
2025-10-13 08:42:49,355 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7487.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25141.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1813.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8259.000000000015}]
2025-10-13 08:42:49,358 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:49,360 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 4.49s
2025-10-13 08:42:49,422 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:49,422 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:49,423 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.42, 'free_margin': 108.92, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:49,424 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24711.19, 'profit': -0.24, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24711.19, 'profit': -0.24, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:49,424 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:49,425 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:49,426 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:49,428 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:49,432 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:49,435 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:49,438 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:49,439 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:49,446 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:49,456 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:49,478 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:49,479 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:49,480 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:49,481 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:49,522 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:49,523 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:49,525 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:49,525 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:50,026 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:50,028 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:50,029 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:50,029 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:50,030 - APP.services.mt5_service - DEBUG - Current price (cp): 24712.19
2025-10-13 08:42:50,033 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 231, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:50,083 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:50,083 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:50,084 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:50,087 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:50,088 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:50,088 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:50,089 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:50,098 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:50,122 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:50,126 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:50,130 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:50,134 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:50,134 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:50,135 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:50,135 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:50,137 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:50,138 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:50,139 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:50,139 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:50,142 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:50,142 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:50,143 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:50,143 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:50,143 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:48+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:50,144 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:48+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:50,144 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:48+07:00
2025-10-13 08:42:50,145 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:48+07:00 trong DST: True
2025-10-13 08:42:50,145 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:50,146 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:50,146 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:50,147 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:50,148 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.673297131656
2025-10-13 08:42:50,159 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:50,186 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.673297131656
2025-10-13 08:42:50,190 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.673297131656, 'asia': 24728.673297131656, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:50,191 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:50,192 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.308613404173
2025-10-13 08:42:50,192 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:50,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.861783089287
2025-10-13 08:42:50,193 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:50,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.066752780032
2025-10-13 08:42:50,194 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:50,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.33825778049
2025-10-13 08:42:50,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:50,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.247019838585
2025-10-13 08:42:50,196 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:50,196 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.137488519853
2025-10-13 08:42:50,197 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:50,197 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.224578051435
2025-10-13 08:42:50,198 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:50,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.695275994905
2025-10-13 08:42:50,199 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.308613404173, 'ema200': 24711.861783089287}, 'M5': {'ema50': 24698.066752780032, 'ema200': 24620.33825778049}, 'M15': {'ema50': 24678.247019838585, 'ema200': 24881.137488519853}, 'H1': {'ema50': 24847.224578051435, 'ema200': 24939.695275994905}}
2025-10-13 08:42:50,199 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:50,200 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:50,200 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:50,201 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:50,201 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:50,202 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:50,203 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:50,203 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:50,204 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:50,204 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:50,204 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24712.19, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:50,205 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:50,205 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:50,205 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:50,206 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:50,206 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7587.999999999738
2025-10-13 08:42:50,206 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25241.999999999825
2025-10-13 08:42:50,207 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1913.49999999984
2025-10-13 08:42:50,207 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8359.000000000015
2025-10-13 08:42:50,207 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:50,208 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7587.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25241.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1913.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8359.000000000015}]
2025-10-13 08:42:50,208 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:50,209 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:50,209 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:50,210 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:50,210 - APP.services.mt5_service - DEBUG - Position in day range: 0.6011524026008277
2025-10-13 08:42:50,210 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:48+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:50,214 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:48+07:00
2025-10-13 08:42:50,220 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:48+07:00 trong DST: True
2025-10-13 08:42:50,242 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:50,244 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:50,246 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:50,247 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,248 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:50,250 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1900', 'price': 24712.19, 'distance_pips': 0.0}, {'level': '1925', 'price': 24712.19, 'distance_pips': 0.25}, {'level': '1950', 'price': 24712.2, 'distance_pips': 0.5}, {'level': '1975', 'price': 24712.2, 'distance_pips': 0.75}]
2025-10-13 08:42:50,250 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:50,250 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,251 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:50,251 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:50,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.19
2025-10-13 08:42:50,253 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:50,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:50,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:50,255 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:50,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:50,256 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24712.19
2025-10-13 08:42:50,257 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:50,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:50,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:50,258 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:50,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:50,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24712.19
2025-10-13 08:42:50,259 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:50,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:50,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:50,261 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:50,262 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:50,263 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.19
2025-10-13 08:42:50,263 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:50,263 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:50,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:50,265 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:50,265 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,265 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:50,266 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:50,266 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:50,267 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:50,267 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:50,267 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:50,268 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:50,268 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:50,268 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:50,269 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:50,269 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:50,269 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:50,270 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:50,270 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:50,270 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:50,271 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:50,271 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:50,272 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,272 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:50,272 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:50,273 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:50,273 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:50,274 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:50,275 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:50,315 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:50,320 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:50,320 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:50,322 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,324 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:50,324 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24712.19, 'ask': 24712.19, 'last': 0.0, 'time': 1760344968}
2025-10-13 08:42:50,326 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:50,326 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:50,326 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:50,327 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,327 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:50,328 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,328 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:50,329 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:50,329 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:50,329 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24712.19
2025-10-13 08:42:50,330 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7587.999999999738}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25241.999999999825}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1913.49999999984}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8359.000000000015}]
2025-10-13 08:42:50,330 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:50,331 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.91s
2025-10-13 08:42:50,376 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:50,378 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:50,379 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.22, 'free_margin': 108.72, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:50,380 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24712.19, 'profit': -0.26, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24712.19, 'profit': -0.26, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:50,381 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:50,429 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:50,437 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:50,439 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:50,442 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:50,442 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:50,444 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:50,446 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:50,447 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:50,454 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:50,454 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:50,455 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:50,456 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:50,456 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:50,457 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:50,457 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:50,458 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:50,482 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:50,959 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:50,960 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:50,961 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:50,962 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:50,962 - APP.services.mt5_service - DEBUG - Current price (cp): 24712.3
2025-10-13 08:42:50,965 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 231, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:51,011 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:51,012 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:51,012 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:51,015 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:51,015 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:51,016 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:51,016 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:51,019 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:51,020 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:51,020 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:51,021 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:51,022 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:51,022 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:51,023 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:51,027 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:51,035 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:51,054 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:51,055 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:51,056 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:51,061 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:51,061 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:51,062 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:51,062 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:51,063 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:50+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:51,063 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:50+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:51,064 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:50+07:00
2025-10-13 08:42:51,064 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:50+07:00 trong DST: True
2025-10-13 08:42:51,064 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:51,065 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:51,066 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:51,067 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:51,068 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.672985871075
2025-10-13 08:42:51,069 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:51,069 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.672985871075
2025-10-13 08:42:51,071 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.672985871075, 'asia': 24728.672985871075, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:51,072 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:51,072 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.312927129664
2025-10-13 08:42:51,073 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:51,073 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.86287761665
2025-10-13 08:42:51,074 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:51,074 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.071066505523
2025-10-13 08:42:51,075 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:51,075 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.339352307856
2025-10-13 08:42:51,075 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:51,076 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.251333564076
2025-10-13 08:42:51,076 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:51,076 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.138583047217
2025-10-13 08:42:51,077 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:51,077 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.228891776926
2025-10-13 08:42:51,078 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:51,078 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.69637052227
2025-10-13 08:42:51,078 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.312927129664, 'ema200': 24711.86287761665}, 'M5': {'ema50': 24698.071066505523, 'ema200': 24620.339352307856}, 'M15': {'ema50': 24678.251333564076, 'ema200': 24881.138583047217}, 'H1': {'ema50': 24847.228891776926, 'ema200': 24939.69637052227}}
2025-10-13 08:42:51,079 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:51,080 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:51,080 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:51,081 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:51,081 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:51,081 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:51,082 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:51,082 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:51,083 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:51,083 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:51,084 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24712.3, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:51,084 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:51,084 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:51,085 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:51,085 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:51,086 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7598.999999999796
2025-10-13 08:42:51,089 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25252.999999999884
2025-10-13 08:42:51,089 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1924.4999999998981
2025-10-13 08:42:51,125 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8370.000000000073
2025-10-13 08:42:51,126 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:51,126 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7598.999999999796}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25252.999999999884}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1924.4999999998981}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8370.000000000073}]
2025-10-13 08:42:51,127 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:51,128 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:51,129 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:51,130 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:51,130 - APP.services.mt5_service - DEBUG - Position in day range: 0.601733890151711
2025-10-13 08:42:51,131 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:50+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:51,131 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:50+07:00
2025-10-13 08:42:51,132 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:50+07:00 trong DST: True
2025-10-13 08:42:51,132 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:51,132 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:51,133 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:51,133 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,133 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:51,134 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3000', 'price': 24712.3, 'distance_pips': 0.0}, {'level': '3025', 'price': 24712.3, 'distance_pips': 0.25}, {'level': '3050', 'price': 24712.31, 'distance_pips': 0.5}, {'level': '3075', 'price': 24712.31, 'distance_pips': 0.75}]
2025-10-13 08:42:51,134 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:51,135 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,135 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:51,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:51,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.3
2025-10-13 08:42:51,137 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:51,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:51,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:51,139 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:51,140 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:51,140 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24712.3
2025-10-13 08:42:51,141 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:51,141 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:51,142 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:51,143 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:51,143 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:51,144 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24712.3
2025-10-13 08:42:51,145 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:51,145 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:51,146 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:51,146 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:51,147 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:51,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.3
2025-10-13 08:42:51,148 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:51,151 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:51,152 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:51,191 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:51,192 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,193 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:51,193 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:51,194 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:51,194 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:51,195 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:51,197 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:51,197 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:51,198 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:51,198 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:51,198 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:51,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:51,199 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:51,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:51,200 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:51,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:51,201 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:51,201 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:51,201 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,203 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:51,203 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:51,204 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:51,204 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:51,205 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:51,205 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:51,207 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:51,210 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,212 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:51,213 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:51,215 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24712.3, 'ask': 24712.3, 'last': 0.0, 'time': 1760344970}
2025-10-13 08:42:51,251 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:51,253 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:51,254 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:51,255 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:51,255 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,256 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:51,256 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,256 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:51,257 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:51,257 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:51,258 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24712.3
2025-10-13 08:42:51,258 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7598.999999999796}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25252.999999999884}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1924.4999999998981}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8370.000000000073}]
2025-10-13 08:42:51,258 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:51,260 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-13 08:42:51,342 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:51,342 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:51,343 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.46, 'free_margin': 108.96, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:51,344 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24712.3, 'profit': -0.26, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24712.3, 'profit': -0.26, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:51,345 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:51,440 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:51,441 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:51,443 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:51,445 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:51,446 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:51,447 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:51,447 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:51,448 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:42:51,457 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:51,458 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:51,459 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:51,459 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:51,460 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:51,461 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:51,462 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:51,463 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:51,547 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:51,965 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:51,969 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:51,972 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:51,973 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:51,974 - APP.services.mt5_service - DEBUG - Current price (cp): 24712.17
2025-10-13 08:42:51,979 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 231, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:52,034 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:52,036 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:52,038 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:52,041 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:52,041 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:52,041 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:52,042 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:52,047 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:52,048 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:52,049 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:52,050 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:52,055 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:52,084 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:52,085 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:52,093 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:52,097 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:52,098 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:52,098 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:52,099 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:52,102 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:52,103 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:52,103 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:52,104 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:52,104 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:51+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:52,105 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:51+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:52,105 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:51+07:00
2025-10-13 08:42:52,106 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:51+07:00 trong DST: True
2025-10-13 08:42:52,106 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:52,107 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:52,107 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:52,108 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:52,108 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.672344985953
2025-10-13 08:42:52,110 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:52,111 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.672344985953
2025-10-13 08:42:52,113 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.672344985953, 'asia': 24728.672344985953, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:52,114 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:52,114 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.30782909045
2025-10-13 08:42:52,114 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:52,115 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.861584084312
2025-10-13 08:42:52,115 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:52,115 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.065968466308
2025-10-13 08:42:52,116 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:52,116 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.338058775516
2025-10-13 08:42:52,117 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:52,117 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.24623552486
2025-10-13 08:42:52,117 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:52,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.137289514878
2025-10-13 08:42:52,160 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:52,161 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.22379373771
2025-10-13 08:42:52,162 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:52,162 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.69507698993
2025-10-13 08:42:52,163 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.30782909045, 'ema200': 24711.861584084312}, 'M5': {'ema50': 24698.065968466308, 'ema200': 24620.338058775516}, 'M15': {'ema50': 24678.24623552486, 'ema200': 24881.137289514878}, 'H1': {'ema50': 24847.22379373771, 'ema200': 24939.69507698993}}
2025-10-13 08:42:52,164 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:52,165 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:52,165 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:52,166 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:52,166 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:52,167 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:52,167 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:52,168 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:52,168 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:52,169 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:52,169 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24712.17, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:52,170 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:52,170 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:52,172 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:52,172 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:52,173 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7585.999999999694
2025-10-13 08:42:52,173 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25239.99999999978
2025-10-13 08:42:52,173 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1911.4999999997963
2025-10-13 08:42:52,174 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8356.99999999997
2025-10-13 08:42:52,174 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:52,174 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7585.999999999694}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25239.99999999978}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1911.4999999997963}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8356.99999999997}]
2025-10-13 08:42:52,175 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:52,175 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:52,176 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:52,176 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:52,177 - APP.services.mt5_service - DEBUG - Position in day range: 0.6010466775915745
2025-10-13 08:42:52,177 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:51+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:52,177 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:51+07:00
2025-10-13 08:42:52,178 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:51+07:00 trong DST: True
2025-10-13 08:42:52,178 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:52,179 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:52,179 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:52,180 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,181 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:52,183 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 24712.17, 'distance_pips': 0.0}, {'level': '1725', 'price': 24712.17, 'distance_pips': 0.25}, {'level': '1750', 'price': 24712.18, 'distance_pips': 0.5}, {'level': '1775', 'price': 24712.18, 'distance_pips': 0.75}]
2025-10-13 08:42:52,184 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:52,184 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,185 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:52,185 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:52,186 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.17
2025-10-13 08:42:52,187 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:52,187 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:52,188 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:52,188 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:52,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:52,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24712.17
2025-10-13 08:42:52,189 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:52,190 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:52,191 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:52,191 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:52,191 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:52,198 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24712.17
2025-10-13 08:42:52,227 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:52,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:52,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:52,229 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:52,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:52,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.17
2025-10-13 08:42:52,232 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:52,233 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:52,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:52,235 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:52,235 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,236 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:52,236 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:52,236 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:52,237 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:52,237 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:52,237 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:52,238 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:52,238 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:52,239 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:52,239 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:52,240 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:52,240 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:52,241 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:52,241 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:52,242 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:52,243 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:52,245 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:52,245 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,246 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:52,253 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:52,284 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:52,285 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:52,285 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:52,286 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:52,291 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:52,293 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,295 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:52,295 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:52,295 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24712.17, 'ask': 24712.17, 'last': 0.0, 'time': 1760344971}
2025-10-13 08:42:52,298 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:52,299 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:52,299 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:52,299 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:52,300 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,301 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:52,301 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,301 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:52,302 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:52,302 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:52,302 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24712.17
2025-10-13 08:42:52,303 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7585.999999999694}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25239.99999999978}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1911.4999999997963}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8356.99999999997}]
2025-10-13 08:42:52,303 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:52,309 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-13 08:42:52,441 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:52,442 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:52,443 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.37, 'free_margin': 108.87, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:52,444 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24712.17, 'profit': -0.26, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24712.17, 'profit': -0.26, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:52,444 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:52,445 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:52,446 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:52,447 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:52,449 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:52,450 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:52,451 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:52,452 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:52,452 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:42:52,463 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:52,464 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:52,496 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:52,497 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:52,498 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:52,499 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:52,499 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:52,502 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:52,545 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:53,004 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:53,005 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:53,006 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:53,006 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:53,007 - APP.services.mt5_service - DEBUG - Current price (cp): 24712.17
2025-10-13 08:42:53,010 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 227, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:53,058 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:53,059 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:53,059 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:53,062 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:53,062 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:53,063 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:53,063 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:53,068 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:53,094 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:53,096 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:53,098 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:53,100 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:53,102 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:53,102 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:53,103 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:53,105 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:53,106 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:53,106 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:53,107 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:53,110 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:53,111 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:53,111 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:53,112 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:53,112 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:51+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:53,113 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:51+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:53,113 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:51+07:00
2025-10-13 08:42:53,114 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:51+07:00 trong DST: True
2025-10-13 08:42:53,114 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:53,114 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:53,115 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:53,116 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:53,116 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.672344985953
2025-10-13 08:42:53,118 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:53,120 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.672344985953
2025-10-13 08:42:53,156 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.672344985953, 'asia': 24728.672344985953, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:53,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:53,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.30782909045
2025-10-13 08:42:53,157 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:53,158 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.861584084312
2025-10-13 08:42:53,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:53,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.065968466308
2025-10-13 08:42:53,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:53,160 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.338058775516
2025-10-13 08:42:53,160 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:53,161 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.24623552486
2025-10-13 08:42:53,161 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:53,162 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.137289514878
2025-10-13 08:42:53,162 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:53,163 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.22379373771
2025-10-13 08:42:53,163 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:53,164 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.69507698993
2025-10-13 08:42:53,164 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.30782909045, 'ema200': 24711.861584084312}, 'M5': {'ema50': 24698.065968466308, 'ema200': 24620.338058775516}, 'M15': {'ema50': 24678.24623552486, 'ema200': 24881.137289514878}, 'H1': {'ema50': 24847.22379373771, 'ema200': 24939.69507698993}}
2025-10-13 08:42:53,165 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:53,165 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:53,166 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:53,166 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:53,167 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:53,167 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:53,168 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:53,168 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:53,169 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:53,169 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:53,170 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24712.17, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:53,170 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:53,170 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:53,171 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:53,171 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:53,171 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7585.999999999694
2025-10-13 08:42:53,172 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25239.99999999978
2025-10-13 08:42:53,172 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1911.4999999997963
2025-10-13 08:42:53,173 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8356.99999999997
2025-10-13 08:42:53,173 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:53,174 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7585.999999999694}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25239.99999999978}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1911.4999999997963}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8356.99999999997}]
2025-10-13 08:42:53,174 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:53,175 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:53,175 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:53,176 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:53,176 - APP.services.mt5_service - DEBUG - Position in day range: 0.6010466775915745
2025-10-13 08:42:53,176 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:51+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:53,177 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:51+07:00
2025-10-13 08:42:53,177 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:51+07:00 trong DST: True
2025-10-13 08:42:53,177 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:53,178 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:53,178 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:53,179 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,179 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:53,182 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 24712.17, 'distance_pips': 0.0}, {'level': '1725', 'price': 24712.17, 'distance_pips': 0.25}, {'level': '1750', 'price': 24712.18, 'distance_pips': 0.5}, {'level': '1775', 'price': 24712.18, 'distance_pips': 0.75}]
2025-10-13 08:42:53,182 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:53,183 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,184 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:53,184 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:53,185 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.17
2025-10-13 08:42:53,186 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:53,186 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:53,187 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:53,188 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:53,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:53,190 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24712.17
2025-10-13 08:42:53,219 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:53,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:53,221 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:53,222 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:53,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:53,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24712.17
2025-10-13 08:42:53,226 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:53,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:53,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:53,228 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:53,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:53,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.17
2025-10-13 08:42:53,230 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:53,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:53,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:53,233 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:53,234 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,234 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:53,234 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:53,235 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:53,235 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:53,235 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:53,236 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:53,236 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:53,237 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:53,237 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:53,237 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:53,238 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:53,238 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:53,239 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:53,239 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:53,239 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:53,240 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:53,240 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:53,240 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,241 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:53,241 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:53,241 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:53,242 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:53,244 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:53,245 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:53,282 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:53,285 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,287 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:53,288 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24712.17, 'ask': 24712.17, 'last': 0.0, 'time': 1760344971}
2025-10-13 08:42:53,288 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:53,289 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:53,291 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:53,292 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:53,292 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:53,293 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,294 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:53,294 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,295 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:53,295 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:53,295 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:53,296 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24712.17
2025-10-13 08:42:53,296 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7585.999999999694}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25239.99999999978}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1911.4999999997963}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8356.99999999997}]
2025-10-13 08:42:53,296 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:53,298 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-13 08:42:53,398 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:53,409 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:53,409 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.26, 'free_margin': 108.76, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:53,410 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24712.17, 'profit': -0.26, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24712.17, 'profit': -0.26, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:53,411 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:53,448 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:53,467 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:53,468 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:53,472 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:53,473 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:53,474 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:53,475 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:53,476 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:42:53,484 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:53,485 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:53,485 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:53,486 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:53,486 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:53,487 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:53,488 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:53,488 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:53,516 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:53,989 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:53,991 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:53,992 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:53,992 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:53,993 - APP.services.mt5_service - DEBUG - Current price (cp): 24712.07
2025-10-13 08:42:53,996 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 227, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:54,047 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:54,048 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:54,048 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:54,051 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:54,051 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:54,052 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:54,053 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:54,058 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:54,084 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:54,085 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:54,086 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:54,089 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:54,091 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:54,092 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:54,092 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:54,094 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:54,095 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:54,095 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:54,096 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:54,099 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:54,099 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:54,100 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:54,100 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:54,101 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:53+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:54,101 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:53+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:54,102 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:53+07:00
2025-10-13 08:42:54,102 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:53+07:00 trong DST: True
2025-10-13 08:42:54,103 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:54,103 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:54,103 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:54,104 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:54,105 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.67174368152
2025-10-13 08:42:54,106 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:54,106 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.67174368152
2025-10-13 08:42:54,109 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.67174368152, 'asia': 24728.67174368152, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:54,109 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:54,110 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.303907521822
2025-10-13 08:42:54,110 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:54,111 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.860589059437
2025-10-13 08:42:54,111 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:54,111 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.06204689768
2025-10-13 08:42:54,112 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:54,112 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.33706375064
2025-10-13 08:42:54,112 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:54,113 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.242313956234
2025-10-13 08:42:54,113 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:54,113 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.136294490003
2025-10-13 08:42:54,114 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:54,114 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.219872169084
2025-10-13 08:42:54,115 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:54,115 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.694081965055
2025-10-13 08:42:54,115 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.303907521822, 'ema200': 24711.860589059437}, 'M5': {'ema50': 24698.06204689768, 'ema200': 24620.33706375064}, 'M15': {'ema50': 24678.242313956234, 'ema200': 24881.136294490003}, 'H1': {'ema50': 24847.219872169084, 'ema200': 24939.694081965055}}
2025-10-13 08:42:54,116 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:54,116 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:54,117 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:54,119 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:54,120 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:54,121 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:54,135 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:54,137 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:54,140 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:54,144 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:54,145 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24712.07, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:54,157 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:54,158 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:54,158 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:54,159 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:54,159 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7575.99999999984
2025-10-13 08:42:54,160 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25229.999999999927
2025-10-13 08:42:54,161 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1901.4999999999418
2025-10-13 08:42:54,161 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8347.000000000116
2025-10-13 08:42:54,163 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:54,165 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7575.99999999984}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25229.999999999927}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1901.4999999999418}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8347.000000000116}]
2025-10-13 08:42:54,166 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:54,167 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:54,167 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:54,168 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:54,168 - APP.services.mt5_service - DEBUG - Position in day range: 0.6005180525453274
2025-10-13 08:42:54,168 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:53+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:54,169 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:53+07:00
2025-10-13 08:42:54,170 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:53+07:00 trong DST: True
2025-10-13 08:42:54,171 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:54,172 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:54,173 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:54,173 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,173 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:54,174 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '700', 'price': 24712.07, 'distance_pips': 0.0}, {'level': '725', 'price': 24712.07, 'distance_pips': 0.25}, {'level': '750', 'price': 24712.08, 'distance_pips': 0.5}, {'level': '775', 'price': 24712.08, 'distance_pips': 0.75}]
2025-10-13 08:42:54,174 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:54,175 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,175 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:54,175 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:54,176 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.07
2025-10-13 08:42:54,177 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:54,177 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:54,178 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:54,178 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:54,183 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:54,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24712.07
2025-10-13 08:42:54,225 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:54,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:54,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:54,228 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:54,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:54,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24712.07
2025-10-13 08:42:54,230 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:54,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:54,233 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:54,233 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:54,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:54,235 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24712.07
2025-10-13 08:42:54,236 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:54,236 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:54,237 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:54,237 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:54,238 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,238 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:54,239 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:54,239 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:54,240 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:54,240 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:54,240 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:54,241 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:54,241 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:54,242 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:54,242 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:54,242 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:54,243 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:54,245 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:54,246 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:54,246 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:54,247 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:54,284 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:54,287 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,287 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:54,288 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:54,288 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:54,289 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:54,289 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:54,290 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:54,293 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:54,297 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,299 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:54,300 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:54,300 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24712.07, 'ask': 24712.07, 'last': 0.0, 'time': 1760344973}
2025-10-13 08:42:54,303 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:54,304 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:54,305 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:54,310 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:54,312 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,312 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:54,313 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,314 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:54,314 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:54,315 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:54,315 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24712.07
2025-10-13 08:42:54,316 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7575.99999999984}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25229.999999999927}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1901.4999999999418}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8347.000000000116}]
2025-10-13 08:42:54,317 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:54,349 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-13 08:42:54,368 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:54,371 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:54,371 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.32, 'free_margin': 108.82, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:54,410 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24712.07, 'profit': -0.25, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24712.07, 'profit': -0.26, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:54,413 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:54,472 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:54,473 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:54,475 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:54,477 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:54,478 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:54,479 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:54,480 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:54,481 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:54,488 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:54,489 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:54,490 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:54,490 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:54,491 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:54,491 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:54,492 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:54,493 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:54,520 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:54,993 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:54,995 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:54,996 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:54,996 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:54,997 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.74
2025-10-13 08:42:55,000 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 227, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:55,050 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:55,051 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:55,051 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:55,054 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:55,055 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:55,055 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:55,056 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:55,065 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:55,084 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:55,085 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:55,085 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:55,089 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:55,092 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:55,093 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:55,093 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:55,095 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:55,096 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:55,097 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:55,098 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:55,101 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:55,102 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:55,102 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:55,103 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:55,103 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:54+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:55,104 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:54+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:55,104 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:54+07:00
2025-10-13 08:42:55,105 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:54+07:00 trong DST: True
2025-10-13 08:42:55,105 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:55,106 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:55,106 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:55,107 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:55,108 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.664683364386
2025-10-13 08:42:55,110 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:55,111 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.664683364386
2025-10-13 08:42:55,113 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.664683364386, 'asia': 24728.664683364386, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:55,114 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:55,114 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.251750659078
2025-10-13 08:42:55,114 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:55,115 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.84735522859
2025-10-13 08:42:55,115 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:55,116 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24698.009890034937
2025-10-13 08:42:55,116 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:55,117 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.323829919795
2025-10-13 08:42:55,117 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:55,117 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.19015709349
2025-10-13 08:42:55,118 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:55,122 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.123060659156
2025-10-13 08:42:55,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:55,160 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.16771530634
2025-10-13 08:42:55,160 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:55,161 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.68084813421
2025-10-13 08:42:55,162 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.251750659078, 'ema200': 24711.84735522859}, 'M5': {'ema50': 24698.009890034937, 'ema200': 24620.323829919795}, 'M15': {'ema50': 24678.19015709349, 'ema200': 24881.123060659156}, 'H1': {'ema50': 24847.16771530634, 'ema200': 24939.68084813421}}
2025-10-13 08:42:55,163 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:55,163 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:55,164 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:55,165 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:55,166 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:55,166 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:55,167 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:55,167 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:55,168 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:55,168 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:55,169 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.74, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:55,169 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:55,170 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:55,171 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:55,172 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:55,172 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7443.000000000029
2025-10-13 08:42:55,173 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25097.000000000116
2025-10-13 08:42:55,173 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1768.500000000131
2025-10-13 08:42:55,174 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8214.000000000306
2025-10-13 08:42:55,174 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:55,174 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7443.000000000029}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25097.000000000116}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1768.500000000131}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8214.000000000306}]
2025-10-13 08:42:55,175 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:55,175 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:55,176 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:55,177 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:55,177 - APP.services.mt5_service - DEBUG - Position in day range: 0.59348733943015
2025-10-13 08:42:55,177 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:54+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:55,178 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:54+07:00
2025-10-13 08:42:55,178 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:54+07:00 trong DST: True
2025-10-13 08:42:55,179 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:55,179 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:55,179 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:55,180 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,183 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:55,191 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7400', 'price': 24710.74, 'distance_pips': 0.0}, {'level': '7425', 'price': 24710.74, 'distance_pips': 0.25}, {'level': '7450', 'price': 24710.75, 'distance_pips': 0.5}, {'level': '7475', 'price': 24710.75, 'distance_pips': 0.75}]
2025-10-13 08:42:55,221 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:55,222 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,224 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:55,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:55,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.74
2025-10-13 08:42:55,228 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:55,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:55,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:55,230 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:55,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:55,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.74
2025-10-13 08:42:55,232 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:55,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:55,233 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:55,234 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:55,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:55,235 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.74
2025-10-13 08:42:55,236 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:55,236 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:55,237 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:55,237 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:55,237 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:55,238 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.74
2025-10-13 08:42:55,239 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:55,239 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:55,240 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:55,241 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:55,241 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,241 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:55,242 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:55,242 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:55,242 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:55,243 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:55,246 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:55,247 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:55,289 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:55,292 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:55,293 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:55,295 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:55,295 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:55,296 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:55,296 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:55,297 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:55,297 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:55,297 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:55,298 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,298 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:55,299 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:55,299 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:55,300 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:55,301 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:55,302 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:55,303 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:55,309 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,347 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:55,347 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:55,348 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.74, 'ask': 24710.74, 'last': 0.0, 'time': 1760344974}
2025-10-13 08:42:55,350 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:55,351 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:55,352 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:55,352 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:55,353 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,353 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:55,354 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,354 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:55,354 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:55,355 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:55,355 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.74
2025-10-13 08:42:55,356 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7443.000000000029}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25097.000000000116}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1768.500000000131}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8214.000000000306}]
2025-10-13 08:42:55,356 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:55,357 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-13 08:42:55,378 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:55,410 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:55,411 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.51, 'free_margin': 109.01, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:55,412 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.74, 'profit': -0.23, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.74, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:55,413 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:55,477 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:55,478 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:55,480 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:55,482 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:55,483 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:55,484 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:55,485 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:55,486 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:42:55,501 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:55,502 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:55,503 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:55,508 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:55,515 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:55,539 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:55,568 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:55,702 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:55,747 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:56,250 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:56,251 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:56,252 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:56,252 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:56,253 - APP.services.mt5_service - DEBUG - Current price (cp): 24710.49
2025-10-13 08:42:56,256 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 226, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:56,290 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:56,308 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:56,309 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:56,312 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:56,313 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:56,313 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:56,314 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:56,319 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:56,319 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:56,320 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:56,321 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:56,322 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:56,323 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:56,323 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:56,324 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:56,326 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:56,326 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:56,326 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:56,327 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:56,329 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:56,330 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:56,330 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:56,330 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:56,331 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:55+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:56,332 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:55+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:56,332 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:55+07:00
2025-10-13 08:42:56,333 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:55+07:00 trong DST: True
2025-10-13 08:42:56,334 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:56,334 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:56,334 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:56,336 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:56,336 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.659478898673
2025-10-13 08:42:56,396 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:56,397 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.659478898673
2025-10-13 08:42:56,412 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.659478898673, 'asia': 24728.659478898673, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:56,442 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:56,443 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.20351536496
2025-10-13 08:42:56,443 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:56,444 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.835116422622
2025-10-13 08:42:56,445 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:42:56,445 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.96165474082
2025-10-13 08:42:56,445 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:42:56,446 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.311591113827
2025-10-13 08:42:56,446 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:42:56,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.14192179937
2025-10-13 08:42:56,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:42:56,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.110821853188
2025-10-13 08:42:56,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:56,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.11948001222
2025-10-13 08:42:56,451 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:42:56,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.66860932824
2025-10-13 08:42:56,452 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.20351536496, 'ema200': 24711.835116422622}, 'M5': {'ema50': 24697.96165474082, 'ema200': 24620.311591113827}, 'M15': {'ema50': 24678.14192179937, 'ema200': 24881.110821853188}, 'H1': {'ema50': 24847.11948001222, 'ema200': 24939.66860932824}}
2025-10-13 08:42:56,452 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:42:56,453 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:42:56,454 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:56,454 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:42:56,455 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:42:56,455 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:42:56,456 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:42:56,456 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:42:56,456 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:42:56,457 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:42:56,457 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24710.49, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:56,458 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:42:56,458 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:42:56,459 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:42:56,459 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:42:56,459 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7418.000000000029
2025-10-13 08:42:56,460 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 25072.000000000116
2025-10-13 08:42:56,460 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1743.500000000131
2025-10-13 08:42:56,460 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8189.000000000306
2025-10-13 08:42:56,460 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:42:56,461 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7418.000000000029}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25072.000000000116}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1743.500000000131}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8189.000000000306}]
2025-10-13 08:42:56,482 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:56,501 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:42:56,505 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:56,505 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:42:56,506 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:56,507 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:42:56,508 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:56,508 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:42:56,509 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:56,509 - APP.services.mt5_service - DEBUG - Position in day range: 0.5921657768145132
2025-10-13 08:42:56,510 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:42:56,510 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:55+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:56,511 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:55+07:00
2025-10-13 08:42:56,511 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:55+07:00 trong DST: True
2025-10-13 08:42:56,511 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:56,512 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:56,512 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:42:56,512 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:56,513 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:56,513 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4900', 'price': 24710.49, 'distance_pips': 0.0}, {'level': '4925', 'price': 24710.49, 'distance_pips': 0.25}, {'level': '4950', 'price': 24710.5, 'distance_pips': 0.5}, {'level': '4975', 'price': 24710.5, 'distance_pips': 0.75}]
2025-10-13 08:42:56,513 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:42:56,514 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:56,514 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:56,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:56,515 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.49
2025-10-13 08:42:56,516 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:56,516 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:56,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:56,517 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:42:56,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:42:56,518 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24710.49
2025-10-13 08:42:56,518 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:56,519 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:42:56,519 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:56,520 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:42:56,520 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:42:56,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24710.49
2025-10-13 08:42:56,521 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:56,522 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:42:56,522 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:56,523 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:42:56,523 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:42:56,524 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24710.49
2025-10-13 08:42:56,525 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:42:56,526 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:42:56,527 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:42:56,528 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:42:56,541 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:56,553 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:56,585 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:56,653 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:56,696 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:56,718 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:56,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:56,786 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:56,823 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:56,901 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:56,907 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:56,911 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:42:56,915 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:42:56,917 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:42:56,919 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:42:56,920 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:42:56,923 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:42:56,926 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:42:56,927 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:42:56,928 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:56,929 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:56,934 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:42:56,936 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:42:56,939 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:42:56,941 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:42:56,944 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:56,946 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:42:56,956 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:56,967 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:42:56,974 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24710.49, 'ask': 24710.49, 'last': 0.0, 'time': 1760344975}
2025-10-13 08:42:56,974 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:42:56,979 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:42:56,983 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:42:56,994 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:42:56,998 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:42:56,999 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:57,001 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:57,003 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:57,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:42:57,007 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:42:57,009 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:57,013 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24710.49
2025-10-13 08:42:57,018 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7418.000000000029}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 25072.000000000116}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1743.500000000131}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8189.000000000306}]
2025-10-13 08:42:57,039 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:42:57,045 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.57s
2025-10-13 08:42:57,066 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:57,070 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:42:57,071 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.27, 'free_margin': 108.77, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:42:57,072 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24710.49, 'profit': -0.22, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24710.49, 'profit': -0.23, 'comment': 'AI Trade TP2'}]
2025-10-13 08:42:57,074 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:42:57,507 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:57,590 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:57,592 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:42:57,598 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:57,601 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:57,609 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:57,611 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:57,611 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:57,612 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:57,613 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:57,614 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-13 08:42:57,614 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:42:57,615 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:42:57,616 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:42:57,617 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:42:57,618 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:42:57,699 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:58,124 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:42:58,185 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:42:58,273 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:42:58,356 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:42:58,381 - APP.services.mt5_service - DEBUG - Current price (cp): 24708.77
2025-10-13 08:42:58,414 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 228, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:42:58,549 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 290, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:42:58,793 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:42:58,801 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:58,807 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:42:58,809 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:42:58,914 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:59,027 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:42:59,029 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:59,066 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:42:59,135 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:42:59,178 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:42:59,180 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-13 08:42:59,186 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:42:59,194 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:42:59,254 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:42:59,364 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:42:59,450 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:59,459 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:59,472 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.45s
2025-10-13 08:42:59,485 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:42:59,497 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:42:59,504 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:42:59,506 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:59,507 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:42:59,507 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:42:59,510 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:42:59,512 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:42:59,513 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:42:59,513 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:42:59,516 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:42:59,518 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:42:59,518 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:42:59,519 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:42:59,519 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:42:57+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:42:59,520 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:57+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:42:59,520 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:57+07:00
2025-10-13 08:42:59,521 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:57+07:00 trong DST: True
2025-10-13 08:42:59,521 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:42:59,521 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:42:59,522 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:42:59,523 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:59,526 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64918577121
2025-10-13 08:42:59,532 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:42:59,533 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.64918577121
2025-10-13 08:42:59,546 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.64918577121, 'asia': 24728.64918577121, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:42:59,559 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:42:59,560 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:42:59,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24720.154887913977
2025-10-13 08:43:00,145 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:00,162 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:00,268 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:00,427 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24711.822778114165
2025-10-13 08:43:00,486 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:00,608 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:00,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:00,848 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:00,943 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.908713564346
2025-10-13 08:43:00,950 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.68s
2025-10-13 08:43:00,950 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:00,963 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.298158278005
2025-10-13 08:43:00,966 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:00,967 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.0889806229
2025-10-13 08:43:00,968 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:00,968 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.097389017366
2025-10-13 08:43:00,973 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:00,979 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.06653883575
2025-10-13 08:43:00,980 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:00,985 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65517649242
2025-10-13 08:43:00,991 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24720.154887913977, 'ema200': 24711.822778114165}, 'M5': {'ema50': 24697.908713564346, 'ema200': 24620.298158278005}, 'M15': {'ema50': 24678.0889806229, 'ema200': 24881.097389017366}, 'H1': {'ema50': 24847.06653883575, 'ema200': 24939.65517649242}}
2025-10-13 08:43:00,992 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:01,003 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:01,027 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:01,028 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:01,115 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 8.08496704814084, TRs count: 119
2025-10-13 08:43:01,193 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:01,320 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:01,325 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:01,399 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:01,475 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 8.08496704814084, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:01,513 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:01,517 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24708.77, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:01,539 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:01,540 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:01,546 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:01,550 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:01,552 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:01,555 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:01,558 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 7245.999999999913
2025-10-13 08:43:01,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:01,559 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24900.0
2025-10-13 08:43:01,562 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:01,563 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1571.5000000000146
2025-10-13 08:43:01,563 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:01,564 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 8017.000000000189
2025-10-13 08:43:01,566 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:01,567 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:01,568 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7245.999999999913}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24900.0}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1571.5000000000146}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8017.000000000189}]
2025-10-13 08:43:01,568 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:01,569 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:01,598 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:01,619 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:01,623 - APP.services.mt5_service - DEBUG - Position in day range: 0.5830734260189263
2025-10-13 08:43:01,624 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:42:57+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:01,625 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:42:57+07:00
2025-10-13 08:43:01,629 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:42:57+07:00 trong DST: True
2025-10-13 08:43:01,629 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:01,630 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:01,630 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:01,636 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:01,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:01,637 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7700', 'price': 24708.77, 'distance_pips': 0.0}, {'level': '7725', 'price': 24708.77, 'distance_pips': 0.25}, {'level': '7750', 'price': 24708.78, 'distance_pips': 0.5}, {'level': '7775', 'price': 24708.78, 'distance_pips': 0.75}]
2025-10-13 08:43:01,656 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:01,672 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:01,757 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:01,782 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:01,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:01,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24708.77
2025-10-13 08:43:01,866 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:02,046 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:02,128 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:02,222 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:02,236 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:02,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24708.77
2025-10-13 08:43:02,278 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:02,286 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:02,315 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:02,317 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:02,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:02,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24708.77
2025-10-13 08:43:02,363 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:02,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:02,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:02,369 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:02,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:02,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24708.77
2025-10-13 08:43:02,375 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:02,377 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:02,379 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:02,380 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:02,383 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:02,384 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:02,384 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:02,385 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:02,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:02,432 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:02,448 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:02,450 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:02,452 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:02,453 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:02,454 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:02,458 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:02,460 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:02,461 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:02,516 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:02,569 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:02,571 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:02,590 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:02,593 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:02,598 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:02,600 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:02,602 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:02,602 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:02,604 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:02,608 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:02,610 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:02,611 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:02,612 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:02,614 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-13 08:43:02,615 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:02,617 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:02,626 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:02,632 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:02,634 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:02,634 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:02,635 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24708.77, 'ask': 24708.77, 'last': 0.0, 'time': 1760344977}
2025-10-13 08:43:02,637 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:02,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:02,640 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:02,640 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:02,642 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:02,643 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:02,645 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:02,714 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:02,810 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:03,040 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:03,073 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:03,092 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24708.77
2025-10-13 08:43:03,235 - APP.services.gemini_service - INFO - Lần thử 1: Kết nối stream tới Gemini API thành công.
2025-10-13 08:43:03,274 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 7245.999999999913}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24900.0}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1571.5000000000146}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 8017.000000000189}]
2025-10-13 08:43:03,310 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:03,338 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 5.75s
2025-10-13 08:43:03,359 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:03,362 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:03,363 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.48, 'free_margin': 108.98, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:03,365 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24708.77, 'profit': -0.19, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24708.77, 'profit': -0.19, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:03,367 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:03,573 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:03,589 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:03,591 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:03,601 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:03,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:03,628 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:03,635 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:03,638 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:03,640 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:03,643 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:03,646 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:03,647 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-13 08:43:03,648 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:03,701 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:03,705 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:03,776 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:03,821 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:03,956 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:04,069 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:04,083 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:04,093 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:04,393 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:04,501 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:04,538 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:04,539 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:04,540 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:04,541 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:04,541 - APP.services.mt5_service - DEBUG - Current price (cp): 24701.18
2025-10-13 08:43:04,547 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:04,584 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:04,584 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:04,585 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:04,588 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:04,589 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:04,589 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:04,589 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:04,594 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:04,595 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:04,595 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:04,596 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:04,598 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:04,599 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:04,599 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:04,600 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:04,603 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:04,603 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:04,604 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:04,604 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:04,607 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:04,620 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:04,624 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:04,636 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:04,639 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:04,640 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:04,641 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:04,642 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:04+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:04,644 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:04,645 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:04+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:04,646 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:04,646 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:04+07:00
2025-10-13 08:43:04,648 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:04,649 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:04+07:00 trong DST: True
2025-10-13 08:43:04,650 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:04,652 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:04,653 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:04,654 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:04,655 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:04,658 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:04,659 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:04,662 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:04,665 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:04,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:04,667 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:04,668 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:04,669 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:04,669 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:04,670 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:04,673 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:04,674 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:04,674 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:04,675 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:04,675 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:04,676 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:04,677 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:04,739 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:04,739 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:04,763 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:04,771 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:04,782 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:04,788 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:04,800 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:05,113 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:05,132 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:05,151 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:05,211 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:05,219 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:05,256 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:05,257 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:05,263 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:05,264 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:05,265 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24701.18, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:05,266 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:05,267 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:05,268 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:05,280 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:05,328 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:05,543 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:05,575 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6486.999999999898
2025-10-13 08:43:05,666 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:05,733 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24140.999999999985
2025-10-13 08:43:05,742 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:05,842 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 812.5
2025-10-13 08:43:05,851 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:05,857 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7258.000000000175
2025-10-13 08:43:05,860 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:05,862 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:05,864 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:05,866 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6486.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24140.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 812.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7258.000000000175}]
2025-10-13 08:43:05,868 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.13s
2025-10-13 08:43:05,881 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:06,235 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:06,314 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:06,357 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:06,519 - APP.services.mt5_service - DEBUG - Position in day range: 0.542950785008194
2025-10-13 08:43:06,519 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:06,633 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:04+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:06,635 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:04+07:00
2025-10-13 08:43:06,653 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:04+07:00 trong DST: True
2025-10-13 08:43:06,655 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:06,661 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:06,669 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:06,670 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:06,671 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:06,671 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1800', 'price': 24701.18, 'distance_pips': 0.0}, {'level': '1825', 'price': 24701.18, 'distance_pips': 0.25}, {'level': '1850', 'price': 24701.19, 'distance_pips': 0.5}, {'level': '1875', 'price': 24701.19, 'distance_pips': 0.75}]
2025-10-13 08:43:06,673 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:06,674 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:06,674 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:06,675 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:06,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:06,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24701.18
2025-10-13 08:43:06,702 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:06,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:06,830 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:06,853 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:06,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:06,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24701.18
2025-10-13 08:43:06,862 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:06,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:06,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:06,868 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:06,871 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:06,873 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:06,874 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24701.18
2025-10-13 08:43:06,882 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:06,890 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:06,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:06,894 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:06,894 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:06,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24701.18
2025-10-13 08:43:06,895 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:06,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:06,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:06,898 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:06,899 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:06,901 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:06,903 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:06,904 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:06,905 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:06,905 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:06,906 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:06,906 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:06,907 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:06,907 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:06,908 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:06,908 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:06,909 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:06,909 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:06,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:06,911 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:06,912 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:06,913 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:06,913 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:06,916 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:06,916 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:06,917 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:06,918 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:06,918 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:06,920 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:06,922 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:06,922 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:06,926 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:06,926 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24701.18, 'ask': 24701.18, 'last': 0.0, 'time': 1760344984}
2025-10-13 08:43:06,964 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:06,965 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:06,977 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:06,993 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:07,047 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:07,065 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,068 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:07,068 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:07,069 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:07,071 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:07,072 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:07,073 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:07,074 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:07,075 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24701.18
2025-10-13 08:43:07,076 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6486.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24140.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 812.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7258.000000000175}]
2025-10-13 08:43:07,077 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:07,079 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.49s
2025-10-13 08:43:07,141 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,197 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,199 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:07,201 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.72, 'free_margin': 109.22, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:07,202 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24701.18, 'profit': -0.04, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24701.18, 'profit': -0.04, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:07,203 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:07,204 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,343 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:07,344 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:07,346 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:07,348 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:07,349 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:07,352 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:07,352 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:07,353 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:07,631 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,827 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:07,907 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:08,205 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:08,308 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:08,313 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:08,315 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:08,316 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:08,316 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:08,318 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:08,319 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:08,320 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:08,360 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:08,387 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:08,708 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:08,822 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:08,824 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:08,825 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:08,826 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:08,827 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:08,827 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:08,827 - APP.services.mt5_service - DEBUG - Current price (cp): 24701.43
2025-10-13 08:43:08,830 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:08,841 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 242, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:08,865 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:08,878 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.52s
2025-10-13 08:43:08,920 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:08,925 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:08,936 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:09,014 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:09,041 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:09,111 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:09,156 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:09,179 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:09,185 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:09,212 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:09,256 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:09,256 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:09,258 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:09,260 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:09,260 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:09,261 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:09,262 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:09,265 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:09,265 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:09,266 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:09,266 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:09,270 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:09,270 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:09,270 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:09,271 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:09,271 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:08+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:09,272 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:08+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:09,274 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:08+07:00
2025-10-13 08:43:09,274 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:08+07:00 trong DST: True
2025-10-13 08:43:09,315 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:09,322 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:09,323 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:09,326 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:09,327 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:09,330 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:09,331 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:09,334 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:09,335 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:09,335 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:09,336 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:09,337 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:09,381 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:09,383 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:09,384 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:09,385 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:09,386 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:09,387 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:09,389 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:09,390 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:09,392 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:09,393 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:09,394 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:09,395 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:09,396 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:09,396 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:09,398 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:09,398 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:09,400 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:09,439 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:09,444 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:09,445 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:09,447 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:09,448 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:09,449 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:09,451 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24701.43, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:09,452 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:09,455 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:09,456 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:09,456 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:09,457 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6511.999999999898
2025-10-13 08:43:09,458 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24165.999999999985
2025-10-13 08:43:09,458 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 837.5
2025-10-13 08:43:09,459 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7283.000000000175
2025-10-13 08:43:09,460 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:09,460 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6511.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24165.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 837.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7283.000000000175}]
2025-10-13 08:43:09,461 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:09,462 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:09,501 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:09,503 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:09,504 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:09,505 - APP.services.mt5_service - DEBUG - Position in day range: 0.5442723476238308
2025-10-13 08:43:09,506 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:08+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:09,507 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:08+07:00
2025-10-13 08:43:09,509 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:08+07:00 trong DST: True
2025-10-13 08:43:09,510 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:09,512 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:09,512 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:09,513 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:09,513 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:09,515 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4300', 'price': 24701.43, 'distance_pips': 0.0}, {'level': '4325', 'price': 24701.43, 'distance_pips': 0.25}, {'level': '4350', 'price': 24701.44, 'distance_pips': 0.5}, {'level': '4375', 'price': 24701.44, 'distance_pips': 0.75}]
2025-10-13 08:43:09,515 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:09,516 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:09,516 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:09,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:09,518 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24701.43
2025-10-13 08:43:09,519 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:09,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:09,523 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:09,526 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:09,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:09,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24701.43
2025-10-13 08:43:09,575 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:09,576 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:09,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:09,581 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:09,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:09,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24701.43
2025-10-13 08:43:09,585 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:09,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:09,587 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:09,678 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:09,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:09,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24701.43
2025-10-13 08:43:09,736 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:09,737 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:09,738 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:09,741 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:09,743 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:09,785 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:09,785 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:09,788 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:09,800 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:09,801 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:09,801 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:09,802 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:09,803 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:09,803 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:09,805 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:09,806 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:09,807 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:09,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:09,850 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:09,852 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:09,857 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:09,859 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:09,861 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:09,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:09,866 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:09,927 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:09,972 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:09,977 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:09,984 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:09,986 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:10,036 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:10,043 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:10,044 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24701.43, 'ask': 24701.43, 'last': 0.0, 'time': 1760344988}
2025-10-13 08:43:10,044 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:10,045 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:10,045 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:10,045 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:10,046 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:10,046 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:10,047 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:10,047 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:10,047 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24701.43
2025-10-13 08:43:10,048 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6511.999999999898}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24165.999999999985}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 837.5}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7283.000000000175}]
2025-10-13 08:43:10,051 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:10,051 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:10,052 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:10,054 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:10,054 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:10,055 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:10,059 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.71s
2025-10-13 08:43:10,239 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:10,353 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:10,354 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:10,354 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.34, 'free_margin': 108.84, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:10,356 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24701.43, 'profit': -0.04, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24701.43, 'profit': -0.05, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:10,357 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:10,358 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:10,518 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:10,639 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:10,640 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:10,642 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:10,644 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:10,645 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:10,646 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:10,648 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:10,657 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:10,950 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:11,111 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:11,246 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:11,396 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:11,519 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:11,843 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:11,845 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:11,846 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:11,846 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:11,848 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:11,848 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:11,849 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:12,049 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:12,358 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:12,479 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:12,613 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:12,743 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:12,889 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:13,008 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:13,010 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:13,011 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:13,012 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:13,013 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:13,014 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-13 08:43:13,237 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:13,453 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:13,583 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:13,733 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:14,063 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:14,396 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:14,581 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:14,765 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:14,955 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:14,957 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:14,958 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:43:14,958 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:14,959 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:43:14,960 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-13 08:43:14,962 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:14,967 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:14,976 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-13 08:43:15,229 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:43:15,230 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:15,346 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:15,520 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:15,640 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:15,732 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:15,803 - APP.services.gemini_service - DEBUG - Stream từ Gemini API hoàn tất.
2025-10-13 08:43:15,809 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 5: Thực thi hoặc quản lý giao dịch.
2025-10-13 08:43:15,816 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.23, 'profit': -0.12, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.23, 'profit': -0.12, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:15,818 - APP.core.analysis_worker - INFO - Có 2 lệnh. Thực hiện quản lý.
2025-10-13 08:43:15,828 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-13 08:43:15,829 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-13 08:43:15,830 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-13 08:43:15,831 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 6 khóa.
2025-10-13 08:43:15,831 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-13 08:43:15,833 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots
2025-10-13 08:43:15,882 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 4 tên file.
2025-10-13 08:43:15,888 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_H1.png
2025-10-13 08:43:15,889 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'H1' cho 'USTEC_H1.png' bằng pattern đã biên dịch.
2025-10-13 08:43:15,890 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_M1.png
2025-10-13 08:43:15,892 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M1' cho 'USTEC_M1.png' bằng pattern đã biên dịch.
2025-10-13 08:43:15,893 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_M15.png
2025-10-13 08:43:15,893 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M15' cho 'USTEC_M15.png' bằng pattern đã biên dịch.
2025-10-13 08:43:15,895 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: USTEC_M5.png
2025-10-13 08:43:15,896 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M5' cho 'USTEC_M5.png' bằng pattern đã biên dịch.
2025-10-13 08:43:15,897 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {'USTEC_H1.png': 'H1', 'USTEC_M1.png': 'M1', 'USTEC_M15.png': 'M15', 'USTEC_M5.png': 'M5'}
2025-10-13 08:43:15,907 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-13 08:43:15,913 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\USTEC\Reports\report_20251013_084315.md
2025-10-13 08:43:15,919 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-13 08:43:15,920 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-13 08:43:15,928 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-13 08:43:15,929 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:15,930 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251013_084315.md
2025-10-13 08:43:15,930 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-13 08:43:15,932 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\USTEC\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-13 08:43:15,940 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-13 08:43:15,985 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-13 08:43:15,990 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-13 08:43:16,082 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-13 08:43:16,224 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 6 khóa.
2025-10-13 08:43:16,229 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-13 08:43:16,245 - APP.persistence.json_handler - DEBUG - Đã thêm 6 khối JSON vào data_to_save.
2025-10-13 08:43:16,252 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-13 08:43:16,253 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-13 08:43:16,281 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:16,283 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-13 08:43:16,294 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-13 08:43:16,296 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-13 08:43:16,303 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-13 08:43:16,305 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 6 khóa.
2025-10-13 08:43:16,306 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-13 08:43:16,308 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: '```json'
2025-10-13 08:43:16,309 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-13 08:43:16,313 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-13 08:43:16,323 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-13 08:43:16,370 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251013_084316.json
2025-10-13 08:43:16,381 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\USTEC\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-13 08:43:16,448 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-13 08:43:16,478 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-13 08:43:16,490 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-13 08:43:16,494 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-13 08:43:16,501 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:16,508 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-13 08:43:16,511 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:16,512 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 6 khóa.
2025-10-13 08:43:16,519 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:16,520 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-13 08:43:16,522 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:16,523 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: '```json'
2025-10-13 08:43:16,525 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:16,526 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-13 08:43:16,527 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:16,528 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-13 08:43:16,530 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:16,532 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-13 08:43:16,533 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:16,534 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-13 08:43:16,535 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:16,536 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-13 08:43:16,539 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-13 08:43:16,541 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251013-084200' (group=analysis.session) hoàn tất sau 75.60s
2025-10-13 08:43:16,797 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:16,861 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:16,899 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:16,974 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:17,203 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:17,216 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:17,217 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:17,218 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:17,220 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:17,222 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:17,227 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:17,330 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:17,346 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:17,524 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: refresh_all_lists
2025-10-13 08:43:17,525 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-13 08:43:17,525 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-13 08:43:17,528 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:43:17,533 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:43:17,533 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-13 08:43:17,563 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-13 08:43:17,569 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:43:17,571 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:43:17,571 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-13 08:43:17,572 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:17,574 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-13 08:43:17,576 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-13 08:43:17,577 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-13 08:43:17,578 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:17,579 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251013-084200: {'status': 'completed', 'early_exit': False}
2025-10-13 08:43:17,580 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:17,582 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 3 Báo cáo.
2025-10-13 08:43:17,583 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 3 JSON.
2025-10-13 08:43:17,644 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 0.11s
2025-10-13 08:43:17,647 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 0.08s
2025-10-13 08:43:17,724 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:17,731 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:17,733 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:17,734 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:17,744 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:17,745 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:17,753 - APP.services.mt5_service - DEBUG - Current price (cp): 24704.13
2025-10-13 08:43:17,780 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:17,794 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 241, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:17,806 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:17,827 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.24s
2025-10-13 08:43:17,855 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:17,863 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:17,866 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:17,874 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:17,909 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:17,913 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:17,914 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:17,962 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:18,044 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:18,051 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:18,080 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:18,080 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:18,170 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:18,170 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:18,173 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:18,193 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:18,222 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:18,253 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:18,267 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:18,386 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:18,524 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:18,534 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:18,553 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:18,602 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:18,616 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:18,618 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:18,627 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:17+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:18,630 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:17+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:18,634 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:17+07:00
2025-10-13 08:43:18,635 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:17+07:00 trong DST: True
2025-10-13 08:43:18,637 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:18,641 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:18,642 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:18,650 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:18,656 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:18,668 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:18,674 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:18,685 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:18,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:18,766 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:18,926 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:18,938 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:18,953 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:18,962 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:18,973 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:18,984 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:18,986 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:18,990 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:18,996 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:18,997 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:18,999 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:19,000 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:19,002 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:19,005 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:19,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:19,007 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-13 08:43:19,009 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:19,010 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:19,011 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:19,012 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:19,013 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:19,014 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:19,015 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:19,016 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:19,017 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:19,018 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:19,019 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:19,019 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:19,020 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:19,021 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:19,022 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:19,040 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.13, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:19,042 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:19,043 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:19,044 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:19,044 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:19,045 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6781.999999999971
2025-10-13 08:43:19,045 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24436.00000000006
2025-10-13 08:43:19,046 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1107.5000000000728
2025-10-13 08:43:19,046 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7553.000000000247
2025-10-13 08:43:19,047 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:19,047 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6781.999999999971}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24436.00000000006}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1107.5000000000728}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7553.000000000247}]
2025-10-13 08:43:19,047 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:19,048 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:19,049 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:19,049 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:19,050 - APP.services.mt5_service - DEBUG - Position in day range: 0.5585452238727114
2025-10-13 08:43:19,050 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:17+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:19,051 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:17+07:00
2025-10-13 08:43:19,051 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:17+07:00 trong DST: True
2025-10-13 08:43:19,052 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:19,052 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:19,053 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:19,053 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,053 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:19,054 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1300', 'price': 24704.13, 'distance_pips': 0.0}, {'level': '1325', 'price': 24704.13, 'distance_pips': 0.25}, {'level': '1350', 'price': 24704.14, 'distance_pips': 0.5}, {'level': '1375', 'price': 24704.14, 'distance_pips': 0.75}]
2025-10-13 08:43:19,054 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:19,055 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,055 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:19,056 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:19,057 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.13
2025-10-13 08:43:19,064 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:19,064 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:19,090 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:19,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:19,198 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:19,243 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:19,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.13
2025-10-13 08:43:19,265 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:19,285 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:19,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:19,455 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:19,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:19,501 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.13
2025-10-13 08:43:19,523 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:19,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:19,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:19,554 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:19,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:19,618 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.13
2025-10-13 08:43:19,621 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:19,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:19,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:19,700 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:19,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,703 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:19,703 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:19,704 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:19,705 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:19,706 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:19,707 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:19,707 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:19,708 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:19,709 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:19,710 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:19,712 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:19,713 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:19,739 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:19,743 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:19,750 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:19,753 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:19,754 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:19,755 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,756 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:19,758 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:19,759 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:19,760 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:19,760 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:19,762 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:19,763 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:19,769 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,771 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:19,771 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:19,774 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.13, 'ask': 24704.13, 'last': 0.0, 'time': 1760344997}
2025-10-13 08:43:19,777 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:19,778 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:19,779 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:19,780 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:19,781 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,782 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:19,783 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,783 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:19,784 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:19,787 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:19,990 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:20,036 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.13
2025-10-13 08:43:20,055 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:20,105 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6781.999999999971}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24436.00000000006}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1107.5000000000728}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7553.000000000247}]
2025-10-13 08:43:20,107 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:20,113 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:20,114 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:20,125 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 9.48s
2025-10-13 08:43:20,127 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:20,129 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-13 08:43:20,156 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:20,170 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:20,185 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.05, 'free_margin': 108.55, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:20,189 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.13, 'profit': -0.1, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.13, 'profit': -0.1, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:20,190 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:20,196 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:21,056 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:21,056 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:21,058 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:21,060 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:21,061 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:21,062 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:21,063 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:21,064 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:21,097 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:21,102 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:21,103 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:21,104 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:21,104 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:21,106 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:21,107 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:21,110 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:21,138 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:21,611 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:21,613 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:21,614 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:21,614 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:21,614 - APP.services.mt5_service - DEBUG - Current price (cp): 24704.01
2025-10-13 08:43:21,620 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:21,670 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:21,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:21,672 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:21,675 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:21,675 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:21,676 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:21,676 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:21,680 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:21,681 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:21,681 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:21,682 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:21,718 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:21,720 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:21,721 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:21,721 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:21,724 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:21,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:21,726 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:21,726 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:21,729 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:21,730 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:21,731 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:21,731 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:21,732 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:21+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:21,732 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:21+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:21,733 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:21+07:00
2025-10-13 08:43:21,733 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:21+07:00 trong DST: True
2025-10-13 08:43:21,733 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:21,734 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:21,734 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:21,736 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:21,736 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:21,737 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:21,738 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:21,741 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:21,742 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:21,742 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:21,743 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:21,743 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:21,743 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:21,744 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:21,744 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:21,744 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:21,745 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:21,745 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:21,745 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:21,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:21,782 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:21,783 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:21,783 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:21,785 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:21,786 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:21,787 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:21,788 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:21,789 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:21,789 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:21,790 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:21,790 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:21,791 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:21,791 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:21,792 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:21,792 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:21,793 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.01, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:21,794 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:21,794 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:21,795 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:21,795 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:21,795 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6769.999999999709
2025-10-13 08:43:21,796 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24423.999999999796
2025-10-13 08:43:21,796 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1095.4999999998108
2025-10-13 08:43:21,796 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7540.999999999985
2025-10-13 08:43:21,797 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:21,798 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6769.999999999709}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24423.999999999796}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1095.4999999998108}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7540.999999999985}]
2025-10-13 08:43:21,798 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:21,799 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:21,799 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:21,800 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:21,800 - APP.services.mt5_service - DEBUG - Position in day range: 0.557910873817192
2025-10-13 08:43:21,800 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:21+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:21,801 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:21+07:00
2025-10-13 08:43:21,801 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:21+07:00 trong DST: True
2025-10-13 08:43:21,801 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:21,802 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:21,802 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:21,803 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,803 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:21,803 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '100', 'price': 24704.01, 'distance_pips': 0.0}, {'level': '125', 'price': 24704.01, 'distance_pips': 0.25}, {'level': '150', 'price': 24704.02, 'distance_pips': 0.5}, {'level': '175', 'price': 24704.02, 'distance_pips': 0.75}]
2025-10-13 08:43:21,804 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:21,804 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,805 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:21,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:21,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.01
2025-10-13 08:43:21,807 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:21,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:21,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:21,849 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:21,849 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:21,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.01
2025-10-13 08:43:21,853 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:21,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:21,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:21,855 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:21,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:21,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.01
2025-10-13 08:43:21,857 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:21,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:21,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:21,859 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:21,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:21,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.01
2025-10-13 08:43:21,863 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:21,863 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:21,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:21,864 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:21,865 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,865 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:21,866 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:21,866 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:21,866 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:21,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:21,867 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:21,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:21,868 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:21,868 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:21,868 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:21,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:21,869 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:21,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:21,870 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:21,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:21,871 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:21,875 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:21,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,913 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:21,914 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:21,914 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:21,915 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:21,915 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:21,916 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:21,921 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:21,932 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,938 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:21,945 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:21,967 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.01, 'ask': 24704.01, 'last': 0.0, 'time': 1760345001}
2025-10-13 08:43:21,971 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:21,971 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:21,972 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:21,973 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:21,973 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,974 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:21,974 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,975 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:21,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:21,975 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:21,976 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.01
2025-10-13 08:43:21,976 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6769.999999999709}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24423.999999999796}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1095.4999999998108}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7540.999999999985}]
2025-10-13 08:43:21,976 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:21,978 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.92s
2025-10-13 08:43:21,986 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:21,987 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:21,988 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.07, 'free_margin': 108.57, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:21,989 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.01, 'profit': -0.09, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.01, 'profit': -0.1, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:21,990 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:22,061 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:22,099 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:22,101 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:22,105 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:22,108 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:22,110 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:22,111 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:22,113 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:22,137 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:22,164 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:22,167 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:22,168 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:22,170 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:22,171 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:22,171 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:22,173 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:22,205 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:22,674 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:22,676 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:22,677 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:22,677 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:22,677 - APP.services.mt5_service - DEBUG - Current price (cp): 24704.28
2025-10-13 08:43:22,683 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:22,735 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:22,736 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:22,737 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:22,740 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:22,740 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:22,741 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:22,741 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:22,747 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:22,776 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:22,781 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:22,783 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:22,786 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:22,787 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:22,787 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:22,788 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:22,791 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:22,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:22,792 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:22,793 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:22,796 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:22,796 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:22,797 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:22,797 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:22,798 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:22+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:22,798 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:22+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:22,799 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:22+07:00
2025-10-13 08:43:22,799 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:22+07:00 trong DST: True
2025-10-13 08:43:22,799 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:22,800 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:22,800 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:22,802 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:22,802 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:22,804 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:22,804 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:22,808 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:22,812 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:22,839 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:22,840 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:22,881 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:22,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:22,922 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:22,923 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:22,925 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:22,927 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:22,928 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:23,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:23,011 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:23,013 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:23,014 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:23,048 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:23,049 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:23,051 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:23,052 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:23,087 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:23,088 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:23,092 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:23,094 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:23,095 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:23,096 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:23,098 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:23,098 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:23,099 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:23,100 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24704.28, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:23,101 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:23,101 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:23,102 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:23,102 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:23,103 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6796.999999999753
2025-10-13 08:43:23,103 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:23,104 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24450.99999999984
2025-10-13 08:43:23,140 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:23,141 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1122.4999999998545
2025-10-13 08:43:23,142 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:23,143 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7568.000000000029
2025-10-13 08:43:23,145 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:23,146 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:23,146 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:23,146 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6796.999999999753}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24450.99999999984}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1122.4999999998545}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7568.000000000029}]
2025-10-13 08:43:23,147 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:23,148 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:23,149 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:23,149 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:23,149 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:23,150 - APP.services.mt5_service - DEBUG - Position in day range: 0.5593381614420819
2025-10-13 08:43:23,150 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:22+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:23,151 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:22+07:00
2025-10-13 08:43:23,152 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:22+07:00 trong DST: True
2025-10-13 08:43:23,153 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:23,153 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:23,154 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:23,154 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:23,154 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:23,155 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2800', 'price': 24704.28, 'distance_pips': 0.0}, {'level': '2825', 'price': 24704.28, 'distance_pips': 0.25}, {'level': '2850', 'price': 24704.28, 'distance_pips': 0.5}, {'level': '2875', 'price': 24704.29, 'distance_pips': 0.75}]
2025-10-13 08:43:23,155 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:23,156 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:23,158 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:23,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:23,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:23,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.28
2025-10-13 08:43:23,214 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:23,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:23,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:23,407 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:23,418 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:23,477 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24704.28
2025-10-13 08:43:23,491 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:23,492 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:23,497 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:23,540 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:23,547 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:23,549 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24704.28
2025-10-13 08:43:23,553 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:23,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:23,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:23,672 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:23,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:23,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24704.28
2025-10-13 08:43:23,678 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:23,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:23,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:23,728 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:23,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:23,733 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:23,736 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:23,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:23,740 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:23,742 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:23,743 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:23,745 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:23,797 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:23,849 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:23,850 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:23,853 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:23,859 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:23,866 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:23,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:23,915 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:23,917 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:23,919 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:23,921 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:23,929 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:23,930 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:23,931 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:23,933 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:23,974 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:23,977 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:23,982 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:23,987 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:23,990 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:23,990 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:24,035 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24704.28, 'ask': 24704.28, 'last': 0.0, 'time': 1760345002}
2025-10-13 08:43:24,044 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:24,046 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:24,047 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:24,048 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:24,049 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:24,050 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:24,050 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:24,051 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:24,052 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:24,052 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:24,052 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24704.28
2025-10-13 08:43:24,053 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6796.999999999753}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24450.99999999984}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1122.4999999998545}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7568.000000000029}]
2025-10-13 08:43:24,053 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:24,054 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.95s
2025-10-13 08:43:24,076 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:24,102 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:24,102 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 112.88, 'free_margin': 108.38, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:24,104 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24704.28, 'profit': -0.1, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24704.28, 'profit': -0.1, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:24,105 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:24,139 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:24,160 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:24,161 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:24,165 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:24,166 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:24,168 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:24,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:24,170 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:24,185 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:24,207 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:24,224 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:24,241 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:24,290 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:24,357 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:24,408 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:24,459 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:24,474 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:24,982 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:24,984 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:24,985 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:24,985 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:24,986 - APP.services.mt5_service - DEBUG - Current price (cp): 24703.87
2025-10-13 08:43:24,991 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:25,079 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:25,084 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:25,085 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:25,126 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:25,128 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:25,129 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:25,141 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:25,148 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:25,148 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:25,149 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:25,150 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:25,152 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:25,156 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:25,158 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:25,159 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:25,162 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:25,163 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:25,163 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:25,166 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:25,166 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:25,167 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:25,167 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:25,169 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:25,172 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:25,172 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:25,173 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:25,174 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:25,174 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:25,175 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:25,176 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:23+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:25,176 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:23+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:25,177 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:23+07:00
2025-10-13 08:43:25,177 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:23+07:00 trong DST: True
2025-10-13 08:43:25,177 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:25,178 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:25,178 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:25,179 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:25,180 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:25,182 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:25,182 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:25,187 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:25,188 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:25,188 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:25,189 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:25,189 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:25,190 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:25,190 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:25,190 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:25,191 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:25,191 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:25,192 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:25,192 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:25,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:25,194 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:25,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:25,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:25,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:25,196 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:25,196 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:25,197 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:25,197 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:25,198 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:25,198 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:25,199 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:25,199 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:25,200 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:25,200 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:25,201 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:25,201 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24703.87, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:25,202 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:25,202 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:25,202 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:25,203 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:25,204 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:25,204 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6755.999999999767
2025-10-13 08:43:25,234 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24409.999999999854
2025-10-13 08:43:25,244 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1081.499999999869
2025-10-13 08:43:25,490 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7527.000000000044
2025-10-13 08:43:25,612 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:25,853 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6755.999999999767}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24409.999999999854}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1081.499999999869}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7527.000000000044}]
2025-10-13 08:43:25,866 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:25,890 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:25,897 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:25,909 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:25,910 - APP.services.mt5_service - DEBUG - Position in day range: 0.5571707987524385
2025-10-13 08:43:25,910 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:23+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:25,914 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:23+07:00
2025-10-13 08:43:25,915 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:23+07:00 trong DST: True
2025-10-13 08:43:25,915 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:25,916 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:25,917 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:25,918 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:25,918 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:25,920 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8700', 'price': 24703.87, 'distance_pips': 0.0}, {'level': '8725', 'price': 24703.87, 'distance_pips': 0.25}, {'level': '8750', 'price': 24703.88, 'distance_pips': 0.5}, {'level': '8775', 'price': 24703.88, 'distance_pips': 0.75}]
2025-10-13 08:43:25,920 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:25,922 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:25,924 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:25,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:25,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24703.87
2025-10-13 08:43:25,928 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:25,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:25,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:25,931 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:25,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:25,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24703.87
2025-10-13 08:43:25,995 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:26,167 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:26,202 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:26,390 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:26,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:26,568 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:26,573 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:26,581 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:26,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:26,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:26,586 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24703.87
2025-10-13 08:43:26,588 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.20s
2025-10-13 08:43:26,592 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:26,594 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:26,595 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:26,596 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:26,597 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:26,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24703.87
2025-10-13 08:43:26,692 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:26,714 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:26,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:26,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:26,865 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:26,870 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:26,882 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:26,891 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:26,894 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:26,897 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:26,900 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:26,903 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:26,907 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:26,944 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:26,967 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:26,990 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:27,044 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:27,046 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:27,048 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:27,050 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:27,054 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:27,056 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:27,058 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:27,073 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:27,099 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:27,102 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:27,106 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:27,108 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:27,111 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:27,112 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:27,153 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:27,388 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:27,388 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:27,392 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:27,392 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:27,399 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:27,414 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24703.87, 'ask': 24703.87, 'last': 0.0, 'time': 1760345003}
2025-10-13 08:43:27,417 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:27,418 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:27,420 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:27,420 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:27,421 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:27,424 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:27,426 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:27,427 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:27,427 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:27,428 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:27,429 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:27,430 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:27,431 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:27,432 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:27,433 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24703.87
2025-10-13 08:43:27,440 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6755.999999999767}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24409.999999999854}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1081.499999999869}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7527.000000000044}]
2025-10-13 08:43:27,443 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:27,446 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.29s
2025-10-13 08:43:27,486 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:27,820 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:27,822 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:27,823 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.16, 'free_margin': 108.66, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:27,824 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24703.87, 'profit': -0.09, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24703.87, 'profit': -0.09, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:27,826 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:28,418 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:28,419 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:28,421 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:28,423 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:28,424 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:28,426 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:28,426 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:28,427 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:28,465 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:28,466 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:28,467 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:28,468 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:28,469 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:28,470 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:28,471 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:28,472 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:28,475 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:28,974 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:28,976 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:28,977 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:28,977 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:28,977 - APP.services.mt5_service - DEBUG - Current price (cp): 24697.88
2025-10-13 08:43:28,983 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:29,033 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 292, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:29,034 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:29,035 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:29,038 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:29,038 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:29,039 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:29,076 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:29,080 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:29,082 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:29,082 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:29,083 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:29,085 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:29,086 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:29,086 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:29,086 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:29,089 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:29,093 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:29,127 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:29,128 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:29,132 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:29,134 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:29,134 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:29,135 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:29,136 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:28+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:29,136 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:28+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:29,137 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:28+07:00
2025-10-13 08:43:29,137 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:28+07:00 trong DST: True
2025-10-13 08:43:29,138 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:29,138 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:29,138 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:29,140 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:29,141 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:29,142 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:29,143 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:29,146 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:29,147 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:29,147 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:29,148 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:29,148 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:29,148 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:29,149 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:29,149 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:29,150 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:29,150 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:29,150 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:29,151 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:29,151 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:29,152 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:29,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:29,192 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:29,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:29,193 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:29,194 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:29,195 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:29,196 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:29,197 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:29,197 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:29,198 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:29,198 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:29,199 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:29,199 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:29,200 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:29,200 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24697.88, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:29,201 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:29,201 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:29,202 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:29,202 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:29,203 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6156.999999999971
2025-10-13 08:43:29,204 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 23811.00000000006
2025-10-13 08:43:29,205 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 482.50000000007276
2025-10-13 08:43:29,205 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 6928.000000000247
2025-10-13 08:43:29,205 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:29,206 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6156.999999999971}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 23811.00000000006}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 482.50000000007276}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 6928.000000000247}]
2025-10-13 08:43:29,206 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:29,207 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:29,207 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:29,208 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:29,209 - APP.services.mt5_service - DEBUG - Position in day range: 0.5255061584817929
2025-10-13 08:43:29,209 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:28+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:29,210 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:28+07:00
2025-10-13 08:43:29,210 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:28+07:00 trong DST: True
2025-10-13 08:43:29,210 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:29,211 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:29,211 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:29,212 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,212 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:29,212 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8800', 'price': 24697.88, 'distance_pips': 0.0}, {'level': '8825', 'price': 24697.88, 'distance_pips': 0.25}, {'level': '8850', 'price': 24697.89, 'distance_pips': 0.5}, {'level': '8875', 'price': 24697.89, 'distance_pips': 0.75}]
2025-10-13 08:43:29,213 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:29,213 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,214 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:29,214 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:29,216 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24697.88
2025-10-13 08:43:29,257 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:29,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:29,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:29,260 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:29,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:29,262 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24697.88
2025-10-13 08:43:29,262 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:29,263 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:29,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:29,264 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:29,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:29,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24697.88
2025-10-13 08:43:29,266 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:29,266 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:29,267 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:29,268 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:29,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:29,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24697.88
2025-10-13 08:43:29,271 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:29,271 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:29,272 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:29,273 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:29,273 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,274 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:29,274 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:29,275 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:29,275 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:29,275 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:29,276 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:29,276 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:29,276 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:29,277 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:29,323 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:29,325 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:29,327 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:29,328 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:29,328 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:29,332 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:29,334 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:29,335 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:29,335 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,336 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:29,336 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:29,337 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:29,338 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:29,338 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:29,340 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:29,379 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:29,384 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,386 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:29,387 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:29,387 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24697.88, 'ask': 24697.88, 'last': 0.0, 'time': 1760345008}
2025-10-13 08:43:29,390 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:29,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:29,391 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:29,391 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:29,393 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,394 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:29,394 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,395 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:29,395 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:29,396 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:29,396 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24697.88
2025-10-13 08:43:29,396 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6156.999999999971}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 23811.00000000006}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 482.50000000007276}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 6928.000000000247}]
2025-10-13 08:43:29,397 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:29,398 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.98s
2025-10-13 08:43:29,424 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:29,445 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:29,446 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:29,450 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:29,450 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:29,450 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:29,451 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:29,453 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:29,453 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.07, 'free_margin': 108.57, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:29,454 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:29,455 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24697.88, 'profit': 0.03, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24697.88, 'profit': 0.03, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:29,455 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:29,456 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:29,458 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:29,991 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:43:29,993 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:43:29,994 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-13 08:43:30,012 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:30,013 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:30,014 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:30,015 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:30,015 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:30,016 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:30,017 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:30,017 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:30,092 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:43:30,448 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:30,519 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:30,521 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:30,522 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:30,523 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:30,524 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:30,524 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:30,524 - APP.services.mt5_service - DEBUG - Current price (cp): 24701.1
2025-10-13 08:43:30,526 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:30,539 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 253, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:30,568 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:30,612 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:30,612 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.16s
2025-10-13 08:43:30,613 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:30,614 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:30,617 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:30,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:30,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:30,619 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:30,623 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:30,641 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:30,652 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:30,675 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:30,696 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:30,715 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:30,758 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:30,923 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:30,951 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:30,974 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:30,991 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:31,003 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:31,078 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:31,230 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:31,296 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:31,306 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:31,307 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:31,331 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:30+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:31,338 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:30+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:31,346 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:30+07:00
2025-10-13 08:43:31,347 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:30+07:00 trong DST: True
2025-10-13 08:43:31,348 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:31,348 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:31,349 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:31,350 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:31,351 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:31,352 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:31,354 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:31,358 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:31,359 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:31,359 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:31,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:31,360 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:31,361 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:31,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:31,362 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:31,363 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:31,363 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:31,364 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:31,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:31,365 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:31,365 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:31,366 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:31,366 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:31,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:31,367 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:31,368 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:31,369 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:31,369 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:31,370 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:31,371 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:31,371 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:31,372 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:31,373 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:31,374 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:31,374 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:31,375 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24701.1, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:31,375 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:31,376 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:31,376 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:31,376 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:31,377 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6478.9999999997235
2025-10-13 08:43:31,377 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24132.99999999981
2025-10-13 08:43:31,378 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 804.4999999998254
2025-10-13 08:43:31,378 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7250.0
2025-10-13 08:43:31,379 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:31,379 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6478.9999999997235}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24132.99999999981}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 804.4999999998254}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7250.0}]
2025-10-13 08:43:31,380 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:31,380 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:31,381 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:31,382 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:31,382 - APP.services.mt5_service - DEBUG - Position in day range: 0.5425278849711811
2025-10-13 08:43:31,383 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:30+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:31,383 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:30+07:00
2025-10-13 08:43:31,384 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:30+07:00 trong DST: True
2025-10-13 08:43:31,384 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:31,385 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:31,385 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:31,386 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:31,386 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:31,391 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1000', 'price': 24701.1, 'distance_pips': 0.0}, {'level': '1025', 'price': 24701.1, 'distance_pips': 0.25}, {'level': '1050', 'price': 24701.11, 'distance_pips': 0.5}, {'level': '1075', 'price': 24701.11, 'distance_pips': 0.75}]
2025-10-13 08:43:31,392 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:31,393 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:31,398 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:31,399 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:31,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24701.1
2025-10-13 08:43:31,401 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:31,401 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:31,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:31,408 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:31,409 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:31,419 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24701.1
2025-10-13 08:43:31,450 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:31,452 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:31,471 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:31,476 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:31,477 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:31,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:31,499 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:31,546 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:31,548 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:31,549 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:31,550 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-13 08:43:31,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24701.1
2025-10-13 08:43:31,553 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:31,554 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:31,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:31,556 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:31,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:31,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24701.1
2025-10-13 08:43:31,557 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:31,598 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:31,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:31,604 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:31,605 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:31,605 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:31,606 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:31,607 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:31,608 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:31,608 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:31,609 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:31,609 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:31,610 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:31,611 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:31,612 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:31,612 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:31,613 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:31,614 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:31,614 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:31,615 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:31,616 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:31,616 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:31,617 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:31,618 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:31,619 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:31,620 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:31,623 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:31,623 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:31,625 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:31,628 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:31,631 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:31,633 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:31,633 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:31,635 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24701.1, 'ask': 24701.1, 'last': 0.0, 'time': 1760345010}
2025-10-13 08:43:31,644 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:31,645 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:31,669 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:31,670 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:31,901 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:32,026 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:32,051 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:32,062 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:32,097 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:32,099 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:32,111 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:32,113 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24701.1
2025-10-13 08:43:32,115 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6478.9999999997235}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24132.99999999981}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 804.4999999998254}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7250.0}]
2025-10-13 08:43:32,117 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:32,214 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.77s
2025-10-13 08:43:32,390 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:32,392 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:32,393 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 112.96, 'free_margin': 108.46, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:32,394 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24701.1, 'profit': -0.04, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24701.1, 'profit': -0.04, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:32,395 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:32,472 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:32,474 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:32,475 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:32,484 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:32,489 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:32,522 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:32,531 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:32,535 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:32,535 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:32,536 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:32,536 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:32,537 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:32,538 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-13 08:43:32,538 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:32,539 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:32,540 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:32,596 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:33,042 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:33,068 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:33,125 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:33,131 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:33,150 - APP.services.mt5_service - DEBUG - Current price (cp): 24700.32
2025-10-13 08:43:33,157 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 254, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:33,280 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 294, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:33,283 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:33,291 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:33,303 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:33,348 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:33,363 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:33,464 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:33,484 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:33,501 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:33,571 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:33,670 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:34,612 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:34,740 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:34,839 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:34,947 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:34,960 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:35,091 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:35,160 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 1.59s
2025-10-13 08:43:35,179 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:35,181 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:35,182 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:35,188 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:35,191 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:35,192 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:35,193 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:35,196 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:35,241 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:35,274 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:35,616 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:35,719 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:36,027 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:36,092 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:32+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:36,252 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:36,385 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:32+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:36,595 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:36,716 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:36,812 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:32+07:00
2025-10-13 08:43:36,903 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:37,017 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:32+07:00 trong DST: True
2025-10-13 08:43:37,170 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.92s
2025-10-13 08:43:37,393 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:37,733 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:37,754 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:37,948 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:37,970 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:38,082 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:38,102 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:38,209 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:38,266 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:38,288 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:38,347 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:38,353 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:38,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:38,510 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:38,523 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:38,524 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:38,568 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:38,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:38,574 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:38,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:38,666 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:38,667 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:38,673 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:38,764 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:38,771 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.20s
2025-10-13 08:43:38,772 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:38,773 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:38,777 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:38,779 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:38,784 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:38,785 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:38,786 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:38,788 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:38,788 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:38,823 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:38,847 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:38,926 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:39,023 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:39,058 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:39,065 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:39,076 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:39,262 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:39,271 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:39,389 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24700.32, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:39,406 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:39,505 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:39,513 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:39,518 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:39,559 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6400.99999999984
2025-10-13 08:43:39,573 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:39,605 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24054.999999999927
2025-10-13 08:43:39,610 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:39,646 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 726.4999999999418
2025-10-13 08:43:39,648 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:39,733 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7172.000000000116
2025-10-13 08:43:39,743 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:39,745 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:39,746 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:39,747 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6400.99999999984}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24054.999999999927}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 726.4999999999418}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7172.000000000116}]
2025-10-13 08:43:39,749 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.14s
2025-10-13 08:43:39,749 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:39,750 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:39,752 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:39,752 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:39,752 - APP.services.mt5_service - DEBUG - Position in day range: 0.5384046096104006
2025-10-13 08:43:39,753 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:32+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:39,754 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:32+07:00
2025-10-13 08:43:39,755 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:32+07:00 trong DST: True
2025-10-13 08:43:39,755 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:39,756 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:39,757 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:39,758 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:39,758 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:39,759 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3200', 'price': 24700.32, 'distance_pips': 0.0}, {'level': '3225', 'price': 24700.32, 'distance_pips': 0.25}, {'level': '3250', 'price': 24700.33, 'distance_pips': 0.5}, {'level': '3275', 'price': 24700.33, 'distance_pips': 0.75}]
2025-10-13 08:43:39,759 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:39,760 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:39,761 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:39,761 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:39,883 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:39,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24700.32
2025-10-13 08:43:40,069 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:40,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:40,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:40,211 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:40,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:40,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24700.32
2025-10-13 08:43:40,411 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:40,470 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:40,470 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:40,533 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:40,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:40,611 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:40,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24700.32
2025-10-13 08:43:40,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:40,736 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:40,738 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:40,739 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:40,741 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:40,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:40,743 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:40,745 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:40,746 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-13 08:43:40,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:40,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24700.32
2025-10-13 08:43:40,957 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:40,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:40,959 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:40,960 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:40,963 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:40,965 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:40,966 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:40,975 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:41,009 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:41,156 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:41,195 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:41,265 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:41,326 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:41,429 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:41,437 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:41,447 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:41,451 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:41,454 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:41,540 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:41,561 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:41,617 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:41,703 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:41,714 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:41,726 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:41,728 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:41,729 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:41,730 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:41,731 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:41,732 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:41,734 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:41,737 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:41,737 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:41,738 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:41,739 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:41,740 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:41,741 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:41,814 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:41,920 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:41,966 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:41,967 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:41,969 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:42,021 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24700.32, 'ask': 24700.32, 'last': 0.0, 'time': 1760345012}
2025-10-13 08:43:42,083 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:42,088 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:42,142 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:42,142 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:42,190 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:42,233 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:42,243 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:42,323 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:42,371 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:42,387 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:42,472 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24700.32
2025-10-13 08:43:42,487 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6400.99999999984}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24054.999999999927}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 726.4999999999418}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7172.000000000116}]
2025-10-13 08:43:42,488 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:42,490 - APP.utils.threading_utils - WARNING - Task 'chart.info' (group=chart.refresh) vượt timeout 10.00s → cancel
2025-10-13 08:43:42,490 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 10.01s
2025-10-13 08:43:42,587 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:42,590 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:42,591 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.14, 'free_margin': 108.64, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:42,593 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24700.21, 'profit': -0.02, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24700.21, 'profit': -0.02, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:42,595 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:42,727 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:42,728 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:42,730 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:42,732 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:42,733 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:42,743 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:42,753 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:42,778 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:42,780 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:42,783 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:42,784 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-13 08:43:42,785 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:42,786 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:42,789 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:42,789 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:42,792 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:42,803 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:43,294 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:43,296 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:43,297 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:43,297 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:43,298 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.95
2025-10-13 08:43:43,304 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 260, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:43,341 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 295, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:43,342 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:43,342 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:43,345 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:43,346 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:43,346 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:43,347 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:43,350 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:43,351 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:43,351 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:43,352 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:43,354 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:43,354 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:43,355 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:43,356 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:43,358 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:43,359 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:43,359 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:43,359 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:43,363 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:43,363 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:43,364 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:43,364 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:43,365 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:42+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:43,365 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:42+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:43,366 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:42+07:00
2025-10-13 08:43:43,366 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:42+07:00 trong DST: True
2025-10-13 08:43:43,366 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:43,367 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:43,367 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:43,369 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:43,370 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:43,371 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:43,372 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:43,375 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:43,375 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:43,376 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:43,376 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:43,377 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:43,377 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:43,378 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:43,378 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:43,378 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:43,379 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:43,379 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:43,379 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:43,380 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:43,380 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:43,381 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:43,381 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:43,381 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:43,382 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:43,382 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:43,383 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:43,383 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:43,384 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:43,384 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:43,385 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:43,385 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:43,387 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:43,387 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:43,387 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:43,388 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.95, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:43,388 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:43,389 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:43,389 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:43,389 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:43,390 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6963.999999999942
2025-10-13 08:43:43,390 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24618.00000000003
2025-10-13 08:43:43,391 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1289.5000000000437
2025-10-13 08:43:43,391 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7735.000000000218
2025-10-13 08:43:43,392 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:43,393 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6963.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24618.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1289.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7735.000000000218}]
2025-10-13 08:43:43,393 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:43,394 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:43,395 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:43,395 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:43,395 - APP.services.mt5_service - DEBUG - Position in day range: 0.5681661997145454
2025-10-13 08:43:43,396 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:42+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:43,396 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:42+07:00
2025-10-13 08:43:43,396 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:42+07:00 trong DST: True
2025-10-13 08:43:43,397 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:43,397 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:43,398 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:43,398 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,398 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:43,399 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9500', 'price': 24705.95, 'distance_pips': 0.0}, {'level': '9525', 'price': 24705.95, 'distance_pips': 0.25}, {'level': '9550', 'price': 24705.96, 'distance_pips': 0.5}, {'level': '9575', 'price': 24705.96, 'distance_pips': 0.75}]
2025-10-13 08:43:43,399 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:43,400 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,400 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:43,401 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:43,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.95
2025-10-13 08:43:43,402 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:43,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:43,403 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:43,404 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:43,404 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:43,405 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.95
2025-10-13 08:43:43,405 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:43,405 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:43,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:43,407 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:43,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:43,408 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.95
2025-10-13 08:43:43,408 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:43,409 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:43,410 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:43,410 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:43,411 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:43,411 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.95
2025-10-13 08:43:43,412 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:43,412 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:43,413 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:43,413 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:43,414 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,414 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:43,415 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:43,415 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:43,415 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:43,416 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:43,416 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:43,417 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:43,417 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:43,417 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:43,418 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:43,418 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:43,418 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:43,419 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:43,419 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:43,419 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:43,420 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:43,420 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:43,421 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,421 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:43,421 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:43,422 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:43,422 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:43,423 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:43,424 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:43,425 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:43,428 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,429 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:43,430 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:43,430 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.95, 'ask': 24705.95, 'last': 0.0, 'time': 1760345022}
2025-10-13 08:43:43,432 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:43,433 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:43,433 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:43,434 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:43,435 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,435 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:43,435 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,436 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:43,436 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:43,436 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:43,437 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.95
2025-10-13 08:43:43,437 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6963.999999999942}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24618.00000000003}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1289.5000000000437}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7735.000000000218}]
2025-10-13 08:43:43,438 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:43,439 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.71s
2025-10-13 08:43:43,490 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:43,491 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:43,492 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 113.1, 'free_margin': 108.6, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:43,493 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.95, 'profit': -0.13, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.95, 'profit': -0.14, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:43,494 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:43,733 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:43,734 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'USTEC', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:43:43,735 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:43:43,738 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 50
2025-10-13 08:43:43,741 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:43,745 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho USTEC 1.
2025-10-13 08:43:43,748 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:43,749 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:43,749 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:43,750 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-13 08:43:43,751 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:43,752 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:43:43,753 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='USTEC', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:43:43,754 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:43:43,754 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: USTEC
2025-10-13 08:43:43,756 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'USTEC' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:43:43,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:44,258 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:43:44,260 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:43:44,260 - APP.services.mt5_service - DEBUG - Đã lấy 2 lệnh đang mở.
2025-10-13 08:43:44,261 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:43:44,261 - APP.services.mt5_service - DEBUG - Current price (cp): 24705.63
2025-10-13 08:43:44,267 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 259, 'median_spread': 0, 'p90_spread': 0}
2025-10-13 08:43:44,304 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 295, 'median_spread': 0.0, 'p90_spread': 0}
2025-10-13 08:43:44,305 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 1, bars: 120
2025-10-13 08:43:44,305 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 1 ở lần thử 1.
2025-10-13 08:43:44,308 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 1.
2025-10-13 08:43:44,309 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:44,309 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 5, bars: 180
2025-10-13 08:43:44,309 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 5 ở lần thử 1.
2025-10-13 08:43:44,313 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho USTEC 5.
2025-10-13 08:43:44,314 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:44,314 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 15, bars: 96
2025-10-13 08:43:44,315 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 15 ở lần thử 1.
2025-10-13 08:43:44,317 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho USTEC 15.
2025-10-13 08:43:44,317 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:44,318 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: USTEC, tf_code: 16385, bars: 120
2025-10-13 08:43:44,318 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho USTEC 16385 ở lần thử 1.
2025-10-13 08:43:44,321 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho USTEC 16385.
2025-10-13 08:43:44,321 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:43:44,322 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:43:44,322 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:43:44,325 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:44,326 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 25220.61, 'low': 24019.21}
2025-10-13 08:43:44,326 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:43:44,327 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}
2025-10-13 08:43:44,327 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:43:43+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:43:44,328 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:43+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:44,328 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:43+07:00
2025-10-13 08:43:44,328 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:43+07:00 trong DST: True
2025-10-13 08:43:44,329 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:44,329 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:44,330 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:43:44,331 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:44,332 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:44,334 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:43:44,334 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 24728.785604364133
2025-10-13 08:43:44,338 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 24728.785604364133, 'asia': 24728.785604364133, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:43:44,338 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:44,339 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24719.59150987885
2025-10-13 08:43:44,339 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:44,340 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24709.54327277361
2025-10-13 08:43:44,340 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:43:44,340 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24697.891066505523
2025-10-13 08:43:44,341 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:43:44,341 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24620.293680666065
2025-10-13 08:43:44,342 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:43:44,342 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24678.071333564076
2025-10-13 08:43:44,342 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:43:44,343 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24881.092911405427
2025-10-13 08:43:44,343 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:43:44,343 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24847.048891776925
2025-10-13 08:43:44,344 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:43:44,344 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 24939.65069888048
2025-10-13 08:43:44,344 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 24719.59150987885, 'ema200': 24709.54327277361}, 'M5': {'ema50': 24697.891066505523, 'ema200': 24620.293680666065}, 'M15': {'ema50': 24678.071333564076, 'ema200': 24881.092911405427}, 'H1': {'ema50': 24847.048891776925, 'ema200': 24939.65069888048}}
2025-10-13 08:43:44,345 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:43:44,346 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.977652117607494, TRs count: 179
2025-10-13 08:43:44,346 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:44,347 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.520284671546901, TRs count: 119
2025-10-13 08:43:44,347 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:43:44,348 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 35.73579149491718, TRs count: 95
2025-10-13 08:43:44,348 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:43:44,348 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 111.35450689537413, TRs count: 119
2025-10-13 08:43:44,349 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 19.977652117607494, 'M1': 7.520284671546901, 'M15': 35.73579149491718, 'H1': 111.35450689537413}
2025-10-13 08:43:44,349 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:43:44,350 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 24705.63, daily: {'open': 24628.6, 'high': 24787.64, 'low': 24598.47, 'eq50': 24693.055, 'midnight_open': None}, prev_day: {'high': 24636.31, 'low': 24459.77}
2025-10-13 08:43:44,350 - APP.services.mt5_service - DEBUG - Thêm PDH: 24636.31
2025-10-13 08:43:44,350 - APP.services.mt5_service - DEBUG - Thêm PDL: 24459.77
2025-10-13 08:43:44,351 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 24693.055
2025-10-13 08:43:44,351 - APP.services.mt5_service - DEBUG - Thêm DO: 24628.6
2025-10-13 08:43:44,351 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 24636.31, Relation: BELOW, Distance: 6931.999999999971
2025-10-13 08:43:44,352 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 24459.77, Relation: BELOW, Distance: 24586.00000000006
2025-10-13 08:43:44,352 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 24693.055, Relation: BELOW, Distance: 1257.5000000000728
2025-10-13 08:43:44,353 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 24628.6, Relation: BELOW, Distance: 7703.000000000247
2025-10-13 08:43:44,353 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:43:44,353 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6931.999999999971}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24586.00000000006}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1257.5000000000728}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7703.000000000247}]
2025-10-13 08:43:44,354 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: USTEC, n: 20
2025-10-13 08:43:44,354 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 450.0260000000002, 'd10': 339.71100000000007, 'd20': 276.17600000000004}
2025-10-13 08:43:44,355 - APP.services.mt5_service - DEBUG - Prev day close: 24628.62
2025-10-13 08:43:44,355 - APP.services.mt5_service - DEBUG - Day range: 189.16999999999825, Day range % of ADR20: 68.49617635131156
2025-10-13 08:43:44,356 - APP.services.mt5_service - DEBUG - Position in day range: 0.5664745995665319
2025-10-13 08:43:44,356 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:43:43+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:43:44,356 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:43:43+07:00
2025-10-13 08:43:44,357 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:43:43+07:00 trong DST: True
2025-10-13 08:43:44,357 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:43:44,358 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:43:44,358 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:43:44,358 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,359 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:44,359 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6300', 'price': 24705.63, 'distance_pips': 0.0}, {'level': '6325', 'price': 24705.63, 'distance_pips': 0.25}, {'level': '6350', 'price': 24705.64, 'distance_pips': 0.5}, {'level': '6375', 'price': 24705.64, 'distance_pips': 0.75}]
2025-10-13 08:43:44,360 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-13 08:43:44,360 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,360 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:44,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:44,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.63
2025-10-13 08:43:44,362 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:44,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:44,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:44,364 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:43:44,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:43:44,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 24705.63
2025-10-13 08:43:44,365 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:44,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:43:44,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:44,367 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:43:44,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:43:44,368 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 24705.63
2025-10-13 08:43:44,368 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:44,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:43:44,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:44,370 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:43:44,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:43:44,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 24705.63
2025-10-13 08:43:44,372 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-13 08:43:44,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:43:44,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:43:44,373 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:43:44,374 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,374 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:44,375 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:44,375 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:44,375 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:44,376 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:44,376 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:44,377 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:44,377 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:44,377 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:44,378 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: USTEC
2025-10-13 08:43:44,378 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:43:44,378 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.01
2025-10-13 08:43:44,379 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:43:44,379 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.01
2025-10-13 08:43:44,379 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:43:44,380 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.01
2025-10-13 08:43:44,380 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.01
2025-10-13 08:43:44,381 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:44,382 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:43:44,382 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:43:44,382 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:43:44,383 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:43:44,384 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:44,385 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:43:44,388 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,389 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:43:44,389 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho USTEC trong 7 ngày qua.
2025-10-13 08:43:44,390 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 24705.63, 'ask': 24705.63, 'last': 0.0, 'time': 1760345023}
2025-10-13 08:43:44,392 - APP.services.mt5_service - DEBUG - Đã định dạng 2 deals cho USTEC.
2025-10-13 08:43:44,393 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:43:44,393 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:43:44,394 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 0
2025-10-13 08:43:44,394 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,395 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:44,395 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,395 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 2, 'point': 0.01, 'contract_size': 1.0, 'spread_current': 0, 'swap_long': -466.6, 'swap_short': 0.0}
2025-10-13 08:43:44,396 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 2, PPP: 1
2025-10-13 08:43:44,396 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:43:44,396 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 24705.63
2025-10-13 08:43:44,397 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 24636.31, 'relation': 'BELOW', 'distance_pips': 6931.999999999971}, {'name': 'PDL', 'price': 24459.77, 'relation': 'BELOW', 'distance_pips': 24586.00000000006}, {'name': 'EQ50_D', 'price': 24693.055, 'relation': 'BELOW', 'distance_pips': 1257.5000000000728}, {'name': 'DO', 'price': 24628.6, 'relation': 'BELOW', 'distance_pips': 7703.000000000247}]
2025-10-13 08:43:44,397 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:43:44,399 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.66s
2025-10-13 08:43:44,405 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:43:44,406 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:43:44,406 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.06, 'equity': 112.87, 'free_margin': 108.37, 'currency': 'USD', 'leverage': 2000}
2025-10-13 08:43:44,407 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2414429300, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.350000000002, 'sl': 24755.0, 'tp': 24686.23, 'price_current': 24705.63, 'profit': -0.13, 'comment': 'AI Trade TP1'}, {'ticket': 2414429318, 'symbol': 'USTEC', 'type': 'SELL', 'volume': 0.02, 'price_open': 24699.15, 'sl': 24755.0, 'tp': 24653.64, 'price_current': 24705.63, 'profit': -0.13, 'comment': 'AI Trade TP2'}]
2025-10-13 08:43:44,408 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:48:16,806 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-13 08:48:16,807 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-13 08:48:16,808 - __main__ - INFO - Ứng dụng đang khởi động...
2025-10-13 08:48:17,181 - APP.ui.app_ui - DEBUG - Bắt đầu khởi tạo AppUI.
2025-10-13 08:48:17,181 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-13 08:48:17,183 - APP.ui.app_ui - DEBUG - Khởi tạo các biến Tkinter.
2025-10-13 08:48:17,185 - APP.utils.general_utils - DEBUG - Bắt đầu deobfuscate text với salt.
2025-10-13 08:48:17,186 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-13 08:48:17,186 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-13 08:48:17,190 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-13 08:48:17,191 - APP.utils.general_utils - DEBUG - Đã deobfuscate text thành công.
2025-10-13 08:48:17,194 - APP.ui.app_ui - DEBUG - Các biến Tkinter đã được khởi tạo.
2025-10-13 08:48:17,204 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-13 08:48:17,204 - APP.ui.utils.ui_builder - DEBUG - Bắt đầu build_ui.
2025-10-13 08:48:17,359 - APP.ui.components.chart_tab - DEBUG - Bắt đầu hàm __init__ của ChartTab.
2025-10-13 08:48:17,360 - APP.ui.components.chart_tab - DEBUG - Bắt đầu hàm _init_vars.
2025-10-13 08:48:17,360 - APP.ui.components.chart_tab - DEBUG - Kết thúc hàm _init_vars.
2025-10-13 08:48:17,362 - APP.ui.components.chart_tab - DEBUG - Bắt đầu hàm _build_controls.
2025-10-13 08:48:17,366 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.symbols' vào nhóm 'chart.init' (metadata={'component': 'chart'})
2025-10-13 08:48:17,368 - APP.services.mt5_service - DEBUG - Bắt đầu get_all_symbols.
2025-10-13 08:48:17,370 - APP.services.mt5_service - DEBUG - Bắt đầu ensure_initialized. Path: None
2025-10-13 08:48:17,371 - APP.services.mt5_service - DEBUG - Bắt đầu connect MT5. Path: None
2025-10-13 08:48:17,429 - APP.services.mt5_service - INFO - Kết nối MT5 thành công.
2025-10-13 08:48:17,431 - APP.services.mt5_service - DEBUG - Kết thúc connect MT5.
2025-10-13 08:48:17,432 - APP.services.mt5_service - DEBUG - Kết thúc ensure_initialized. Kết quả: True
2025-10-13 08:48:17,445 - APP.services.mt5_service - DEBUG - Đã lấy được 357 symbols.
2025-10-13 08:48:17,449 - APP.utils.threading_utils - DEBUG - Task 'chart.symbols' (group=chart.init) hoàn tất sau 0.08s
2025-10-13 08:48:17,519 - APP.ui.components.chart_tab - DEBUG - Kết thúc hàm _build_controls.
2025-10-13 08:48:17,746 - APP.ui.components.chart_tab - DEBUG - Đã khởi tạo Figure và FigureCanvasTkAgg.
2025-10-13 08:48:17,883 - APP.ui.components.chart_tab - DEBUG - Đã khởi tạo NavigationToolbar2Tk.
2025-10-13 08:48:18,025 - APP.ui.components.chart_tab - DEBUG - Kết thúc hàm __init__ của ChartTab.
2025-10-13 08:48:19,642 - APP.ui.utils.ui_builder - DEBUG - Kết thúc build_ui.
2025-10-13 08:48:19,767 - APP.ui.components.history_manager - DEBUG - Bắt đầu liên kết các widget UI cho HistoryManager.
2025-10-13 08:48:19,965 - APP.ui.components.history_manager - DEBUG - Đã tạo md_manager cho history_list.
2025-10-13 08:48:20,150 - APP.ui.components.history_manager - DEBUG - Đã tạo json_manager cho json_list.
2025-10-13 08:48:20,244 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.update_models' vào nhóm 'ui.io.models' (metadata={'component': 'ui', 'operation': 'update_models'})
2025-10-13 08:48:20,327 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.update_models vào group ui.io.models (metadata={'component': 'ui', 'operation': 'update_models'})
2025-10-13 08:48:20,327 - APP.ui.app_ui - DEBUG - Bắt đầu worker cập nhật danh sách mô hình AI.
2025-10-13 08:48:20,330 - APP.ui.app_ui - DEBUG - Bắt đầu áp dụng cấu hình lên UI.
2025-10-13 08:48:20,515 - APP.ui.app_ui - DEBUG - Bắt đầu quá trình tải file từ thư mục: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots.
2025-10-13 08:48:20,537 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.scan_folder' vào nhóm 'ui.io.scan' (metadata={'component': 'ui', 'operation': 'scan_folder'})
2025-10-13 08:48:20,730 - APP.ui.app_ui - DEBUG - Luồng quét thư mục bắt đầu cho: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots.
2025-10-13 08:48:20,730 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.scan_folder vào group ui.io.scan (metadata={'component': 'ui', 'operation': 'scan_folder'})
2025-10-13 08:48:20,733 - APP.ui.app_ui - DEBUG - Symbol đã thay đổi thành: XAUUSD, đang đồng bộ hóa các thành phần.
2025-10-13 08:48:20,738 - APP.ui.app_ui - INFO - Luồng quét đã hoàn tất, tìm thấy 4 file.
2025-10-13 08:48:20,752 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-13 08:48:20,754 - APP.utils.threading_utils - DEBUG - Task 'ui.io.scan_folder' (group=ui.io.scan) hoàn tất sau 0.02s
2025-10-13 08:48:20,817 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-13 08:48:20,925 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:20,927 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:20,927 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-13 08:48:20,929 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-13 08:48:20,933 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:20,935 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-13 08:48:20,935 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:20,994 - APP.ui.app_ui - DEBUG - Thông báo cho ChartTab để vẽ lại biểu đồ.
2025-10-13 08:48:20,995 - APP.ui.components.chart_tab - DEBUG - Đặt lại trạng thái và vẽ lại biểu đồ do hành động của người dùng.
2025-10-13 08:48:20,996 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M15', candles=150, chart_type='Nến')
2025-10-13 08:48:21,026 - APP.services.gemini_service - INFO - Đã tìm thấy 41 model khả dụng.
2025-10-13 08:48:21,056 - APP.ui.components.chart_tab - DEBUG - Đặt lại trạng thái và vẽ lại biểu đồ do hành động của người dùng.
2025-10-13 08:48:21,060 - APP.utils.threading_utils - DEBUG - Task 'ui.io.update_models' (group=ui.io.models) hoàn tất sau 0.73s
2025-10-13 08:48:21,060 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='Nến')
2025-10-13 08:48:21,062 - APP.ui.app_ui - INFO - Chuyển đổi Autorun sang: Bật
2025-10-13 08:48:21,070 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-13 08:48:21,072 - APP.ui.components.prompt_manager - DEBUG - Yêu cầu tải prompts từ đĩa. Silent: True
2025-10-13 08:48:21,073 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._load_prompts_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_load_prompts_worker'})
2025-10-13 08:48:21,117 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._load_prompts_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_load_prompts_worker'})
2025-10-13 08:48:21,118 - APP.ui.components.prompt_manager - DEBUG - Worker bắt đầu đọc các file prompt.
2025-10-13 08:48:21,119 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-13 08:48:21,120 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-13 08:48:21,121 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-13 08:48:21,121 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:21,122 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-13 08:48:21,123 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-13 08:48:21,129 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:21,130 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-13 08:48:21,131 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-13 08:48:21,135 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-13 08:48:21,184 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-13 08:48:21,186 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-13 08:48:21,187 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:21,194 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-13 08:48:21,197 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-13 08:48:21,198 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._load_prompts_worker' (group=ui.misc) hoàn tất sau 0.08s
2025-10-13 08:48:21,249 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-13 08:48:21,296 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:21,305 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:48:21,306 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:48:21,308 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:48:21,373 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:48:21,377 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-13 08:48:21,435 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-13 08:48:21,438 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-13 08:48:21,489 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-13 08:48:21,496 - APP.ui.app_ui - INFO - Đã áp dụng cấu hình lên UI thành công.
2025-10-13 08:48:21,502 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:21,551 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:21,617 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-13 08:48:21,644 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-13 08:48:21,713 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-13 08:48:21,764 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:48:21,780 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-13 08:48:21,920 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-13 08:48:21,922 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-13 08:48:21,922 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-13 08:48:21,932 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-13 08:48:22,057 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:22,147 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: refresh_all_lists
2025-10-13 08:48:22,153 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-13 08:48:22,175 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-13 08:48:22,232 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-13 08:48:22,237 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-13 08:48:22,245 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:22,247 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.33s
2025-10-13 08:48:22,253 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:22,256 - APP.ui.components.history_manager.FileListView - ERROR - Lỗi khi làm mới danh sách Báo cáo: main thread is not in main loop
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\ui\components\history_manager.py", line 83, in _refresh_worker
    base_folder_str = self.app.folder_path.get()
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\tkinter\__init__.py", line 569, in get
    value = self._tk.globalgetvar(self._name)
RuntimeError: main thread is not in main loop
2025-10-13 08:48:22,258 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-13 08:48:22,258 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-13 08:48:22,369 - APP.ui.components.history_manager.FileListView - ERROR - Lỗi khi làm mới danh sách JSON: main thread is not in main loop
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\ui\components\history_manager.py", line 83, in _refresh_worker
    base_folder_str = self.app.folder_path.get()
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\tkinter\__init__.py", line 569, in get
    value = self._tk.globalgetvar(self._name)
RuntimeError: main thread is not in main loop
2025-10-13 08:48:22,473 - APP.ui.components.history_manager.FileListView - ERROR - Lỗi khi làm mới danh sách Báo cáo: main thread is not in main loop
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\ui\components\history_manager.py", line 83, in _refresh_worker
    base_folder_str = self.app.folder_path.get()
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\tkinter\__init__.py", line 569, in get
    value = self._tk.globalgetvar(self._name)
RuntimeError: main thread is not in main loop
2025-10-13 08:48:22,518 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 1.59s
2025-10-13 08:48:22,520 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:22,520 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 1.58s
2025-10-13 08:48:22,521 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 1.40s
2025-10-13 08:48:22,522 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-13 08:48:22,522 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-13 08:48:22,526 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui_success
2025-10-13 08:48:22,528 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:22,529 - APP.ui.components.prompt_manager - DEBUG - Cập nhật UI với nội dung prompt đã tải.
2025-10-13 08:48:22,631 - APP.ui.components.prompt_manager - DEBUG - Kết thúc cập nhật UI cho prompts.
2025-10-13 08:48:22,679 - APP.ui.components.history_manager.FileListView - ERROR - Lỗi khi làm mới danh sách JSON: main thread is not in main loop
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\ui\components\history_manager.py", line 83, in _refresh_worker
    base_folder_str = self.app.folder_path.get()
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\tkinter\__init__.py", line 569, in get
    value = self._tk.globalgetvar(self._name)
RuntimeError: main thread is not in main loop
2025-10-13 08:48:22,739 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:22,754 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 1.51s
2025-10-13 08:48:22,755 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:22,758 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:22,760 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:23,040 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:48:23,203 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-13 08:48:23,204 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-13 08:48:23,321 - APP.ui.components.prompt_manager - DEBUG - Yêu cầu tải prompts từ đĩa. Silent: False
2025-10-13 08:48:23,324 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._load_prompts_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_load_prompts_worker'})
2025-10-13 08:48:23,325 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._load_prompts_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_load_prompts_worker'})
2025-10-13 08:48:23,325 - APP.ui.components.prompt_manager - DEBUG - Worker bắt đầu đọc các file prompt.
2025-10-13 08:48:23,328 - APP.ui.app_ui - DEBUG - AppUI đã khởi tạo xong.
2025-10-13 08:48:23,333 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-13 08:48:23,334 - APP.ui.controllers.chart_controller - INFO - Khởi động ChartController cho symbol=XAUUSD
2025-10-13 08:48:23,335 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-13 08:48:23,336 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:23,338 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-13 08:48:23,339 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:23,340 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:48:23,342 - APP.ui.components.chart_tab - INFO - ChartTab đã bắt đầu làm mới dữ liệu.
2025-10-13 08:48:23,343 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-13 08:48:23,446 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='Nến')
2025-10-13 08:48:23,447 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-13 08:48:23,502 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:23,550 - APP.ui.controllers.chart_controller - DEBUG - User yêu cầu snapshot chart ngay lập tức.
2025-10-13 08:48:23,554 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-13 08:48:23,555 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-13 08:48:23,566 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:23,567 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:23,570 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:23,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:23,621 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-13 08:48:23,623 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:23,625 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-13 08:48:23,626 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._load_prompts_worker' (group=ui.misc) hoàn tất sau 0.30s
2025-10-13 08:48:23,700 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.20s
2025-10-13 08:48:23,790 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:23,822 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-13 08:48:23,973 - APP.ui.components.prompt_manager - DEBUG - Cập nhật UI với nội dung prompt đã tải.
2025-10-13 08:48:23,975 - APP.ui.components.prompt_manager - DEBUG - Kết thúc cập nhật UI cho prompts.
2025-10-13 08:48:23,981 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:24,282 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 3 JSON.
2025-10-13 08:48:24,283 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 3 Báo cáo.
2025-10-13 08:48:24,287 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 1.76s
2025-10-13 08:48:24,290 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:24,295 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 2.04s
2025-10-13 08:48:24,298 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:24,307 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:24,376 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:24,581 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.29s
2025-10-13 08:48:25,092 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:25,095 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:25,108 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:25,141 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:48:25,401 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:25,411 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:25,412 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:25,415 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:25,456 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:25,458 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-13 08:48:25,556 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:25,947 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:48:26,123 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,124 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:48:26,127 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,128 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,245 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:48:26,263 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,279 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,332 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-13 08:48:26,343 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:48:26,352 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,356 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:48:26,364 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,374 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-13 08:48:26,621 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:26,797 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-13 08:48:26,905 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:48:27,182 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-13 08:48:27,206 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:48:27,207 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:27,330 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-13 08:48:27,991 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-13 08:48:28,029 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-13 08:48:28,029 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:48:28,030 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:28,201 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-13 08:48:28,298 - APP.services.mt5_service - DEBUG - Current price (cp): 4075.824
2025-10-13 08:48:28,384 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:28,393 - APP.services.mt5_service - DEBUG - Current price (cp): 4075.882
2025-10-13 08:48:28,400 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 279, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-13 08:48:28,405 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:28,411 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 279, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-13 08:48:28,487 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 250, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-13 08:48:28,538 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 1.54s
2025-10-13 08:48:28,616 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 250, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-13 08:48:28,617 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-13 08:48:28,620 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:48:28,674 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-13 08:48:28,746 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:28,748 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:28,789 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-13 08:48:28,867 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:28,920 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:28,937 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-13 08:48:28,989 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-13 08:48:29,062 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,166 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-13 08:48:29,168 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:29,169 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-13 08:48:29,175 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-13 08:48:29,178 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:29,179 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-13 08:48:29,181 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,191 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:29,242 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-13 08:48:29,298 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-13 08:48:29,359 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:29,364 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,367 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-13 08:48:29,369 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,426 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-13 08:48:29,481 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-13 08:48:29,487 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.31s
2025-10-13 08:48:29,490 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-13 08:48:29,494 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,500 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-13 08:48:29,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-13 08:48:29,604 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,605 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-13 08:48:29,609 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-13 08:48:29,612 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-13 08:48:29,613 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-13 08:48:29,613 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,620 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-13 08:48:29,623 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:48:29,626 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:29,673 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-13 08:48:29,678 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:48:29,733 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-13 08:48:29,738 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4060.294, 'low': 4008.706}
2025-10-13 08:48:30,001 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4060.294, 'low': 4008.706}
2025-10-13 08:48:30,021 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:48:30,032 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-13 08:48:30,033 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:30,140 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-13 08:48:30,372 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:48:30,374 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-13 08:48:30,437 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4035.257, 'high': 4078.268, 'low': 4024.361, 'eq50': 4051.3145, 'midnight_open': None}
2025-10-13 08:48:30,561 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4035.257, 'high': 4078.268, 'low': 4024.361, 'eq50': 4051.3145, 'midnight_open': None}
2025-10-13 08:48:30,621 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:30,668 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:48:27+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:48:30,760 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-13 15:48:26+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-13 08:48:30,880 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:31,168 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:48:27+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:48:31,297 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:48:26+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:48:31,410 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:31,420 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:48:27+07:00
2025-10-13 08:48:31,420 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:48:26+07:00
2025-10-13 08:48:31,422 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:31,544 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:48:27+07:00 trong DST: True
2025-10-13 08:48:31,594 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:48:26+07:00 trong DST: True
2025-10-13 08:48:31,759 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:31,778 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:48:31,779 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:48:31,780 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.90s
2025-10-13 08:48:31,781 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:48:31,818 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:48:31,988 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:48:31,989 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-13 08:48:32,097 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:48:32,110 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:32,112 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:48:32,119 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4071.754640381355
2025-10-13 08:48:32,180 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4071.7550471050463
2025-10-13 08:48:32,297 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:48:32,383 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-13 08:48:32,504 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4071.754640381355
2025-10-13 08:48:32,526 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4071.754640381355, 'asia': 4071.754640381355, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:48:32,530 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4071.7550471050463
2025-10-13 08:48:32,718 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:48:32,746 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4072.710730265862
2025-10-13 08:48:32,755 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4071.7550471050463, 'asia': 4071.7550471050463, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-13 08:48:32,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:48:33,000 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:48:33,017 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4071.089922212832
2025-10-13 08:48:33,094 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4072.7081420305676
2025-10-13 08:48:33,170 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:48:33,187 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:33,410 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:48:33,412 - APP.utils.threading_utils - WARNING - Task 'chart.info' (group=chart.refresh) vượt timeout 10.00s → cancel
2025-10-13 08:48:33,416 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:48:33,426 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:33,477 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4068.0649276144527
2025-10-13 08:48:33,516 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:48:33,520 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:48:33,520 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4071.089265496414
2025-10-13 08:48:33,521 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:33,526 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.9063712170746
2025-10-13 08:48:33,539 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-13 08:48:33,541 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:33,542 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:33,577 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.15s
2025-10-13 08:48:33,580 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:48:33,581 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4068.0649276144527
2025-10-13 08:48:33,583 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4050.5809754692245
2025-10-13 08:48:33,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-13 08:48:33,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:48:33,584 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.9063712170746
2025-10-13 08:48:33,585 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.685105483947
2025-10-13 08:48:33,585 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-13 08:48:33,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:48:33,590 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4050.5809754692245
2025-10-13 08:48:33,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4017.849986512989
2025-10-13 08:48:33,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:48:33,593 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.891611478031
2025-10-13 08:48:33,646 - APP.utils.threading_utils - WARNING - Task 'chart.info' (group=chart.refresh) vượt timeout 10.00s → cancel
2025-10-13 08:48:33,655 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4072.710730265862, 'ema200': 4071.089922212832}, 'M5': {'ema50': 4068.0649276144527, 'ema200': 4040.9063712170746}, 'M15': {'ema50': 4050.5809754692245, 'ema200': 4014.685105483947}, 'H1': {'ema50': 4017.849986512989, 'ema200': 3984.891611478031}}
2025-10-13 08:48:33,729 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:33,730 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-13 08:48:33,731 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:48:33,733 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 4.056485790318613, TRs count: 179
2025-10-13 08:48:33,733 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.685105483947
2025-10-13 08:48:33,745 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:48:33,842 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-13 08:48:33,854 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.6590675876421965, TRs count: 119
2025-10-13 08:48:33,949 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4017.849986512989
2025-10-13 08:48:33,952 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:48:34,110 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-13 08:48:34,145 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.475147282253355, TRs count: 95
2025-10-13 08:48:34,152 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.891611478031
2025-10-13 08:48:34,154 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:48:34,156 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4072.7081420305676, 'ema200': 4071.089265496414}, 'M5': {'ema50': 4068.0649276144527, 'ema200': 4040.9063712170746}, 'M15': {'ema50': 4050.5809754692245, 'ema200': 4014.685105483947}, 'H1': {'ema50': 4017.849986512989, 'ema200': 3984.891611478031}}
2025-10-13 08:48:34,290 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 18.411787418107426, TRs count: 119
2025-10-13 08:48:34,295 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-13 08:48:34,298 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 4.056485790318613, TRs count: 179
2025-10-13 08:48:34,300 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:48:34,302 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 4.056485790318613, 'M1': 1.6590675876421965, 'M15': 7.475147282253355, 'H1': 18.411787418107426}
2025-10-13 08:48:34,305 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.6590675876421965, TRs count: 119
2025-10-13 08:48:34,311 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-13 08:48:34,313 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 7.475147282253355, TRs count: 95
2025-10-13 08:48:34,385 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-13 08:48:34,387 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:48:34,391 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 18.411787418107426, TRs count: 119
2025-10-13 08:48:34,392 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4075.882, daily: {'open': 4035.257, 'high': 4078.268, 'low': 4024.361, 'eq50': 4051.3145, 'midnight_open': None}, prev_day: {'high': 4060.294, 'low': 4008.706}
2025-10-13 08:48:34,395 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 4.056485790318613, 'M1': 1.6590675876421965, 'M15': 7.475147282253355, 'H1': 18.411787418107426}
2025-10-13 08:48:34,396 - APP.services.mt5_service - DEBUG - Thêm PDH: 4060.294
2025-10-13 08:48:34,398 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-13 08:48:34,398 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4075.824, daily: {'open': 4035.257, 'high': 4078.268, 'low': 4024.361, 'eq50': 4051.3145, 'midnight_open': None}, prev_day: {'high': 4060.294, 'low': 4008.706}
2025-10-13 08:48:34,403 - APP.services.mt5_service - DEBUG - Thêm PDH: 4060.294
2025-10-13 08:48:34,404 - APP.services.mt5_service - DEBUG - Thêm PDL: 4008.706
2025-10-13 08:48:34,405 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4051.3145
2025-10-13 08:48:34,406 - APP.services.mt5_service - DEBUG - Thêm DO: 4035.257
2025-10-13 08:48:34,407 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4060.294, Relation: BELOW, Distance: 15530.0000000002
2025-10-13 08:48:34,451 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-13 08:48:34,454 - APP.services.mt5_service - DEBUG - Thêm PDL: 4008.706
2025-10-13 08:48:34,457 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4008.706, Relation: BELOW, Distance: 67117.99999999994
2025-10-13 08:48:34,461 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-13 08:48:34,468 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4051.3145
2025-10-13 08:48:34,469 - APP.services.mt5_service - DEBUG - Thêm DO: 4035.257
2025-10-13 08:48:34,514 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-13 08:48:34,516 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4051.3145, Relation: BELOW, Distance: 24509.500000000116
2025-10-13 08:48:34,517 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4035.257, Relation: BELOW, Distance: 40567.00000000001
2025-10-13 08:48:34,526 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-13 08:48:34,584 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4060.294, Relation: BELOW, Distance: 15588.000000000193
2025-10-13 08:48:34,642 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:48:34,647 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-13 08:48:34,648 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4008.706, Relation: BELOW, Distance: 67175.99999999993
2025-10-13 08:48:34,649 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4051.3145, Relation: BELOW, Distance: 24567.50000000011
2025-10-13 08:48:34,650 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4035.257, Relation: BELOW, Distance: 40625.0
2025-10-13 08:48:34,651 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-13 08:48:34,655 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4060.294, 'relation': 'BELOW', 'distance_pips': 15588.000000000193}, {'name': 'PDL', 'price': 4008.706, 'relation': 'BELOW', 'distance_pips': 67175.99999999993}, {'name': 'EQ50_D', 'price': 4051.3145, 'relation': 'BELOW', 'distance_pips': 24567.50000000011}, {'name': 'DO', 'price': 4035.257, 'relation': 'BELOW', 'distance_pips': 40625.0}]
2025-10-13 08:48:34,681 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-13 08:48:34,705 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.25s
2025-10-13 08:48:34,709 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4060.294, 'relation': 'BELOW', 'distance_pips': 15530.0000000002}, {'name': 'PDL', 'price': 4008.706, 'relation': 'BELOW', 'distance_pips': 67117.99999999994}, {'name': 'EQ50_D', 'price': 4051.3145, 'relation': 'BELOW', 'distance_pips': 24509.500000000116}, {'name': 'DO', 'price': 4035.257, 'relation': 'BELOW', 'distance_pips': 40567.00000000001}]
2025-10-13 08:48:34,715 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 74.16679999999997, 'd10': 65.854, 'd20': 57.34705000000001}
2025-10-13 08:48:34,718 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-13 08:48:34,719 - APP.services.mt5_service - DEBUG - Prev day close: 4035.208
2025-10-13 08:48:34,721 - APP.services.mt5_service - DEBUG - Day range: 53.90700000000015, Day range % of ADR20: 94.00134793332899
2025-10-13 08:48:34,722 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 74.16679999999997, 'd10': 65.854, 'd20': 57.34705000000001}
2025-10-13 08:48:34,722 - APP.services.mt5_service - DEBUG - Position in day range: 0.9557385868254594
2025-10-13 08:48:34,761 - APP.services.mt5_service - DEBUG - Prev day close: 4035.208
2025-10-13 08:48:34,763 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:48:27+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:48:34,765 - APP.services.mt5_service - DEBUG - Day range: 53.90700000000015, Day range % of ADR20: 94.00134793332899
2025-10-13 08:48:34,769 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:48:27+07:00
2025-10-13 08:48:34,771 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:48:27+07:00 trong DST: True
2025-10-13 08:48:34,772 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:48:34,773 - APP.services.mt5_service - DEBUG - Position in day range: 0.9546626597658939
2025-10-13 08:48:34,776 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-13 15:48:26+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-13 08:48:34,777 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-13 15:48:26+07:00
2025-10-13 08:48:34,778 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-13 15:48:26+07:00 trong DST: True
2025-10-13 08:48:34,779 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-13 08:48:34,780 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:48:34,781 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:48:34,794 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:48:34,821 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-13 08:48:34,826 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-13 08:48:34,829 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:34,844 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-13 08:48:34,899 - APP.services.mt5_service - DEBUG - Killzone active: london, Mins to next killzone: None
2025-10-13 08:48:34,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:35,077 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:35,080 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8200', 'price': 4075.82, 'distance_pips': 0.4}, {'level': '8225', 'price': 4075.823, 'distance_pips': 0.15}, {'level': '8250', 'price': 4075.825, 'distance_pips': 0.1}, {'level': '8275', 'price': 4075.828, 'distance_pips': 0.35}]
2025-10-13 08:48:35,082 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:35,156 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.9121195515614282}
2025-10-13 08:48:35,165 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8800', 'price': 4075.88, 'distance_pips': 0.2}, {'level': '8825', 'price': 4075.883, 'distance_pips': 0.05}, {'level': '8850', 'price': 4075.885, 'distance_pips': 0.3}, {'level': '8875', 'price': 4075.888, 'distance_pips': 0.55}]
2025-10-13 08:48:35,469 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.9121195515614282}
2025-10-13 08:48:35,477 - APP.ui.app_ui - INFO - Bắt đầu quy trình tắt ứng dụng an toàn.
2025-10-13 08:48:35,560 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:35,570 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:35,572 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:35,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:48:35,577 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:35,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:48:35,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4075.882
2025-10-13 08:48:35,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4075.824
2025-10-13 08:48:35,593 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:35,594 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:35,594 - APP.utils.threading_utils - INFO - Cancel group 'news.polling' → task 'news.refresh.autorun'
2025-10-13 08:48:35,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:48:35,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:48:35,678 - APP.utils.threading_utils - INFO - Cancel group 'news.polling' → task 'news.provider.fmp'
2025-10-13 08:48:35,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:35,912 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:48:35,956 - APP.ui.controllers.chart_controller - INFO - Dừng ChartController stream hiện tại.
2025-10-13 08:48:36,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:48:36,040 - APP.utils.threading_utils - INFO - Cancel group 'chart.refresh' → task 'chart.info'
2025-10-13 08:48:36,041 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-13 08:48:36,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4075.824
2025-10-13 08:48:36,042 - APP.utils.threading_utils - INFO - Cancel group 'chart.refresh' → task 'chart.info'
2025-10-13 08:48:36,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-13 08:48:36,044 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4075.882
2025-10-13 08:48:36,045 - APP.ui.components.chart_tab - INFO - ChartTab đã dừng làm mới dữ liệu.
2025-10-13 08:48:36,046 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:36,047 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:36,048 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:48:36,048 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-13 08:48:36,049 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,052 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,112 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:48:36,113 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-13 08:48:36,113 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:48:36,118 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-13 08:48:36,124 - APP.ui.app_ui - DEBUG - Bắt đầu thu thập dữ liệu cấu hình từ UI.
2025-10-13 08:48:36,171 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4075.882
2025-10-13 08:48:36,172 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4075.824
2025-10-13 08:48:36,173 - APP.configs.workspace_config - DEBUG - Bắt đầu lưu cấu hình vào file.
2025-10-13 08:48:36,174 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:36,176 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:48:36,177 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,179 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:48:36,180 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:48:36,186 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4075.882
2025-10-13 08:48:36,187 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:36,188 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:36,230 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-13 08:48:36,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:48:36,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-13 08:48:36,233 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-13 08:48:36,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,235 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,236 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-13 08:48:36,236 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:48:36,237 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-13 08:48:36,237 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-13 08:48:36,238 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,238 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-13 08:48:36,239 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-13 08:48:36,239 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,240 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4075.824
2025-10-13 08:48:36,241 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'te'.
2025-10-13 08:48:36,241 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-13 08:48:36,242 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-13 08:48:36,244 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-13 08:48:36,245 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:48:36,245 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-13 08:48:36,246 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-13 08:48:36,247 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-13 08:48:36,247 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-13 08:48:36,248 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-13 08:48:36,248 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:48:36,250 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-13 08:48:36,251 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,253 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-13 08:48:36,253 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:48:36,254 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,255 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-13 08:48:36,289 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-13 08:48:36,295 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-13 08:48:36,295 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-13 08:48:36,296 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-13 08:48:36,299 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'fmp'.
2025-10-13 08:48:36,305 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-13 08:48:36,311 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-13 08:48:36,329 - APP.services.fmp_service - INFO - Lấy thành công 476 sự kiện từ investpy cho 7 ngày tới.
2025-10-13 08:48:36,354 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-13 08:48:36,358 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-13 08:48:36,358 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:48:36,359 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 14.74s
2025-10-13 08:48:36,360 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-13 08:48:36,360 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-13 08:48:36,361 - APP.services.news_service - INFO - Provider fmp bị hủy do cancel token.
2025-10-13 08:48:36,361 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-13 08:48:36,362 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:48:36,362 - APP.services.news_service - INFO - Provider te bị hủy do cancel token.
2025-10-13 08:48:36,363 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-13 08:48:36,363 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-13 08:48:36,364 - APP.utils.threading_utils - INFO - Task 'news.refresh.autorun' (group=news.polling) bị hủy sau 14.87s
2025-10-13 08:48:36,364 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'token' trong nhóm 'telegram'.
2025-10-13 08:48:36,365 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:48:36,366 - APP.ui.controllers.news_controller - DEBUG - Future news bị cancel, không cập nhật UI.
2025-10-13 08:48:36,368 - APP.configs.workspace_config - INFO - Cấu hình đã được lưu thành công vào C:\Users\leanhchi\.gemini_folder_analyze\workspace.json
2025-10-13 08:48:36,368 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-13 08:48:36,369 - APP.configs.workspace_config - DEBUG - Kết thúc lưu cấu hình vào file.
2025-10-13 08:48:36,370 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-13 08:48:36,372 - APP.ui.app_ui - INFO - Đã lưu cấu hình workspace thành công.
2025-10-13 08:48:36,373 - APP.services.mt5_service - INFO - Đang ngắt kết nối khỏi MetaTrader 5.
2025-10-13 08:48:36,374 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-13 08:48:36,374 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:48:36,376 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-13 08:48:36,380 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:48:36,420 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-13 08:48:36,421 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:48:36,422 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-13 08:48:36,422 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-13 08:48:36,423 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,425 - APP.services.mt5_service - INFO - Đã ngắt kết nối MT5 thành công.
2025-10-13 08:48:36,425 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,426 - APP.ui.app_ui - INFO - UI queue backlog khi shutdown: 0
2025-10-13 08:48:36,427 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-13 08:48:36,427 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:48:36,428 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-13 08:48:36,429 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:48:36,430 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:48:36,437 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:48:36,442 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:48:36,478 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-13 08:48:36,479 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-13 08:48:36,480 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:48:36,480 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-13 08:48:36,483 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-13 08:48:36,483 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,483 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:48:36,483 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-13 08:48:36,484 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4075.882, 'ask': 4075.919, 'last': 0.0, 'time': 1760345307}
2025-10-13 08:48:36,485 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:48:36,486 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-13 08:48:36,486 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-13 08:48:36,487 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,487 - APP.services.mt5_service - WARNING - MT5 chưa kết nối, không thể lấy lịch sử deals.
2025-10-13 08:48:36,487 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,488 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,488 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:48:36,488 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,489 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,490 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,491 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-13 08:48:36,492 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,493 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-13 08:48:36,495 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:48:36,496 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-13 08:48:36,497 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4075.882
2025-10-13 08:48:36,497 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-13 08:48:36,497 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4060.294, 'relation': 'BELOW', 'distance_pips': 15588.000000000193}, {'name': 'PDL', 'price': 4008.706, 'relation': 'BELOW', 'distance_pips': 67175.99999999993}, {'name': 'EQ50_D', 'price': 4051.3145, 'relation': 'BELOW', 'distance_pips': 24567.50000000011}, {'name': 'DO', 'price': 4035.257, 'relation': 'BELOW', 'distance_pips': 40625.0}]
2025-10-13 08:48:36,498 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-13 08:48:36,498 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:48:36,500 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-13 08:48:36,501 - APP.utils.threading_utils - INFO - Task 'chart.info' (group=chart.refresh) bị hủy sau 12.68s
2025-10-13 08:48:36,504 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,505 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-13 08:48:36,505 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-13 08:48:36,506 - APP.ui.controllers.chart_controller - DEBUG - Future chart.info bị cancel, không cập nhật UI.
2025-10-13 08:48:36,541 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4075.824, 'ask': 4075.861, 'last': 0.0, 'time': 1760345306}
2025-10-13 08:48:36,542 - APP.services.mt5_service - WARNING - MT5 chưa kết nối, không thể lấy lịch sử deals.
2025-10-13 08:48:36,544 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-13 08:48:36,545 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-13 08:48:36,545 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-13 08:48:36,546 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,547 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,547 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,548 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-13 08:48:36,548 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-13 08:48:36,548 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': london
2025-10-13 08:48:36,549 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4075.824
2025-10-13 08:48:36,549 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4060.294, 'relation': 'BELOW', 'distance_pips': 15530.0000000002}, {'name': 'PDL', 'price': 4008.706, 'relation': 'BELOW', 'distance_pips': 67117.99999999994}, {'name': 'EQ50_D', 'price': 4051.3145, 'relation': 'BELOW', 'distance_pips': 24509.500000000116}, {'name': 'DO', 'price': 4035.257, 'relation': 'BELOW', 'distance_pips': 40567.00000000001}]
2025-10-13 08:48:36,550 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-13 08:48:36,551 - APP.utils.threading_utils - INFO - Task 'chart.info' (group=chart.refresh) bị hủy sau 13.21s
2025-10-13 08:48:36,552 - APP.ui.controllers.chart_controller - DEBUG - Future chart.info bị cancel, không cập nhật UI.
2025-10-13 08:48:36,552 - APP.utils.threading_utils - INFO - ThreadingManager.shutdown(wait=True, timeout=5.0, force=False)
2025-10-13 08:48:37,086 - APP.ui.app_ui - INFO - Ứng dụng đã đóng thành công.
2025-10-13 08:48:37,284 - __main__ - INFO - Ứng dụng đã đóng thành công.
