2025-10-11 04:58:34,395 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:34,452 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:34,454 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:34,454 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:34,455 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:34,456 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:34,457 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:34,457 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:34,457 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:34,458 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:34,458 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:34,460 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:34,460 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:34,461 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:34,477 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:34,486 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:34,488 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:34,489 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:34,489 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:34,491 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:34,491 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:34,495 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:34,501 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:34,516 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:34,519 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:34,520 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:34,520 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:34,522 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:34,526 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 04:58:34,530 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:34,557 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:34,558 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:34,558 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:34,559 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:34,559 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:34,560 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:34,561 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:34,562 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:34,583 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.16s
2025-10-11 04:58:34,623 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:34,719 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:34,720 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:34,721 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:34,721 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:34,724 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:35,487 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:35,488 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:35,490 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:35,491 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:35,492 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:35,494 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:35,494 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:35,495 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:35,521 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:35,522 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:35,523 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:35,524 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:35,524 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:35,525 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:35,525 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:35,526 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:35,594 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:36,027 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:36,028 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:36,029 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:36,029 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:36,030 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:36,030 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:36,031 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:36,031 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:36,033 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:36,034 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:36,034 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:36,035 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:36,040 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:36,059 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:36,059 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:36,061 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:36,063 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:36,064 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:36,064 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:36,065 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:36,067 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:36,068 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:36,069 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:36,069 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:36,075 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:36,089 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:36,091 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:36,093 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:36,093 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:36,094 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:36.094627+07:00
2025-10-11 04:58:36,095 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:36.094627+07:00
2025-10-11 04:58:36,095 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:36.094627+07:00 trong DST: True
2025-10-11 04:58:36,096 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:36,096 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:36,097 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:36,122 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:36,122 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:36,126 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:36,127 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:36,128 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:36,128 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:36,131 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:36,148 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:36,148 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:36,150 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:36,150 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:36,151 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:36,151 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:36,152 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:36,152 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:36,152 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:36,153 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:36,153 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:36,154 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:36,154 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:36,154 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:36,155 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:36,155 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:36,156 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:36,156 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:36,157 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:36,157 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:36,158 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:36,159 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:36,160 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:36,160 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:36,161 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:36,161 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:36,185 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:36,186 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:36,187 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:36,187 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:36,188 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:36,188 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:36,189 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:36,189 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:36,189 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:36,190 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:36.190341+07:00
2025-10-11 04:58:36,190 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:36.190341+07:00
2025-10-11 04:58:36,191 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:36.190341+07:00 trong DST: True
2025-10-11 04:58:36,191 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:36,191 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:36,192 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:36,192 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,193 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:36,194 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:36,194 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:36,195 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,216 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:36,216 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:36,217 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:36,219 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:36,219 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:36,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:36,220 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:36,221 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:36,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:36,222 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:36,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:36,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:36,224 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:36,224 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:36,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:36,225 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:36,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:36,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:36,227 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:36,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:36,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:36,238 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:36,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:36,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:36,255 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:36,255 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,256 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:36,256 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:36,257 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:36,257 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:36,257 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:36,258 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:36,258 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:36,258 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:36,259 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:36,259 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:36,260 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:36,261 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:36,261 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:36,262 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:36,262 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:36,285 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:36,285 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:36,286 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,287 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:36,287 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:36,288 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:36,288 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:36,289 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:36,290 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:36,290 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:36,292 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,293 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:36,293 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:36,294 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:36,295 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:36,301 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:36,320 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:36,322 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:36,322 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,323 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:36,323 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,324 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:36,324 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:36,325 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:36,325 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:36,325 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:36,326 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:36,327 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-11 04:58:36,423 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:36,423 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:36,424 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:36,425 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:36,427 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:36,496 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:36,496 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:36,498 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:36,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:36,500 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:36,501 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:36,502 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:36,503 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:36,509 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:36,510 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:36,510 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:36,511 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:36,511 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:36,512 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:36,538 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:36,541 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:36,548 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:37,078 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:37,079 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:37,080 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:37,081 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:37,081 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:37,081 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:37,082 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:37,082 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:37,084 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:37,085 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:37,085 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:37,086 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:37,090 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:37,109 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:37,109 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:37,111 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:37,113 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:37,114 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:37,114 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:37,115 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:37,117 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:37,118 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:37,118 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:37,119 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:37,122 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:37,122 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:37,123 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:37,123 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:37,123 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:37,124 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:37.124137+07:00
2025-10-11 04:58:37,124 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:37.124137+07:00
2025-10-11 04:58:37,124 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:37.124137+07:00 trong DST: True
2025-10-11 04:58:37,125 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:37,125 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:37,126 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:37,127 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:37,127 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:37,135 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:37,151 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:37,152 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:37,152 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:37,153 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:37,155 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:37,155 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:37,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:37,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:37,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:37,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:37,158 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:37,158 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:37,158 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:37,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:37,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:37,160 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:37,160 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:37,161 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:37,162 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:37,162 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:37,163 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:37,163 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:37,164 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:37,164 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:37,186 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:37,187 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:37,188 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:37,189 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:37,189 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:37,189 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:37,190 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:37,190 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:37,190 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:37,191 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:37,192 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:37,192 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:37,193 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:37,193 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:37,194 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:37,194 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:37.194610+07:00
2025-10-11 04:58:37,195 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:37.194610+07:00
2025-10-11 04:58:37,195 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:37.194610+07:00 trong DST: True
2025-10-11 04:58:37,196 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:37,196 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:37,197 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:37,197 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,218 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:37,219 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:37,220 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:37,220 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,221 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:37,221 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:37,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:37,222 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:37,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:37,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:37,224 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:37,224 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:37,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:37,225 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:37,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:37,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:37,227 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:37,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:37,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:37,230 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:37,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:37,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:37,234 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:37,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:37,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:37,258 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:37,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:37,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:37,260 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:37,260 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,261 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:37,261 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:37,261 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:37,262 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:37,262 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:37,263 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:37,263 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:37,264 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:37,264 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:37,264 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:37,287 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:37,289 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:37,290 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:37,291 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:37,291 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:37,292 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:37,292 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:37,292 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,293 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:37,293 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:37,294 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:37,295 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:37,296 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:37,312 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:37,322 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:37,323 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,324 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:37,324 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:37,324 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:37,325 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:37,327 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:37,328 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:37,329 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:37,329 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,350 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:37,351 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,352 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:37,352 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:37,352 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:37,353 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:37,353 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:37,354 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:37,355 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-11 04:58:37,422 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:37,423 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:37,424 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:37,424 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:37,427 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:37,500 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:37,501 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:37,503 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:37,504 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:37,505 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:37,506 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:37,506 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:37,507 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:37,538 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:37,748 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:37,749 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:37,750 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:37,751 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:37,751 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:37,752 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:37,753 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:37,753 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:38,254 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:38,256 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:38,256 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:38,257 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:38,257 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:38,258 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:38,258 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:38,259 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:38,261 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:38,262 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:38,262 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:38,263 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:38,269 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:38,286 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:38,287 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:38,287 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:38,290 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:38,291 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:38,292 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:38,292 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:38,295 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:38,295 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:38,295 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:38,296 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:38,299 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:38,321 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:38,322 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:38,322 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:38,323 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:38,323 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:38.323579+07:00
2025-10-11 04:58:38,323 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:38.323579+07:00
2025-10-11 04:58:38,324 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:38.323579+07:00 trong DST: True
2025-10-11 04:58:38,324 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:38,324 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:38,325 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:38,326 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:38,326 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:38,329 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:38,330 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:38,330 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:38,334 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:38,354 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:38,356 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:38,357 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:38,357 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:38,358 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:38,358 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:38,359 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:38,359 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:38,360 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:38,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:38,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:38,361 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:38,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:38,362 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:38,362 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:38,363 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:38,363 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:38,364 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:38,364 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:38,366 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:38,366 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:38,367 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:38,367 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:38,388 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:38,389 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:38,390 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:38,390 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:38,391 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:38,392 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:38,392 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:38,392 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:38,393 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:38,393 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:38,394 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:38,394 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:38,395 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:38,395 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:38.395394+07:00
2025-10-11 04:58:38,395 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:38.395394+07:00
2025-10-11 04:58:38,396 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:38.395394+07:00 trong DST: True
2025-10-11 04:58:38,397 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:38,398 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:38,398 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:38,399 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,400 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:38,400 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:38,401 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:38,403 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,420 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:38,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:38,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:38,424 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:38,424 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:38,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:38,425 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:38,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:38,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:38,427 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:38,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:38,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:38,428 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:38,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:38,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:38,430 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:38,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:38,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:38,432 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:38,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:38,455 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:38,457 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:38,457 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:38,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:38,459 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:38,459 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,460 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:38,460 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:38,461 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:38,461 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:38,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:38,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:38,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:38,463 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:38,463 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:38,464 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:38,464 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:38,464 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:38,465 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:38,466 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:38,466 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:38,466 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:38,467 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:38,467 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,492 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:38,493 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:38,493 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:38,494 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:38,494 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:38,495 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:38,496 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:38,499 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,499 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:38,500 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:38,500 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:38,528 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:38,528 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:38,529 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:38,530 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:38,533 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:38,534 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:38,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:38,559 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,560 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:38,561 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:38,561 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:38,562 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,563 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:58:38,563 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:38,565 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:38,565 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:38,565 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:38,566 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:38,566 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:38,589 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.09s
2025-10-11 04:58:38,661 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:38,758 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:38,759 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:38,760 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:38,761 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:38,764 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:39,532 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:39,533 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:39,535 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:39,536 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:39,537 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:39,539 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:39,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:39,540 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:39,565 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:39,566 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:39,567 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:39,567 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:39,568 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:39,568 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:39,569 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:39,569 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:39,637 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:40,071 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:40,072 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:40,073 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:40,073 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:40,074 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:40,074 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:40,074 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:40,075 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:40,077 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:40,078 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:40,078 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:40,078 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:40,084 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:40,100 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:40,104 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:40,105 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:40,107 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:40,108 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:40,108 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:40,110 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:40,116 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:40,135 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:40,136 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:40,137 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:40,140 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:40,163 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:40,165 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:40,166 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:40,166 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:40,166 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:40.166811+07:00
2025-10-11 04:58:40,167 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:40.166811+07:00
2025-10-11 04:58:40,167 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:40.166811+07:00 trong DST: True
2025-10-11 04:58:40,167 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:40,168 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:40,168 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:40,169 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:40,170 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:40,174 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:40,197 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:40,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:40,199 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:40,199 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:40,200 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:40,200 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:40,201 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:40,201 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:40,201 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:40,202 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:40,202 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:40,202 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:40,203 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:40,204 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:40,205 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:40,206 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:40,206 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:40,226 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:40,228 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:40,228 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:40,229 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:40,230 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:40,230 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:40,230 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:40,232 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:40,232 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:40,232 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:40,233 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:40,233 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:40,233 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:40,234 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:40,234 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:40,235 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:40,235 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:40,235 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:40,236 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:40,237 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:40,237 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:40,237 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:40,238 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:40.238256+07:00
2025-10-11 04:58:40,238 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:40.238256+07:00
2025-10-11 04:58:40,239 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:40.238256+07:00 trong DST: True
2025-10-11 04:58:40,239 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:40,240 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:40,240 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:40,241 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,265 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:40,266 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:40,267 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:40,267 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,268 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:40,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:40,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:40,270 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:40,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:40,271 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:40,271 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:40,272 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:40,273 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:40,274 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:40,274 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:40,278 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:40,296 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:40,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:40,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:40,301 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:40,301 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:40,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:40,302 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:40,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:40,303 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:40,303 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:40,304 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:40,305 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:40,306 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:40,306 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,306 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:40,307 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:40,307 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:40,308 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:40,331 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:40,333 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:40,334 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:40,335 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:40,335 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:40,336 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:40,336 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:40,336 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:40,337 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:40,337 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:40,337 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:40,338 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:40,338 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:40,339 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,339 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:40,340 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:40,350 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:40,364 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:40,365 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:40,366 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:40,368 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:40,369 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,370 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:40,370 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:40,370 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:40,374 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:40,374 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:40,395 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:40,397 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:40,398 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,399 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:40,399 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,400 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:40,401 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:40,401 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:40,401 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:40,402 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:40,402 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:40,403 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:58:40,438 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:40,440 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:40,441 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:40,441 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:40,465 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:40,536 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:40,536 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:40,538 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:40,540 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:40,541 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:40,542 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:40,542 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:40,543 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:40,549 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:40,550 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:40,550 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:40,551 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:40,551 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:40,552 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:40,552 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:40,553 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:40,568 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:41,054 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:41,055 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:41,056 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:41,056 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:41,057 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:41,057 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:41,058 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:41,058 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:41,060 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:41,060 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:41,060 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:41,061 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:41,067 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:41,085 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:41,086 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:41,087 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:41,089 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:41,090 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:41,090 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:41,091 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:41,097 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:41,116 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:41,116 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:41,117 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:41,120 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:41,121 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:41,122 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:41,122 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:41,122 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:41,123 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:41.123219+07:00
2025-10-11 04:58:41,123 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:41.123219+07:00
2025-10-11 04:58:41,124 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:41.123219+07:00 trong DST: True
2025-10-11 04:58:41,124 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:41,124 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:41,125 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:41,126 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:41,147 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:41,152 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:41,153 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:41,153 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:41,154 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:41,154 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:41,154 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:41,155 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:41,155 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:41,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:41,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:41,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:41,157 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:41,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:41,158 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:41,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:41,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:41,162 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:41,180 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:41,182 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:41,183 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:41,183 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:41,184 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:41,184 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:41,185 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:41,185 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:41,186 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:41,186 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:41,187 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:41,187 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:41,188 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:41,188 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:41,189 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:41,189 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:41,189 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:41,190 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:41,190 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:41,191 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:41,192 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:41,195 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:41,197 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:41,200 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:41.200090+07:00
2025-10-11 04:58:41,204 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:41.200090+07:00
2025-10-11 04:58:41,213 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:41.200090+07:00 trong DST: True
2025-10-11 04:58:41,214 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:41,215 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:41,216 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:41,217 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,217 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:41,218 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:41,219 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:41,219 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,220 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:41,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:41,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:41,221 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:41,221 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:41,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:41,223 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:41,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:41,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:41,224 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:41,224 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:41,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:41,225 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:41,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:41,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:41,232 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:41,237 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:41,241 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:41,243 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:41,250 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:41,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:41,253 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:41,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:41,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:41,254 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:41,255 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,255 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:41,256 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:41,256 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:41,257 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:41,258 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:41,258 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:41,259 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:41,267 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:41,278 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:41,281 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:41,283 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:41,284 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:41,284 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:41,285 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:41,308 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:41,309 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:41,310 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:41,311 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,311 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:41,312 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:41,320 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:41,332 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:41,335 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:41,337 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:41,339 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:41,340 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,341 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:41,342 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:41,342 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:41,367 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:41,368 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:41,370 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:41,371 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:41,372 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,372 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:41,373 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,373 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:41,374 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:41,374 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:41,375 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:41,376 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:41,377 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:41,399 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-11 04:58:41,413 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:41,433 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:41,434 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:41,435 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:41,437 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:41,542 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:41,543 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:41,545 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:41,546 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:41,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:41,548 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:41,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:41,550 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:41,556 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:41,556 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:41,557 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:41,557 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:41,558 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:41,558 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:41,559 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:41,559 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:41,639 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:41,737 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:58:41,738 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:58:42,060 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:42,062 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:42,063 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.32s
2025-10-11 04:58:42,064 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:42,064 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:42,065 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:42,065 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:42,066 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:42,066 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:42,069 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:42,069 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:42,070 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:42,072 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:42,091 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:42,092 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:58:42,092 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:42,093 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:42,094 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:42,099 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:42,118 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:42,120 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:42,121 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:42,124 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:42,124 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:42,124 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:42,125 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:42,128 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:42,128 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:42,150 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:42,151 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:42,151 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:42,152 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:42.152229+07:00
2025-10-11 04:58:42,152 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:42.152229+07:00
2025-10-11 04:58:42,152 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:42.152229+07:00 trong DST: True
2025-10-11 04:58:42,153 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:42,154 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:42,154 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:42,155 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:42,155 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:42,159 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:42,160 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:42,161 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:42,161 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:42,162 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:42,183 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:42,184 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:42,185 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:42,185 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:42,185 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:42,186 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:42,186 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:42,187 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:42,187 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:42,187 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:42,188 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:42,188 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:42,189 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:42,189 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:42,190 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:42,190 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:42,190 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:42,191 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:42,191 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:42,192 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:42,193 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:42,193 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:42,194 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:42,194 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:42,195 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:42,199 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:42,214 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:42,215 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:42,215 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:42,216 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:42,217 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:42,217 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:42,219 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:42,219 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:42,221 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:42,221 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:42.221406+07:00
2025-10-11 04:58:42,221 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:42.221406+07:00
2025-10-11 04:58:42,222 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:42.221406+07:00 trong DST: True
2025-10-11 04:58:42,222 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:42,222 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:42,223 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:42,223 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,224 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:42,224 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:42,224 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:42,225 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,225 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:42,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:42,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:42,227 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:42,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:42,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:42,249 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:42,250 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:42,251 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:42,252 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:42,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:42,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:42,254 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:42,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:42,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:42,255 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:42,256 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:42,256 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:42,257 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:42,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:42,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:42,259 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:42,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:42,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:42,261 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:42,261 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,262 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:42,285 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:42,286 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:42,286 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:42,287 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:42,287 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:42,288 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:42,289 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:42,289 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:42,290 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:42,290 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:42,290 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:42,291 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:42,291 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:42,291 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:42,292 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:42,292 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:42,293 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,294 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:42,294 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:42,294 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:42,295 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:42,319 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:42,322 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:42,324 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:42,325 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,326 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:42,326 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:42,326 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:42,333 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:42,350 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:42,351 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:42,352 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:42,353 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,354 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:42,354 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,354 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:42,355 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:42,355 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:42,355 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:42,356 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:42,356 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:42,357 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.81s
2025-10-11 04:58:42,425 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:42,426 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:42,427 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:42,427 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:42,430 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:42,551 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:42,552 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:42,553 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:42,555 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:42,556 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:42,557 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:42,557 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:42,558 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:42,583 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:42,584 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:42,585 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:42,586 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:42,586 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:42,587 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:42,587 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:42,588 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:42,631 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:43,089 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:43,091 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:43,091 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:43,092 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:43,092 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:43,093 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:43,093 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:43,093 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:43,095 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:43,096 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:43,097 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:43,097 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:43,103 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:43,121 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:43,122 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:43,122 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:43,127 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:43,129 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:43,129 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:43,130 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:43,137 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:43,152 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:43,152 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:43,153 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:43,156 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:43,157 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:43,158 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:43,158 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:43,159 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:43,159 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:43.159457+07:00
2025-10-11 04:58:43,159 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:43.159457+07:00
2025-10-11 04:58:43,160 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:43.159457+07:00 trong DST: True
2025-10-11 04:58:43,160 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:43,161 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:43,161 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:43,163 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:43,163 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:43,169 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:43,180 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:43,182 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:43,188 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:43,189 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:43,190 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:43,191 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:43,191 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:43,192 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:43,193 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:43,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:43,194 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:43,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:43,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:43,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:43,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:43,196 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:43,197 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:43,198 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:43,198 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:43,198 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:43,203 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:43,217 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:43,219 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:43,220 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:43,221 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:43,222 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:43,222 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:43,223 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:43,223 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:43,224 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:43,224 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:43,224 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:43,225 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:43,225 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:43,225 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:43,226 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:43,226 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:43,227 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:43,227 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:43,227 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:43.227846+07:00
2025-10-11 04:58:43,228 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:43.227846+07:00
2025-10-11 04:58:43,228 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:43.227846+07:00 trong DST: True
2025-10-11 04:58:43,228 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:43,229 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:43,229 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:43,230 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,230 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:43,230 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:43,231 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:43,231 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,232 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:43,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:43,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:43,236 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:43,239 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:43,241 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:43,253 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:43,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:43,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:43,256 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:43,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:43,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:43,259 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:43,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:43,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:43,261 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:43,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:43,262 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:43,262 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:43,262 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:43,263 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:43,264 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:43,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:43,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:43,268 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:43,271 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,278 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:43,283 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:43,284 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:43,286 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:43,288 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:43,289 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:43,289 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:43,289 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:43,290 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:43,291 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:43,291 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:43,291 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:43,291 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:43,292 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:43,292 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:43,292 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:43,293 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:43,293 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,294 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:43,294 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:43,294 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:43,296 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:43,297 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:43,297 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:43,322 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:43,324 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,325 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:43,326 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:43,327 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:43,327 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:43,327 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:43,330 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:43,332 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,340 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:43,348 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:43,349 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,350 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:43,350 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:43,351 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:43,351 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:43,352 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:43,352 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:43,353 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 04:58:43,395 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:43,396 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:43,397 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:43,398 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:43,400 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:43,555 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:43,556 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:43,557 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:43,559 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:43,560 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:43,562 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:43,562 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:43,563 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:43,588 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:43,588 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:43,589 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:43,590 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:43,590 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:43,591 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:43,591 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:43,591 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:43,604 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:44,092 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:44,094 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:44,095 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:44,095 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:44,096 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:44,096 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:44,096 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:44,097 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:44,099 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:44,099 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:44,099 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:44,100 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:44,106 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:44,126 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:44,126 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:44,127 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:44,131 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:44,132 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:44,134 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:44,136 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:44,142 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:44,155 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:44,156 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:44,158 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:44,161 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:44,161 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:44,162 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:44,162 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:44,163 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:44,163 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:44.163661+07:00
2025-10-11 04:58:44,164 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:44.163661+07:00
2025-10-11 04:58:44,164 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:44.163661+07:00 trong DST: True
2025-10-11 04:58:44,165 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:44,165 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:44,165 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:44,166 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:44,167 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:44,174 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:44,193 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:44,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:44,196 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:44,196 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:44,197 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:44,197 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:44,198 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:44,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:44,199 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:44,199 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:44,200 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:44,200 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:44,201 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:44,201 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:44,202 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:44,202 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:44,222 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:44,225 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:44,226 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:44,226 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:44,227 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:44,227 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:44,227 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:44,228 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:44,228 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:44,229 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:44,229 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:44,230 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:44,230 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:44,231 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:44,231 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:44,231 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:44,232 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:44,232 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:44,232 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:44,233 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:44,234 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:44,235 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:44,236 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:44,260 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:44.260629+07:00
2025-10-11 04:58:44,263 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:44.260629+07:00
2025-10-11 04:58:44,264 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:44.260629+07:00 trong DST: True
2025-10-11 04:58:44,264 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:44,265 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:44,266 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:44,266 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,266 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:44,267 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:44,268 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:44,269 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,269 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:44,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:44,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:44,292 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:44,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:44,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:44,294 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:44,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:44,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:44,295 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:44,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:44,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:44,297 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:44,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:44,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:44,299 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:44,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:44,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:44,301 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:44,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:44,303 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:44,314 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:44,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:44,325 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:44,327 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:44,328 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,328 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:44,329 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:44,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:44,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:44,505 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:44,545 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:44,560 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:44,599 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:44,694 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:44,701 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:44,702 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:44,703 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:44,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:44,725 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:44,726 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:44,727 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:44,728 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:44,728 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:44,729 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:44,729 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,730 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:44,731 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:44,732 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:44,732 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:44,733 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:44,733 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:44,734 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.11s
2025-10-11 04:58:44,734 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:44,735 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:44,735 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:44,737 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:44,738 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,739 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:44,739 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:44,739 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:44,744 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:44,744 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:44,745 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:44,745 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:44,746 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,747 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:44,748 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,748 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:44,749 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:44,749 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:44,749 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:44,822 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:44,824 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:44,826 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.27s
2025-10-11 04:58:44,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:44,919 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:44,920 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:44,921 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:44,924 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:44,926 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:45,625 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:45,626 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:45,628 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:45,629 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:45,630 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:45,631 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:45,632 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:45,633 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:45,658 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:45,659 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:45,660 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:45,660 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:45,661 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:45,662 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:45,662 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:45,662 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:45,695 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:46,164 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:46,165 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:46,166 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:46,166 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:46,167 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:46,167 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:46,168 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:46,168 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:46,170 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:46,170 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:46,171 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:46,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:46,177 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:46,197 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:46,198 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:46,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:46,200 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:46,200 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:46,201 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:46,201 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:46,206 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:46,223 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:46,224 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:46,225 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:46,227 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:46,228 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:46,229 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:46,229 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:46,230 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:46,230 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:46.230570+07:00
2025-10-11 04:58:46,230 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:46.230570+07:00
2025-10-11 04:58:46,231 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:46.230570+07:00 trong DST: True
2025-10-11 04:58:46,231 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:46,249 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:46,253 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:46,255 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:46,256 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:46,260 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:46,261 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:46,261 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:46,262 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:46,262 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:46,263 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:46,263 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:46,263 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:46,264 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:46,264 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:46,265 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:46,265 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:46,284 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:46,285 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:46,285 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:46,286 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:46,286 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:46,286 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:46,287 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:46,288 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:46,288 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:46,289 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:46,289 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:46,290 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:46,290 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:46,291 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:46,291 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:46,291 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:46,292 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:46,292 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:46,292 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:46,293 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:46,293 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:46,294 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:46,294 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:46,295 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:46,295 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:46,296 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:46,296 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:46,296 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:46,297 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:46.297294+07:00
2025-10-11 04:58:46,297 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:46.297294+07:00
2025-10-11 04:58:46,298 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:46.297294+07:00 trong DST: True
2025-10-11 04:58:46,298 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:46,299 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:46,299 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:46,319 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,320 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:46,321 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:46,322 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:46,322 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,323 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:46,323 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:46,325 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:46,326 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:46,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:46,327 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:46,328 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:46,328 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:46,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:46,330 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:46,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:46,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:46,354 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:46,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:46,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:46,357 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:46,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:46,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:46,359 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:46,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:46,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:46,361 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:46,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:46,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:46,363 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:46,363 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,364 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:46,364 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:46,365 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:46,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:46,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:46,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:46,389 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:46,390 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:46,391 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:46,391 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:46,392 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:46,392 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:46,393 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:46,393 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:46,394 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:46,394 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:46,394 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:46,395 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,396 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:46,397 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:46,397 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:46,398 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:46,420 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:46,422 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:46,424 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:46,426 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,426 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:46,427 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:46,427 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:46,430 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:46,431 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:46,438 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:46,454 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:46,455 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,455 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:46,456 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,456 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:46,457 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:46,457 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:46,458 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:46,458 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:46,459 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:46,460 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.83s
2025-10-11 04:58:46,555 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:46,556 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:46,556 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:46,557 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:46,559 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:46,630 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:46,631 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:46,632 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:46,634 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:46,635 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:46,636 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:46,637 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:46,638 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:58:46,641 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:46,642 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:46,642 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:46,643 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:46,643 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:46,644 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:46,645 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:46,645 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:46,664 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:47,146 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:47,148 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:47,149 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:47,149 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:47,150 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:47,150 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:47,151 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:47,151 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:47,154 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:47,154 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:47,155 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:47,156 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:47,181 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:47,182 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:47,182 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:47,184 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:47,216 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:47,219 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:47,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:47,220 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:47,223 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:47,224 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:47,226 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:47,226 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:47,229 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:47,230 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:47,230 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:47,231 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:47,231 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:47,232 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:47.232860+07:00
2025-10-11 04:58:47,233 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:47.232860+07:00
2025-10-11 04:58:47,233 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:47.232860+07:00 trong DST: True
2025-10-11 04:58:47,234 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:47,234 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:47,258 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:47,260 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:47,261 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:47,264 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:47,264 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:47,266 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:47,267 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:47,285 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:47,286 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:47,286 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:47,287 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:47,288 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:47,288 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:47,289 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:47,289 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:47,290 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:47,290 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:47,290 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:47,291 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:47,292 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:47,292 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:47,293 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:47,293 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:47,294 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:47,294 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:47,295 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:47,295 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:47,296 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:47,296 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:47,297 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:47,297 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:47,298 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:47,298 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:47,299 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:47,299 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:47,299 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:47,323 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:47,324 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:47,325 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:47,325 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:47,326 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:47,326 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:47,327 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:47,327 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:47.327502+07:00
2025-10-11 04:58:47,327 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:47.327502+07:00
2025-10-11 04:58:47,328 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:47.327502+07:00 trong DST: True
2025-10-11 04:58:47,328 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:47,329 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:47,329 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:47,329 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,330 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:47,331 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:47,332 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:47,333 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,352 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:47,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:47,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:47,355 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:47,355 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:47,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:47,356 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:47,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:47,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:47,358 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:47,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:47,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:47,360 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:47,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:47,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:47,362 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:47,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:47,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:47,363 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:47,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:47,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:47,366 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:47,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:47,390 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:47,392 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:47,392 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,393 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:47,393 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:47,394 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:47,394 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:47,395 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:47,395 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:47,396 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:47,396 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:47,396 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:47,397 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:47,397 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:47,398 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:47,398 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:47,399 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:47,399 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:47,400 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:47,402 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:47,423 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,424 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:47,425 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:47,425 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:47,426 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:47,426 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:47,427 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:47,428 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:47,429 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,431 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:47,431 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:47,432 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:47,438 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:47,453 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:47,456 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:47,456 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:47,457 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,457 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:47,458 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,458 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:47,459 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:47,459 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:47,459 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:47,460 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:47,460 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:47,461 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.83s
2025-10-11 04:58:47,525 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:47,528 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:47,528 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:47,529 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:47,532 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:47,635 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:47,636 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:47,637 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:47,639 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:47,640 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:47,641 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:47,641 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:47,642 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:47,672 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:47,672 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:47,673 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:47,673 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:47,674 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:47,674 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:47,675 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:47,675 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:47,743 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:48,177 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:48,178 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:48,179 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:48,179 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:48,180 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:48,180 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:48,181 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:48,181 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:48,183 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:48,184 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:48,184 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:48,185 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:48,191 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:48,208 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:48,209 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:48,210 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:48,212 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:48,212 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:48,213 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:48,213 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:48,217 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:48,217 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:48,218 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:48,218 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:48,224 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:48,242 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:48,244 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:48,245 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:48,245 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:48,246 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:48.246277+07:00
2025-10-11 04:58:48,246 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:48.246277+07:00
2025-10-11 04:58:48,247 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:48.246277+07:00 trong DST: True
2025-10-11 04:58:48,247 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:48,247 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:48,248 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:48,249 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:48,249 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:48,253 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:48,253 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:48,254 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:48,254 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:48,276 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:48,277 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:48,278 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:48,279 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:48,279 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:48,279 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:48,280 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:48,280 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:48,280 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:48,281 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:48,281 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:48,282 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:48,282 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:48,282 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:48,283 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:48,284 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:48,285 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:48,285 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:48,286 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:48,288 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:48,308 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:48,310 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:48,310 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:48,311 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:48,311 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:48,312 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:48,312 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:48,312 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:48,313 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:48,313 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:48,313 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:48,314 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:48,314 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:48,315 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:48,315 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:48,316 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:48,316 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:48.316640+07:00
2025-10-11 04:58:48,317 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:48.316640+07:00
2025-10-11 04:58:48,318 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:48.316640+07:00 trong DST: True
2025-10-11 04:58:48,318 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:48,318 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:48,319 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:48,319 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,339 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:48,339 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:48,340 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:48,340 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,341 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:48,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:48,342 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:48,343 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:48,343 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:48,344 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:48,344 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:48,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:48,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:48,346 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:48,346 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:48,347 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:48,347 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:48,348 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:48,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:48,349 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:48,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:48,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:48,351 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:48,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:48,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:48,353 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:48,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:48,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:48,375 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:48,376 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,376 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:48,377 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:48,378 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:48,378 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:48,379 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:48,379 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:48,379 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:48,380 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:48,381 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:48,381 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:48,381 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:48,382 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:48,382 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:48,382 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:48,383 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:48,383 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:48,384 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:48,384 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,385 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:48,386 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:48,386 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:48,386 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:48,409 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:48,411 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:48,412 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:48,414 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,414 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:48,414 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:48,415 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:48,418 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:48,419 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:48,419 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:48,423 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:48,442 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,442 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:48,443 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,444 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:48,444 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:48,445 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:48,445 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:48,446 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:48,446 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:48,447 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.81s
2025-10-11 04:58:48,547 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:48,548 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:48,548 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:48,549 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:48,551 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:48,639 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:48,640 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:48,641 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:48,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:48,644 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:48,645 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:48,646 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:48,647 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:48,650 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:48,651 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:48,651 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:48,652 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:48,653 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:48,653 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:48,654 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:48,654 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:48,677 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:49,189 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:49,191 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:49,191 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:49,192 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:49,192 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:49,193 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:49,193 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:49,194 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:49,196 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:49,197 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:49,197 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:49,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:49,204 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:49,222 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:49,222 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:49,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:49,225 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:49,226 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:49,226 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:49,227 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:49,229 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:49,230 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:49,230 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:49,230 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:49,233 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:49,233 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:49,234 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:49,234 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:49,235 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:49,235 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:49.235513+07:00
2025-10-11 04:58:49,235 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:49.235513+07:00
2025-10-11 04:58:49,236 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:49.235513+07:00 trong DST: True
2025-10-11 04:58:49,237 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:49,237 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:49,238 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:49,241 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:49,261 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:49,267 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:49,287 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:49,288 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:49,289 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:49,289 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:49,290 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:49,310 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:49,311 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:49,311 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:49,312 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:49,313 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:49,313 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:49,332 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:49,334 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:49,334 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:49,335 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:49,335 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:49,336 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:49,356 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:49,357 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:49,357 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:49,358 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:49,358 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:49,379 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:49,380 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:49,382 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:49,382 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:49,383 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:49,403 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:49,404 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:49,404 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:49,404 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:49,405 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:49,405 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:49,406 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:49,429 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:49,431 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:49,437 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:49,458 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:49,479 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:49,480 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:49.480678+07:00
2025-10-11 04:58:49,481 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:49.480678+07:00
2025-10-11 04:58:49,482 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:49.480678+07:00 trong DST: True
2025-10-11 04:58:49,503 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:49,506 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:49,507 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:49,507 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,508 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:49,509 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:49,509 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:49,510 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,538 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:49,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:49,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:49,542 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:49,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:49,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:49,544 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:49,545 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:49,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:49,546 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:49,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:49,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:49,573 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:49,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:49,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:49,575 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:49,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:49,576 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:49,577 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:49,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:49,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:49,579 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:49,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:49,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:49,604 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:49,605 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,606 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:49,606 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:49,606 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:49,607 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:49,607 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:49,607 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:49,608 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:49,608 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:49,608 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:49,609 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:49,610 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:49,611 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:49,611 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:49,612 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:49,612 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:49,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:49,639 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:49,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,640 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:49,641 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:49,641 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:49,641 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:49,642 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:49,643 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:49,643 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:49,645 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:49,668 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,670 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:49,670 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:49,670 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:49,671 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:49,671 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:49,672 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:49,676 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:49,677 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:49,678 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:49,679 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:49,679 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:49,680 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,701 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:58:49,703 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:49,704 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,704 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:49,705 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:49,705 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:49,706 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:49,706 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:49,707 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:49,708 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.07s
2025-10-11 04:58:49,774 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:49,873 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:49,874 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:49,875 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:49,876 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:49,878 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:50,671 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:50,672 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:50,674 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:50,675 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:50,676 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:50,677 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:50,678 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:50,679 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:50,710 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:50,710 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:50,712 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:50,712 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:50,713 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:50,736 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:50,737 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:50,737 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:50,747 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:51,238 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:51,240 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:51,240 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:51,241 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:51,241 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:51,242 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:51,242 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:51,243 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:51,244 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:51,245 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:51,245 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:51,246 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:51,249 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:51,249 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:51,268 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:51,269 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:51,272 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:51,272 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:51,273 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:51,273 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:51,275 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:51,276 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:51,276 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:51,276 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:51,279 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:51,281 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:51,281 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:51,282 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:51,282 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:51,303 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:51.303685+07:00
2025-10-11 04:58:51,305 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:51.303685+07:00
2025-10-11 04:58:51,305 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:51.303685+07:00 trong DST: True
2025-10-11 04:58:51,305 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:51,306 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:51,306 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:51,307 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:51,308 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:51,313 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:51,313 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:51,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:51,314 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:51,315 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:51,315 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:51,316 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:51,316 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:51,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:51,324 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:51,336 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:51,337 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:51,338 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:51,339 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:51,339 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:51,340 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:51,340 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:51,341 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:51,341 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:51,342 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:51,342 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:51,343 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:51,343 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:51,344 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:51,344 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:51,345 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:51,345 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:51,346 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:51,346 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:51,347 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:51,347 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:51,348 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:51,348 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:51,349 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:51,349 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:51,349 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:51,352 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:51,374 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:51,375 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:51,377 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:51,377 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:51.377435+07:00
2025-10-11 04:58:51,377 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:51.377435+07:00
2025-10-11 04:58:51,378 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:51.377435+07:00 trong DST: True
2025-10-11 04:58:51,378 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:51,379 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:51,379 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:51,380 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,380 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:51,380 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:51,381 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:51,381 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:51,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:51,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:51,406 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:51,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:51,408 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:51,408 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:51,409 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:51,410 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:51,410 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:51,410 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:51,411 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:51,411 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:51,412 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:51,413 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:51,413 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:51,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:51,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:51,415 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:51,416 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:51,416 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:51,417 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:51,417 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:51,441 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:51,442 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:51,443 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,444 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:51,444 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:51,445 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:51,445 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:51,445 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:51,446 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:51,446 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:51,447 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:51,447 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:51,448 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:51,448 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:51,448 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:51,449 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:51,449 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:51,450 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:51,450 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:51,473 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:51,473 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,474 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:51,475 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:51,475 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:51,476 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:51,476 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:51,477 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:51,478 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:51,479 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:51,480 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,480 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:51,481 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:51,487 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:51,505 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:51,506 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:51,506 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:51,507 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,507 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:51,508 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,508 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:51,509 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:51,509 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:51,509 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:51,510 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:51,510 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:51,512 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-11 04:58:51,580 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:51,581 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:51,581 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:51,584 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:51,586 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:51,676 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:51,677 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:51,679 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:51,680 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:51,681 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:51,682 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:51,683 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:51,684 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:51,687 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:51,688 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:51,688 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:51,698 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:51,728 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:51,779 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:51,816 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:51,888 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:51,900 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:52,402 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:52,403 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:52,404 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:52,405 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:52,405 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:52,405 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:52,406 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:52,406 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:52,408 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:52,409 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:52,409 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:52,409 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:52,415 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:52,435 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:52,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:52,437 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:52,439 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:52,439 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:52,440 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:52,440 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:52,447 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:52,447 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:52,447 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:52,448 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:52,450 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:52,450 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:52,451 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:52,451 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:52,452 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:52,453 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:52.453214+07:00
2025-10-11 04:58:52,453 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:52.453214+07:00
2025-10-11 04:58:52,473 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:52.453214+07:00 trong DST: True
2025-10-11 04:58:52,474 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:52,474 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:52,475 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:52,476 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:52,476 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:52,479 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:52,480 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:52,480 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:52,481 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:52,481 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:52,482 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:52,482 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:52,482 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:52,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:52,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:52,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:52,484 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:52,484 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:52,485 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:52,486 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:52,486 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:52,487 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:52,487 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:52,507 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:52,508 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:52,509 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:52,510 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:52,510 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:52,511 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:52,511 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:52,512 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:52,512 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:52,512 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:52,513 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:52,513 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:52,514 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:52,514 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:52,514 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:52,515 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:52,515 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:52,516 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:52,517 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:52,517 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:52,518 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:52,518 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:52,518 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:52.518637+07:00
2025-10-11 04:58:52,519 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:52.518637+07:00
2025-10-11 04:58:52,519 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:52.518637+07:00 trong DST: True
2025-10-11 04:58:52,520 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:52,520 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:52,521 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:52,522 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,522 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:52,548 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:52,550 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:52,551 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,552 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:52,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:52,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:52,575 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:52,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:52,576 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:52,577 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:52,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:52,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:52,578 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:52,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:52,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:52,580 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:52,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:52,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:52,582 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:52,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:52,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:52,583 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:52,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:52,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:52,585 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:52,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:52,586 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:52,586 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:52,587 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,587 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:52,587 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:52,614 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:52,615 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:52,615 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:52,616 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:52,616 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:52,616 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:52,617 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:52,617 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:52,617 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:52,618 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:52,618 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:52,619 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:52,619 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:52,619 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:52,620 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:52,620 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,626 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:52,641 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:52,642 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:52,642 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:52,643 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:52,644 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:52,645 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:52,647 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:52,647 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:52,647 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,651 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:52,652 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:52,653 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:52,655 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:52,674 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:52,675 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,676 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:52,677 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,677 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:52,677 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:52,678 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:52,678 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:52,679 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:52,679 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:52,680 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.00s
2025-10-11 04:58:52,682 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:52,683 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:52,684 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:52,686 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:52,687 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:52,690 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:52,713 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:52,714 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:58:52,715 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:52,716 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:52,717 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:52,717 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:52,718 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:52,719 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:52,720 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:52,720 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:52,748 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:52,749 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:52,750 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:52,751 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:52,755 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:52,783 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:53,221 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:53,223 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:53,223 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:53,224 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:53,224 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:53,225 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:53,225 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:53,226 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:53,229 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:53,229 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:53,229 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:53,230 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:53,236 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:53,254 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:53,254 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:53,255 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:53,257 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:53,258 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:53,258 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:53,258 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:53,262 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:53,262 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:53,262 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:53,263 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:53,266 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:53,266 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:53,267 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:53,267 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:53,268 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:53,268 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:53.268384+07:00
2025-10-11 04:58:53,268 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:53.268384+07:00
2025-10-11 04:58:53,269 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:53.268384+07:00 trong DST: True
2025-10-11 04:58:53,269 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:53,269 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:53,270 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:53,271 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:53,293 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:53,299 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:53,300 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:53,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:53,301 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:53,302 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:53,302 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:53,302 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:53,303 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:53,303 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:53,303 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:53,304 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:53,304 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:53,304 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:53,305 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:53,306 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:53,306 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:53,307 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:53,307 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:53,327 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:53,328 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:53,329 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:53,330 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:53,330 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:53,331 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:53,331 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:53,332 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:53,333 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:53,333 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:53,333 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:53,334 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:53,334 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:53,335 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:53,335 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:53,335 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:53,336 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:53,336 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:53,337 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:53,337 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:53,338 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:53,338 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:53,338 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:53.338749+07:00
2025-10-11 04:58:53,339 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:53.338749+07:00
2025-10-11 04:58:53,339 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:53.338749+07:00 trong DST: True
2025-10-11 04:58:53,339 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:53,340 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:53,340 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:53,342 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,363 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:53,366 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:53,367 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:53,367 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,368 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:53,368 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:53,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:53,370 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:53,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:53,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:53,372 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:53,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:53,396 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:53,397 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:53,398 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:53,399 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:53,399 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:53,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:53,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:53,401 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:53,401 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:53,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:53,403 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:53,403 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:53,404 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:53,405 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:53,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:53,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:53,410 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:53,431 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,434 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:53,435 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:53,435 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:53,436 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:53,436 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:53,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:53,437 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:53,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:53,438 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:53,438 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:53,439 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:53,439 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:53,440 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:53,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:53,463 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:53,465 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:53,465 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:53,466 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,466 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:53,467 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:53,467 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:53,468 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:53,468 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:53,469 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:53,472 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:53,473 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,495 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:53,483 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:53,497 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:53,501 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:53,502 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:53,503 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:53,503 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:53,504 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,504 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:53,505 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,505 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:53,506 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:53,506 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:53,507 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:53,508 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:53,508 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:53,534 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 04:58:53,635 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:53,636 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:53,637 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:53,637 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:53,640 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:53,687 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:53,688 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:53,690 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:53,691 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:53,692 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:53,693 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:53,694 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:53,695 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:53,701 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:53,702 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:53,702 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:53,703 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:53,703 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:53,704 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:53,704 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:53,705 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:53,741 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:54,206 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:54,208 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:54,208 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:54,209 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:54,209 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:54,210 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:54,210 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:54,210 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:54,212 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:54,213 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:54,213 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:54,214 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:54,219 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:54,237 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:54,238 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:54,240 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:54,242 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:54,243 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:54,243 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:54,244 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:54,246 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:54,247 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:54,247 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:54,247 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:54,250 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:54,250 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:54,251 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:54,251 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:54,252 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:54,252 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:54.252474+07:00
2025-10-11 04:58:54,252 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:54.252474+07:00
2025-10-11 04:58:54,253 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:54.252474+07:00 trong DST: True
2025-10-11 04:58:54,253 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:54,254 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:54,254 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:54,256 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:54,256 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:54,263 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:54,280 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:54,281 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:54,282 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:54,283 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:54,283 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:54,284 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:54,284 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:54,285 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:54,285 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:54,285 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:54,286 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:54,286 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:54,286 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:54,287 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:54,287 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:54,287 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:54,287 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:54,288 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:54,289 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:54,289 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:54,290 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:54,290 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:54,291 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:54,291 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:54,292 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:54,292 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:54,297 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:54,315 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:54,317 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:54,317 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:54,318 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:54,318 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:54,319 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:54,319 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:54,320 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:54,320 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:54,321 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:54,321 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:54,321 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:54,322 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:54.322145+07:00
2025-10-11 04:58:54,322 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:54.322145+07:00
2025-10-11 04:58:54,322 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:54.322145+07:00 trong DST: True
2025-10-11 04:58:54,324 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:54,324 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:54,325 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:54,325 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,328 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:54,345 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:54,346 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:54,346 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,347 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:54,347 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:54,348 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:54,349 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:54,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:54,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:54,351 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:54,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:54,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:54,352 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:54,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:54,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:54,354 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:54,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:54,355 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:54,356 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:54,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:54,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:54,358 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:54,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:54,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:54,383 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:54,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:54,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:54,386 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:54,387 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,387 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:54,388 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:54,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:54,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:54,389 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:54,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:54,389 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:54,390 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:54,390 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:54,391 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:54,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:54,392 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:54,392 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:54,393 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:54,415 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:54,417 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:54,418 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:54,418 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,419 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:54,419 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:54,420 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:54,420 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:54,420 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:54,421 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:54,423 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:54,424 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,425 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:54,425 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:54,425 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:54,447 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:54,451 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:54,452 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:54,452 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:54,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,453 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:54,454 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,454 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:54,455 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:54,455 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:54,455 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:54,456 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:54,457 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:54,459 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.77s
2025-10-11 04:58:54,485 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:54,486 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:54,486 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:54,488 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:54,491 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:54,694 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:54,695 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:54,696 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:54,698 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:54,699 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:54,700 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:54,701 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:54,702 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:54,726 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:54,927 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:54,928 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:54,929 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:54,929 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:54,930 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:54,930 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:54,931 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:54,931 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:55,432 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:55,433 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:55,434 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:55,434 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:55,435 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:55,435 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:55,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:55,436 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:55,438 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:55,439 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:55,439 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:55,440 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:55,446 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:55,463 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:55,463 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:55,466 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:55,468 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:55,523 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:55,524 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:55,525 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:55,560 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:55,633 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:55,698 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:55,700 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:55,756 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:55,802 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:55,852 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:55,889 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:55,890 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:55,890 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:55,891 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:55,892 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:55,893 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:55,893 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:55,895 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-11 04:58:55,895 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:55.895518+07:00
2025-10-11 04:58:55,896 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:55.895518+07:00
2025-10-11 04:58:55,896 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:55.895518+07:00 trong DST: True
2025-10-11 04:58:55,897 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:55,897 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:55,898 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:55,899 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:55,899 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:55,902 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:55,903 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:55,903 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:55,904 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:55,904 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:55,904 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:56,037 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:56,094 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:56,095 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:56,102 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:56,150 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:56,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:56,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:56,216 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:56,220 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:56,221 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:56,222 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:56,224 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:56,225 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:56,228 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:56,251 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:56,253 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:56,255 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:56,258 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:56,260 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:56,262 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:56,293 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:56,327 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:56,329 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:56,354 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:56,354 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:56,381 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:56,389 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:56,389 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:56,390 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:56,391 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:56,392 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:56,394 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:56,396 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:56,413 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:56,415 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:56,416 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:56.416310+07:00
2025-10-11 04:58:56,418 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:56.416310+07:00
2025-10-11 04:58:56,419 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:56.416310+07:00 trong DST: True
2025-10-11 04:58:56,420 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:56,420 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:56,426 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:56,428 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,432 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:56,449 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:56,451 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:56,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,455 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:56,455 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:56,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:56,459 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:56,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:56,463 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:56,489 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:56,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:56,491 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:56,492 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:56,492 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:56,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:56,495 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:56,496 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:56,500 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:56,528 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:56,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:56,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:56,557 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:56,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:56,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:56,559 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:56,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:56,561 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:56,563 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:56,563 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,564 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:56,587 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:56,587 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:56,588 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:56,588 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:56,589 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:56,590 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:56,590 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:56,591 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:56,591 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:56,591 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:56,592 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:56,592 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:56,593 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:56,593 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:56,593 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:56,594 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:56,594 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,594 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:56,596 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:56,597 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:56,597 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:56,625 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:56,626 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:56,627 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:56,628 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,629 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:56,630 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:56,630 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:56,655 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:56,656 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:56,657 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:56,657 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:56,658 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,658 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:56,659 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,659 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:56,659 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:56,660 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:56,660 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:56,661 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:56,662 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:56,663 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.97s
2025-10-11 04:58:56,757 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:58:56,758 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:58:56,759 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 04:58:56,760 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:56,761 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:56,762 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:56,763 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:56,767 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:56,768 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:58:56,838 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:56,839 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:56,840 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:56,842 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:56,842 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:56,844 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:56,844 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:56,845 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:58:56,872 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:57,077 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:57,078 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:57,078 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:57,079 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:57,079 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:57,080 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:57,080 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:57,081 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:57,582 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:57,583 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:57,584 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:57,584 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:57,584 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:57,585 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:57,585 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:57,586 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:57,587 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:57,588 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:57,588 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:57,589 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:57,595 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:57,613 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:57,613 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:57,614 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:57,617 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:57,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:57,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:57,618 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:57,620 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:57,621 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:57,621 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:57,622 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:57,624 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:57,625 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:57,625 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:57,626 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:57,626 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:57,627 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:57.627042+07:00
2025-10-11 04:58:57,627 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:57.627042+07:00
2025-10-11 04:58:57,627 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:57.627042+07:00 trong DST: True
2025-10-11 04:58:57,628 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:57,628 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:57,628 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:57,629 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:57,630 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:57,637 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:57,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:57,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:57,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:57,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:57,657 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:57,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:57,657 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:57,658 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:57,658 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:57,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:57,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:57,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:57,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:57,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:57,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:57,661 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:57,661 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:57,662 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:57,662 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:57,663 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:57,663 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:57,664 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:57,665 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:57,665 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:57,666 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:57,688 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:57,689 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:57,690 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:57,690 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:57,691 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:57,692 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:57,692 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:57,692 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:57,693 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:57,693 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:57,694 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:57,694 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:57,695 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:57,695 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:57,695 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:57.695801+07:00
2025-10-11 04:58:57,696 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:57.695801+07:00
2025-10-11 04:58:57,696 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:57.695801+07:00 trong DST: True
2025-10-11 04:58:57,696 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:57,697 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:57,697 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:57,698 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,698 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:57,699 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:57,699 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:57,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,700 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:57,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:57,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:57,727 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:57,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:57,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:57,729 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:57,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:57,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:57,730 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:57,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:57,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:57,732 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:57,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:57,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:57,764 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:57,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:57,768 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:57,794 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:57,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:57,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:57,796 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:57,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:57,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:57,798 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:57,799 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,800 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:57,800 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:57,800 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:57,824 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:57,825 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:57,826 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:57,827 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:57,827 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:57,827 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:57,828 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:57,828 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:57,829 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:57,829 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:57,829 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:57,830 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:57,830 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:57,830 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:57,831 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,831 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:57,832 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:57,832 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:57,833 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:57,834 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:57,856 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:57,857 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:57,861 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:57,863 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,865 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:57,865 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:57,866 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:57,885 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:57,886 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:57,889 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:57,890 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:57,891 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:57,892 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:57,892 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:57,893 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:57,893 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,894 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:58:57,895 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:57,895 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,896 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:57,896 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:57,897 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:57,897 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:57,898 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:57,899 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:57,918 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.08s
2025-10-11 04:58:57,991 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:58,091 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:58,092 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:58,092 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:58:58,095 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:58:58,097 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:58,863 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:58,864 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:58,866 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:58:58,867 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:58,868 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:58,870 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:58,870 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:58,871 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:58:58,903 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:58,903 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:58,904 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:58,905 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:58:58,906 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:58:58,906 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:58:58,907 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:58:58,927 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:58:58,969 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:58:59,429 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:58:59,430 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:58:59,431 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:58:59,431 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:58:59,432 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:58:59,432 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:58:59,433 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:58:59,433 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:59,435 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:58:59,436 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:59,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:58:59,437 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:58:59,443 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:58:59,460 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:59,461 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:58:59,461 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:58:59,464 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:58:59,464 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:59,464 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:58:59,465 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:58:59,467 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:58:59,467 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:59,468 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:58:59,468 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:58:59,471 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:59,471 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:58:59,472 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:58:59,472 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:58:59,473 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:59,473 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:59.473590+07:00
2025-10-11 04:58:59,474 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:59.473590+07:00
2025-10-11 04:58:59,474 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:59.473590+07:00 trong DST: True
2025-10-11 04:58:59,474 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:59,475 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:59,475 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:58:59,479 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:58:59,496 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:58:59,501 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:58:59,501 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:59,502 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:58:59,502 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:59,503 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:58:59,530 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:58:59,531 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:58:59,532 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:58:59,532 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:58:59,533 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:58:59,533 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:58:59,534 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:58:59,535 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:58:59,536 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:58:59,536 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:58:59,536 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:58:59,559 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:58:59,560 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:58:59,561 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:58:59,561 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:58:59,562 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:59,583 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:58:59,584 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:58:59,585 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:58:59,606 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:58:59,607 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:58:59,609 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:58:59,609 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:58:59,635 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:58:59,660 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:58:59,660 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:58:59,661 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:58:59,662 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:58:59,662 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:58:59,686 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:59,687 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:58:59,688 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:58:59,688 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:58:59,709 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:58:59,709 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:58:59,711 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:58:59.710906+07:00
2025-10-11 04:58:59,711 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:58:59.710906+07:00
2025-10-11 04:58:59,712 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:58:59.710906+07:00 trong DST: True
2025-10-11 04:58:59,734 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:58:59,761 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:58:59,786 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 62
2025-10-11 04:58:59,787 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,787 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:59,788 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:58:59,788 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:58:59,789 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:59,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:59,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:59,791 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:59,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:59,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:59,793 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:58:59,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:58:59,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:58:59,795 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:59,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:58:59,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:59,797 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:58:59,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:58:59,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:58:59,799 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:58:59,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:58:59,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:59,801 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:58:59,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:58:59,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:58:59,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:58:59,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:58:59,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:58:59,829 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:58:59,829 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,830 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:59,830 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:59,830 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:59,831 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:59,831 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:59,832 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:59,832 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:59,832 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:59,833 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:59,833 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:58:59,834 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:58:59,835 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:58:59,836 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:58:59,836 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:58:59,836 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:58:59,862 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:58:59,862 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:58:59,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,863 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:59,864 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:58:59,864 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:58:59,864 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:58:59,865 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:58:59,865 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:58:59,868 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:58:59,869 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,882 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:58:59,888 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:58:59,889 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:58:59,891 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:58:59,893 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:58:59,935 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:58:59,937 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:58:59,938 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:58:59,939 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:58:59,959 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:58:59,961 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:58:59,963 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,983 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:58:59,984 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:59,985 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-11 04:58:59,985 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,986 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:58:59,987 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:58:59,987 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:58:59,987 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:58:59,988 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:58:59,988 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:58:59,989 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.12s
2025-10-11 04:59:00,019 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:00,122 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:00,122 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:00,123 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:00,124 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:00,126 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:00,897 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:00,897 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:00,899 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:00,901 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:00,901 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:00,902 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:00,903 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:00,904 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:00,934 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:00,935 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:00,937 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:00,937 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:00,937 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:00,960 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:00,960 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:00,961 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:00,993 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:01,462 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:01,464 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:01,464 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:01,465 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:01,465 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:01,466 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:01,466 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:01,467 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:01,469 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:01,470 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:01,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:01,471 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:01,477 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:01,496 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:01,497 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:01,499 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:01,501 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:01,501 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:01,502 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:01,502 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:01,505 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:01,506 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:01,506 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:01,506 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:01,513 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:01,538 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:01,538 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:01,539 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:01,539 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:01,540 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:01.540133+07:00
2025-10-11 04:59:01,540 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:01.540133+07:00
2025-10-11 04:59:01,541 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:01.540133+07:00 trong DST: True
2025-10-11 04:59:01,541 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:01,541 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:01,542 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:01,543 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:01,544 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:01,548 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:01,548 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:01,549 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:01,549 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:01,550 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:01,550 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:01,551 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:01,551 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:01,552 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:01,552 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:01,553 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:01,553 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:01,573 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:01,574 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:01,575 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:01,576 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:01,577 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:01,577 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:01,577 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:01,578 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:01,579 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:01,579 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:01,580 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:01,580 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:01,581 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:01,581 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:01,582 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:01,582 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:01,582 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:01,583 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:01,583 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:01,583 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:01,584 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:01,584 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:01,585 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:01,585 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:01,586 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:01,587 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:01,587 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:01,590 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:01,608 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:01.608769+07:00
2025-10-11 04:59:01,609 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:01.608769+07:00
2025-10-11 04:59:01,611 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:01.608769+07:00 trong DST: True
2025-10-11 04:59:01,612 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:01,613 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:01,613 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:01,614 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,614 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:01,614 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:01,615 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:01,615 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,615 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:01,616 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:01,617 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:01,618 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:01,620 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:01,621 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:01,623 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:01,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:01,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:01,641 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:01,642 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:01,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:01,643 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:01,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:01,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:01,645 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:01,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:01,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:01,647 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:01,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:01,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:01,649 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:01,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:01,650 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:01,651 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:01,651 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,651 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:01,652 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:01,652 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:01,653 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:01,654 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:01,654 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:01,654 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:01,655 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:01,674 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:01,675 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:01,675 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:01,677 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:01,677 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:01,678 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:01,678 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:01,679 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:01,679 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:01,680 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,680 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:01,680 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:01,681 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:01,681 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:01,682 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:01,682 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:01,684 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:01,685 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,686 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:01,687 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:01,687 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:01,688 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:01,710 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:01,711 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:01,712 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:01,712 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,713 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:01,713 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,713 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:01,714 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:01,714 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:01,714 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:01,715 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:01,715 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:01,716 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-11 04:59:01,807 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:01,807 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:01,808 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:01,809 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:01,811 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:01,900 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:01,901 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:01,902 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:01,904 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:01,905 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:01,907 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:01,907 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:01,908 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:01,931 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:02,157 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:02,158 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:02,159 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:02,159 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:02,159 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:02,160 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:02,160 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:02,161 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:02,662 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:02,663 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:02,664 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:02,665 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:02,665 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:02,666 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:02,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:02,667 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:02,670 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:02,670 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:02,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:02,671 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:02,677 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:02,694 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:02,695 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:02,696 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:02,698 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:02,699 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:02,699 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:02,700 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:02,877 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:02,878 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:02,878 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:02,879 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:02,881 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:02,882 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:02,882 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:02,883 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:02,883 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:02,883 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:02.883853+07:00
2025-10-11 04:59:02,884 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:02.883853+07:00
2025-10-11 04:59:02,884 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:02.883853+07:00 trong DST: True
2025-10-11 04:59:02,885 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:02,885 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:02,886 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:02,889 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:02,909 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:02,913 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:02,914 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:02,914 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:02,916 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:02,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:02,917 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:02,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:02,918 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:02,919 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:02,919 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:02,920 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:02,920 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:02,921 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:02,921 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:02,922 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:02,922 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:02,923 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:02,924 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:02,924 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:02,925 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:02,925 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:02,949 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:02,950 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:02,951 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:02,951 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:02,952 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:02,952 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:02,953 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:02,953 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:02,954 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:02,954 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:02,955 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:02,956 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:02,957 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:02,958 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:02,958 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:02,976 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:02,977 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:02,977 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:02,978 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:02,979 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:02,979 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:02,980 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:02,980 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:02,981 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:03,038 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:03,064 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:03,075 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:03.075809+07:00
2025-10-11 04:59:03,133 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:03.075809+07:00
2025-10-11 04:59:03,161 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:03.075809+07:00 trong DST: True
2025-10-11 04:59:03,174 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:03,208 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:03,209 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:03,211 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,212 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:03,237 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:03,248 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:03,268 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,283 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:03,286 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:03,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:03,314 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:03,315 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:03,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:03,367 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:03,368 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:03,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:03,393 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:03,397 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:03,399 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:03,402 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:03,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:03,462 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:03,467 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:03,468 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:03,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:03,495 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:03,497 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:03,501 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:03,534 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:03,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:03,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:03,590 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:03,592 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,593 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:03,593 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:03,595 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:03,596 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:03,596 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:03,597 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:03,598 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:03,599 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:03,599 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:03,630 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:03,633 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:03,635 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:03,662 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:03,665 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:03,686 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:03,696 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:03,696 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:03,697 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,697 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:03,698 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:03,698 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:03,698 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:03,699 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:03,700 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:03,703 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:03,728 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,729 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:03,729 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:03,729 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:03,732 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:03,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:03,733 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:03,735 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:03,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:03,738 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,738 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:03,738 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:03,763 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:03,766 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:03,767 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:03,768 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:03,770 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.87s
2025-10-11 04:59:03,832 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:03,835 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:03,835 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:03,837 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:03,839 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:03,915 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:03,916 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:03,918 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:03,919 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:03,920 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:03,921 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:03,922 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:03,923 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:03,928 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:03,929 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:03,929 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:03,930 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:03,930 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:03,931 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:03,931 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:03,932 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:03,940 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:04,432 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:04,434 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:04,435 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:04,435 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:04,435 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:04,436 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:04,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:04,437 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:04,439 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:04,439 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:04,439 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:04,440 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:04,446 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:04,463 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:04,464 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:04,465 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:04,469 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:04,470 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:04,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:04,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:04,475 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:04,493 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:04,494 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:04,495 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:04,498 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:04,499 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:04,500 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:04,500 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:04,500 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:04,501 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:04.501024+07:00
2025-10-11 04:59:04,501 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:04.501024+07:00
2025-10-11 04:59:04,502 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:04.501024+07:00 trong DST: True
2025-10-11 04:59:04,502 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:04,502 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:04,503 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:04,504 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:04,504 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:04,511 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:04,535 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:04,536 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:04,536 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:04,537 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:04,538 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:04,539 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:04,561 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:04,564 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:04,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:04,565 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:04,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:04,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:04,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:04,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:04,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:04,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:04,568 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:04,569 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:04,570 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:04,570 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:04,571 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:04,590 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:04,591 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:04,592 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:04,593 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:04,594 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:04,594 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:04,595 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:04,595 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:04,596 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:04,596 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:04,596 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:04,597 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:04,597 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:04,598 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:04,598 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:04,599 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:04,599 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:04,600 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:04,600 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:04.600612+07:00
2025-10-11 04:59:04,601 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:04.600612+07:00
2025-10-11 04:59:04,601 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:04.600612+07:00 trong DST: True
2025-10-11 04:59:04,601 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:04,602 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:04,602 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:04,603 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,603 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:04,604 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:04,604 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:04,604 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,605 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:04,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:04,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:04,626 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:04,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:04,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:04,628 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:04,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:04,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:04,630 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:04,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:04,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:04,632 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:04,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:04,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:04,633 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:04,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:04,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:04,635 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:04,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:04,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:04,636 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:04,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:04,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:04,638 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:04,638 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,663 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:04,664 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:04,664 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:04,665 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:04,665 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:04,665 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:04,666 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:04,666 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:04,666 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:04,667 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:04,667 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:04,667 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:04,668 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:04,668 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:04,668 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:04,669 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:04,669 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:04,669 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,670 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:04,671 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:04,671 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:04,672 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:04,672 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:04,676 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:04,696 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:04,699 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,700 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:04,700 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:04,701 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:04,704 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:04,705 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:04,706 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:04,725 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:04,727 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,728 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:04,728 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,728 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:04,729 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:04,729 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:04,730 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:04,730 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:04,731 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:04,732 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-11 04:59:04,769 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:04,772 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:04,773 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:04,774 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:04,779 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:04,921 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:04,922 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:04,923 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:04,925 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:04,926 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:04,927 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:04,927 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:04,928 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:04,957 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:04,958 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:04,958 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:04,959 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:04,959 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:04,960 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:04,960 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:04,961 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:05,004 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:05,462 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:05,464 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:05,464 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:05,465 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:05,465 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:05,465 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:05,466 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:05,466 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:05,468 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:05,469 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:05,469 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:05,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:05,476 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:05,494 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:05,496 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:05,496 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:05,498 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:05,499 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:05,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:05,500 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:05,502 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:05,504 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:05,504 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:05,505 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:05,511 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:05,532 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:05,533 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:05,534 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:05,534 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:05,535 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:05.535052+07:00
2025-10-11 04:59:05,535 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:05.535052+07:00
2025-10-11 04:59:05,535 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:05.535052+07:00 trong DST: True
2025-10-11 04:59:05,536 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:05,536 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:05,537 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:05,539 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:05,539 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:05,545 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:05,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:05,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:05,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:05,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:05,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:05,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:05,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:05,572 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:05,572 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:05,573 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:05,573 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:05,574 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:05,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:05,594 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:05,596 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:05,597 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:05,597 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:05,598 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:05,598 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:05,599 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:05,599 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:05,600 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:05,600 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:05,600 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:05,601 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:05,602 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:05,602 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:05,603 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:05,603 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:05,603 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:05,604 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:05,604 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:05,605 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:05,605 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:05,605 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:05,606 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:05,609 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:05,631 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:05,631 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:05,632 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:05.632452+07:00
2025-10-11 04:59:05,633 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:05.632452+07:00
2025-10-11 04:59:05,634 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:05.632452+07:00 trong DST: True
2025-10-11 04:59:05,634 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:05,634 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:05,635 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:05,635 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:05,636 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:05,637 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:05,638 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,639 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:05,639 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:05,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:05,646 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:05,662 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:05,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:05,666 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:05,666 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:05,667 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:05,668 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:05,668 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:05,669 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:05,669 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:05,670 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:05,671 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:05,672 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:05,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:05,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:05,697 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:05,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:05,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:05,700 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:05,700 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:05,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:05,702 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:05,702 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,703 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:05,703 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:05,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:05,704 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:05,704 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:05,705 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:05,706 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:05,706 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:05,707 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:05,730 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:05,730 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:05,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:05,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:05,733 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:05,733 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:05,733 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:05,734 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:05,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:05,736 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:05,737 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:05,738 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:05,738 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:05,740 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:05,771 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:05,773 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,774 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:05,775 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:05,775 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:05,800 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:05,800 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:05,801 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:05,801 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:05,802 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,802 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:05,802 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,803 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:05,803 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:05,803 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:05,804 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:05,804 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:05,806 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:05,808 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.89s
2025-10-11 04:59:05,836 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:05,836 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:05,837 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:05,838 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:05,863 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:05,926 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:05,926 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:05,928 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:05,929 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:05,930 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:05,931 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:05,932 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:05,932 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:05,961 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:05,962 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:05,962 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:05,963 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:05,963 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:05,964 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:05,964 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:05,964 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:05,968 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:06,465 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:06,467 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:06,468 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:06,468 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:06,468 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:06,469 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:06,469 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:06,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:06,472 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:06,473 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:06,473 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:06,474 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:06,480 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:06,498 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:06,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:06,500 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:06,502 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:06,502 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:06,503 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:06,503 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:06,505 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:06,506 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:06,507 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:06,507 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:06,512 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:06,536 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:06,537 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:06,538 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:06,538 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:06,538 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:06.538852+07:00
2025-10-11 04:59:06,539 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:06.538852+07:00
2025-10-11 04:59:06,539 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:06.538852+07:00 trong DST: True
2025-10-11 04:59:06,540 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:06,540 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:06,541 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:06,542 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:06,543 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:06,550 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:06,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:06,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:06,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:06,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:06,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:06,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:06,572 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:06,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:06,629 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:06,630 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:06,632 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:06,632 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:06,635 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:06,722 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:06,787 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:06,841 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:06,854 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:06,921 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:06,932 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:06,934 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:06,939 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:06,939 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:06,940 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:06,941 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:06,942 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:06,942 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:06,943 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:06,944 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:06,945 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:06,945 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:06,946 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:06,946 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:06,947 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:06,947 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:06,948 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:06,948 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:06,949 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:06,949 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:06,950 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:06,950 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:06,950 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:06,951 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:06,952 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:06,952 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:06,952 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:06,953 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:06.953282+07:00
2025-10-11 04:59:06,953 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:06.953282+07:00
2025-10-11 04:59:06,954 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:06.953282+07:00 trong DST: True
2025-10-11 04:59:06,954 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:06,955 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:06,955 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:06,955 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:06,956 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:06,956 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:06,957 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:06,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:06,957 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:06,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:06,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:06,959 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:06,960 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:06,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:07,049 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:07,050 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:07,053 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:07,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:07,170 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:07,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:07,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:07,259 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:07,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:07,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:07,303 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:07,306 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:07,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:07,331 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:07,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:07,334 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:07,337 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:07,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:07,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:07,371 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:07,374 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:07,397 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:07,399 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:07,401 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:07,430 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:07,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:07,463 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:07,465 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:07,465 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:07,467 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:07,467 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:07,467 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:07,469 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:07,469 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:07,471 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:07,480 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:07,499 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:07,561 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:07,562 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:07,562 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:07,564 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:07,564 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:07,566 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:07,567 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:07,568 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:07,572 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:07,573 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:07,574 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:07,574 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:07,575 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:07,607 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:07,627 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:07,629 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:07,630 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:07,636 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:07,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:07,637 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:07,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:07,663 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:07,665 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:07,666 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:07,667 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:07,670 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:07,671 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.74s
2025-10-11 04:59:07,704 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:07,705 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:07,705 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:07,706 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:07,730 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:07,940 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:07,941 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:07,942 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:07,944 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:07,945 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:07,946 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:07,947 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:07,948 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:07,974 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:07,974 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:07,975 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:07,975 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:07,976 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:07,976 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:07,977 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:07,977 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:08,033 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:08,478 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:08,480 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:08,480 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:08,481 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:08,481 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:08,482 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:08,482 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:08,482 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:08,485 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:08,485 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:08,486 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:08,486 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:08,492 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:08,510 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:08,512 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:08,513 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:08,515 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:08,515 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:08,515 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:08,516 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:08,518 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:08,519 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:08,520 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:08,520 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:08,523 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:08,524 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:08,525 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:08,525 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:08,525 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:08,526 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:08.526164+07:00
2025-10-11 04:59:08,555 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:08.526164+07:00
2025-10-11 04:59:08,556 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:08.526164+07:00 trong DST: True
2025-10-11 04:59:08,557 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:08,557 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:08,557 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:08,559 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:08,560 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:08,576 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:08,585 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:08,585 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:08,586 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:08,586 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:08,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:08,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:08,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:08,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:08,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:08,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:08,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:08,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:08,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:08,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:08,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:08,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:08,612 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:08,613 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:08,614 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:08,614 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:08,615 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:08,615 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:08,616 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:08,616 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:08,617 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:08,617 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:08,618 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:08,618 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:08,618 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:08,619 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:08,619 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:08,619 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:08,620 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:08,620 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:08,620 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:08,621 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:08,622 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:08,624 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:08,624 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:08,625 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:08.625139+07:00
2025-10-11 04:59:08,625 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:08.625139+07:00
2025-10-11 04:59:08,625 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:08.625139+07:00 trong DST: True
2025-10-11 04:59:08,628 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:08,649 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:08,649 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:08,651 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,651 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:08,652 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:08,652 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:08,652 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,653 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:08,653 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:08,654 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:08,655 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:08,655 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:08,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:08,656 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:08,657 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:08,657 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:08,658 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:08,658 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:08,659 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:08,659 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:08,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:08,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:08,686 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:08,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:08,687 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:08,688 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:08,688 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:08,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:08,689 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:08,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:08,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:08,692 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:08,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,695 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:08,716 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:08,718 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:08,718 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:08,719 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:08,719 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:08,720 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:08,720 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:08,721 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:08,721 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:08,721 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:08,722 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:08,722 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:08,722 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:08,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:08,724 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:08,724 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:08,725 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,725 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:08,727 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:08,756 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:08,757 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:08,757 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:08,758 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:08,760 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:08,764 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,789 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:08,789 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:08,789 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:08,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:08,793 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:08,812 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:08,813 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:08,814 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,815 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:08,815 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,815 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:08,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:08,816 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:08,817 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:08,817 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:08,818 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:08,819 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-11 04:59:08,859 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:08,862 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:08,863 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:08,864 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:08,866 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:08,945 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:08,946 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:08,947 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:08,949 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:08,950 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:08,951 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:08,952 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:08,953 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:08,956 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:08,956 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:08,957 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:08,957 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:08,958 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:08,958 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:08,958 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:08,959 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:08,970 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:09,460 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:09,461 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:09,462 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:09,462 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:09,463 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:09,463 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:09,464 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:09,464 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:09,466 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:09,467 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:09,467 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:09,468 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:09,473 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:09,491 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:09,491 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:09,493 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:09,496 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:09,496 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:09,497 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:09,498 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:09,504 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:09,523 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:09,523 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:09,524 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:09,527 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:09,528 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:09,529 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:09,529 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:09,530 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:09,531 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:09.531193+07:00
2025-10-11 04:59:09,531 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:09.531193+07:00
2025-10-11 04:59:09,532 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:09.531193+07:00 trong DST: True
2025-10-11 04:59:09,532 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:09,532 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:09,533 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:09,562 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:09,563 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:09,578 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:09,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:09,590 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:09,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:09,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:09,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:09,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:09,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:09,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:09,593 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:09,593 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:09,594 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:09,594 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:09,595 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:09,595 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:09,595 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:09,596 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:09,597 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:09,598 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:09,599 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:09,613 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:09,619 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:09,621 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:09,622 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:09,622 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:09,623 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:09,623 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:09,623 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:09,624 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:09,624 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:09,624 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:09,625 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:09,625 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:09,625 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:09,626 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:09,626 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:09,627 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:09,627 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:09,628 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:09,628 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:09,629 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:09.629133+07:00
2025-10-11 04:59:09,629 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:09.629133+07:00
2025-10-11 04:59:09,629 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:09.629133+07:00 trong DST: True
2025-10-11 04:59:09,630 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:09,630 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:09,630 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:09,631 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,631 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:09,632 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:09,632 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:09,633 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,643 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:09,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:09,652 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:09,654 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:09,655 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:09,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:09,657 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:09,658 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:09,659 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:09,659 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:09,659 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:09,660 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:09,661 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:09,661 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:09,662 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:09,662 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:09,663 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:09,664 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:09,665 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:09,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:09,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:09,688 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:09,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:09,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:09,691 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:09,691 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,692 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:09,692 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:09,693 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:09,693 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:09,693 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:09,694 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:09,694 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:09,695 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:09,695 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:09,695 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:09,696 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:09,696 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:09,697 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:09,698 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:09,699 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:09,699 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:09,699 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:09,710 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,721 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:09,722 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:09,723 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:09,723 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:09,724 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:09,725 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:09,726 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:09,727 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,728 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:09,728 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:09,728 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:09,728 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:09,732 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:09,733 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:09,757 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:09,758 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,760 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:09,760 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,761 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:09,762 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:09,762 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:09,762 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:09,763 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:09,763 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:09,766 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-11 04:59:09,835 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:09,836 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:09,836 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:09,837 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:09,839 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:09,950 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:09,950 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:09,952 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:09,954 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:09,954 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:09,955 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:09,956 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:09,957 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:09,962 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:09,962 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:09,963 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:09,964 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:09,964 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:09,965 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:09,965 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:09,966 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:10,041 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:10,467 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:10,468 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:10,469 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:10,469 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:10,469 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:10,470 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:10,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:10,471 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:10,473 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:10,473 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:10,474 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:10,474 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:10,479 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:10,498 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:10,498 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:10,499 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:10,501 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:10,502 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:10,502 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:10,503 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:10,505 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:10,506 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:10,506 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:10,507 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:10,509 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:10,510 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:10,511 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:10,511 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:10,511 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:10,512 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:10.512098+07:00
2025-10-11 04:59:10,512 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:10.512098+07:00
2025-10-11 04:59:10,513 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:10.512098+07:00 trong DST: True
2025-10-11 04:59:10,513 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:10,513 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:10,514 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:10,515 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:10,515 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:10,521 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:10,547 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:10,549 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:10,549 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:10,549 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:10,550 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:10,551 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:10,552 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:10,552 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:10,574 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:10,575 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:10,576 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:10,576 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:10,577 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:10,578 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:10,578 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:10,579 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:10,579 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:10,580 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:10,580 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:10,581 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:10,581 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:10,582 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:10,582 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:10,582 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:10,584 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:10,584 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:10,585 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:10,585 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:10,606 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:10,608 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:10,609 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:10,609 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:10,609 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:10,610 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:10,610 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:10,611 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:10,611 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:10,612 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:10,612 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:10,612 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:10.612837+07:00
2025-10-11 04:59:10,613 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:10.612837+07:00
2025-10-11 04:59:10,613 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:10.612837+07:00 trong DST: True
2025-10-11 04:59:10,614 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:10,614 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:10,614 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:10,615 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,615 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:10,615 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:10,616 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:10,617 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,618 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:10,618 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:10,619 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:10,620 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:10,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:10,642 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:10,643 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:10,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:10,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:10,647 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:10,667 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:10,669 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:10,670 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:10,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:10,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:10,696 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:10,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:10,721 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:10,722 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:10,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:10,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:10,781 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:10,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:10,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:10,807 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:10,808 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,809 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:10,834 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:10,835 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:10,836 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:10,837 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:10,858 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:10,859 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:10,860 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:10,861 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:10,861 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:10,862 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:10,862 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:10,863 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:10,863 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:10,863 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:10,864 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:10,864 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:10,865 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,865 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:10,866 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:10,866 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:10,867 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:10,867 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:10,868 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:10,870 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:10,894 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,895 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:10,896 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:10,897 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:10,900 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:10,900 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:10,901 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:10,901 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:10,903 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,903 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:10,904 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,923 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:10,924 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:10,924 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:10,925 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:10,925 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:10,926 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:10,927 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.98s
2025-10-11 04:59:10,954 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:10,960 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:10,961 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:10,963 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:10,964 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:10,965 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:10,966 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:10,966 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:10,993 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:10,997 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:10,998 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:11,001 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:11,029 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:11,031 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:11,270 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:11,270 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:11,271 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:11,271 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:11,272 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:11,272 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:11,273 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:11,273 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:11,760 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:11,761 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:11,784 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:11,791 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:11,792 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.03s
2025-10-11 04:59:11,792 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:11,793 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:11,794 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:11,794 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:11,794 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:11,795 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:11,797 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:11,798 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:11,798 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:11,799 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:11,802 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:11,802 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:11,803 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:11,803 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:11,808 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:11,828 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:11,828 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:11,830 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:11,832 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:11,832 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:11,833 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:11,833 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:11,835 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:11,836 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:11,837 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:11,837 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:11,838 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:11,838 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:11.838584+07:00
2025-10-11 04:59:11,839 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:11.838584+07:00
2025-10-11 04:59:11,841 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:11.838584+07:00 trong DST: True
2025-10-11 04:59:11,863 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:11,863 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:11,864 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:11,865 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:11,866 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:11,869 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:11,869 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:59:11,870 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:11,871 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:11,872 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:11,872 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:11,891 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:11,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:11,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:11,893 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:11,894 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:11,895 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:11,895 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:11,896 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:11,896 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:11,897 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:11,897 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:11,897 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:11,898 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:11,898 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:11,899 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:11,899 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:11,900 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:11,900 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:11,901 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:11,902 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:11,902 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:11,903 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:11,903 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:11,904 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:11,904 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:11,905 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:11,905 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:11,905 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:11,906 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:11,906 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:11,931 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:11,932 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:11,934 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:11,935 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:11,935 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:11,935 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:11.935685+07:00
2025-10-11 04:59:11,936 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:11.935685+07:00
2025-10-11 04:59:11,938 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:11.935685+07:00 trong DST: True
2025-10-11 04:59:11,939 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:11,939 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:11,940 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:11,940 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:11,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:11,954 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:11,961 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:11,962 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:11,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:11,963 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:11,964 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:11,964 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:11,964 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:11,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:11,967 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:11,967 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:11,968 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:11,968 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:11,970 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:11,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:11,971 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:11,972 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:11,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:11,977 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:11,978 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:11,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:11,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:11,990 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:11,991 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:11,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:11,997 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:11,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:11,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:12,016 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:12,037 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:12,067 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:12,096 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:12,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:12,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:12,196 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:12,198 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:12,232 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:12,272 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:12,297 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:12,298 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:12,300 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:12,300 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:12,300 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:12,301 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:12,301 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:12,301 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:12,302 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:12,302 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:12,303 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:12,335 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:12,362 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:12,371 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:12,402 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:12,403 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:12,407 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:12,408 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:12,409 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:12,409 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:12,411 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:12,413 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:12,415 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:12,417 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:12,418 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:12,418 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:12,424 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:12,450 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:12,452 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:12,453 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:12,454 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:12,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:12,490 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:12,512 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:12,513 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:12,515 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:12,517 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:12,518 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:12,518 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:12,520 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:12,565 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.60s
2025-10-11 04:59:12,638 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:12,638 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:12,639 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:12,640 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:12,642 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:12,968 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:12,968 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:12,969 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:12,971 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:12,972 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:12,974 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:12,974 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:12,975 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:13,002 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:13,004 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:13,004 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:13,006 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:13,007 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:13,007 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:13,008 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:13,029 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:13,067 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:13,531 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:13,533 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:13,533 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:13,534 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:13,534 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:13,535 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:13,535 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:13,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:13,538 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:13,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:13,539 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:13,539 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:13,545 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:13,563 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:13,563 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:13,564 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:13,566 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:13,567 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:13,567 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:13,568 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:13,569 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:13,570 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:13,571 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:13,571 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:13,574 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:13,577 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:13,597 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:13,597 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:13,598 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:13,599 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:13.599643+07:00
2025-10-11 04:59:13,600 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:13.599643+07:00
2025-10-11 04:59:13,600 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:13.599643+07:00 trong DST: True
2025-10-11 04:59:13,601 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:13,601 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:13,602 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:13,603 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:13,603 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:13,607 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:13,608 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:13,608 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:13,609 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:13,609 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:13,633 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:13,634 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:13,634 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:13,634 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:13,635 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:13,635 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:13,636 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:13,636 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:13,637 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:13,637 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:13,638 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:13,638 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:13,639 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:13,639 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:13,641 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:13,641 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:13,642 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:13,646 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:13,661 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:13,662 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:13,663 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:13,664 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:13,664 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:13,664 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:13,665 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:13,666 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:13,666 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:13,667 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:13,667 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:13,667 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:13,668 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:13,669 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:13,669 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:13,669 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:13,670 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:13,670 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:13.670560+07:00
2025-10-11 04:59:13,671 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:13.670560+07:00
2025-10-11 04:59:13,672 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:13.670560+07:00 trong DST: True
2025-10-11 04:59:13,672 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:13,672 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:13,673 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:13,674 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,674 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:13,675 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:13,677 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:13,697 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,698 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:13,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:13,700 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:13,701 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:13,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:13,702 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:13,702 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:13,702 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:13,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:13,704 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:13,704 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:13,705 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:13,705 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:13,706 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:13,707 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:13,711 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:13,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:13,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:13,732 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:13,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:13,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:13,734 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:13,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:13,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:13,735 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:13,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:13,736 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:13,736 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:13,737 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:13,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:13,738 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:13,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:13,739 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:13,740 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:13,740 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:13,741 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:13,741 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:13,742 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:13,770 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:13,773 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:13,775 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:13,776 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:13,776 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,777 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:13,778 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:13,778 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:13,792 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:13,803 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:13,804 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:13,805 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:13,808 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,808 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:13,828 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:13,814 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:13,831 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:13,835 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:13,835 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:13,836 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:13,836 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,837 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:13,838 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,838 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:13,838 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:13,839 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:13,839 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:13,839 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:13,840 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:13,841 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:59:13,906 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:13,907 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:13,908 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:13,909 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:13,911 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:13,972 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:13,973 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:13,975 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:13,976 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:13,977 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:13,979 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:13,979 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:13,980 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:14,013 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:14,201 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:14,202 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:14,203 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:14,203 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:14,204 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:14,204 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:14,205 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:14,205 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:14,707 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:14,708 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:14,709 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:14,709 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:14,710 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:14,710 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:14,710 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:14,711 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:14,714 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:14,714 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:14,715 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:14,715 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:14,721 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:14,739 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:14,741 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:14,742 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:14,748 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:14,773 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:14,774 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:14,775 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:14,781 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:14,802 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:14,802 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:14,803 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:14,806 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:14,806 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:14,807 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:14,807 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:14,808 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:14,808 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:14.808725+07:00
2025-10-11 04:59:14,809 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:14.808725+07:00
2025-10-11 04:59:14,809 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:14.808725+07:00 trong DST: True
2025-10-11 04:59:14,809 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:14,810 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:14,810 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:14,813 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:14,833 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:14,837 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:14,838 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:14,838 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:14,839 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:14,839 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:14,840 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:14,840 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:14,840 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:14,841 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:14,841 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:14,843 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:14,843 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:14,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:14,866 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:14,867 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:14,867 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:14,868 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:14,868 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:14,869 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:14,870 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:14,870 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:14,871 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:14,871 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:14,872 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:14,872 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:14,873 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:14,873 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:14,874 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:14,874 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:14,875 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:14,876 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:14,876 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:14,877 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:14,877 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:14,881 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:14,900 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:14,903 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:14,904 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:14,904 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:14,905 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:14,905 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:14.905602+07:00
2025-10-11 04:59:14,905 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:14.905602+07:00
2025-10-11 04:59:14,906 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:14.905602+07:00 trong DST: True
2025-10-11 04:59:14,906 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:14,907 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:14,907 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:14,908 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:14,908 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:14,909 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:14,909 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:14,910 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:14,911 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:14,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:14,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:14,938 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:14,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:14,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:14,940 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:14,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:14,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:14,941 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:14,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:14,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:14,943 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:14,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:14,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:14,965 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:14,967 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:14,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:14,970 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:14,970 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:14,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:14,972 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:14,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:14,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:14,974 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:14,974 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:14,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:14,976 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:14,976 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:14,981 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:15,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:15,006 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:15,006 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:15,007 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:15,007 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:15,007 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:15,008 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:15,009 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:15,009 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:15,010 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:15,038 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:15,039 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:15,040 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:15,040 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:15,041 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-11 04:59:15,041 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:15,042 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:15,043 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:15,043 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:15,066 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:15,068 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:15,068 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:15,069 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:15,069 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:15,070 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:15,071 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:15,072 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:15,074 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:15,075 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:15,075 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:15,075 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:15,081 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:15,100 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:15,101 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:15,102 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:15,103 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:15,103 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:15,104 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:15,105 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:15,105 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:15,106 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:15,106 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:15,107 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:15,107 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:15,115 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.14s
2025-10-11 04:59:15,115 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:15,247 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:15,248 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:15,248 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:15,249 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:15,251 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:15,978 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:15,978 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:15,980 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:15,982 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:15,982 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:15,984 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:15,985 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:15,986 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:16,015 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:16,212 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:16,213 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:16,214 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:16,214 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:16,215 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:16,215 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:16,216 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:16,216 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:16,717 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:16,719 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:16,720 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:16,720 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:16,721 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:16,721 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:16,721 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:16,722 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:16,724 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:16,724 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:16,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:16,725 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:16,731 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:16,757 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:16,757 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:16,758 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:16,760 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:16,761 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:16,763 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:16,763 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:16,768 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:16,790 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:16,791 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:16,791 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:16,818 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:16,819 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:16,820 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:16,820 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:16,820 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:16,821 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:16.821381+07:00
2025-10-11 04:59:16,821 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:16.821381+07:00
2025-10-11 04:59:16,822 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:16.821381+07:00 trong DST: True
2025-10-11 04:59:16,822 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:16,822 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:16,823 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:16,824 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:16,825 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:16,828 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:16,828 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:16,828 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:16,829 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:16,829 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:16,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:16,830 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:16,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:16,831 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:16,831 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:16,832 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:16,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:16,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:16,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:16,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:16,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:16,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:16,856 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:16,856 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:16,857 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:16,857 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:16,858 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:16,858 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:16,859 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:16,859 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:16,859 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:16,860 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:16,861 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:16,861 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:16,861 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:16,863 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:16,863 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:16,864 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:16,864 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:16,886 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:16,887 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:16,888 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:16,889 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:16,889 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:16,889 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:16,890 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:16.890071+07:00
2025-10-11 04:59:16,890 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:16.890071+07:00
2025-10-11 04:59:16,891 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:16.890071+07:00 trong DST: True
2025-10-11 04:59:16,892 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:16,892 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:16,892 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:16,893 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:16,893 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:16,893 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:16,894 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:16,894 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:16,895 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:16,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:16,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:16,898 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:16,898 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:16,901 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:16,918 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:16,920 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:16,921 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:16,922 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:16,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:16,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:16,923 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:16,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:16,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:16,925 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:16,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:16,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:16,927 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:16,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:16,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:16,929 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:16,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:16,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:16,930 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:16,931 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:16,932 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:16,932 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:16,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:16,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:16,957 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:16,958 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:16,958 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:16,959 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:16,960 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:16,960 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:16,961 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:16,961 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:16,962 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:16,962 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:16,963 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:16,963 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:16,963 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:16,964 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:16,984 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:16,987 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:16,987 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:16,988 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:16,988 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:16,991 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:16,991 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:16,992 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:16,993 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:16,994 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:16,995 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:16,995 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:16,996 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:16,999 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:17,026 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:17,027 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:17,028 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:17,029 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:17,032 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:17,064 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:17,085 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:17,091 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:17,152 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:17,160 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:17,211 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:17,218 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:17,283 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:17,293 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:17,317 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:17,328 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:17,356 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:17,392 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.41s
2025-10-11 04:59:17,582 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:17,632 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:17,668 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:17,707 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:17,749 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:17,993 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:17,993 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:17,995 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:17,996 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:17,997 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:17,999 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:18,000 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:18,001 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:18,030 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:18,031 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:18,032 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:18,032 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:18,033 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:18,034 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:18,034 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:18,037 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:18,054 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:18,553 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:18,555 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:18,555 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:18,556 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:18,556 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:18,557 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:18,557 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:18,557 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:18,559 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:18,560 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:18,560 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:18,561 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:18,566 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:18,584 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:18,585 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:18,585 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:18,588 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:18,588 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:18,588 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:18,589 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:18,591 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:18,592 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:18,592 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:18,592 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:18,595 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:18,596 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:18,596 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:18,597 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:18,597 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:18,598 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:18.597962+07:00
2025-10-11 04:59:18,598 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:18.597962+07:00
2025-10-11 04:59:18,598 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:18.597962+07:00 trong DST: True
2025-10-11 04:59:18,599 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:18,599 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:18,599 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:18,603 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:18,621 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:18,625 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:18,625 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:18,626 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:18,627 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:18,627 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:18,627 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:18,628 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:18,628 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:18,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:18,629 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:18,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:18,630 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:18,630 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:18,631 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:18,631 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:18,631 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:18,632 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:18,632 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:18,633 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:18,633 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:18,634 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:18,635 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:18,635 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:18,636 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:18,656 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:18,657 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:18,657 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:18,658 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:18,659 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:18,659 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:18,659 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:18,660 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:18,660 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:18,660 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:18,661 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:18,661 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:18,662 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:18,663 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:18,663 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:18,663 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:18,664 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:18.664107+07:00
2025-10-11 04:59:18,664 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:18.664107+07:00
2025-10-11 04:59:18,665 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:18.664107+07:00 trong DST: True
2025-10-11 04:59:18,665 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:18,665 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:18,666 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:18,666 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,667 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:18,667 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:18,668 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:18,668 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,669 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:18,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:18,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:18,693 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:18,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:18,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:18,695 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:18,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:18,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:18,696 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:18,697 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:18,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:18,698 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:18,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:18,700 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:18,701 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:18,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:18,702 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:18,725 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:18,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:18,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:18,728 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:18,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:18,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:18,730 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:18,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,731 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:18,731 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:18,731 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:18,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:18,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:18,733 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:18,733 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:18,734 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:18,734 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:18,735 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:18,735 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:18,767 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:18,768 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:18,769 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:18,770 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:18,770 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:18,771 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:18,799 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:18,800 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:18,800 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:18,801 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:18,801 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:18,825 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:18,827 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:18,829 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,829 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:18,830 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:18,830 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:18,831 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:18,834 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:18,835 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:18,835 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:18,836 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,856 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:18,857 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,857 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:18,858 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:18,858 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:18,859 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:18,860 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:18,860 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:18,861 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:59:18,900 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:18,901 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:18,901 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:18,902 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:18,904 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:18,999 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:19,000 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:19,001 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:19,003 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:19,004 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:19,006 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:19,007 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:19,007 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:19,039 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:19,039 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:19,040 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:19,040 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:19,041 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:19,041 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:19,042 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:19,043 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:19,112 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:19,544 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:19,546 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:19,546 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:19,547 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:19,547 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:19,547 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:19,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:19,548 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:19,550 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:19,550 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:19,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:19,551 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:19,557 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:19,576 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:19,576 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:19,577 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:19,579 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:19,580 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:19,580 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:19,581 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:19,583 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:19,584 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:19,585 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:19,585 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:19,590 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:19,610 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:19,611 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:19,611 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:19,612 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:19,612 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:19.612376+07:00
2025-10-11 04:59:19,612 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:19.612376+07:00
2025-10-11 04:59:19,613 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:19.612376+07:00 trong DST: True
2025-10-11 04:59:19,613 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:19,613 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:19,614 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:19,615 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:19,616 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:19,620 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:19,641 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:19,642 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:19,642 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:19,643 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:19,644 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:19,644 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:19,644 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:19,645 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:19,645 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:19,646 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:19,646 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:19,647 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:19,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:19,647 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:19,648 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:19,648 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:19,649 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:19,649 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:19,650 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:19,650 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:19,651 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:19,651 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:19,652 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:19,652 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:19,653 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:19,653 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:19,654 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:19,654 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:19,655 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:19,675 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:19,676 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:19,678 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:19,678 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:19,703 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:19,703 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:19,704 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:19,705 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:19,705 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:19,723 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:19,724 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:19.724478+07:00
2025-10-11 04:59:19,725 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:19.724478+07:00
2025-10-11 04:59:19,725 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:19.724478+07:00 trong DST: True
2025-10-11 04:59:19,726 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:19,727 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:19,727 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:19,728 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,728 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:19,729 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:19,729 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:19,729 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,730 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:19,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:19,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:19,731 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:19,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:19,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:19,733 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:19,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:19,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:19,735 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:19,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:19,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:19,736 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:19,737 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:19,738 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:19,767 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:19,768 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:19,770 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:19,770 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:19,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:19,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:19,798 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:19,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:19,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:19,800 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:19,801 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,801 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:19,801 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:19,803 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:19,804 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:19,804 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:19,827 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:19,829 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:19,830 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:19,830 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:19,831 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:19,831 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:19,832 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:19,832 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:19,832 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:19,832 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:19,833 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:19,833 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:19,833 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,834 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:19,834 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:19,835 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:19,836 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:19,837 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:19,837 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:19,864 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:19,866 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,867 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:19,867 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:19,868 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:19,868 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:19,874 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:19,888 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:19,890 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:19,890 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,891 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:19,892 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,892 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:19,892 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:19,893 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:19,893 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:19,893 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:19,894 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:19,895 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.89s
2025-10-11 04:59:19,931 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:19,932 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:19,933 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:19,933 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:19,936 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:20,005 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:20,006 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:20,007 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:20,009 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:20,010 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:20,011 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:20,037 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:20,039 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:59:20,040 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:20,040 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:20,041 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:20,041 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:20,042 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:20,042 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:20,043 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:20,043 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:20,138 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:20,544 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:20,546 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:20,546 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:20,547 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:20,547 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:20,548 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:20,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:20,549 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:20,550 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:20,551 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:20,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:20,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:20,558 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:20,575 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:20,576 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:20,577 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:20,579 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:20,579 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:20,579 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:20,580 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:20,583 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:20,583 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:20,583 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:20,584 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:20,587 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:20,587 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:20,588 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:20,589 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:20,589 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:20,610 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:20.610632+07:00
2025-10-11 04:59:20,611 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:20.610632+07:00
2025-10-11 04:59:20,612 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:20.610632+07:00 trong DST: True
2025-10-11 04:59:20,612 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:20,613 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:20,613 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:20,615 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:20,615 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:20,618 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:20,619 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:20,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:20,620 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:20,620 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:20,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:20,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:20,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:20,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:20,623 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:20,623 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:20,643 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:20,645 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:20,646 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:20,646 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:20,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:20,648 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:20,648 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:20,648 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:20,649 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:20,649 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:20,650 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:20,650 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:20,651 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:20,651 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:20,652 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:20,652 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:20,653 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:20,653 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:20,654 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:20,655 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:20,655 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:20,656 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:20,661 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:20,680 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:20,681 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:20,682 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:20,683 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:20,684 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:20,684 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:20,684 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:20.684808+07:00
2025-10-11 04:59:20,685 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:20.684808+07:00
2025-10-11 04:59:20,685 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:20.684808+07:00 trong DST: True
2025-10-11 04:59:20,685 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:20,686 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:20,686 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:20,686 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,687 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:20,687 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:20,688 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:20,688 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,689 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:20,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:20,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:20,712 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:20,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:20,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:20,716 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:20,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:20,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:20,717 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:20,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:20,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:20,718 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:20,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:20,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:20,720 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:20,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:20,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:20,722 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:20,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:20,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:20,726 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:20,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:20,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:20,753 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:20,754 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,755 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:20,755 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:20,756 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:20,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:20,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:20,786 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:20,787 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:20,787 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:20,788 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:20,789 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:20,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:20,790 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:20,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:20,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:20,791 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:20,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:20,792 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:20,792 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:20,793 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:20,793 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:20,794 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:20,794 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:20,801 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:20,819 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:20,821 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:20,821 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:20,822 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,826 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:20,844 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:20,845 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:20,847 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:20,847 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:20,848 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,848 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:20,849 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,849 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:20,850 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:20,850 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:20,850 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:20,851 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:20,851 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:20,852 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 04:59:20,881 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-11 04:59:20,892 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.autorun.guard' vào nhóm 'ui.autorun' (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-11 04:59:20,903 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.autorun.guard vào group ui.autorun (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-11 04:59:20,903 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-11 04:59:20,904 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:20,907 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:20,908 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:20,910 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:20,933 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:20,938 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-11 04:59:20,939 - APP.utils.threading_utils - DEBUG - Task 'ui.autorun.guard' (group=ui.autorun) hoàn tất sau 0.04s
2025-10-11 04:59:21,010 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:21,011 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:21,012 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:21,014 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:21,015 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:21,016 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:21,017 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:21,017 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:21,020 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,021 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:21,021 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,022 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,022 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:21,023 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,024 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:21,024 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:21,041 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _request_autorun_start
2025-10-11 04:59:21,049 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:21,050 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,050 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:21,051 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,051 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:21,052 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,052 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:21,053 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:21,053 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-11 04:59:21,053 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-11 04:59:21,054 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-11 04:59:21,056 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251011-045921' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-045921', 'priority': 'autorun'})
2025-10-11 04:59:21,056 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-11 04:59:21,061 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251011-045921 (priority=autorun)
2025-10-11 04:59:21,081 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-11 04:59:21,082 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-11 04:59:21,082 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-11 04:59:21,083 - APP.ui.app_ui - INFO - Autorun autorun-20251011-045921 bắt đầu ngay lập tức.
2025-10-11 04:59:21,084 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-11 04:59:21,084 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-11 04:59:21,087 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:21,088 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 04:59:21,088 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-11 04:59:21,231 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:21,232 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-11 04:59:21,233 - APP.ui.app_ui - INFO - Phiên autorun-20251011-045921 bắt đầu (priority=autorun, source=autorun).
2025-10-11 04:59:21,234 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-11 04:59:21,279 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-11 04:59:21,290 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-11 04:59:21,317 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (TaskGroup analysis.upload).
2025-10-11 04:59:21,350 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-11 04:59:21,384 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy vào cuối tuần.
2025-10-11 04:59:21,386 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-11 04:59:21,388 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy vào cuối tuần.
2025-10-11 04:59:21,389 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-11 04:59:21,391 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-11 04:59:21,392 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.31s
2025-10-11 04:59:21,392 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-11 04:59:21,421 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-045921.0' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-045921', 'index': 0})
2025-10-11 04:59:21,485 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-045921.1' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-045921', 'index': 1})
2025-10-11 04:59:21,496 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-045921.2' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-045921', 'index': 2})
2025-10-11 04:59:21,498 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 13067:1760147730:262e74bf02a1c2b2
2025-10-11 04:59:21,500 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-045921.3' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-045921', 'index': 3})
2025-10-11 04:59:21,501 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11958:1760147795:513f8e5839ff7a34
2025-10-11 04:59:21,502 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/x6cackq4w5ls
2025-10-11 04:59:21,503 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14388:1760147725:aafea65d11833a75
2025-10-11 04:59:21,504 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/oqaz6abzw1q3
2025-10-11 04:59:21,505 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-11 04:59:21,505 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251011.jsonl.
2025-10-11 04:59:21,507 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/cbqd2j9q86jf
2025-10-11 04:59:21,542 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:21,575 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-11 04:59:21,585 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-11 04:59:21,587 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-11 04:59:21,592 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:21,654 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy vào cuối tuần.
2025-10-11 04:59:21,656 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:21,656 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_2_logic' hoàn tất thành công.
2025-10-11 04:59:21,686 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:21,691 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:21,696 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-045921.0' (group=analysis.upload) hoàn tất sau 0.20s
2025-10-11 04:59:21,713 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-045921.1' (group=analysis.upload) hoàn tất sau 0.22s
2025-10-11 04:59:21,714 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:21,717 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:21,719 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:21,719 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 11602:1760147800:c0e0245d791aa20d
2025-10-11 04:59:21,722 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:21,723 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/tmyqg1ktggaa
2025-10-11 04:59:21,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:21,725 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-11 04:59:21,753 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:21,788 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:21,799 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:21,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:21,820 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-045921.2' (group=analysis.upload) hoàn tất sau 0.32s
2025-10-11 04:59:21,821 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:21,823 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:21,825 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:21,830 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:21,852 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:21,854 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:21,856 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:21,856 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:21,857 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:21,859 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-045921.3' (group=analysis.upload) hoàn tất sau 0.14s
2025-10-11 04:59:21,883 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:21,888 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:21,888 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-11 04:59:21,889 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:21,889 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:21,892 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-11 04:59:21,892 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:21,893 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:21,913 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_3_logic' hoàn tất thành công.
2025-10-11 04:59:21,918 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:21,918 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:21,919 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-11 04:59:21,919 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:21,920 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-11 04:59:21,920 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:21.920715+07:00
2025-10-11 04:59:21,922 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-11 04:59:21,950 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:21.920715+07:00
2025-10-11 04:59:21,951 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-11 04:59:21,951 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:21.920715+07:00 trong DST: True
2025-10-11 04:59:21,952 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251011-045921' (group=analysis.session) hoàn tất sau 0.87s
2025-10-11 04:59:21,952 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:21,953 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:21,953 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:21,954 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:21,955 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:21,960 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:21,980 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:21,981 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:21,982 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:21,982 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:21,983 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:21,984 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:21,985 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:21,985 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:21,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:21,986 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:21,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:21,987 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:21,987 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:21,988 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:21,988 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:21,989 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:21,990 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:21,990 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:21,991 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:21,992 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:21,993 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:21,993 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:22,021 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:22,022 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:22,024 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:22,025 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,025 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:22,026 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:22,051 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:22,054 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:22,055 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:22,055 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:22,056 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:22,056 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:59:22,057 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:22,059 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:22,059 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:22,059 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:22,060 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:22,060 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:22,086 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:22,086 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:22,087 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:22,088 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:22,088 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:22,088 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:22,089 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:22.089248+07:00
2025-10-11 04:59:22,089 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:22.089248+07:00
2025-10-11 04:59:22,090 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:22.089248+07:00 trong DST: True
2025-10-11 04:59:22,090 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:22,090 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:22,091 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:22,091 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,092 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:22,092 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:22,093 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:22,093 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,094 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:22,113 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:22,114 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:22,116 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:22,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:22,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:22,118 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:22,118 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:22,119 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:22,119 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:22,120 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:22,120 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:22,121 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:22,121 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:22,122 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:22,123 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:22,123 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:22,124 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:22,126 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:22,126 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:22,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:22,150 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,151 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:22,154 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:22,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:22,156 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:22,157 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,158 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:22,160 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:22,160 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:22,161 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:22,161 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:22,164 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:22,187 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:22,188 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:22,188 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:22,189 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:22,189 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:22,189 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:22,190 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:22,190 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:22,192 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:22,193 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:22,193 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:22,194 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,217 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:22,218 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:22,219 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:22,220 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:22,221 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:22,221 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:22,223 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:22,224 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,226 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:22,226 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:22,252 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:22,256 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:22,256 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,257 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:22,257 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:22,259 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:22,260 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,263 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:22,281 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,282 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:22,283 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:22,283 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:22,284 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:22,284 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:22,285 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:22,286 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.27s
2025-10-11 04:59:22,365 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,365 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,467 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,468 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,568 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,569 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,669 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,670 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,771 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,772 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,772 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-11 04:59:22,773 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-11 04:59:22,773 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-11 04:59:22,774 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,774 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251011-045921: {'status': 'completed', 'early_exit': True}
2025-10-11 04:59:22,774 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,888 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:22,888 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:22,889 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:22,890 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:22,892 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:23,039 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:23,040 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:23,041 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:23,043 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:23,044 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:23,045 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:23,046 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:23,047 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:23,098 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:23,099 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:23,100 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:23,100 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:23,101 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:23,101 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:23,102 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:23,102 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:23,139 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:23,264 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 04:59:23,442 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 04:59:23,603 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:23,605 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:23,606 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:23,606 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:23,607 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:23,607 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:23,608 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:23,608 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:23,611 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:23,612 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:23,612 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:23,613 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:23,619 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:23,636 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:23,638 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:23,639 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:23,641 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:23,641 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:23,642 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:23,642 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:23,645 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:23,646 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:23,647 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:23,670 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:23,673 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:23,674 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:23,675 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:23,676 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:23,676 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:23,676 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:23.676629+07:00
2025-10-11 04:59:23,677 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:23.676629+07:00
2025-10-11 04:59:23,677 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:23.676629+07:00 trong DST: True
2025-10-11 04:59:23,678 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:23,678 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:23,678 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:23,682 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:23,701 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:23,706 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:23,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:23,707 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:23,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:23,708 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:23,708 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:23,709 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:23,709 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:23,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:23,710 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:23,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:23,711 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:23,713 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:23,733 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:23,736 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:23,737 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:23,737 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:23,738 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:23,738 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:23,739 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:23,740 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:23,741 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:23,741 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:23,742 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:23,742 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:23,743 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:23,744 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:23,746 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:23,746 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:23,778 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:23,779 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:23,779 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:23,781 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:23,806 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:23,807 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:23,808 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:23,809 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:23,810 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:23,810 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:23,812 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:23,813 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:23.812950+07:00
2025-10-11 04:59:23,813 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:23.812950+07:00
2025-10-11 04:59:23,813 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:23.812950+07:00 trong DST: True
2025-10-11 04:59:23,814 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:23,814 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:23,839 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:23,840 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:23,841 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:23,841 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:23,842 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:23,842 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:23,842 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:23,843 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:23,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:23,845 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:23,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:23,846 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:23,871 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:23,873 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:23,874 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:23,874 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:23,875 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:23,876 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:23,876 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:23,877 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:23,878 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:23,880 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:23,904 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:23,906 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:23,907 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:23,907 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:23,908 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:23,909 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:23,909 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:23,910 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:23,912 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:23,913 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:23,936 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:23,937 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:23,938 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:23,938 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:23,939 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:23,939 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:23,940 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:23,941 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:23,941 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:23,941 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:23,942 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:23,942 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:23,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:23,943 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:23,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:23,943 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:23,944 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:23,946 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:23,947 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:23,958 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:23,969 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:23,971 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:23,971 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:23,972 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:23,973 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:23,974 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:23,975 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:23,975 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:23,975 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:23,979 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:23,979 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:23,980 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:23,981 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:24,001 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:24,002 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:24,003 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:24,003 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:24,004 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:24,004 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:24,005 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:24,005 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:24,007 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:24,008 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.97s
2025-10-11 04:59:24,042 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:24,043 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:24,043 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:24,044 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:24,069 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:24,073 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:24,074 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:24,075 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:24,078 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:24,080 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:24,081 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:24,103 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:24,104 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:59:24,174 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:24,391 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:24,392 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:24,392 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:24,393 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:24,393 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:24,394 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:24,394 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:24,395 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:24,714 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 04:59:24,778 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 04:59:24,896 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:24,898 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:24,898 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:24,899 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:24,899 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:24,900 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:24,900 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:24,900 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:24,904 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:24,904 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:24,904 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:24,905 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:24,913 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:24,929 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:24,930 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:24,931 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:24,934 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:24,935 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:24,936 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:24,936 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:24,939 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:24,940 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:24,941 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:24,941 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:24,944 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:24,944 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:24,945 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:24,946 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:24,947 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:24,947 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:24.947690+07:00
2025-10-11 04:59:24,948 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:24.947690+07:00
2025-10-11 04:59:24,948 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:24.947690+07:00 trong DST: True
2025-10-11 04:59:24,948 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:24,949 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:24,972 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:24,975 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:24,975 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:24,979 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:24,979 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:24,981 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:24,981 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:24,982 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:25,005 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:25,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:25,006 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:25,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:25,007 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:25,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:25,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:25,009 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:25,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:25,010 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:25,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:25,011 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:25,011 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:25,011 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:25,012 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:25,014 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:25,015 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:25,015 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:25,039 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:25,039 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:25,041 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:25,042 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:25,042 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:25,043 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:25,043 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:25,044 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:25,044 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:25,044 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:25,045 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:25,045 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:25,045 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:25,046 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:25,048 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:25,048 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:25,073 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:25,074 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:25.073941+07:00
2025-10-11 04:59:25,074 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:25.073941+07:00
2025-10-11 04:59:25,075 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:25.073941+07:00 trong DST: True
2025-10-11 04:59:25,076 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:25,076 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:25,076 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:25,077 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,077 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:25,078 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:25,079 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:25,080 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:25,081 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,085 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:25,100 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:25,101 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:25,102 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:25,104 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:25,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:25,107 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:25,107 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:25,108 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:59:25,109 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:25,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:25,111 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:25,111 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:25,112 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:25,113 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:25,113 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:25,114 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:25,115 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:25,143 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:25,144 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:25,145 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:25,146 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:25,146 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:25,147 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:25,176 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:25,177 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:25,177 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:25,178 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:25,179 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:25,180 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:25,180 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,182 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:25,182 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:25,183 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:25,207 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:25,207 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:25,237 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:25,248 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:25,282 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:25,306 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:25,344 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:25,379 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:25,442 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:25,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:25,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:25,465 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:25,523 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:25,566 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:25,573 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:25,578 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,581 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:25,606 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:25,609 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:25,611 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:25,613 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:25,644 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:25,645 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:25,648 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:25,649 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,649 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:25,678 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:25,706 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:25,714 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:25,736 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:25,740 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:25,749 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,786 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:25,786 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,789 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:25,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:25,791 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:25,791 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:25,792 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:25,792 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:25,797 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.72s
2025-10-11 04:59:25,876 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:25,876 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:25,877 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:25,877 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:25,880 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:26,089 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:26,089 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:26,091 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:26,093 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:26,094 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:26,095 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:26,096 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:26,097 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:26,125 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:26,126 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:26,127 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:26,128 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:26,128 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:26,129 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:26,130 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:26,130 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:26,190 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:26,221 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 04:59:26,269 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 04:59:26,636 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:26,644 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:26,684 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:26,684 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:26,685 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:26,686 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:26,686 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:26,687 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:26,689 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:26,689 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:26,690 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:26,690 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:26,693 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:26,694 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:26,694 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:26,695 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:26,697 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:26,697 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:26,697 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:26,698 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:26,700 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:26,701 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:26,701 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:26,701 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:26,727 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:26,728 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:26,729 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:26,729 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:26,730 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:26,730 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:26.730450+07:00
2025-10-11 04:59:26,730 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:26.730450+07:00
2025-10-11 04:59:26,731 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:26.730450+07:00 trong DST: True
2025-10-11 04:59:26,731 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:26,731 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:26,732 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:26,733 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:26,734 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:26,742 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:26,766 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:26,767 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:26,768 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:26,769 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:26,770 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:26,783 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.01s
2025-10-11 04:59:26,794 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:26,795 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:26,796 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:26,796 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:26,797 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:26,797 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:26,798 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:26,798 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:26,798 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:26,800 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:26,801 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:26,801 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:26,801 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:26,805 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:26,822 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:26,824 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:26,825 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:26,826 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:26,827 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:26,828 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:26,828 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:26,828 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:26,829 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:26,829 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:26,830 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:26,830 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:26,831 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:26,831 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:26,831 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:26,832 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:26,832 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:26,833 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:26,833 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:26,834 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:26,834 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:26,835 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:26,836 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:26.835955+07:00
2025-10-11 04:59:26,857 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:26.835955+07:00
2025-10-11 04:59:26,860 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:26.835955+07:00 trong DST: True
2025-10-11 04:59:26,860 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:26,861 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:26,861 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:26,862 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:26,862 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:26,863 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:26,863 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:26,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:26,864 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:26,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:26,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:26,865 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:26,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:26,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:26,872 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:26,884 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:59:26,893 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:26,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:26,896 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:26,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:26,898 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:26,898 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:26,898 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:26,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:26,901 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:26,901 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:26,902 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:26,903 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:26,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:26,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:26,929 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:26,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:26,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:26,931 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:26,931 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:26,931 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:26,932 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:26,932 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:26,932 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:26,933 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:26,933 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:26,934 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:26,936 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:26,936 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:26,937 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:26,962 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:26,963 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:26,963 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:26,964 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:26,964 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:26,966 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:26,966 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:26,966 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:26,967 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:26,967 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:26,968 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:26,969 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:26,969 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:26,970 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:26,996 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:26,998 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:26,999 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:26,999 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:27,000 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:27,007 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:27,026 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:27,027 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:27,027 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:27,028 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:27,028 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:27,029 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:27,030 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:27,030 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:27,030 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:27,031 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:27,031 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:27,032 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:27,033 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-11 04:59:27,093 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:27,094 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:27,095 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:27,097 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:27,098 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:27,098 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:27,099 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:27,099 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:27,100 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:27,101 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:27,102 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:27,103 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:27,129 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:27,130 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:27,394 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:27,394 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:27,395 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:27,395 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:27,396 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:27,396 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:27,397 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:27,397 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:27,614 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 04:59:27,637 - APP.services.fmp_service - INFO - Lấy thành công 400 sự kiện từ investpy cho 7 ngày tới.
2025-10-11 04:59:27,649 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 6.57s
2025-10-11 04:59:27,659 - APP.ui.app_ui - DEBUG - Callback nhận được 138 sự kiện tin tức mới.
2025-10-11 04:59:27,659 - APP.services.news_service - INFO - NewsService làm mới cache (138 sự kiện, priority=autorun, source=network, latency=6.60s)
2025-10-11 04:59:27,660 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 6.60s
2025-10-11 04:59:27,693 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:59:27,697 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:27,898 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:27,900 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:27,900 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:27,901 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:27,901 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:27,902 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:27,902 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:27,902 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:27,905 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:27,905 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:27,906 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:27,906 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:27,912 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:27,928 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:27,929 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:27,930 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:27,932 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:27,933 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:27,933 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:27,934 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:27,936 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:27,937 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:27,937 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:27,937 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:27,943 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:27,961 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:27,962 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:27,963 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:27,963 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:27,964 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:27.964271+07:00
2025-10-11 04:59:27,964 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:27.964271+07:00
2025-10-11 04:59:27,965 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:27.964271+07:00 trong DST: True
2025-10-11 04:59:27,965 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:27,966 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:27,966 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:27,967 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:27,967 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:27,971 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:27,993 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:27,995 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:27,995 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:27,996 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:27,996 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:27,996 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:27,997 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:27,997 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:27,998 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:27,998 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:27,998 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:27,999 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:27,999 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:28,000 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:28,000 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:28,000 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:28,001 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:28,002 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:28,002 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:28,004 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:28,005 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:28,005 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:28,006 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:28,032 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:28,033 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:28,033 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:28,034 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:28,034 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:28,035 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:28,035 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:28,036 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:28,036 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:28,037 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:28,064 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:28,067 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:28,067 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:28,068 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:28,069 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:28,069 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:28,069 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:28.069763+07:00
2025-10-11 04:59:28,070 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:28.069763+07:00
2025-10-11 04:59:28,070 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:28.069763+07:00 trong DST: True
2025-10-11 04:59:28,071 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:28,071 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:28,071 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:28,072 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,095 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:28,097 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:28,098 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:28,098 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:28,100 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:28,101 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,101 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:28,102 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:28,103 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:28,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:28,105 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:28,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:28,106 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:28,130 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:28,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:28,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:28,133 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:28,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:28,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:28,136 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:28,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:28,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:28,137 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:28,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:28,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:28,139 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:28,163 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:28,164 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:28,165 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:28,166 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:28,166 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:28,167 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:28,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:28,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:28,168 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:28,169 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,169 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:28,169 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:28,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:28,170 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:28,171 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:28,172 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:28,172 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:28,194 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:28,194 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:28,195 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:28,195 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:28,198 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:28,198 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:28,199 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:28,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:28,200 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:28,201 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:28,201 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,201 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:28,202 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:28,202 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:28,202 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:28,235 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:28,291 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:28,301 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:28,390 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:28,399 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,399 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:28,417 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:28,423 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:28,466 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:28,467 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:28,471 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:28,471 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:28,498 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,499 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:28,501 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,503 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:28,504 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:28,505 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:28,532 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:28,534 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:28,567 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:28,605 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.51s
2025-10-11 04:59:28,693 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:28,696 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:28,696 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:28,697 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:28,699 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:29,101 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:29,102 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:29,103 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:29,105 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:29,106 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:29,107 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:29,108 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:29,108 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:29,140 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:29,143 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:29,158 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:29,159 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:29,160 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:29,161 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:29,161 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:29,162 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:29,209 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:29,662 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:29,664 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:29,665 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:29,665 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:29,666 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:29,666 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:29,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:29,667 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:29,669 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:29,669 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:29,669 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:29,670 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:29,676 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:29,696 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:29,696 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:29,697 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:29,699 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:29,700 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:29,700 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:29,701 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:29,702 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:29,703 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:29,703 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:29,703 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:29,706 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:29,707 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:29,727 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:29,728 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:29,728 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:29,729 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:29.728961+07:00
2025-10-11 04:59:29,729 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:29.728961+07:00
2025-10-11 04:59:29,730 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:29.728961+07:00 trong DST: True
2025-10-11 04:59:29,730 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:29,730 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:29,731 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:29,732 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:29,732 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:29,736 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:29,737 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:29,738 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:29,738 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:29,739 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:29,739 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:29,740 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:29,741 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:29,741 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:29,742 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:29,742 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:29,771 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:29,772 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:29,772 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:29,773 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:29,773 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:29,774 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:29,775 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:29,796 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:29,797 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:29,798 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:29,799 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:29,800 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:29,800 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:29,801 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:29,801 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:29,802 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:29,802 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:29,802 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:29,803 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:29,803 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:29,803 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:29,804 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:29,804 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:29,805 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:29,805 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:29,806 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:29,807 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:29,807 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:29,808 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:29,808 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:29.808398+07:00
2025-10-11 04:59:29,808 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:29.808398+07:00
2025-10-11 04:59:29,809 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:29.808398+07:00 trong DST: True
2025-10-11 04:59:29,809 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:29,809 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:29,831 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:29,832 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,833 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:29,833 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:29,835 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:29,835 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,835 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:29,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:29,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:29,837 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:29,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:29,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:29,838 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:29,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:29,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:29,840 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:29,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:29,841 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:29,842 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:29,842 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:29,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:29,869 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:29,870 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:29,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:29,871 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:29,872 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:29,873 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:29,873 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:29,874 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:29,876 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:29,876 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:29,895 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,898 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:29,898 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:29,899 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:29,899 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:29,900 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:29,900 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:29,901 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:29,901 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:29,901 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:29,901 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:29,902 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:29,902 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:29,902 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:29,903 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:29,903 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:29,903 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:29,904 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:29,904 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,905 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:29,905 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:29,905 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:29,906 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:29,906 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:29,907 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:29,909 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:29,934 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,935 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:29,935 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:29,936 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:29,939 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:29,940 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:29,941 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:29,949 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:29,960 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,961 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:29,962 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,962 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:29,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:29,963 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:29,963 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:29,964 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:29,964 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:29,965 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-11 04:59:30,041 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:30,042 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:30,042 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:30,043 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:30,045 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:30,107 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:30,109 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:30,110 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:30,112 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:30,113 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:30,114 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:30,115 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:30,116 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:30,163 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:30,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:30,166 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:30,179 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:30,223 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:30,248 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:30,301 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:30,323 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:30,346 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:30,880 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:30,881 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:30,882 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:30,882 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:30,883 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:30,884 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:30,884 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:30,884 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:30,887 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:30,887 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:30,888 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:30,888 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:30,894 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:30,911 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:30,912 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:30,913 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:30,915 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:30,916 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:30,916 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:30,917 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:30,919 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:30,919 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:30,920 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:30,920 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:30,923 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:30,924 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:30,924 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:30,924 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:30,925 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:30,926 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:30.926337+07:00
2025-10-11 04:59:30,926 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:30.926337+07:00
2025-10-11 04:59:30,927 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:30.926337+07:00 trong DST: True
2025-10-11 04:59:30,927 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:30,927 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:30,928 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:30,931 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:30,952 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:30,956 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:30,956 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:30,957 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:30,957 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:30,957 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:30,958 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:30,958 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:30,959 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:30,959 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:30,959 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:30,960 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:30,961 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:30,961 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:30,962 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:30,964 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:30,981 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:30,982 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:30,983 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:30,985 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:30,986 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:30,986 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:30,987 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:30,987 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:30,988 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:30,988 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:30,989 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:30,989 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:30,990 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:30,990 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:30,991 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:30,991 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:30,992 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:30,992 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:30,992 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:30,993 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:30,993 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:30,994 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:30,995 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:30,995 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:30,996 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:31,025 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:31.025319+07:00
2025-10-11 04:59:31,026 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:31.025319+07:00
2025-10-11 04:59:31,028 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:31.025319+07:00 trong DST: True
2025-10-11 04:59:31,028 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:31,029 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:31,029 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:31,030 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,030 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:31,031 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:31,031 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:31,051 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,052 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:31,053 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:31,054 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:31,055 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:31,055 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:31,056 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:31,056 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:31,057 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:31,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:31,058 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:31,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:31,059 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:31,061 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:31,062 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:31,066 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:31,087 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:31,088 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:31,089 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:31,089 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:31,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:31,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:31,091 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:31,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:31,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:31,093 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:31,093 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,094 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:31,095 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:31,096 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:31,097 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:31,099 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:31,114 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:31,121 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:31,122 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:31,123 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:31,123 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:31,123 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:31,125 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:31,125 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:31,126 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:31,127 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:31,127 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:31,128 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:31,129 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:31,129 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:31,129 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,130 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:31,130 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:31,134 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:31,154 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:31,155 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:31,155 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:59:31,156 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:31,157 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:31,157 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:31,158 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:31,160 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:31,161 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:31,162 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:31,163 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,169 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:31,187 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:31,187 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:31,188 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:31,189 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:31,189 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,189 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:31,190 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,190 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:31,190 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:31,191 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:31,191 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:31,192 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:31,192 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:31,193 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.08s
2025-10-11 04:59:31,225 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:31,345 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:31,346 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:31,346 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:31,349 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:31,352 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:32,123 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:32,123 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:32,125 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:32,127 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:32,127 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:32,128 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:32,129 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:32,130 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:32,159 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:32,160 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:32,161 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:32,162 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:32,162 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:32,186 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:32,187 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:32,188 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:32,224 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:32,689 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:32,690 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:32,691 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:32,691 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:32,692 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:32,692 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:32,693 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:32,693 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:32,695 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:32,696 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:32,697 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:32,698 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:32,705 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:32,719 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:32,720 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:32,722 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:32,725 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:32,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:32,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:32,726 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:32,728 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:32,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:32,729 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:32,730 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:32,735 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:32,757 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:32,758 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:32,759 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:32,759 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:32,760 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:32.759946+07:00
2025-10-11 04:59:32,760 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:32.759946+07:00
2025-10-11 04:59:32,761 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:32.759946+07:00 trong DST: True
2025-10-11 04:59:32,762 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:32,763 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:32,763 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:32,766 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:32,789 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:32,793 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:32,793 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:32,794 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:32,794 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:32,795 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:32,796 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:32,796 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:32,796 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:32,797 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:32,800 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:32,818 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:32,819 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:32,820 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:32,821 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:32,821 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:32,822 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:32,822 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:32,823 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:32,823 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:32,824 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:32,824 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:32,825 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:32,825 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:32,825 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:32,826 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:32,826 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:32,827 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:32,827 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:32,828 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:32,828 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:32,829 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:32,830 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:32,830 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:32,830 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:32,853 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:32,855 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:32,856 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:32,857 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:32,857 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:32,857 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:32,858 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:32.858117+07:00
2025-10-11 04:59:32,858 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:32.858117+07:00
2025-10-11 04:59:32,859 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:32.858117+07:00 trong DST: True
2025-10-11 04:59:32,859 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:32,859 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:32,860 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:32,860 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,860 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:32,861 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:32,862 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:32,862 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,863 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:32,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:32,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:32,887 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:32,887 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:32,888 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:32,889 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:32,890 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:32,891 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:32,891 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:32,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:32,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:32,893 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:32,893 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:32,894 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:32,894 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:32,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:32,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:32,898 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:32,898 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:32,921 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:32,922 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:32,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:32,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:32,924 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:32,924 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,925 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:32,925 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:32,925 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:32,925 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:32,926 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:32,926 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:32,926 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:32,927 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:32,927 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:32,927 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:32,928 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:32,928 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:32,929 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:32,929 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:32,930 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:32,930 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:32,939 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:32,954 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,955 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:32,955 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:32,956 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:32,956 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:32,957 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:32,957 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:32,959 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:32,960 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,960 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:32,961 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:32,961 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:32,968 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:32,987 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:32,988 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:32,988 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:32,989 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,989 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:32,990 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,990 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:32,990 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:32,991 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:32,991 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:32,991 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:32,992 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:32,993 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:59:33,072 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:33,073 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:33,073 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:33,074 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:33,076 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:33,143 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:33,144 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:33,145 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:33,147 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:33,148 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:33,149 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:33,149 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:33,150 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:33,153 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:33,154 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:33,155 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:33,155 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:33,156 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:33,156 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:33,157 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:33,157 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:33,191 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:33,658 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:33,660 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:33,661 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:33,661 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:33,662 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:33,662 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:33,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:33,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:33,665 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:33,666 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:33,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:33,667 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:33,671 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:33,690 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:33,691 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:33,692 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:33,694 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:33,695 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:33,695 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:33,696 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:33,702 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:33,718 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:33,719 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:33,720 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:33,723 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:33,724 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:33,724 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:33,725 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:33,725 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:33,726 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:33.725970+07:00
2025-10-11 04:59:33,726 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:33.725970+07:00
2025-10-11 04:59:33,726 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:33.725970+07:00 trong DST: True
2025-10-11 04:59:33,727 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:33,727 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:33,727 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:33,729 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:33,729 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:33,733 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:33,733 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:33,761 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:33,761 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:33,762 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:33,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:33,763 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:33,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:33,764 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:33,765 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:33,766 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:33,766 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:33,767 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:33,767 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:33,790 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:33,791 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:33,792 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:33,792 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:33,793 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:33,794 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:33,794 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:33,795 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:33,795 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:33,796 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:33,796 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:33,797 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:33,797 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:33,798 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:33,798 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:33,799 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:33,799 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:33,799 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:33,802 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:33,823 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:33,825 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:33,825 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:33,826 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:33,827 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:33,827 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:33,828 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:33,828 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:33.828534+07:00
2025-10-11 04:59:33,828 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:33.828534+07:00
2025-10-11 04:59:33,829 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:33.828534+07:00 trong DST: True
2025-10-11 04:59:33,829 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:33,830 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:33,830 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:33,830 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,831 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:33,831 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:33,831 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:33,832 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,833 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:33,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:33,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:33,837 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:33,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:33,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:33,859 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:33,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:33,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:33,861 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:33,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:33,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:33,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:33,863 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:33,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:33,865 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:33,867 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:33,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:33,891 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:33,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:33,893 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:33,894 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:33,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:33,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:33,896 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:33,896 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,897 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:33,897 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:33,898 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:33,898 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:33,899 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:33,899 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:33,899 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:33,900 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:33,922 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:33,923 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:33,925 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:33,926 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:33,926 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:33,927 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:33,927 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:33,927 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:33,928 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:33,928 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,929 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:33,929 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:33,929 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:33,930 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:33,930 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:33,931 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:33,933 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:33,944 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,958 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:33,959 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:33,959 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:33,960 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:33,963 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:33,963 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:33,964 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:33,964 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,965 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:33,966 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,967 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:33,967 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:33,967 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:33,968 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:33,971 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:33,989 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:33,991 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 04:59:34,028 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:34,029 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:34,029 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:34,030 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:34,033 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:34,149 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:34,150 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:34,152 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:34,153 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:34,154 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:34,155 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:34,156 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:34,157 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:34,187 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:34,188 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:34,189 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:34,189 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:34,189 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:34,190 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:34,190 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:34,191 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:34,260 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:34,692 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:34,694 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:34,694 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:34,695 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:34,695 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:34,696 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:34,696 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:34,697 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:34,699 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:34,699 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:34,700 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:34,700 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:34,706 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:34,724 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:34,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:34,726 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:34,728 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:34,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:34,729 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:34,729 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:34,734 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:34,758 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:34,758 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:34,762 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:34,790 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:34,791 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:34,791 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:34,792 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:34,792 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:34,792 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:34.792762+07:00
2025-10-11 04:59:34,793 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:34.792762+07:00
2025-10-11 04:59:34,793 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:34.792762+07:00 trong DST: True
2025-10-11 04:59:34,793 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:34,794 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:34,794 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:34,795 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:34,796 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:34,800 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:34,803 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:34,821 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:34,822 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:34,822 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:34,823 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:34,823 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:34,824 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:34,824 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:34,824 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:34,825 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:34,825 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:34,826 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:34,826 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:34,826 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:34,827 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:34,827 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:34,828 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:34,828 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:34,829 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:34,829 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:34,830 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:34,831 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:34,832 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:34,833 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:34,834 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:34,859 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:34,860 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:34,861 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:34,862 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:34,862 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:34,863 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:34,863 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:34,863 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:34,864 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:34,865 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:34,867 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:34,889 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:34,890 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:34,890 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:34,891 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:34.891053+07:00
2025-10-11 04:59:34,891 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:34.891053+07:00
2025-10-11 04:59:34,891 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:34.891053+07:00 trong DST: True
2025-10-11 04:59:34,892 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:34,892 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:34,893 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:34,893 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:34,893 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:34,894 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:34,894 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:34,895 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:34,895 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:34,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:34,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:34,897 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:34,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:34,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:34,901 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:34,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:34,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:34,926 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:34,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:34,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:34,928 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:34,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:34,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:34,931 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:34,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:34,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:34,933 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:34,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:34,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:34,961 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:34,962 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:34,963 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:34,963 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:34,964 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:34,965 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:34,966 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:34,966 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:34,966 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:34,990 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:34,991 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:34,993 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:34,994 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:34,994 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:34,995 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:34,995 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:34,996 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:34,996 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:34,996 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:34,996 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:34,997 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:34,997 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:34,998 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:34,998 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:34,999 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:35,000 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:35,001 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:35,030 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:35,032 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:35,034 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:35,036 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:35,040 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:35,045 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:35,060 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:35,065 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:35,066 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:35,067 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:35,067 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:35,082 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:35,088 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:35,088 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:35,089 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:35,090 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:35,091 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:35,091 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:35,091 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:35,092 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:35,093 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-11 04:59:35,154 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:35,157 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:35,159 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:35,161 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:35,162 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:35,163 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:35,164 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:35,165 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:35,165 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:35,165 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:35,166 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:35,167 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:35,170 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:35,193 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:35,439 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:35,440 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:35,440 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:35,441 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:35,441 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:35,442 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:35,442 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:35,443 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:35,944 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:35,945 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:35,946 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:35,946 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:35,947 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:35,947 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:35,948 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:35,948 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:35,951 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:35,951 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:35,951 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:35,952 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:35,957 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:35,976 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:35,977 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:35,977 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:35,979 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:35,979 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:35,980 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:35,980 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:35,982 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:35,983 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:35,983 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:35,983 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:35,989 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:36,010 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:36,011 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:36,012 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:36,013 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:36,014 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:36.014025+07:00
2025-10-11 04:59:36,014 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:36.014025+07:00
2025-10-11 04:59:36,015 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:36.014025+07:00 trong DST: True
2025-10-11 04:59:36,015 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:36,016 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:36,016 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:36,018 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:36,019 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:36,047 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:36,048 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:36,048 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:36,048 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:36,049 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:36,049 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:36,050 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:36,050 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:36,051 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:36,052 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:36,052 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:36,053 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:36,053 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:36,056 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:36,074 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:36,075 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:36,077 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:36,077 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:36,078 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:36,079 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:36,079 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:36,079 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:36,080 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:36,080 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:36,080 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:36,081 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:36,081 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:36,082 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:36,082 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:36,083 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:36,083 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:36,085 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:36,086 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:36,086 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:36,104 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:36,106 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:36,108 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:36,108 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:36,109 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:36,109 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:36,110 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:36.109942+07:00
2025-10-11 04:59:36,110 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:36.109942+07:00
2025-10-11 04:59:36,110 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:36.109942+07:00 trong DST: True
2025-10-11 04:59:36,110 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:36,111 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:36,111 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:36,111 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,112 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:36,112 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:36,113 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:36,114 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,114 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:36,115 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:36,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:36,116 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:36,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:36,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:36,118 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:36,119 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:36,119 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:36,120 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:36,142 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:36,143 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:36,144 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:36,145 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:36,145 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:36,146 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:36,146 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:36,147 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:36,148 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:36,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:36,149 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:36,149 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:36,150 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:36,150 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:36,151 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:36,151 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,152 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:36,153 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:36,153 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:36,154 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:36,154 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:36,154 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:36,174 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:36,179 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:36,181 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:36,182 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:36,182 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:36,184 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:36,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:36,187 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:36,209 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:36,210 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:36,211 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:36,212 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:36,213 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:36,213 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,213 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:36,214 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:36,215 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:36,216 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:36,216 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:36,216 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:36,217 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 04:59:36,217 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:36,219 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:36,220 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:36,246 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:36,248 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:36,248 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:36,249 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,253 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:36,253 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:36,271 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:36,272 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:36,302 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:36,351 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:36,389 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,403 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:36,439 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,469 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:36,475 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:36,476 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:36,477 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:36,478 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:36,511 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:36,630 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.47s
2025-10-11 04:59:36,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:36,852 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:36,853 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:36,854 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:36,857 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:37,182 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:37,183 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:37,184 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:37,187 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:37,187 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:37,189 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:37,189 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:37,190 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:37,215 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:37,216 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:37,217 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:37,217 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:37,218 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:37,218 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:37,219 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:37,219 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:37,262 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:37,720 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:37,722 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:37,722 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:37,723 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:37,723 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:37,724 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:37,724 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:37,725 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:37,727 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:37,727 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:37,728 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:37,728 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:37,734 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:37,758 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:37,759 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:37,760 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:37,762 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:37,763 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:37,763 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:37,764 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:37,767 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:37,770 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:37,791 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:37,792 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:37,795 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:37,796 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:37,796 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:37,797 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:37,797 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:37,797 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:37.797771+07:00
2025-10-11 04:59:37,798 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:37.797771+07:00
2025-10-11 04:59:37,798 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:37.797771+07:00 trong DST: True
2025-10-11 04:59:37,798 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:37,799 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:37,800 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:37,801 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:37,801 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:37,827 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:37,828 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:37,828 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:37,829 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:37,829 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:37,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:37,830 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:37,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:37,831 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:37,831 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:37,832 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:37,832 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:37,834 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:37,834 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:37,835 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:37,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:37,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:37,855 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:37,855 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:37,856 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:37,857 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:37,857 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:37,858 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:37,858 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:37,859 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:37,859 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:37,860 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:37,860 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:37,861 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:37,862 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:37,863 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:37,863 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:37,863 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:37,864 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:37,864 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:37,865 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:37,866 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:37,867 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:37,868 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:37,872 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:37,888 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:37.888865+07:00
2025-10-11 04:59:37,890 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:37.888865+07:00
2025-10-11 04:59:37,891 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:37.888865+07:00 trong DST: True
2025-10-11 04:59:37,891 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:37,892 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:37,892 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:37,893 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:37,893 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:37,894 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:37,894 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:37,894 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:37,895 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:37,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:37,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:37,897 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:37,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:37,898 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:37,899 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:37,899 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:37,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:37,901 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:37,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:37,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:37,925 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:37,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:37,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:37,927 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:37,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:37,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:37,929 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:37,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:37,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:37,931 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:37,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:37,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:37,933 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:37,934 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:37,934 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:37,937 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:37,945 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:37,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:37,957 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:37,957 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:37,958 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:37,959 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:37,959 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:37,959 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:37,960 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:37,960 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:37,960 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:37,961 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:37,962 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:37,962 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:37,962 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:37,963 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:37,963 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:37,964 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:37,964 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:37,964 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:37,965 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:37,966 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:37,967 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:37,969 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:37,993 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:37,993 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:37,994 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:37,995 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:37,999 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:38,001 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:38,003 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:38,025 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:38,026 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:38,027 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:38,028 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:38,028 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:38,029 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:38,029 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:38,029 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:38,030 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:38,031 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 04:59:38,099 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:38,100 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:38,101 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:38,102 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:38,104 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:38,187 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:38,188 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:38,189 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:38,191 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:38,192 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:38,193 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:38,193 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:38,194 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:38,213 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:38,528 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:38,528 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:38,529 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:38,530 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:38,530 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:38,531 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:38,531 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:38,532 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:39,033 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:39,035 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:39,035 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:39,036 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:39,036 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:39,037 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:39,037 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:39,038 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:39,040 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:39,040 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:39,041 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:39,041 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:39,047 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:39,066 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:39,066 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:39,067 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:39,070 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:39,071 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:39,071 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:39,072 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:39,074 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:39,074 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:39,074 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:39,075 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:39,077 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:39,078 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:39,078 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:39,079 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:39,079 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:39,079 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:39.079663+07:00
2025-10-11 04:59:39,080 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:39.079663+07:00
2025-10-11 04:59:39,080 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:39.079663+07:00 trong DST: True
2025-10-11 04:59:39,080 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:39,080 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:39,081 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:39,082 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:39,083 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:39,090 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:39,105 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:39,107 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:39,109 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:39,110 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:39,111 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:39,111 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:39,111 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:39,112 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:39,112 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:39,113 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:39,113 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:39,133 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:39,134 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:39,135 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:39,136 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:39,136 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:39,137 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:39,137 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:39,138 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:39,139 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:39,140 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:39,140 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:39,140 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:39,141 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:39,142 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:39,142 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:39,143 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:39,143 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:39,143 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:39,144 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:39,144 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:39,145 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:39,146 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:39,146 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:39,146 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:39,149 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:39,169 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:39,170 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:39,170 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:39,171 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:39.171067+07:00
2025-10-11 04:59:39,171 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:39.171067+07:00
2025-10-11 04:59:39,171 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:39.171067+07:00 trong DST: True
2025-10-11 04:59:39,172 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:39,172 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:39,172 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:39,173 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,173 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:39,174 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:39,174 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:39,174 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,175 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:39,175 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:39,176 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:39,176 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:39,177 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:39,178 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:39,178 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:39,179 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:39,180 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:39,180 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:39,181 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:39,202 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:39,203 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:39,204 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:39,206 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:39,206 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:39,207 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:39,208 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:39,209 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:39,209 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:39,210 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:39,210 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:39,212 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:39,213 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:39,236 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:39,238 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:39,238 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:39,239 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:39,240 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:39,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:39,279 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:39,281 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:39,312 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,336 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:39,394 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:39,431 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:39,454 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:39,455 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:39,457 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:39,457 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:39,458 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:39,485 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:39,512 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:39,518 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:39,557 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:39,583 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:39,584 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:39,586 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:39,587 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:39,588 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:39,589 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,592 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:39,616 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:39,619 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:39,621 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:39,622 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:39,627 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:39,651 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:39,654 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:39,657 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,682 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:39,714 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:39,717 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:39,717 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:39,720 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:39,720 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:39,721 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,723 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:39,723 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,751 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:39,783 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:39,790 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:39,792 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:39,793 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:39,816 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:39,819 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.63s
2025-10-11 04:59:39,894 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:39,894 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:39,895 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:39,896 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:39,898 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:40,207 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:40,207 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:40,209 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:40,210 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:40,211 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:40,213 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:40,213 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:40,214 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:40,239 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:40,241 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:40,242 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:40,243 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:40,243 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:40,244 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:40,244 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:40,245 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:40,300 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:40,746 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:40,748 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:40,748 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:40,749 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:40,749 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:40,750 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:40,750 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:40,750 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:40,753 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:40,754 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:40,755 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:40,780 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:40,784 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:40,784 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:40,785 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:40,785 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:40,788 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:40,788 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:40,788 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:40,789 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:40,791 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:40,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:40,792 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:40,793 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:40,795 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:40,796 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:40,818 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:40,820 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:40,821 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:40,822 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:40.822183+07:00
2025-10-11 04:59:40,822 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:40.822183+07:00
2025-10-11 04:59:40,823 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:40.822183+07:00 trong DST: True
2025-10-11 04:59:40,823 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:40,824 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:40,824 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:40,825 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:40,826 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:40,832 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:40,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:40,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:40,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:40,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:40,856 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:40,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:40,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:40,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:40,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:40,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:40,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:40,859 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:40,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:40,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:40,862 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:40,862 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:40,882 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:40,883 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:40,886 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:40,887 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:40,887 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:40,888 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:40,888 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:40,888 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:40,889 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:40,889 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:40,890 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:40,890 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:40,891 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:40,891 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:40,892 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:40,892 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:40,892 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:40,893 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:40,893 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:40,894 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:40,894 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:40,894 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:40,895 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:40,896 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:40.896211+07:00
2025-10-11 04:59:40,896 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:40.896211+07:00
2025-10-11 04:59:40,897 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:40.896211+07:00 trong DST: True
2025-10-11 04:59:40,919 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:40,920 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:40,921 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:40,923 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:40,923 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:40,924 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:40,924 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:40,925 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:40,925 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:40,925 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:40,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:40,927 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:40,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:40,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:40,930 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:40,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:40,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:40,954 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:40,954 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:40,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:40,956 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:40,956 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:40,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:40,957 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:40,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:40,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:40,959 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:40,959 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:40,960 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:40,961 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:40,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:40,962 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:40,963 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:40,984 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:40,985 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:40,988 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:40,988 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:40,989 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:40,989 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:40,989 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:40,990 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:40,990 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:40,990 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:40,991 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:40,991 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:40,991 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:40,992 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:40,992 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:40,992 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:40,993 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:40,993 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:40,994 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:40,995 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:40,995 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:40,996 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:40,996 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:41,025 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:41,027 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:41,028 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:41,030 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,040 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:41,041 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:41,051 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:41,053 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:41,054 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:41,055 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,058 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:41,059 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:41,059 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:41,060 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,060 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,061 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:41,062 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:41,062 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:41,062 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:41,063 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:41,079 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:59:41,126 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:41,127 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:41,128 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:41,129 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:41,131 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:41,212 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:41,213 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:41,214 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:41,216 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:41,217 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:41,219 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:41,219 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:41,220 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:41,226 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:41,227 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:41,227 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:41,228 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:41,228 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:41,229 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:41,229 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:41,230 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:41,238 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:41,731 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:41,732 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:41,733 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:41,733 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:41,734 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:41,734 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:41,735 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:41,735 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:41,738 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:41,738 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:41,739 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:41,741 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:41,772 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:41,773 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:41,773 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:41,774 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:41,777 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:41,777 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:41,777 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:41,778 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:41,803 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:41,805 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:41,806 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:41,807 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:41,809 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 04:59:41,809 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:41,810 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:41,813 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:41,813 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:41,815 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:41,815 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:41,816 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:41,816 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:41.816613+07:00
2025-10-11 04:59:41,837 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:41.816613+07:00
2025-10-11 04:59:41,837 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:41.816613+07:00 trong DST: True
2025-10-11 04:59:41,838 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:41,838 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:41,839 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:41,840 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:41,840 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:41,843 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:41,844 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:41,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:41,844 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:41,845 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:41,845 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:41,846 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:41,846 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:41,846 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:41,847 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:41,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:41,848 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:41,848 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:41,848 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:41,849 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:41,849 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:41,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:41,872 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:41,873 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:41,874 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:41,874 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:41,875 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:41,876 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:41,876 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:41,877 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:41,877 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:41,879 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:41,879 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:41,880 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:41,880 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:41,881 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:41,882 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:41,882 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:41,883 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:41,883 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:41,883 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:41,905 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:41,906 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:59:41,907 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:41,908 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:41,908 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:41,909 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:41.909083+07:00
2025-10-11 04:59:41,909 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:41.909083+07:00
2025-10-11 04:59:41,909 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:41.909083+07:00 trong DST: True
2025-10-11 04:59:41,910 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:41,910 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:41,910 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:41,911 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,911 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:41,911 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:41,912 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:41,913 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,913 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:41,913 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:41,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:41,915 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:41,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:41,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:41,916 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:41,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:41,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:41,934 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:41,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:41,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:41,939 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:41,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:41,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:41,941 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:41,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:41,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:41,942 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:41,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:41,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:41,944 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:41,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:41,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:41,946 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:41,946 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,946 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:41,947 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:41,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:41,947 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:41,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:41,948 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:41,949 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:41,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:41,950 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:41,950 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:41,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:41,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:41,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:41,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:41,958 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:41,963 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:41,966 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:41,968 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,972 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:41,973 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:41,975 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:41,975 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:41,976 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:41,977 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:41,978 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:41,979 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:41,980 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:41,980 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:41,980 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:41,981 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:41,987 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:42,007 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:42,008 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:42,009 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,010 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:42,010 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,011 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,012 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:42,012 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:42,012 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:42,013 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:42,013 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:42,015 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 04:59:42,112 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:42,112 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:42,113 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:42,114 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:42,117 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:42,216 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:42,217 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:42,219 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:42,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:42,221 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:42,222 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:42,222 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:42,223 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:42,231 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:42,232 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:42,232 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:42,233 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:42,233 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:42,234 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:42,234 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:42,234 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:42,323 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:42,736 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:42,737 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:42,738 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:42,738 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:42,739 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:42,739 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:42,739 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:42,740 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:42,743 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:42,744 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:42,744 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:42,745 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:42,752 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:42,773 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:42,774 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:42,775 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:42,777 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:42,777 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:42,778 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:42,779 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:42,782 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:42,782 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:42,782 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:42,783 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:42,788 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:42,806 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:42,807 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:42,808 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:42,809 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:42,809 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:42.809668+07:00
2025-10-11 04:59:42,810 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:42.809668+07:00
2025-10-11 04:59:42,810 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:42.809668+07:00 trong DST: True
2025-10-11 04:59:42,810 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:42,811 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:42,811 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:42,812 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:42,812 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:42,816 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:42,816 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:42,817 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:42,818 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:42,819 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:42,822 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:42,841 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:42,841 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:42,843 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:42,843 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:42,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:42,844 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:42,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:42,845 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:42,845 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:42,845 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:42,846 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:42,846 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:42,846 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:42,847 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:42,848 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:42,848 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:42,849 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:42,850 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:42,850 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:42,851 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:42,851 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:42,852 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:42,877 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:42,879 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:42,879 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:42,880 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:42,880 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:42,880 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:42,881 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:42,881 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:42,882 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:42,882 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:42,883 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:42,883 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:42,883 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:42.883810+07:00
2025-10-11 04:59:42,885 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:42.883810+07:00
2025-10-11 04:59:42,885 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:42.883810+07:00 trong DST: True
2025-10-11 04:59:42,886 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:42,886 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:42,889 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:42,906 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,907 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:42,907 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:42,908 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:42,909 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,909 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:42,910 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:42,910 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:42,911 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:42,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:42,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:42,913 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:42,913 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:42,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:42,914 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:42,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:42,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:42,916 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:42,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:42,917 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:42,918 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:42,919 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:42,919 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:42,941 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:42,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:42,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:42,944 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:42,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:42,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:42,945 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:42,946 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,946 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:42,946 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:42,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:42,947 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:42,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:42,948 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:42,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:42,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:42,949 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:42,950 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:42,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:42,950 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:42,951 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:42,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:42,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:42,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:42,952 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:42,953 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,953 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:42,965 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:42,975 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:42,976 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:42,977 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:42,979 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:42,980 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:42,982 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:42,982 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:42,983 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:42,986 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:43,012 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:43,013 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:43,014 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:43,014 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:43,015 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,015 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:43,016 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,017 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,018 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:43,018 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:43,019 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:43,019 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:43,020 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:43,042 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-11 04:59:43,142 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:43,143 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:43,144 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:43,145 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:43,147 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:43,221 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:43,222 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:43,223 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:43,225 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:43,226 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:43,227 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:43,228 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:43,229 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:43,232 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:43,233 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:43,233 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:43,234 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:43,234 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:43,235 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:43,235 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:43,236 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:43,253 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:43,737 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:43,739 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:43,740 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:43,740 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:43,741 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:43,741 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:43,741 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:43,742 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:43,745 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:43,745 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:43,746 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:43,746 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:43,753 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:43,777 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:43,778 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:43,778 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:43,780 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:43,780 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:43,781 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:43,782 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:43,785 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:43,785 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:43,786 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:43,786 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:43,792 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:43,808 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:43,810 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:43,810 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:43,811 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:43,812 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:43.812021+07:00
2025-10-11 04:59:43,812 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:43.812021+07:00
2025-10-11 04:59:43,812 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:43.812021+07:00 trong DST: True
2025-10-11 04:59:43,813 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:43,813 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:43,813 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:43,814 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:43,815 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:43,819 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:43,819 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:43,820 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:43,820 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:43,821 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:43,840 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:43,841 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:43,841 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:43,842 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:43,842 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:43,843 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:43,843 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:43,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:43,844 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:43,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:43,845 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:43,845 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:43,846 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:43,846 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:43,847 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:43,847 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:43,848 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:43,848 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:43,849 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:43,849 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:43,850 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:43,850 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:43,851 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:43,851 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:43,851 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:43,852 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:43,852 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:43,853 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:43,853 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:43,854 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:43,854 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:43,880 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:43,881 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:43,883 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:43,883 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:43,883 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:43.883819+07:00
2025-10-11 04:59:43,884 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:43.883819+07:00
2025-10-11 04:59:43,884 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:43.883819+07:00 trong DST: True
2025-10-11 04:59:43,885 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:43,885 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:43,886 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:43,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,887 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:43,888 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:43,888 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:43,888 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,889 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:43,908 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:43,909 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:43,910 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:43,910 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:43,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:43,912 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:43,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:43,913 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:43,914 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:43,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:43,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:43,915 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:43,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:43,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:43,917 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:43,917 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:43,918 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:43,919 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:43,919 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:43,920 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:43,920 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:43,921 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:43,921 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:43,922 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:43,944 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,948 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:43,949 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:43,949 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:43,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:43,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:43,950 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:43,951 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:43,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:43,951 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:43,951 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:43,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:43,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:43,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:43,954 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:43,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:43,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:43,956 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:43,980 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,980 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:43,981 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:43,981 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:43,982 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:43,982 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:43,983 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:43,984 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:43,985 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:43,986 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:43,987 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:43,987 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:43,992 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:44,013 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:44,014 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:44,014 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:44,015 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:44,015 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:44,016 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:44,016 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:44,017 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:44,017 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:44,018 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:44,018 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:44,019 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:44,021 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 04:59:44,081 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:44,082 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:44,082 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:44,083 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:44,086 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:44,226 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:44,226 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:44,228 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:44,230 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:44,230 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:44,231 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:44,232 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:44,232 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:44,256 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:44,260 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:44,261 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:44,262 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:44,262 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:44,263 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:44,263 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:44,264 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:44,291 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:44,765 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:44,766 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:44,767 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:44,768 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:44,768 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:44,768 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:44,769 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:44,769 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:44,771 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:44,772 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:44,772 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:44,772 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:44,776 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:44,794 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:44,795 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:44,795 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:44,798 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:44,798 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:44,799 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:44,799 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:44,806 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:44,807 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:44,827 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:44,828 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:44,832 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:44,832 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:44,833 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:44,833 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:44,834 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:44,834 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:44.834672+07:00
2025-10-11 04:59:44,835 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:44.834672+07:00
2025-10-11 04:59:44,835 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:44.834672+07:00 trong DST: True
2025-10-11 04:59:44,836 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:44,836 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:44,837 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:44,839 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:44,839 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:44,853 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:44,864 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:44,864 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:44,865 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:44,866 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:44,866 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:44,867 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:44,867 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:44,867 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:44,868 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:44,868 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:44,869 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:44,869 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:44,870 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:44,871 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:44,871 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:44,872 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:44,873 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:44,873 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:44,895 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:44,898 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:44,899 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:44,899 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:44,900 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:44,900 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:44,901 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:44,901 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:44,902 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:44,902 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:44,902 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:44,903 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:44,903 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:44,904 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:44,904 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:44,905 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:44,906 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:44,906 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:44,910 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:44,931 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:44,932 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:44,933 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:44.933597+07:00
2025-10-11 04:59:44,934 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:44.933597+07:00
2025-10-11 04:59:44,934 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:44.933597+07:00 trong DST: True
2025-10-11 04:59:44,935 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:44,935 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:44,936 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:44,936 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:44,937 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:44,937 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:44,937 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:44,938 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:44,938 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:44,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:44,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:44,940 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:44,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:44,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:44,962 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:44,963 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:44,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:44,965 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:44,966 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:44,966 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:44,967 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:44,967 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:44,968 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:44,969 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:44,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:44,970 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:44,971 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:44,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:44,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:44,972 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:44,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:44,974 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:44,974 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:44,983 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:44,990 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:44,997 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:44,998 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:45,000 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:45,001 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:45,001 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:45,002 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:45,002 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:45,003 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:45,003 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:45,003 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:45,004 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:45,004 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:45,004 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:45,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:45,007 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:45,033 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:45,034 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,035 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,036 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:45,036 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:45,037 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:45,037 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:45,039 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:45,040 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:45,065 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:45,065 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:45,065 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,068 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:45,069 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:45,070 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:45,070 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:45,071 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:45,072 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,072 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,072 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,073 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,077 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,094 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:45,095 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:45,095 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:45,096 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:45,097 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:59:45,137 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:45,141 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:45,141 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:45,167 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:45,170 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:45,238 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:45,239 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:45,241 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:45,243 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:45,244 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:45,245 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:45,246 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:45,246 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:45,251 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:45,251 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:45,252 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:45,252 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:45,253 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:45,253 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:45,254 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:45,254 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:45,276 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:45,756 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:45,757 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:45,758 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:45,758 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:45,759 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:45,759 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:45,760 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:45,760 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:45,762 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:45,762 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:45,763 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:45,763 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:45,769 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:45,788 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:45,789 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:45,790 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:45,793 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:45,793 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:45,794 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:45,794 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:45,797 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:45,797 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:45,797 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:45,798 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:45,800 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:45,801 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:45,801 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:45,802 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:45,802 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:45,802 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:45.802729+07:00
2025-10-11 04:59:45,803 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:45.802729+07:00
2025-10-11 04:59:45,803 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:45.802729+07:00 trong DST: True
2025-10-11 04:59:45,803 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:45,803 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:45,804 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:45,805 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:45,805 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:45,812 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:45,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:45,832 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:45,832 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:45,833 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:45,833 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:45,834 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:45,834 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:45,835 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:45,835 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:45,835 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:45,836 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:45,836 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:45,836 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:45,837 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:45,837 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:45,837 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:45,838 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:45,838 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:45,839 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:45,839 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:45,841 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:45,841 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:45,842 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:45,866 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:45,866 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:45,867 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:45,867 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:45,868 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:45,868 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:45,868 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:45,869 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:45,869 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:45,869 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:45,870 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:45,870 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:45,871 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:45,872 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:45,872 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:45,872 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:45,872 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:45.872901+07:00
2025-10-11 04:59:45,873 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:45.872901+07:00
2025-10-11 04:59:45,874 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:45.872901+07:00 trong DST: True
2025-10-11 04:59:45,874 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:45,875 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:45,875 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:45,894 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,895 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,897 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:45,898 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:45,899 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,899 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:45,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:45,901 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:45,901 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:45,902 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:45,902 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:45,902 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:45,903 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:45,903 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:45,904 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:45,905 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:45,905 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:45,905 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:45,906 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:45,906 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:45,907 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:45,908 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:45,908 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:45,909 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:45,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:45,934 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:45,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:45,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:45,937 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:45,937 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,938 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,938 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:45,938 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:45,939 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:45,939 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:45,940 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:45,940 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:45,940 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:45,941 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:45,942 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:45,942 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:45,942 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:45,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:45,943 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:45,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:45,966 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:45,967 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:45,968 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,968 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:45,968 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:45,969 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:45,969 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:45,970 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:45,970 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:45,972 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:45,973 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:45,974 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:45,974 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:45,974 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:45,975 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:45,981 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:46,000 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:46,002 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:46,002 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:46,003 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:46,004 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:46,004 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:46,005 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:46,005 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:46,006 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:46,006 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:46,007 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:46,009 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.77s
2025-10-11 04:59:46,102 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:46,103 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:46,104 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:46,105 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:46,107 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:46,244 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:46,245 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:46,246 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:46,248 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:46,248 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:46,250 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:46,250 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:46,251 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:46,278 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:46,280 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:46,281 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:46,282 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:46,282 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:46,283 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:46,283 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:46,284 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:46,319 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:46,785 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:46,787 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:46,788 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:46,788 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:46,789 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:46,789 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:46,789 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:46,790 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:46,792 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:46,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:46,793 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:46,793 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:46,798 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:46,816 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:46,817 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:46,818 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:46,821 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:46,821 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:46,821 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:46,822 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:46,825 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:46,826 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:46,826 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:46,827 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:46,832 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:46,849 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:46,851 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:46,851 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:46,851 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:46,852 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:46.852147+07:00
2025-10-11 04:59:46,852 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:46.852147+07:00
2025-10-11 04:59:46,853 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:46.852147+07:00 trong DST: True
2025-10-11 04:59:46,853 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:46,853 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:46,853 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:46,855 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:46,855 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:46,858 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:46,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:46,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:46,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:46,863 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:46,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:46,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:46,886 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:46,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:46,887 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:46,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:46,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:46,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:46,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:46,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:46,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:46,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:46,890 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:46,890 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:46,891 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:46,892 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:46,892 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:46,892 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:46,893 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:46,893 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:46,895 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:46,895 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:46,915 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:46,916 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:46,918 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:46,919 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:46,919 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:46,919 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:46,920 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:46,920 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:46,921 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:46,921 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:46,922 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:46,922 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:46,923 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:46,923 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:46.923453+07:00
2025-10-11 04:59:46,923 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:46.923453+07:00
2025-10-11 04:59:46,924 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:46.923453+07:00 trong DST: True
2025-10-11 04:59:46,924 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:46,925 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:46,925 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:46,926 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:46,927 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:46,927 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:46,928 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:46,928 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:46,949 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:46,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:46,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:46,952 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:46,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:46,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:46,954 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:46,954 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:46,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:46,955 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:46,956 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:46,956 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:46,957 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:46,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:46,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:46,959 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:46,960 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:46,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:46,965 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:46,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:46,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:46,987 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:46,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:46,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:46,988 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:46,989 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:46,989 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:46,990 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:46,990 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:46,991 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:46,991 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:46,991 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:46,992 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:46,993 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:46,993 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:46,994 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:46,994 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:47,022 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:47,023 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:47,024 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:47,025 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:47,025 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:47,026 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:47,026 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,027 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:47,027 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:47,028 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:47,028 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:47,028 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:47,032 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:47,053 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:47,055 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:47,056 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:47,056 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,060 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:47,060 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:47,064 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:47,079 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:47,082 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:47,083 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,084 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:47,084 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,085 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,085 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:47,086 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:47,086 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:47,087 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:47,087 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:47,088 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-11 04:59:47,125 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:47,127 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:47,128 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:47,131 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:47,154 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:47,248 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:47,249 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:47,251 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:47,252 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:47,253 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:47,255 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:47,256 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:47,260 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:47,282 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:47,284 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:47,284 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:47,285 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:47,285 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:47,286 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:47,286 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:47,287 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:47,357 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:47,788 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:47,790 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:47,790 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:47,791 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:47,791 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:47,792 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:47,792 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:47,793 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:47,795 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:47,795 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:47,795 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:47,796 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:47,799 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:47,820 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:47,821 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:47,822 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:47,824 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:47,824 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:47,824 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:47,825 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:47,836 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:47,851 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:47,852 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:47,852 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:47,856 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:47,856 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:47,857 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:47,857 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:47,858 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:47,858 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:47.858641+07:00
2025-10-11 04:59:47,859 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:47.858641+07:00
2025-10-11 04:59:47,859 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:47.858641+07:00 trong DST: True
2025-10-11 04:59:47,860 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:47,860 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:47,860 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:47,861 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:47,863 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:47,888 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:47,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:47,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:47,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:47,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:47,891 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:47,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:47,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:47,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:47,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:47,893 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:47,894 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:47,894 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:47,895 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:47,895 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:47,896 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:47,897 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:47,897 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:47,898 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:47,901 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:47,918 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:47,920 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:47,921 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:47,921 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:47,921 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:47,922 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:47,923 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:47,923 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:47,924 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:47,924 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:47,924 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:47,925 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:47,925 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:47,925 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:47,926 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:47,926 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:47,927 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:47,928 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:47,929 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:47,929 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:47,930 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:47.930086+07:00
2025-10-11 04:59:47,930 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:47.930086+07:00
2025-10-11 04:59:47,930 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:47.930086+07:00 trong DST: True
2025-10-11 04:59:47,950 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:47,952 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:47,953 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:47,954 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,955 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:47,955 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:47,956 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:47,956 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,956 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:47,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:47,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:47,958 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:47,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:47,959 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:47,959 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:47,960 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:47,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:47,961 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:47,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:47,963 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:47,964 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:47,964 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:47,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:47,976 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:47,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:47,989 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:47,990 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:47,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:47,991 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:47,992 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:47,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:47,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:47,993 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:47,994 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:47,995 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:47,996 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:47,996 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:47,997 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:48,025 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:48,029 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:48,030 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:48,030 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:48,045 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:48,053 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:48,054 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:48,055 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:48,056 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:48,057 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:48,057 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:48,058 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:48,058 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:48,059 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:48,059 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:48,059 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:48,060 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:48,060 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:48,060 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:48,062 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:48,063 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:48,088 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:48,089 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:48,090 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:48,091 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:48,091 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:48,094 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:48,095 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:48,097 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:48,097 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:48,098 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:48,099 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:48,119 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:48,120 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:48,121 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:48,121 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:48,122 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:48,122 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:48,123 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 04:59:48,157 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:48,158 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:48,159 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:48,159 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:48,162 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:48,253 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:48,254 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:48,255 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:48,257 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:48,258 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:48,259 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:48,259 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:48,260 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:48,287 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:48,477 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:48,478 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:48,479 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:48,479 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:48,480 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:48,480 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:48,481 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:48,481 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:48,983 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:48,984 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:48,985 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:48,985 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:48,986 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:48,986 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:48,987 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:48,987 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:48,990 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:48,990 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:48,990 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:48,991 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:48,997 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:49,022 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,022 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:49,023 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:49,025 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:49,025 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,026 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:49,026 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:49,029 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:49,029 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,030 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:49,031 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:49,036 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:49,054 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:49,055 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:49,055 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:49,056 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:49,056 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:49.056479+07:00
2025-10-11 04:59:49,056 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:49.056479+07:00
2025-10-11 04:59:49,057 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:49.056479+07:00 trong DST: True
2025-10-11 04:59:49,057 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:49,057 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:49,058 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:49,059 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:49,059 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:49,063 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:49,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:49,064 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:49,065 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:49,065 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:49,067 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:49,069 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:49,071 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:49,081 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:49,085 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:49,088 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:49,089 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:49,089 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:49,090 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:49,090 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:49,091 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:49,091 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:49,092 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:49,092 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:49,093 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:49,093 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:49,094 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:49,094 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:49,095 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:49,095 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:49,096 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:49,096 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:49,097 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:49,097 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:49,098 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:49,098 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:49,099 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:49,120 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:49,122 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:49,122 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:49,123 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:49,123 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:49,124 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:49,124 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:49,125 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:49,125 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:49.125335+07:00
2025-10-11 04:59:49,125 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:49.125335+07:00
2025-10-11 04:59:49,126 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:49.125335+07:00 trong DST: True
2025-10-11 04:59:49,126 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:49,126 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:49,127 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:49,127 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,128 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,128 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:49,129 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:49,129 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,129 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:49,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:49,131 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:49,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:49,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:49,133 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:49,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:49,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:49,141 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:49,147 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:49,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:49,154 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:49,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:49,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:49,156 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:49,157 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:49,158 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:49,158 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:49,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:49,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:49,160 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:49,160 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:49,161 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:49,162 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:49,162 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,163 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,163 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:49,164 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:49,164 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:49,164 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:49,165 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:49,165 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:49,165 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:49,166 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:49,166 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:49,166 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:49,169 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:49,177 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:49,181 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:49,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:49,187 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:49,190 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:49,191 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,191 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,192 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:49,192 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:49,193 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:49,194 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:49,195 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:49,196 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:49,197 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,199 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:49,204 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:49,199 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:49,216 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:49,222 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:49,226 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:49,227 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,228 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:49,228 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,229 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,229 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,230 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,230 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:49,231 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:49,231 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:49,232 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:49,253 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.00s
2025-10-11 04:59:49,257 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:49,258 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:49,259 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:49,261 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:49,262 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:49,264 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:49,264 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,265 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:49,293 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:49,294 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:49,294 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:49,295 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:49,296 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:49,296 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:49,296 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:49,297 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:49,298 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:49,299 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:49,299 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:49,319 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:49,333 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:49,351 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:49,830 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:49,831 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:49,832 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:49,832 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:49,833 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:49,833 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:49,833 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:49,834 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:49,836 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:49,837 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,837 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:49,838 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:49,843 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:49,863 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,864 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:49,865 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:49,867 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:49,868 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,868 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:49,871 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:49,893 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:49,894 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:49,894 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:49,895 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:49,897 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:49,898 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:49,900 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:49,900 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:49,901 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:49,901 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:49.901381+07:00
2025-10-11 04:59:49,906 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:49.901381+07:00
2025-10-11 04:59:49,920 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:49.901381+07:00 trong DST: True
2025-10-11 04:59:49,922 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:49,922 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:49,923 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:49,925 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:49,925 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:49,929 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:49,930 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:49,930 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:49,930 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:49,931 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:49,932 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:49,932 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:49,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:49,933 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:49,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:49,934 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:49,955 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:49,955 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:49,956 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:49,957 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:49,958 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:49,958 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:49,959 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:49,959 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:49,960 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:49,960 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:49,961 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:49,961 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:49,962 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:49,962 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:49,963 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:49,963 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:49,964 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:49,964 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:49,964 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:49,965 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:49,965 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:49,966 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:49,966 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:49,967 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:49,967 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:49,992 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:49,995 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:49,995 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:49,996 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:49,996 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:49.996595+07:00
2025-10-11 04:59:49,997 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:49.996595+07:00
2025-10-11 04:59:49,997 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:49.996595+07:00 trong DST: True
2025-10-11 04:59:49,997 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:49,998 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:49,998 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:49,998 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:49,999 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:49,999 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:50,002 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:50,028 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,030 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,031 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:50,032 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:50,033 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:50,033 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:50,034 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:50,035 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:50,057 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:50,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:50,059 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:50,059 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:50,060 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:50,060 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:50,061 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:50,062 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:50,062 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:50,063 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:50,064 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:50,064 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:50,065 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:50,066 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:50,067 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:50,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:50,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:50,094 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:50,094 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,094 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,095 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:50,095 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:50,096 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:50,096 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:50,096 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:50,097 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:50,097 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:50,097 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:50,098 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:50,098 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:50,099 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:50,100 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:50,100 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:50,101 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:50,126 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:50,127 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:50,127 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,128 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,129 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:50,129 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:50,129 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:50,130 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:50,131 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:50,132 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:50,142 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,161 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:50,162 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:50,163 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:50,164 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:50,164 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:50,164 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,168 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:50,169 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,185 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:50,190 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,191 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,192 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,193 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:50,193 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:50,194 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:50,194 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:50,195 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-11 04:59:50,200 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:50,201 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:50,201 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:50,202 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:50,227 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:50,296 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:50,297 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:50,298 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:50,300 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:50,301 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:50,302 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:50,303 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:50,303 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:50,308 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:50,309 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:50,310 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:50,310 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:50,311 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:50,312 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:50,312 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:50,312 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:50,335 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:50,813 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:50,815 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:50,815 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:50,816 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:50,816 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:50,817 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:50,817 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:50,818 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:50,820 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:50,820 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:50,820 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:50,821 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:50,826 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:50,843 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:50,844 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:50,844 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:50,847 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:50,847 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:50,847 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:50,848 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:50,858 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:50,878 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:50,878 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:50,879 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:50,882 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:50,883 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:50,883 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:50,884 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:50,884 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:50,885 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:50.885057+07:00
2025-10-11 04:59:50,886 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:50.885057+07:00
2025-10-11 04:59:50,887 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:50.885057+07:00 trong DST: True
2025-10-11 04:59:50,887 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:50,887 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:50,907 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:50,912 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:50,913 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:50,916 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:50,916 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:50,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:50,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:50,918 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:50,918 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:50,919 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:50,919 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:50,920 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:50,920 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:50,940 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:50,941 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:50,941 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:50,942 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:50,943 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:50,943 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:50,944 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:50,944 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:50,945 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:50,945 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:50,946 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:50,946 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:50,946 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:50,947 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:50,947 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:50,948 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:50,949 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:50,949 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:50,949 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:50,950 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:50,950 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:50,950 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:50,951 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:50,951 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:50,952 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:50,952 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:50,953 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:50,954 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:50,977 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:50,978 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:50,979 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:50.979650+07:00
2025-10-11 04:59:50,980 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:50.979650+07:00
2025-10-11 04:59:50,980 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:50.979650+07:00 trong DST: True
2025-10-11 04:59:50,981 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:50,981 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:50,982 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:50,982 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,982 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,983 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:50,983 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:50,983 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:50,984 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:50,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:50,985 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:50,986 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:50,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:50,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:51,015 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:51,016 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:51,017 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:51,019 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:51,019 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:51,020 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:51,043 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:51,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:51,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:51,046 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:51,046 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:51,047 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:51,047 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:51,048 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:51,049 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:51,049 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:51,050 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:51,051 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:51,052 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:51,053 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:51,077 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:51,079 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:51,080 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:51,080 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:51,081 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:51,082 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:51,082 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:51,082 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:51,082 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:51,083 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:51,083 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:51,083 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:51,084 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:51,084 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:51,085 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:51,086 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:51,087 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:51,110 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:51,111 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:51,112 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:51,112 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:51,113 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:51,113 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:51,114 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:51,115 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:51,116 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:51,117 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:51,118 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:51,119 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:51,124 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:51,142 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:51,143 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:51,143 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:51,144 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:51,145 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:51,145 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:51,145 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:51,146 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:51,146 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:51,146 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:51,147 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:51,147 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:51,149 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 04:59:51,180 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:51,181 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:51,182 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:51,182 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:51,185 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:51,301 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:51,302 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:51,303 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:51,305 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:51,306 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:51,307 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:51,307 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:51,308 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:51,338 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:51,339 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:51,339 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:51,340 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:51,358 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:51,362 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:51,363 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:51,363 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:51,396 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:51,865 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:51,866 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:51,867 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:51,867 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:51,868 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:51,868 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:51,869 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:51,869 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:51,871 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:51,871 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:51,872 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:51,873 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:51,878 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:51,895 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:51,897 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:51,898 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:51,900 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:51,901 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:51,901 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:51,902 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:51,905 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:51,905 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:51,905 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:51,928 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:51,931 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:51,932 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:51,932 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:51,933 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:51,933 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:51,934 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:51.934031+07:00
2025-10-11 04:59:51,934 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:51.934031+07:00
2025-10-11 04:59:51,934 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:51.934031+07:00 trong DST: True
2025-10-11 04:59:51,935 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:51,935 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:51,935 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:51,937 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:51,938 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:51,945 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:51,961 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:51,962 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:51,963 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:51,964 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:51,964 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:51,964 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:51,965 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:51,965 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:51,965 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:51,966 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:51,966 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:51,966 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:51,967 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:51,967 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:51,968 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:51,968 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:51,969 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:51,970 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:51,970 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:51,971 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:51,972 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:51,972 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:51,994 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:51,995 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:51,996 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:51,997 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:51,997 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:51,997 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:51,998 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:51,998 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:51,999 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:51,999 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:52,000 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:52,000 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:52,001 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:52,001 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:52,002 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:52,002 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:52,002 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:52,004 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:52.004383+07:00
2025-10-11 04:59:52,005 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:52.004383+07:00
2025-10-11 04:59:52,005 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:52.004383+07:00 trong DST: True
2025-10-11 04:59:52,005 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:52,030 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:52,031 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:52,032 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,032 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:52,033 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:52,033 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:52,034 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,034 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:52,034 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:52,035 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:52,036 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:52,036 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:52,038 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:52,038 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:52,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:52,063 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:52,064 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:52,065 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:52,066 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:52,066 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:52,067 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:52,067 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:52,068 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:52,068 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:52,069 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:52,071 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:52,071 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:52,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:52,096 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:52,099 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:52,100 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:52,101 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:52,101 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,101 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:52,102 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:52,102 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:52,102 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:52,103 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:52,104 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:52,105 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:52,105 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:52,106 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:52,127 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:52,128 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:52,128 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:52,129 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:52,129 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:52,130 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:52,130 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:52,131 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:52,131 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,132 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:52,132 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:52,132 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:52,133 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:52,133 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:52,134 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:52,135 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:52,137 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,138 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:52,139 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:52,139 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:52,145 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:52,165 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:52,167 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:52,168 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:52,168 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,169 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:52,169 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,170 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:52,170 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:52,171 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:52,172 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:52,173 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:52,173 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:52,191 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.89s
2025-10-11 04:59:52,232 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:52,233 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:52,233 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:52,234 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:52,236 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:52,306 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:52,306 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:52,308 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:52,310 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:52,310 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:52,312 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:52,312 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:52,313 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:52,337 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:52,436 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:52,444 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:52,473 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:52,500 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:52,504 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:52,541 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:52,547 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:52,549 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:53,050 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:53,052 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:53,052 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:53,053 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:53,053 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:53,054 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:53,054 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:53,054 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:53,056 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:53,057 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:53,057 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:53,058 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:53,063 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:53,080 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:53,080 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:53,081 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:53,083 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:53,085 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:53,085 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:53,086 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:53,088 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:53,088 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:53,089 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:53,089 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:53,094 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:53,113 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:53,114 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:53,115 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:53,116 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:53,116 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:53.116775+07:00
2025-10-11 04:59:53,117 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:53.116775+07:00
2025-10-11 04:59:53,117 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:53.116775+07:00 trong DST: True
2025-10-11 04:59:53,117 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:53,118 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:53,118 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:53,119 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:53,120 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:53,124 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:53,124 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:53,125 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:53,125 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:53,144 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:53,144 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:53,145 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:53,146 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:53,146 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:53,147 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:53,148 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:53,148 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:53,148 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:53,149 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:53,149 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:53,150 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:53,151 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:53,151 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:53,152 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:53,153 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:53,154 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:53,154 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:53,155 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:53,155 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:53,156 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:53,156 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:53,158 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:53,158 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:53,159 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:53,159 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:53,183 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:53,185 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:53,186 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:53,186 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:53,187 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:53,187 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:53,188 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:53,189 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:53,189 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:53,189 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:53,190 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:53.190273+07:00
2025-10-11 04:59:53,190 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:53.190273+07:00
2025-10-11 04:59:53,191 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:53.190273+07:00 trong DST: True
2025-10-11 04:59:53,192 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:53,192 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:53,193 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:53,193 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,193 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:53,213 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:53,214 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:53,214 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,215 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:53,217 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:53,218 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:53,218 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:53,219 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:53,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:53,220 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:53,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:53,221 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:53,221 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:53,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:53,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:53,223 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:53,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:53,224 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:53,225 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:53,225 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:53,226 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:53,251 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:53,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:53,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:53,253 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:53,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:53,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:53,255 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:53,255 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,256 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:53,256 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:53,257 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:53,258 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:53,258 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:53,258 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:53,259 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:53,259 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:53,283 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:53,285 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:53,285 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:53,286 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:53,286 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:53,286 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:53,287 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:53,288 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:53,288 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:53,289 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,289 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:53,289 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:53,290 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:53,290 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:53,292 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:53,292 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:53,317 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:53,321 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:53,323 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,324 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:53,325 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:53,326 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:53,326 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:53,326 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:53,332 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:53,350 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:53,351 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:53,352 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:53,352 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:53,353 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:53,354 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,354 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 04:59:53,355 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:53,356 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,356 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:53,356 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:53,357 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:53,357 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:53,357 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:53,359 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:53,362 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.05s
2025-10-11 04:59:53,381 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:53,502 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:53,503 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:53,503 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:53,504 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:53,506 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:54,327 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:54,327 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:54,329 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:54,331 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:54,332 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:54,333 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:54,334 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:54,334 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:54,367 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:54,368 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:54,368 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:54,369 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:54,369 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:54,370 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:54,370 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:54,371 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:54,376 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:54,872 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:54,874 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:54,874 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:54,874 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:54,875 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:54,875 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:54,876 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:54,876 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:54,878 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:54,879 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:54,879 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:54,880 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:54,886 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:54,903 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:54,904 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:54,905 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:54,907 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:54,907 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:54,907 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:54,908 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:54,910 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:54,911 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:54,912 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:54,912 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:54,918 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:54,938 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:54,938 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:54,939 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:54,939 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:54,940 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:54.940090+07:00
2025-10-11 04:59:54,940 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:54.940090+07:00
2025-10-11 04:59:54,940 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:54.940090+07:00 trong DST: True
2025-10-11 04:59:54,941 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:54,941 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:54,942 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:54,943 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:54,943 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:54,946 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:54,946 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:54,947 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:54,947 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:54,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:54,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:54,949 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:54,949 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:54,952 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:54,968 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:54,969 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:54,970 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:54,970 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:54,971 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:54,972 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:54,972 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:54,973 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:54,973 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:54,974 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:54,974 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:54,975 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:54,975 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:54,976 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:54,976 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:54,977 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:54,978 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:54,978 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:54,979 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:54,979 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:54,979 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:54,980 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:54,980 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:54,980 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:54,980 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:54,981 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:54,982 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:54,982 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:54,983 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:54,985 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:55,013 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:55,015 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:55.015257+07:00
2025-10-11 04:59:55,015 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:55.015257+07:00
2025-10-11 04:59:55,016 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:55.015257+07:00 trong DST: True
2025-10-11 04:59:55,025 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:55,037 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:55,038 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:55,039 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,039 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:55,040 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:55,040 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:55,040 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,041 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:55,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:55,042 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:55,042 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:55,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:55,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:55,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:55,044 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:55,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:55,045 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:55,046 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:55,046 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:55,047 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:55,047 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:55,049 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:55,049 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:55,050 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:55,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:55,073 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:55,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:55,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:55,077 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:55,077 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:55,078 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:55,078 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:55,079 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,079 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:55,079 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:55,080 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:55,080 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:55,081 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:55,081 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:55,082 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:55,082 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:55,082 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:55,083 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:55,083 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:55,106 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:55,107 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:55,108 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:55,109 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:55,109 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:55,109 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:55,110 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,110 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:55,111 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:55,111 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:55,112 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:55,112 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:55,113 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:55,114 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:55,117 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,127 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:55,131 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:55,142 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:55,146 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:55,146 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:55,147 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:55,172 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:55,173 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,174 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:55,175 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,175 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:55,176 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:55,176 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:55,177 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:55,177 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:55,178 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:55,179 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 04:59:55,215 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:55,216 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:55,239 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:55,242 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:55,245 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:55,331 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:55,332 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:55,333 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:55,335 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:55,336 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:55,337 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:55,338 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:55,339 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:55,362 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:55,363 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:55,363 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:55,376 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:55,397 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:55,456 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:55,471 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:55,491 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:55,562 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:56,076 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:56,077 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:56,078 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:56,078 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:56,079 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:56,079 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:56,080 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:56,080 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:56,082 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:56,083 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:56,083 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:56,084 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:56,090 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:56,108 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:56,109 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:56,109 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:56,112 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:56,112 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:56,112 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:56,113 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:56,117 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:56,117 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:56,139 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:56,140 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:56,144 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:56,145 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:56,145 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:56,146 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:56,146 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:56,147 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:56.147186+07:00
2025-10-11 04:59:56,147 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:56.147186+07:00
2025-10-11 04:59:56,148 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:56.147186+07:00 trong DST: True
2025-10-11 04:59:56,148 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:56,149 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:56,149 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:56,151 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:56,151 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:56,158 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:56,176 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:56,178 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:56,178 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:56,178 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:56,179 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:56,179 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:56,179 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:56,180 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:56,180 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:56,180 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:56,181 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:56,181 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:56,181 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:56,182 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:56,182 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:56,184 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:56,184 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:56,185 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:56,185 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:56,207 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:56,207 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:56,208 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:56,209 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:56,209 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:56,210 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:56,211 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:56,212 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:56,212 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:56,213 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:56,213 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:56,213 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:56,214 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:56,214 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:56,214 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:56,215 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:56,216 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:56,216 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:56,217 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:56,218 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:56,218 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:56.218662+07:00
2025-10-11 04:59:56,221 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:56.218662+07:00
2025-10-11 04:59:56,241 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:56.218662+07:00 trong DST: True
2025-10-11 04:59:56,242 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:56,243 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:56,244 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:56,244 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,245 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:56,245 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:56,245 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:56,246 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,246 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:56,247 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:56,247 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:56,248 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:56,248 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:56,249 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:56,249 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:56,251 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:56,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:56,257 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:56,278 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:56,279 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:56,279 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:56,280 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:56,281 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:56,281 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:56,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:56,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:56,283 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:56,283 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:56,284 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:56,285 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:56,286 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:56,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:56,311 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:56,312 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,313 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:56,313 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:56,314 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:56,315 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:56,316 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:56,317 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:56,317 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:56,318 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:56,318 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:56,318 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:56,321 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:56,334 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:56,342 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:56,344 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:56,344 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:56,345 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:56,346 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:56,346 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:56,347 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,348 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:56,348 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:56,349 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:56,350 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:56,351 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:56,375 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:56,378 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:56,379 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:56,380 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 04:59:56,380 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:56,382 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:56,383 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:56,385 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,406 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:56,408 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:56,408 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:56,408 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:56,411 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:56,412 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:56,413 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:56,413 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,413 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:56,414 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,414 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:56,415 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:56,415 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:56,415 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:56,416 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:56,459 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:56,500 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:56,722 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.39s
2025-10-11 04:59:56,901 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:56,901 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 04:59:56,903 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 04:59:56,903 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:56,904 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:56,905 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:56,905 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:56,908 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:56,910 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 04:59:57,344 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:57,345 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:57,346 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:57,348 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:57,349 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:57,350 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:57,350 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:57,351 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:57,378 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:57,378 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:57,380 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:57,380 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:57,381 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:57,381 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:57,382 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:57,382 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:57,415 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:57,883 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:57,884 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:57,885 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:57,885 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:57,886 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:57,887 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:57,887 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:57,887 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:57,890 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:57,890 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:57,891 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:57,891 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:57,897 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:57,915 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:57,915 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:57,916 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:57,918 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:57,918 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:57,919 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:57,920 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:57,924 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:57,942 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:57,943 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:57,944 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:57,946 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:57,947 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:57,948 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:57,948 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:57,949 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:57,949 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:57.949609+07:00
2025-10-11 04:59:57,950 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:57.949609+07:00
2025-10-11 04:59:57,950 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:57.949609+07:00 trong DST: True
2025-10-11 04:59:57,950 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:57,969 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:57,970 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:57,972 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:57,975 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:57,978 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:57,978 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:57,979 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:57,979 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:57,979 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:57,980 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:57,980 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:57,981 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:57,981 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:57,982 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:57,982 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:57,982 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:57,983 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:57,985 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:58,004 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:58,006 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:58,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:58,007 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:58,008 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:58,009 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:58,009 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:58,010 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:58,010 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:58,011 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:58,011 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:58,012 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:58,012 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:58,012 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:58,013 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:58,013 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:58,015 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:58,015 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:58,016 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:58,016 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:58,040 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:58,042 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:58,043 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:58,044 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:58,044 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:58,045 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:58,045 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:58.045380+07:00
2025-10-11 04:59:58,045 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:58.045380+07:00
2025-10-11 04:59:58,046 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:58.045380+07:00 trong DST: True
2025-10-11 04:59:58,046 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:58,046 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:58,047 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:58,047 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,048 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:58,048 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:58,048 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:58,049 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,049 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:58,050 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:58,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:58,074 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:58,075 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:58,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:58,076 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:58,077 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:58,077 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:58,078 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:58,078 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:58,079 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:58,079 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:58,079 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:58,080 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:58,082 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:58,082 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:58,085 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:58,106 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:58,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:58,109 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:58,110 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:58,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:58,111 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:58,113 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:58,113 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,114 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:58,114 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:58,115 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:58,115 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:58,116 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:58,116 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:58,116 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:58,119 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:58,141 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:58,141 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:58,142 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:58,142 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:58,143 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:58,143 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:58,144 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:58,144 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:58,144 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:58,145 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,145 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:58,146 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:58,146 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:58,146 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:58,147 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:58,148 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:58,174 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:58,176 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,178 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:58,178 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:58,178 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:58,182 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:58,183 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:58,190 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:58,201 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:58,203 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,203 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:58,203 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,204 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:58,204 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:58,205 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:58,205 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:58,206 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:58,206 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:58,207 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-11 04:59:58,245 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:58,246 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:58,246 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:58,250 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:58,276 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:58,369 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:58,370 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:58,372 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 04:59:58,373 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:58,374 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:58,375 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:58,376 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:58,376 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 04:59:58,377 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:58,589 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:58,590 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:58,591 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:58,591 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 04:59:58,592 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 04:59:58,592 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 04:59:58,593 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 04:59:58,593 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 04:59:59,094 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 04:59:59,096 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 04:59:59,097 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 04:59:59,097 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 04:59:59,098 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 04:59:59,098 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 04:59:59,098 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 04:59:59,099 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:59,101 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 04:59:59,102 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:59,102 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 04:59:59,103 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 04:59:59,108 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 04:59:59,126 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:59,126 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 04:59:59,127 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 04:59:59,130 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 04:59:59,131 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:59,131 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 04:59:59,132 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 04:59:59,134 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 04:59:59,135 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:59,135 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 04:59:59,135 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 04:59:59,141 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:59,157 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 04:59:59,159 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 04:59:59,160 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 04:59:59,160 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:59,160 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:59.160783+07:00
2025-10-11 04:59:59,162 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:59.160783+07:00
2025-10-11 04:59:59,162 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:59.160783+07:00 trong DST: True
2025-10-11 04:59:59,162 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:59,163 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:59,163 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 04:59:59,164 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 04:59:59,165 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 04:59:59,171 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 04:59:59,192 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:59,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 04:59:59,193 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:59,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 04:59:59,194 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 04:59:59,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 04:59:59,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 04:59:59,196 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 04:59:59,196 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 04:59:59,196 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 04:59:59,197 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 04:59:59,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 04:59:59,198 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 04:59:59,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 04:59:59,199 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 04:59:59,199 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 04:59:59,200 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 04:59:59,201 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 04:59:59,205 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 04:59:59,221 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:59,223 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 04:59:59,226 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 04:59:59,227 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 04:59:59,227 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 04:59:59,228 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 04:59:59,229 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 04:59:59,229 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 04:59:59,230 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 04:59:59,230 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 04:59:59,231 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 04:59:59,231 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 04:59:59,231 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 04:59:59,232 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 04:59:59,232 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:59,232 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 04:59:59,233 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 04:59:59,234 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 04:59:59,234 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 04:59:59,235 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 04:59:59,259 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 11:59:59.259072+07:00
2025-10-11 04:59:59,261 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 11:59:59.259072+07:00
2025-10-11 04:59:59,262 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 11:59:59.259072+07:00 trong DST: True
2025-10-11 04:59:59,262 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 04:59:59,263 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 04:59:59,263 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 61
2025-10-11 04:59:59,264 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,264 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:59,265 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 04:59:59,265 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 04:59:59,265 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,266 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:59,266 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:59,267 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:59,268 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:59,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:59,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:59,269 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 04:59:59,288 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 04:59:59,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 04:59:59,291 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:59,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 04:59:59,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:59,293 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 04:59:59,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 04:59:59,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 04:59:59,295 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 04:59:59,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 04:59:59,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:59,296 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 04:59:59,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 04:59:59,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 04:59:59,300 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 04:59:59,301 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 04:59:59,303 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 04:59:59,324 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 04:59:59,325 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,326 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:59,327 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:59,327 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:59,328 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:59,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:59,329 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:59,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:59,330 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:59,330 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:59,330 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 04:59:59,330 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 04:59:59,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 04:59:59,331 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 04:59:59,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 04:59:59,333 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 04:59:59,333 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 04:59:59,333 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 04:59:59,334 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,334 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:59,356 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 04:59:59,357 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 04:59:59,358 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 04:59:59,359 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 04:59:59,360 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:59,361 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 04:59:59,362 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,363 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 04:59:59,363 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 04:59:59,363 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 04:59:59,364 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 04:59:59,367 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 04:59:59,368 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 04:59:59,372 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 04:59:59,391 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 04:59:59,392 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,394 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 04:59:59,395 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:59,396 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 04:59:59,396 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,397 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 04:59:59,398 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 04:59:59,398 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 04:59:59,399 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 04:59:59,399 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 04:59:59,401 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 04:59:59,401 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 04:59:59,403 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 04:59:59,407 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:59,424 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 04:59:59,538 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.17s
2025-10-11 04:59:59,553 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 04:59:59,554 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 04:59:59,554 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 04:59:59,555 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 04:59:59,558 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:00,397 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:00,398 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:00,399 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:00,401 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:00,402 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:00,403 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:00,403 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:00,405 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:00,428 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:00,641 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:00,642 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:00,643 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:00,643 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:00,643 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:00,644 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:00,644 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:00,645 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:01,146 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:01,148 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:01,148 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:01,148 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:01,149 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:01,150 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:01,150 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:01,151 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:01,152 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:01,153 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:01,153 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:01,154 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:01,159 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:01,179 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:01,181 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:01,182 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:01,184 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:01,184 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:01,185 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:01,186 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:01,189 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:01,189 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:01,191 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:01,210 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:01,215 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:01,216 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:01,216 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:01,217 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:01,217 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:01,217 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:01.217876+07:00
2025-10-11 05:00:01,218 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:01.217876+07:00
2025-10-11 05:00:01,218 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:01.217876+07:00 trong DST: True
2025-10-11 05:00:01,219 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:01,219 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:01,219 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:01,221 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:01,221 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:01,229 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:01,245 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:01,246 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:01,247 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:01,248 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:01,248 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:01,249 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:01,250 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:01,250 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:01,250 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:01,251 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:01,251 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:01,252 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:01,252 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:01,253 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:01,253 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:01,253 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:01,254 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:01,254 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:01,256 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:01,256 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:01,267 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:01,276 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:01,277 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:01,278 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:01,279 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:01,279 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:01,280 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:01,280 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:01,281 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:01,281 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:01,281 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:01,282 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:01,282 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:01,283 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:01,283 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:01,283 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:01,284 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:01,285 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:01,285 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:01,285 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:01.285633+07:00
2025-10-11 05:00:01,286 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:01.285633+07:00
2025-10-11 05:00:01,286 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:01.285633+07:00 trong DST: True
2025-10-11 05:00:01,286 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:01,287 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:01,287 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:01,288 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,288 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:01,289 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:01,289 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:01,290 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,294 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:01,311 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:01,314 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:01,335 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:01,338 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:01,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:01,363 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:01,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:01,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:01,365 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:01,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:01,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:01,366 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:01,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:01,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:01,368 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:01,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:01,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:01,370 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:01,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:01,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:01,372 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:01,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:01,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:01,373 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:01,374 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,397 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:01,399 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:01,400 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:01,400 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:01,400 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:01,401 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:01,401 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:01,402 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:01,402 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:01,403 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:01,403 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:01,405 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:01,406 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:01,406 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:01,430 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:01,432 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:01,433 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:01,434 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:01,434 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:01,434 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,435 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:01,436 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:01,437 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:01,438 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:01,438 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:01,439 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:01,442 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 05:00:01,464 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:01,466 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:01,466 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:01,545 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:01,635 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:01,700 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,702 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:01,703 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:01,703 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:01,740 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:01,768 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:01,804 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:01,826 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:01,829 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,830 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:01,832 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,833 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:01,837 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:01,859 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:01,860 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:01,864 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:01,866 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:01,885 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.49s
2025-10-11 05:00:01,997 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:01,998 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:01,998 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:02,001 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:02,006 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:02,403 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:02,404 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:02,405 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:02,407 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:02,408 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:02,409 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:02,409 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:02,411 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:02,438 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:02,439 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:02,440 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:02,440 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:02,441 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:02,459 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:02,459 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:02,460 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:02,511 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:02,962 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:02,963 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:02,964 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:02,964 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:02,965 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:02,965 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:02,966 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:02,966 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:02,968 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:02,968 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:02,969 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:02,969 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:02,975 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:02,992 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:02,993 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:02,995 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:02,997 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:02,998 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:02,998 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:02,999 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:03,001 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:03,002 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:03,002 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:03,002 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:03,006 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:03,032 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:03,033 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:03,034 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:03,034 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:03,034 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:03.034933+07:00
2025-10-11 05:00:03,035 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:03.034933+07:00
2025-10-11 05:00:03,035 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:03.034933+07:00 trong DST: True
2025-10-11 05:00:03,036 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:03,036 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:03,036 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:03,038 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:03,038 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:03,046 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:03,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:03,063 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:03,064 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:03,064 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:03,064 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:03,065 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:03,065 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:03,065 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:03,066 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:03,066 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:03,067 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:03,067 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:03,067 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:03,068 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:03,068 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:03,068 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:03,069 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:03,069 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:03,070 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:03,070 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:03,071 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:03,071 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:03,072 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:03,072 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:03,073 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:03,073 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:03,092 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:03,093 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:03,094 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:03,095 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:03,095 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:03,095 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:03,096 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:03,097 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:03,097 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:03,097 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:03,098 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:03,098 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:03,099 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:03,099 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:03.099346+07:00
2025-10-11 05:00:03,099 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:03.099346+07:00
2025-10-11 05:00:03,100 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:03.099346+07:00 trong DST: True
2025-10-11 05:00:03,100 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:03,100 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:03,101 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:03,101 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,102 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:03,102 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:03,102 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:03,103 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,103 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:03,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:03,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:03,105 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:03,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:03,109 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:03,127 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:03,128 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:03,128 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:03,129 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:03,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:03,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:03,131 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:03,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:03,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:03,133 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:03,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:03,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:03,134 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:03,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:03,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:03,136 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:03,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:03,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:03,138 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:03,138 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,139 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:03,139 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:03,139 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:03,140 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:03,140 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:03,140 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:03,161 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:03,163 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:03,163 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:03,163 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:03,164 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:03,164 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:03,165 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:03,165 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:03,165 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:03,166 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:03,166 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:03,167 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,167 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:03,168 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:03,168 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:03,168 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:03,169 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:03,169 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:03,170 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:03,173 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,196 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:03,201 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:03,205 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:03,206 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:03,206 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:03,225 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:03,228 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:03,229 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,230 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:03,230 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,231 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:03,231 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:03,232 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:03,232 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:03,232 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:03,233 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:03,234 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.83s
2025-10-11 05:00:03,334 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:03,335 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:03,335 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:03,338 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:03,341 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:03,408 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:03,408 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:03,410 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:03,411 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:03,412 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:03,413 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:03,414 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:03,415 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:03,421 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:03,421 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:03,422 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:03,422 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:03,423 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:03,423 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:03,424 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:03,424 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:03,443 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:03,944 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:03,946 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:03,946 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:03,947 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:03,947 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:03,948 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:03,948 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:03,949 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:03,951 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:03,951 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:03,952 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:03,953 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:03,958 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:03,975 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:03,977 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:03,978 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:03,980 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:03,980 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:03,981 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:03,981 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:03,987 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:03,987 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:03,988 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:03,988 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:03,994 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:04,017 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:04,018 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:04,019 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:04,019 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:04,020 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:04.020036+07:00
2025-10-11 05:00:04,020 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:04.020036+07:00
2025-10-11 05:00:04,020 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:04.020036+07:00 trong DST: True
2025-10-11 05:00:04,021 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:04,021 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:04,021 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:04,023 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:04,023 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:04,031 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:04,049 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:04,049 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:04,050 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:04,050 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:04,051 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:04,051 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:04,052 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:04,052 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:04,053 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:04,053 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:04,054 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:04,054 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:04,054 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:04,055 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:04,055 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:04,056 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:04,056 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:04,056 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:04,057 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:04,059 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:04,060 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:04,081 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:04,081 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:04,082 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:04,083 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:04,083 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:04,084 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:04,084 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:04,084 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:04,085 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:04,085 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:04,085 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:04,086 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:04,086 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:04,087 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:04,087 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:04,088 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:04,088 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:04,088 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:04,089 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:04.089219+07:00
2025-10-11 05:00:04,089 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:04.089219+07:00
2025-10-11 05:00:04,090 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:04.089219+07:00 trong DST: True
2025-10-11 05:00:04,090 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:04,090 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:04,091 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:04,091 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,092 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:04,092 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:04,093 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:04,093 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,094 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:04,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:04,104 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:04,106 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:04,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:04,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:04,116 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:04,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:04,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:04,118 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:04,118 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:04,119 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:04,119 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:04,120 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:04,120 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:04,121 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:04,122 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:04,122 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:04,123 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:04,123 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:04,124 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:04,125 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:04,126 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:04,127 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:04,132 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:04,146 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,151 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:04,152 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:04,152 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:04,153 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:04,153 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:04,153 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:04,154 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:04,154 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:04,154 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:04,155 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:04,155 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:04,155 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:04,156 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:04,156 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:04,156 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:04,157 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:04,157 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:04,157 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,158 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:04,159 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:04,159 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:04,160 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:04,160 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:04,161 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:04,185 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:04,188 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,189 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:04,190 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:04,190 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:04,191 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:04,196 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:04,213 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:04,214 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:04,215 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,216 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:04,216 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,217 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:04,217 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:04,217 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:04,218 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:04,218 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:04,219 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:04,220 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.81s
2025-10-11 05:00:04,290 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:04,291 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:04,291 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:04,293 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:04,295 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:04,412 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:04,413 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:04,414 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:04,416 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:04,417 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:04,418 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:04,419 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:04,419 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:04,448 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:04,449 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:04,450 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:04,450 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:04,451 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:04,452 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:04,452 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:04,452 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:04,504 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:04,953 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:04,955 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:04,956 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:04,956 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:04,957 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:04,957 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:04,957 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:04,958 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:04,960 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:04,961 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:04,961 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:04,962 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:04,968 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:04,986 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:04,987 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:04,987 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:04,990 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:04,990 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:04,991 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:04,991 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:04,994 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:04,995 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:04,995 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:04,996 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:04,998 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:04,999 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:05,000 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:05,000 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:05,001 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:05,029 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:05.029532+07:00
2025-10-11 05:00:05,032 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:05.029532+07:00
2025-10-11 05:00:05,032 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:05.029532+07:00 trong DST: True
2025-10-11 05:00:05,033 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:05,034 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:05,034 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:05,036 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:05,058 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:05,062 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:05,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:05,064 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:05,064 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:05,064 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:05,065 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:05,065 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:05,066 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:05,066 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:05,067 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:05,068 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:05,068 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:05,069 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:05,069 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:05,088 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:05,090 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:05,091 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:05,091 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:05,092 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:05,092 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:05,093 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:05,093 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:05,094 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:05,094 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:05,095 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:05,095 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:05,096 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:05,096 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:05,097 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:05,097 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:05,097 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:05,098 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:05,098 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:05,099 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:05,099 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:05,099 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:05,100 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:05,100 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:05,101 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:05,101 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:05,102 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:05.102191+07:00
2025-10-11 05:00:05,102 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:05.102191+07:00
2025-10-11 05:00:05,103 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:05.102191+07:00 trong DST: True
2025-10-11 05:00:05,103 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:05,105 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:05,125 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:05,126 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,127 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:05,127 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:05,128 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:05,128 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,129 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:05,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:05,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:05,130 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:05,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:05,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:05,132 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:05,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:05,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:05,133 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:05,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:05,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:05,162 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:05,163 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:05,163 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:05,164 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:05,164 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:05,165 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:05,166 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:05,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:05,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:05,169 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:05,194 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:05,195 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:05,197 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:05,197 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,198 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:05,198 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:05,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:05,199 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:05,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:05,200 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:05,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:05,200 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:05,201 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:05,203 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:05,203 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:05,228 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:05,228 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:05,229 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:05,230 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:05,230 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:05,230 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:05,231 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,231 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:05,232 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:05,232 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:05,233 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:05,233 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:05,234 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:05,235 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:05,262 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,263 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:05,264 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:05,264 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:05,265 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:05,268 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:05,269 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:05,286 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:05,287 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,287 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:05,288 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,288 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:05,289 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:05,289 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:05,289 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:05,290 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:05,290 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:05,297 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-11 05:00:05,333 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:05,352 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:05,353 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:05,356 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:05,380 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:05,426 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:05,427 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:05,428 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:05,430 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:05,430 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:05,432 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:05,432 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:05,433 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:05,440 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:05,440 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:05,441 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:05,442 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:05,442 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:05,443 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:05,462 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:05,463 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:05,503 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:05,965 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:05,966 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:05,967 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:05,968 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:05,968 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:05,969 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:05,969 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:05,969 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:05,971 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:05,972 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:05,972 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:05,973 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:05,979 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:05,996 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:05,997 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:05,998 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:06,001 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:06,002 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:06,002 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:06,003 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:06,006 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:06,006 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:06,007 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:06,008 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:06,014 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:06,035 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:06,037 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:06,038 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:06,038 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:06,039 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:06.039268+07:00
2025-10-11 05:00:06,039 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:06.039268+07:00
2025-10-11 05:00:06,040 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:06.039268+07:00 trong DST: True
2025-10-11 05:00:06,040 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:06,040 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:06,041 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:06,042 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:06,042 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:06,048 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:06,068 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:06,069 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:06,070 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:06,070 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:06,070 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:06,071 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:06,071 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:06,072 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:06,072 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:06,073 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:06,073 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:06,073 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:06,074 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:06,074 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:06,074 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:06,075 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:06,075 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:06,076 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:06,076 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:06,077 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:06,077 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:06,078 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:06,079 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:06,079 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:06,079 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:06,080 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:06,101 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:06,102 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:06,102 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:06,103 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:06,103 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:06,104 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:06,104 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:06,104 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:06,105 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:06,106 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:06,106 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:06,106 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:06,107 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:06,107 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:06.107543+07:00
2025-10-11 05:00:06,107 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:06.107543+07:00
2025-10-11 05:00:06,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:06.107543+07:00 trong DST: True
2025-10-11 05:00:06,108 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:06,108 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:06,109 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:06,109 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,110 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:06,111 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:06,111 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:06,112 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,116 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:06,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:06,139 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:06,140 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:06,140 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:06,141 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:06,142 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:06,142 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:06,143 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:06,144 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:06,144 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:06,150 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:06,165 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:06,166 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:06,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:06,168 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:06,169 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:06,170 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:06,170 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:06,171 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:06,171 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:06,172 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:06,172 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:06,173 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:06,174 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:06,174 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,175 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:06,175 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:06,176 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:06,176 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:06,177 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:06,178 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:06,179 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:06,179 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:06,179 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:06,201 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:06,203 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:06,204 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:06,204 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:06,204 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:06,205 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:06,205 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:06,206 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:06,207 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,207 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:06,208 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:06,208 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:06,208 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:06,209 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:06,210 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:06,212 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:06,238 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,239 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:06,239 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:06,239 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:06,240 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:06,243 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:06,245 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:06,263 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:06,266 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,267 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:06,268 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,269 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:06,269 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:06,269 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:06,270 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:06,270 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:06,271 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:06,272 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 05:00:06,340 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:06,351 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:06,352 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:06,356 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:06,381 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:06,453 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:06,454 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:06,455 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:06,457 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:06,457 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:06,459 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:06,459 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:06,460 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:06,466 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:06,466 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:06,467 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:06,467 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:06,468 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:06,468 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:06,469 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:06,469 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:06,489 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:06,970 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:06,972 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:06,973 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:06,973 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:06,974 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:06,974 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:06,974 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:06,975 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:06,977 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:06,978 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:06,978 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:06,979 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:06,983 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:07,003 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:07,004 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:07,005 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:07,008 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:07,009 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:07,009 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:07,010 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:07,017 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:07,018 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:07,018 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:07,019 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:07,022 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:07,023 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:07,044 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:07,046 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:07,047 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:07,047 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:07.047497+07:00
2025-10-11 05:00:07,047 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:07.047497+07:00
2025-10-11 05:00:07,048 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:07.047497+07:00 trong DST: True
2025-10-11 05:00:07,048 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:07,049 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:07,049 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:07,050 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:07,050 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:07,053 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:07,054 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:07,055 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:07,055 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:07,056 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:07,078 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:07,079 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:07,079 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:07,080 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:07,080 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:07,081 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:07,081 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:07,082 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:07,082 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:07,083 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:07,083 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:07,083 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:07,084 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:07,084 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:07,085 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:07,086 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:07,087 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:07,088 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:07,089 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:07,089 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:07,112 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:07,112 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:07,113 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:07,114 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:07,114 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:07,114 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:07,115 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:07,115 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:07,116 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:07,116 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:07,117 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:07,118 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:07,118 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:07,118 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:07,119 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:07,119 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:07.119463+07:00
2025-10-11 05:00:07,119 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:07.119463+07:00
2025-10-11 05:00:07,120 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:07.119463+07:00 trong DST: True
2025-10-11 05:00:07,120 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:07,120 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:07,121 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:07,121 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,122 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:07,122 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:07,123 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:07,123 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,124 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:07,124 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:07,126 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:07,144 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:07,145 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:07,146 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:07,147 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:07,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:07,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:07,149 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:07,149 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:07,150 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:07,150 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:07,151 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:07,151 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:07,152 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:07,152 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:07,153 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:07,154 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:07,154 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:07,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:07,156 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:07,158 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:07,178 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:07,180 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:07,181 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,181 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:07,181 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:07,182 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:07,182 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:07,182 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:07,183 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:07,183 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:07,183 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:07,184 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:07,184 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:07,184 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:07,185 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:07,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:07,185 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:07,186 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:07,186 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:07,187 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:07,188 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,188 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:07,189 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:07,189 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:07,214 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:07,215 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:07,216 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:07,217 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:07,219 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,221 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:07,221 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:07,221 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:07,228 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:07,244 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:07,245 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:07,246 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:07,246 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,247 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:07,247 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,247 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:07,248 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:07,248 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:07,249 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:07,249 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:07,250 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:07,251 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 05:00:07,318 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:07,319 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:07,320 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:07,320 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:07,323 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:07,457 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:07,458 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:07,460 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:07,461 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:07,462 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:07,463 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:07,464 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:07,464 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:07,485 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:07,490 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:07,491 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:07,492 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:07,493 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:07,494 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:07,494 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:07,494 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:07,530 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:07,995 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:07,997 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:07,998 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:07,998 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:07,998 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:07,999 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:07,999 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:08,000 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:08,003 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:08,003 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:08,004 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:08,005 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:08,011 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:08,032 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:08,033 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:08,034 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:08,036 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:08,037 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:08,037 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:08,038 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:08,041 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:08,041 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:08,041 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:08,042 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:08,047 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:08,067 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:08,067 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:08,068 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:08,068 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:08,069 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:08.069240+07:00
2025-10-11 05:00:08,069 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:08.069240+07:00
2025-10-11 05:00:08,070 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:08.069240+07:00 trong DST: True
2025-10-11 05:00:08,070 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:08,070 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:08,071 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:08,072 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:08,072 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:08,076 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:08,077 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:08,078 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:08,079 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:08,079 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:08,082 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:08,101 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:08,102 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:08,103 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:08,104 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:08,104 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:08,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:08,248 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:08,303 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:08,309 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:08,385 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:08,396 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:08,446 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:08,455 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:08,491 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:08,491 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:08,492 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:08,495 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:08,495 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:08,496 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:08,496 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:08,498 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:08,498 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:08,499 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:08,499 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:08,500 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:08,501 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:08,502 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:08,502 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:08,502 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:08,503 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:08,503 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:08,503 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:08,504 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:08,504 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:08,505 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:08,505 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:08,506 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:08,506 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:08,507 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:08,507 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:08,507 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:08.507866+07:00
2025-10-11 05:00:08,508 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:08.507866+07:00
2025-10-11 05:00:08,508 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:08.507866+07:00 trong DST: True
2025-10-11 05:00:08,509 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:08,509 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:08,509 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:08,510 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:08,510 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:08,511 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:08,513 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:08,514 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:08,514 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:08,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:08,518 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:08,594 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:08,595 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:08,619 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:08,645 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:08,681 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:08,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:08,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:08,838 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:08,880 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:08,881 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:08,893 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:08,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:08,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:08,984 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:08,985 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:08,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:08,989 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:08,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:08,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:09,020 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:09,025 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:09,030 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:09,054 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:09,057 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:09,060 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:09,082 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:09,089 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:09,117 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:09,122 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:09,122 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:09,123 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:09,124 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:09,127 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:09,127 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:09,181 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:09,203 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:09,207 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:09,207 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:09,209 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:09,211 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:09,236 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:09,236 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:09,238 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:09,239 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:09,241 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:09,241 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:09,242 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:09,270 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:09,298 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:09,302 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:09,304 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:09,304 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:09,315 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:09,332 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:09,335 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:09,335 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:09,336 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:09,336 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:09,337 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:09,338 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:09,339 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:09,340 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:09,340 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:09,341 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:09,341 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:09,343 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:09,359 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.90s
2025-10-11 05:00:09,377 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:09,378 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:09,400 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:09,402 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:09,405 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:09,495 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:09,496 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:09,498 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:09,500 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:09,500 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:09,502 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:09,502 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:09,503 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:09,506 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:09,720 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:09,721 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:09,721 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:09,722 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:09,722 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:09,723 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:09,723 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:09,724 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:10,225 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:10,226 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:10,227 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:10,227 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:10,228 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:10,228 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:10,229 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:10,229 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:10,232 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:10,232 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:10,233 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:10,233 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:10,240 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:10,257 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:10,258 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:10,259 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:10,261 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:10,262 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:10,262 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:10,263 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:10,268 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:10,273 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:10,274 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:10,276 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:10,283 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:10,288 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:10,288 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:10,289 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:10,290 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:10,290 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:10.290712+07:00
2025-10-11 05:00:10,291 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:10.290712+07:00
2025-10-11 05:00:10,292 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:10.290712+07:00 trong DST: True
2025-10-11 05:00:10,292 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:10,292 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:10,293 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:10,294 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:10,295 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:10,301 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:10,318 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:10,319 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:10,321 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:10,321 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:10,322 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:10,323 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:10,328 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:10,346 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:10,347 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:10,348 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:10,349 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:10,349 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:10,350 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:10,350 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:10,351 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:10,351 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:10,351 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:10,352 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:10,353 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:10,353 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:10,353 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:10,354 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:10,354 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:10,355 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:10,355 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:10,356 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:10,356 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:10,356 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:10,357 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:10,357 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:10,358 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:10,358 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:10,358 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:10,359 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:10,359 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:10,360 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:10,360 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:10,361 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:10,361 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:10,362 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:10.362108+07:00
2025-10-11 05:00:10,362 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:10.362108+07:00
2025-10-11 05:00:10,378 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:10.362108+07:00 trong DST: True
2025-10-11 05:00:10,385 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:10,386 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:10,387 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:10,388 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,388 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:10,389 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:10,390 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:10,391 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,391 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:10,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:10,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:10,393 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:10,393 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:10,394 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:10,395 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:10,395 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:10,396 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:10,404 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:10,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:10,416 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:10,417 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:10,417 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:10,418 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:10,419 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:10,419 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:10,420 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:10,421 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:10,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:10,422 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:10,423 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:10,423 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:10,424 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:10,425 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:10,425 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,426 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:10,426 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:10,427 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:10,427 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:10,428 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:10,428 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:10,429 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:10,429 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:10,455 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:10,456 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:10,457 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:10,457 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:10,458 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:10,458 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:10,459 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:10,459 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:10,460 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:10,460 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,460 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:10,461 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:10,462 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:10,463 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:10,465 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:10,486 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:10,488 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:10,489 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:10,489 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:10,490 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,493 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:10,495 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:10,496 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:10,496 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:10,518 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:10,519 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:10,521 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:10,522 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,522 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:10,523 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:10,524 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:10,524 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,525 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:10,525 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:10,526 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:10,526 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:10,528 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:10,529 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:10,529 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:10,530 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:10,557 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.06s
2025-10-11 05:00:10,558 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:10,679 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:10,680 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:10,681 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:10,682 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:10,684 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:11,522 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:11,523 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:11,524 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:11,526 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:11,527 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:11,530 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:11,531 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:11,535 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:11,590 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:11,591 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:11,591 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:11,592 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:11,592 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:11,593 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:11,594 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:11,594 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:11,668 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:11,904 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:11,904 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:12,095 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:12,097 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:12,098 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.19s
2025-10-11 05:00:12,099 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:12,099 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:12,100 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:12,100 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:12,101 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:12,101 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:12,103 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:12,104 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:12,104 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:12,105 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:12,110 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:12,127 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:12,128 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:12,129 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:12,131 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:12,132 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:12,132 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:12,133 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:12,138 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:12,154 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:12,157 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:12,157 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:12,160 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:12,160 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:12,161 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:12,161 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:12,162 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:12,162 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:12.162393+07:00
2025-10-11 05:00:12,162 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:12.162393+07:00
2025-10-11 05:00:12,163 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:12.162393+07:00 trong DST: True
2025-10-11 05:00:12,164 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:12,164 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:12,165 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:12,169 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:12,188 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:12,189 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:00:12,193 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:12,194 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:12,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:12,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:12,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:12,196 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:12,196 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:12,197 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:12,197 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:12,197 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:12,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:12,198 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:12,199 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:12,200 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:12,200 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:12,201 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:12,201 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:12,223 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:12,224 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:12,225 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:12,226 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:12,226 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:12,227 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:12,227 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:12,228 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:12,228 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:12,229 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:12,229 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:12,230 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:12,230 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:12,231 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:12,231 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:12,231 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:12,232 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:12,232 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:12,233 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:12,257 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:12,258 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:12,259 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:12,259 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:12,260 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:12.260089+07:00
2025-10-11 05:00:12,260 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:12.260089+07:00
2025-10-11 05:00:12,260 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:12.260089+07:00 trong DST: True
2025-10-11 05:00:12,261 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:12,261 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:12,261 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:12,262 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,262 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:12,263 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:12,263 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:12,263 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,264 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:12,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:12,266 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:12,267 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:12,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:12,288 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:12,289 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:12,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:12,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:12,291 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:12,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:12,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:12,293 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:12,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:12,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:12,294 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:12,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:12,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:12,297 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:12,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:12,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:12,300 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:12,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:12,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:12,326 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:12,327 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,327 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:12,328 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:12,328 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:12,328 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:12,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:12,329 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:12,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:12,330 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:12,330 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:12,331 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:12,331 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:12,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:12,333 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:12,334 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:12,356 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:12,357 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:12,358 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:12,359 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,360 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:12,360 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:12,361 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:12,361 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:12,361 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:12,362 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:12,363 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:12,364 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:12,365 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:12,365 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,372 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:12,393 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:12,394 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:12,394 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:12,395 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:12,395 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,396 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:12,396 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,396 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:12,397 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:12,397 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:12,398 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:12,398 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:12,399 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:12,400 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-11 05:00:12,497 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:12,498 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:12,498 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:12,499 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:12,501 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:12,582 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:12,583 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:12,584 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:12,586 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:12,587 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:12,588 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:12,589 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:12,590 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:12,597 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:12,597 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:12,598 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:12,598 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:12,599 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:12,600 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:12,600 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:12,605 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:12,620 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:13,132 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:13,133 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:13,134 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:13,134 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:13,135 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:13,135 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:13,136 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:13,136 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:13,138 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:13,138 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:13,139 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:13,139 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:13,145 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:13,163 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:13,164 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:13,165 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:13,167 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:13,167 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:13,168 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:13,169 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:13,174 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:13,191 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:13,193 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:13,193 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:13,196 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:13,196 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:13,197 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:13,197 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:13,198 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:13,198 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:13.198782+07:00
2025-10-11 05:00:13,199 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:13.198782+07:00
2025-10-11 05:00:13,199 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:13.198782+07:00 trong DST: True
2025-10-11 05:00:13,200 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:13,200 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:13,200 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:13,201 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:13,202 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:13,208 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:13,217 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:13,221 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:13,223 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:13,224 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:13,225 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:13,225 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:13,226 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:13,227 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:13,228 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:13,228 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:13,228 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:13,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:13,229 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:13,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:13,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:13,230 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:13,231 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:13,231 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:13,232 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:13,232 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:13,233 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:13,233 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:13,234 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:13,235 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:13,235 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:13,235 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:13,246 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:13,257 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:13,257 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:13,259 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:13,259 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:13,259 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:13,260 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:13,260 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:13,261 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:13,261 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:13,262 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:13,262 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:13,262 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:13,263 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:13.262947+07:00
2025-10-11 05:00:13,263 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:13.262947+07:00
2025-10-11 05:00:13,263 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:13.262947+07:00 trong DST: True
2025-10-11 05:00:13,264 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:13,264 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:13,264 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:13,265 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,265 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:13,265 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:13,266 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:13,266 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,266 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:13,267 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:13,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:13,268 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:13,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:13,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:13,277 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:13,281 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:13,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:13,293 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:13,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:13,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:13,304 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:13,306 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:13,311 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:13,320 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:13,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:13,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:13,323 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:13,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:13,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:13,325 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:13,325 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:13,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:13,326 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:13,327 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,327 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:13,328 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:13,328 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:13,328 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:13,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:13,329 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:13,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:13,330 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:13,330 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:13,330 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:13,331 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:13,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:13,331 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:13,332 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:13,332 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:13,332 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:13,333 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:13,333 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,333 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:13,334 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:13,334 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:13,334 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:13,335 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:13,336 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:13,337 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:13,361 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,363 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:13,364 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:13,365 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:13,366 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:13,366 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:13,366 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,370 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:13,371 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:13,371 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:13,372 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,394 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:13,395 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:13,395 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:13,396 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:13,396 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:13,396 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:13,398 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.81s
2025-10-11 05:00:13,465 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:13,466 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:13,467 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:13,468 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:13,470 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:13,587 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:13,588 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:13,589 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:13,591 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:13,592 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:13,593 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:13,594 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:13,595 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:13,620 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:13,621 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:13,622 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:13,622 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:13,622 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:13,623 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:13,623 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:13,624 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:13,693 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:14,125 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:14,127 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:14,127 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:14,128 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:14,128 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:14,129 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:14,129 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:14,130 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:14,132 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:14,132 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:14,133 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:14,133 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:14,139 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:14,157 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:14,158 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:14,159 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:14,161 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:14,162 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:14,162 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:14,163 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:14,165 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:14,165 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:14,166 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:14,166 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:14,169 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:14,170 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:14,170 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:14,171 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:14,171 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:14,173 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:14.173819+07:00
2025-10-11 05:00:14,193 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:14.173819+07:00
2025-10-11 05:00:14,194 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:14.173819+07:00 trong DST: True
2025-10-11 05:00:14,195 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:14,196 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:14,196 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:14,198 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:14,199 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:14,202 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:14,203 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:14,203 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:14,204 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:14,204 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:14,226 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:14,227 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:14,228 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:14,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:14,229 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:14,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:14,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:14,230 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:14,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:14,231 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:14,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:14,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:14,232 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:14,232 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:14,233 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:14,234 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:14,234 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:14,235 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:14,235 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:14,235 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:14,236 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:14,237 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:14,237 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:14,238 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:14,239 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:14,239 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:14,262 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:14,263 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:14,265 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:14,265 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:14,266 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:14,267 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:14,267 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:14,268 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:14,268 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:14,268 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:14.268795+07:00
2025-10-11 05:00:14,269 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:14.268795+07:00
2025-10-11 05:00:14,269 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:14.268795+07:00 trong DST: True
2025-10-11 05:00:14,270 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:14,270 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:14,271 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:14,271 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,271 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:14,293 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:14,294 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:14,294 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,295 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:14,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:14,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:14,297 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:14,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:14,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:14,298 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:14,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:14,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:14,300 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:14,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:14,301 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:14,301 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:14,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:14,304 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:14,305 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:14,305 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:14,306 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:14,329 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:14,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:14,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:14,331 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:14,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:14,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:14,333 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:14,333 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,334 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:14,334 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:14,334 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:14,335 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:14,336 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:14,336 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:14,337 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:14,337 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:14,337 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:14,338 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:14,361 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:14,363 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:14,364 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:14,364 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:14,365 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:14,365 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:14,366 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:14,366 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,367 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:14,367 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:14,367 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:14,368 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:14,368 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:14,369 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:14,372 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:14,373 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,396 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:14,398 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:14,400 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:14,401 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:14,401 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:14,402 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:14,403 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:14,404 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,405 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:14,405 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,406 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:14,424 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:14,425 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:14,426 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:14,426 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:14,427 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:14,429 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-11 05:00:14,504 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:14,505 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:14,505 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:14,506 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:14,508 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:14,593 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:14,594 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:14,595 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:14,597 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:14,598 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:14,600 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:14,600 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:14,601 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:14,608 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:14,610 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:14,612 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:14,633 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:14,645 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:14,668 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:14,710 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:14,787 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:14,824 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:15,345 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:15,347 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:15,348 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:15,348 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:15,348 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:15,349 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:15,349 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:15,350 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:15,353 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:15,353 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:15,353 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:15,354 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:15,360 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:15,377 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:15,378 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:15,380 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:15,382 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:15,382 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:15,383 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:15,383 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:15,386 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:15,386 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:15,387 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:15,387 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:15,390 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:15,391 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:15,391 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:15,395 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:15,413 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:15,414 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:15.414698+07:00
2025-10-11 05:00:15,415 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:15.414698+07:00
2025-10-11 05:00:15,415 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:15.414698+07:00 trong DST: True
2025-10-11 05:00:15,416 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:15,416 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:15,417 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:15,418 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:15,418 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:15,422 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:15,423 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:15,423 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:15,424 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:15,424 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:15,425 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:15,446 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:15,446 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:15,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:15,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:15,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:15,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:15,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:15,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:15,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:15,451 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:15,452 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:15,452 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:15,452 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:15,453 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:15,453 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:15,454 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:15,454 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:15,455 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:15,455 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:15,456 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:15,457 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:15,457 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:15,458 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:15,458 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:15,472 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:15,479 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:15,479 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:15,480 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:15,481 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:15,481 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:15,482 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:15,482 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:15,483 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:15,483 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:15,483 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:15.483804+07:00
2025-10-11 05:00:15,484 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:15.483804+07:00
2025-10-11 05:00:15,484 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:15.483804+07:00 trong DST: True
2025-10-11 05:00:15,484 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:15,485 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:15,485 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:15,485 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,486 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:15,486 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:15,487 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:15,487 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,487 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:15,488 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:15,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:15,489 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:15,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:15,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:15,493 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:15,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:15,496 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:15,499 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:15,506 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:15,510 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:15,511 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:15,513 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:15,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:15,515 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:15,516 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:15,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:15,518 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:15,518 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:15,519 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:15,519 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:15,520 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:15,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:15,521 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:15,522 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,522 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:15,523 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:15,523 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:15,523 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:15,524 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:15,552 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:15,554 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:15,556 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:15,557 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:15,558 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:15,558 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:15,582 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:15,582 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:15,584 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:15,584 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:15,585 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:15,586 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:15,587 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,587 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:15,587 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:15,588 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:15,589 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:15,589 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:15,590 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:15,612 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:15,612 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:15,616 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:15,618 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:15,619 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:15,619 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:15,620 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:15,620 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:15,622 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:15,629 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:15,642 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:15,643 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:15,644 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:15,645 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,645 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 05:00:15,646 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:15,647 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,647 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:15,648 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:15,649 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:15,649 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:15,649 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:15,650 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:15,652 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.06s
2025-10-11 05:00:15,692 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:15,809 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:15,811 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:15,812 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:15,813 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:15,816 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:16,619 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:16,620 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:16,621 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:16,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:16,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:16,625 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:16,625 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:16,627 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:16,658 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:16,659 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:16,660 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:16,660 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:16,660 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:16,661 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:16,661 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:16,662 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:16,693 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:17,163 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:17,165 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:17,165 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:17,166 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:17,166 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:17,167 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:17,167 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:17,168 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:17,170 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:17,170 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:17,171 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:17,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:17,177 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:17,195 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:17,196 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:17,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:17,200 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:17,200 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:17,201 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:17,201 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:17,206 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:17,226 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:17,227 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:17,249 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:17,254 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:17,277 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:17,277 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:17,278 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:17,279 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:17,279 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:17.279628+07:00
2025-10-11 05:00:17,280 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:17.279628+07:00
2025-10-11 05:00:17,280 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:17.279628+07:00 trong DST: True
2025-10-11 05:00:17,280 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:17,281 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:17,281 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:17,282 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:17,282 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:17,286 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:17,286 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:17,287 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:17,287 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:17,289 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:17,311 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:17,312 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:17,312 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:17,313 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:17,313 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:17,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:17,314 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:17,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:17,315 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:17,315 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:17,316 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:17,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:17,318 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:17,319 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:17,319 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:17,320 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:17,322 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:17,344 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:17,344 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:17,345 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:17,346 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:17,347 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:17,347 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:17,348 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:17,348 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:17,348 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:17,349 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:17,349 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:17,351 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:17,351 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:17,352 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:17,352 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:17,353 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:17,353 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:17,354 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:17,354 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:17.354425+07:00
2025-10-11 05:00:17,354 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:17.354425+07:00
2025-10-11 05:00:17,355 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:17.354425+07:00 trong DST: True
2025-10-11 05:00:17,376 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:17,380 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:17,380 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:17,381 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:17,381 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:17,382 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:17,382 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,383 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:17,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:17,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:17,386 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:17,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:17,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:17,410 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:17,410 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:17,412 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:17,412 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:17,413 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:17,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:17,414 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:17,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:17,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:17,416 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:17,416 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:17,417 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:17,418 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:17,419 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:17,420 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:17,421 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:17,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:17,446 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:17,447 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:17,447 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,448 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:17,448 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:17,448 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:17,449 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:17,449 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:17,450 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:17,450 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:17,450 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:17,451 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:17,451 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:17,451 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:17,455 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:17,477 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:17,479 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:17,479 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:17,479 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:17,480 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:17,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,480 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:17,481 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:17,481 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:17,481 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:17,482 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:17,483 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:17,484 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:17,486 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,487 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:17,487 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:17,487 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:17,510 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:17,513 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:17,514 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:17,515 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:17,515 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,516 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:17,516 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,517 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:17,517 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:17,517 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:17,518 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:17,519 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:17,520 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:17,543 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.92s
2025-10-11 05:00:17,579 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:17,580 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:17,580 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:17,581 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:17,584 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:17,669 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:17,670 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:17,671 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:17,673 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:17,674 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:17,675 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:17,675 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:17,676 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:17,682 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:17,683 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:17,684 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:17,684 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:17,684 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:17,685 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:17,685 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:17,686 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:17,687 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:18,187 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:18,188 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:18,189 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:18,190 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:18,190 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:18,190 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:18,191 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:18,191 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:18,193 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:18,194 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:18,194 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:18,195 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:18,202 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:18,218 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:18,219 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:18,220 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:18,222 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:18,222 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:18,223 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:18,223 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:18,226 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:18,227 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:18,227 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:18,227 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:18,230 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:18,231 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:18,231 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:18,231 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:18,232 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:18,232 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:18.232618+07:00
2025-10-11 05:00:18,233 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:18.232618+07:00
2025-10-11 05:00:18,233 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:18.232618+07:00 trong DST: True
2025-10-11 05:00:18,233 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:18,234 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:18,234 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:18,236 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:18,236 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:18,243 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:18,260 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:18,261 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:18,261 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:18,262 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:18,262 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:18,263 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:18,263 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:18,263 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:18,264 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:18,264 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:18,264 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:18,265 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:18,265 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:18,266 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:18,266 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:18,267 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:18,267 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:18,268 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:18,269 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:18,269 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:18,270 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:18,271 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:18,271 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:18,274 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:18,294 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:18,295 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:18,296 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:18,296 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:18,297 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:18,297 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:18,298 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:18,298 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:18,298 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:18,299 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:18,299 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:18,300 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:18,300 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:18,301 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:18,301 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:18,301 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:18.301700+07:00
2025-10-11 05:00:18,302 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:18.301700+07:00
2025-10-11 05:00:18,302 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:18.301700+07:00 trong DST: True
2025-10-11 05:00:18,303 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:18,303 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:18,304 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:18,304 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,304 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:18,305 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:18,308 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:18,327 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,328 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:18,328 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:18,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:18,340 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:18,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:18,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:18,352 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:18,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:18,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:18,375 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:18,378 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:18,379 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:18,401 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:18,408 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:18,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:18,426 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:18,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:18,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:18,428 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:18,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:18,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:18,430 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:18,431 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:18,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:18,432 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:18,433 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,433 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:18,433 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:18,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:18,434 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:18,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:18,435 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:18,435 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:18,436 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:18,436 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:18,436 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:18,437 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:18,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:18,438 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:18,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:18,439 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:18,439 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:18,440 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:18,463 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,465 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:18,465 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:18,466 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:18,466 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:18,467 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:18,467 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:18,468 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:18,469 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,470 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:18,470 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:18,470 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:18,472 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:18,478 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:18,496 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:18,496 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:18,498 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,498 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:18,499 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,499 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:18,500 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:18,500 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:18,501 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:18,501 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:18,502 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:18,503 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.83s
2025-10-11 05:00:18,530 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:18,532 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:18,532 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:18,534 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:18,536 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:18,673 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:18,674 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:18,676 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:18,677 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:18,678 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:18,679 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:18,679 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:18,680 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:18,708 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:18,709 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:18,709 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:18,710 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:18,710 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:18,711 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:18,711 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:18,712 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:18,753 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:19,212 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:19,214 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:19,215 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:19,215 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:19,215 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:19,216 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:19,216 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:19,217 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:19,219 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:19,219 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:19,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:19,220 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:19,226 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:19,244 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:19,245 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:19,246 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:19,248 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:19,248 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:19,249 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:19,249 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:19,252 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:19,252 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:19,253 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:19,253 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:19,257 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:19,258 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:19,277 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:19,278 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:19,280 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:19,281 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:19.281340+07:00
2025-10-11 05:00:19,282 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:19.281340+07:00
2025-10-11 05:00:19,282 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:19.281340+07:00 trong DST: True
2025-10-11 05:00:19,283 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:19,283 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:19,283 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:19,285 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:19,285 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:19,288 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:19,289 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:19,289 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:19,290 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:19,290 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:19,291 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:19,291 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:19,291 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:19,300 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:19,312 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:19,313 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:19,315 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:19,315 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:19,316 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:19,316 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:19,317 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:19,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:19,318 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:19,318 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:19,319 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:19,319 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:19,319 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:19,320 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:19,320 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:19,321 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:19,322 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:19,322 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:19,323 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:19,323 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:19,324 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:19,324 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:19,332 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:19,346 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:19,347 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:19,349 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:19,350 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:19,351 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:19,352 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:19,352 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:19,352 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:19,353 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:19.353185+07:00
2025-10-11 05:00:19,353 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:19.353185+07:00
2025-10-11 05:00:19,353 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:19.353185+07:00 trong DST: True
2025-10-11 05:00:19,354 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:19,354 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:19,354 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:19,355 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,355 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:19,356 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:19,356 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:19,357 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,357 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:19,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:19,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:19,361 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:19,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:19,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:19,384 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:19,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:19,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:19,386 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:19,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:19,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:19,387 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:19,388 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:19,388 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:19,389 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:19,391 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:19,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:19,393 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:19,418 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:19,419 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:19,420 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:19,420 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:19,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:19,421 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:19,422 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,422 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:19,422 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:19,423 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:19,423 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:19,424 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:19,425 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:19,425 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:19,425 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:19,426 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:19,447 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:19,448 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:19,449 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:19,449 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:19,450 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:19,450 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:19,450 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:19,451 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:19,451 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,452 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:19,452 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:19,452 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:19,453 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:19,453 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:19,454 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:19,455 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:19,456 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,457 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:19,458 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:19,458 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:19,464 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:19,483 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:19,485 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:19,486 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:19,487 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,611 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:19,646 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,672 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:19,678 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:19,715 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:19,762 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:19,818 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:19,822 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:19,842 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:19,846 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:19,863 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:19,864 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:19,865 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:19,867 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.11s
2025-10-11 05:00:19,870 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.19s
2025-10-11 05:00:19,965 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:20,063 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:20,064 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:20,064 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:20,068 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:20,070 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:20,762 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:20,763 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:20,765 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:20,767 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:20,767 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:20,769 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:20,770 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:20,771 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:20,796 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:20,797 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:20,798 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:20,798 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:20,799 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:20,799 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:20,799 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:20,800 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:20,842 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:21,301 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:21,302 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:21,303 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:21,304 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:21,304 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:21,304 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:21,305 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:21,305 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:21,307 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:21,308 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:21,308 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:21,309 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:21,315 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:21,332 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:21,333 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:21,334 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:21,336 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:21,336 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:21,336 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:21,337 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:21,339 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:21,340 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:21,340 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:21,341 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:21,343 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:21,344 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:21,344 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:21,345 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:21,345 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:21,346 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:21.346072+07:00
2025-10-11 05:00:21,365 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:21.346072+07:00
2025-10-11 05:00:21,367 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:21.346072+07:00 trong DST: True
2025-10-11 05:00:21,368 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:21,368 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:21,369 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:21,370 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:21,370 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:21,374 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:21,374 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:21,375 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:21,375 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:21,375 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:21,376 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:21,376 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:21,376 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:21,378 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:21,379 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:21,379 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:21,379 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:21,380 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:21,400 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:21,402 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:21,404 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:21,424 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:21,426 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:21,449 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:21,455 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:21,471 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:21,472 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:21,473 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:21,474 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:21,496 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:21,497 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:21,505 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:21,517 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:21,518 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:21,519 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:21,519 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:21,519 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:21,520 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:21,520 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:21,542 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:21,567 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:21,580 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:21,583 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:21,604 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:21,605 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:21,612 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:21.611681+07:00
2025-10-11 05:00:21,628 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:21.611681+07:00
2025-10-11 05:00:21,629 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:21.611681+07:00 trong DST: True
2025-10-11 05:00:21,630 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:21,633 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:21,656 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:21,656 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,657 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:21,658 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:21,658 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:21,658 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,659 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:21,659 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:21,661 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:21,661 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:21,662 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:21,663 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:21,663 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:21,664 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:21,664 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:21,665 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:21,666 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:21,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:21,686 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:21,687 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:21,688 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:21,689 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:21,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:21,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:21,690 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:21,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:21,692 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:21,692 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:21,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:21,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:21,694 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:21,695 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,695 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:21,718 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:21,719 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:21,720 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:21,720 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:21,721 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:21,721 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:21,722 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:21,722 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:21,723 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:21,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:21,723 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:21,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:21,724 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:21,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:21,725 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:21,725 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:21,726 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,727 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:21,727 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:21,728 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:21,728 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:21,729 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:21,733 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:21,759 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:21,785 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:21,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,790 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:21,790 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:21,792 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:21,792 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:21,796 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:21,797 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:21,817 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:21,818 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:21,820 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:21,820 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:21,821 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:21,821 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,822 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 05:00:21,823 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:21,823 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,824 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:21,824 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:21,824 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:21,825 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:21,826 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:21,826 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:21,827 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.06s
2025-10-11 05:00:21,893 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:21,986 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:21,987 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:21,988 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:21,989 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:21,991 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:22,775 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-11 05:00:22,776 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.autorun.guard' vào nhóm 'ui.autorun' (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-11 05:00:22,776 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.autorun.guard vào group ui.autorun (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-11 05:00:22,777 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-11 05:00:22,778 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-11 05:00:22,778 - APP.utils.threading_utils - DEBUG - Task 'ui.autorun.guard' (group=ui.autorun) hoàn tất sau 0.00s
2025-10-11 05:00:22,797 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:22,810 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:22,812 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:22,819 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:22,836 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:22,838 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:22,838 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:22,839 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 05:00:22,843 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,843 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:22,844 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,844 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,844 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:22,845 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,845 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:22,846 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:22,860 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _request_autorun_start
2025-10-11 05:00:22,873 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:22,874 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,874 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:22,875 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,875 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:22,876 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,876 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:22,877 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:22,878 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-11 05:00:22,879 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-11 05:00:22,879 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-11 05:00:22,880 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251011-050022' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050022', 'priority': 'autorun'})
2025-10-11 05:00:22,881 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-11 05:00:22,884 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251011-050022 (priority=autorun)
2025-10-11 05:00:22,886 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-11 05:00:22,905 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-11 05:00:22,906 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-11 05:00:22,908 - APP.ui.app_ui - INFO - Autorun autorun-20251011-050022 bắt đầu ngay lập tức.
2025-10-11 05:00:22,909 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:22,911 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-11 05:00:22,912 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-11 05:00:22,915 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:00:22,945 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-11 05:00:23,083 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:23,083 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-11 05:00:23,084 - APP.ui.app_ui - INFO - Phiên autorun-20251011-050022 bắt đầu (priority=autorun, source=autorun).
2025-10-11 05:00:23,085 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-11 05:00:23,128 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-11 05:00:23,154 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-11 05:00:23,163 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (TaskGroup analysis.upload).
2025-10-11 05:00:23,188 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-11 05:00:23,233 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-11 05:00:23,255 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050022.0' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050022', 'index': 0})
2025-10-11 05:00:23,258 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy vào cuối tuần.
2025-10-11 05:00:23,258 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050022.1' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050022', 'index': 1})
2025-10-11 05:00:23,261 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy vào cuối tuần.
2025-10-11 05:00:23,262 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 13067:1760147730:262e74bf02a1c2b2
2025-10-11 05:00:23,266 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050022.2' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050022', 'index': 2})
2025-10-11 05:00:23,289 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-11 05:00:23,295 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-11 05:00:23,322 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/x6cackq4w5ls
2025-10-11 05:00:23,338 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050022.3' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050022', 'index': 3})
2025-10-11 05:00:23,354 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:23,388 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-11 05:00:23,392 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-11 05:00:23,395 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:23,427 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.52s
2025-10-11 05:00:23,490 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:23,492 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:23,492 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11958:1760147795:513f8e5839ff7a34
2025-10-11 05:00:23,493 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:23,495 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/oqaz6abzw1q3
2025-10-11 05:00:23,495 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251011.jsonl.
2025-10-11 05:00:23,498 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:23,528 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-11 05:00:23,560 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-11 05:00:23,562 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:23,587 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14388:1760147725:aafea65d11833a75
2025-10-11 05:00:23,589 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy vào cuối tuần.
2025-10-11 05:00:23,591 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:23,593 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/cbqd2j9q86jf
2025-10-11 05:00:23,594 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_2_logic' hoàn tất thành công.
2025-10-11 05:00:23,597 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:23,628 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050022.0' (group=analysis.upload) hoàn tất sau 0.37s
2025-10-11 05:00:23,629 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-11 05:00:23,657 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050022.1' (group=analysis.upload) hoàn tất sau 0.17s
2025-10-11 05:00:23,660 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:23,663 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 11602:1760147800:c0e0245d791aa20d
2025-10-11 05:00:23,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:23,666 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/tmyqg1ktggaa
2025-10-11 05:00:23,691 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:23,692 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-11 05:00:23,694 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:23,698 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:23,699 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:23,724 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:23,725 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:23,728 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:23,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:23,730 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:23,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:23,735 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050022.2' (group=analysis.upload) hoàn tất sau 0.18s
2025-10-11 05:00:23,759 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:23,762 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:23,762 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:23,763 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:23,769 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:23,772 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050022.3' (group=analysis.upload) hoàn tất sau 0.11s
2025-10-11 05:00:23,792 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:23,794 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-11 05:00:23,795 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:23,796 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:23,797 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-11 05:00:23,797 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:23,798 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_3_logic' hoàn tất thành công.
2025-10-11 05:00:23,818 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:23.818466+07:00
2025-10-11 05:00:23,820 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-11 05:00:23,821 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:23,821 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:23.818466+07:00
2025-10-11 05:00:23,821 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-11 05:00:23,824 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:23,824 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:23.818466+07:00 trong DST: True
2025-10-11 05:00:23,825 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-11 05:00:23,825 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:23,826 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:23,826 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:23,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:23,828 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:23,828 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-11 05:00:23,829 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:23,830 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:23,830 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:23,831 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251011-050022' (group=analysis.session) hoàn tất sau 0.95s
2025-10-11 05:00:23,834 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:23,854 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:23,855 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 05:00:23,857 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:23,862 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:23,862 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:23,863 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:23,863 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:23,865 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:23,865 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:23,866 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:23,866 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:23,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:23,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:23,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:23,891 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:23,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:23,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:23,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:23,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:23,893 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:23,894 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:23,894 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:23,895 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:23,895 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:23,896 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:23,896 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:23,897 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:23,897 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:23,898 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:23,899 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:23,899 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:23,900 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:23,922 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:23,923 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:23,924 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:23,925 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:23,925 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:23,926 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:23,926 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:23,927 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:23,928 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:23,928 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:23,929 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:23,929 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:23.929538+07:00
2025-10-11 05:00:23,929 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:23.929538+07:00
2025-10-11 05:00:23,931 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:23.929538+07:00 trong DST: True
2025-10-11 05:00:23,932 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:23,952 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:23,955 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:23,955 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:23,956 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:23,956 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:23,957 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:23,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:23,958 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:23,958 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:23,959 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:23,960 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:23,961 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:23,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:23,962 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:23,963 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:23,963 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:23,964 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:23,964 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:23,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:23,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:23,988 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:23,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:23,991 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:23,992 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:23,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:23,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:23,993 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:23,994 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:23,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:23,996 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:23,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:23,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:23,998 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:23,999 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:23,999 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:23,999 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:24,029 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:24,030 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:24,031 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:24,033 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:24,055 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:24,057 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:24,058 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:24,058 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:24,058 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:24,059 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:24,059 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:24,059 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,060 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:24,062 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:24,065 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:24,066 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:24,066 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:24,090 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:24,091 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:24,091 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:24,092 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:24,092 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:24,093 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:24,095 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:24,098 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:24,098 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:24,099 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:24,122 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:24,123 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:24,124 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:24,124 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:24,124 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:24,125 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:24,125 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:24,126 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:24,126 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:24,126 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:24,127 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:24,128 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:24,129 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:24,129 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:24,130 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.32s
2025-10-11 05:00:24,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,266 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,266 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,368 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,369 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,470 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,470 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,572 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,573 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,573 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-11 05:00:24,574 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-11 05:00:24,574 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-11 05:00:24,575 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,575 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251011-050022: {'status': 'completed', 'early_exit': True}
2025-10-11 05:00:24,576 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,705 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:24,705 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:24,706 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:24,707 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:24,709 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:24,864 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:00:24,911 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:24,911 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:24,913 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:24,915 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:24,915 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:24,917 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:24,917 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:24,918 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:24,958 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:24,959 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:24,960 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:24,961 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:24,961 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:24,962 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:24,963 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:24,964 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:24,968 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:00:25,035 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:25,466 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:25,468 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:25,468 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:25,469 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:25,469 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:25,470 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:25,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:25,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:25,473 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:25,474 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:25,474 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:25,474 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:25,481 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:25,501 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:25,502 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:25,513 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:25,531 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:25,532 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:25,532 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:25,533 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:25,536 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:25,537 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:25,537 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:25,565 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:25,571 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:25,591 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:25,593 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:25,593 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:25,593 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:25,594 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:25.594340+07:00
2025-10-11 05:00:25,594 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:25.594340+07:00
2025-10-11 05:00:25,595 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:25.594340+07:00 trong DST: True
2025-10-11 05:00:25,595 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:25,595 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:25,596 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:25,597 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:25,598 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:25,602 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:25,603 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:25,603 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:25,604 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:25,604 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:25,606 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:25,625 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:25,627 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:25,628 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:25,629 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:25,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:25,629 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:25,630 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:25,630 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:25,630 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:25,631 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:25,631 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:25,632 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:25,632 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:25,633 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:25,633 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:25,634 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:25,634 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:25,635 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:25,635 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:25,636 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:25,636 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:25,637 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:25,660 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:25,662 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:25,662 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:25,663 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:25,663 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:25,664 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:25,664 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:25,665 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:25,666 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:25,666 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:25,667 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:25,667 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:25,668 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:25.668918+07:00
2025-10-11 05:00:25,669 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:25.668918+07:00
2025-10-11 05:00:25,669 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:25.668918+07:00 trong DST: True
2025-10-11 05:00:25,670 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:25,690 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:25,691 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:25,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,693 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:25,693 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:25,694 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:25,694 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,695 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:25,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:25,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:25,696 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:25,697 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:25,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:25,698 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:25,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:25,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:25,700 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:25,700 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:25,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:25,702 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:25,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:25,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:25,704 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:25,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:25,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:25,731 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:25,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:25,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:25,732 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:25,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:25,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:25,734 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:25,734 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:25,736 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:25,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:25,766 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:25,767 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:25,767 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:25,767 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:25,770 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:25,771 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:25,796 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:25,798 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:25,798 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:25,799 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:25,799 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:25,800 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:25,800 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:25,800 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:25,801 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,801 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:25,802 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:25,802 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:25,803 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:25,803 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:25,806 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:25,831 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:25,832 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,833 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:25,833 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:25,834 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:25,835 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:25,840 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:25,857 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:25,858 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:25,859 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,859 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:25,860 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,860 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:25,861 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:25,861 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:25,862 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:25,862 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:25,863 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:25,864 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.95s
2025-10-11 05:00:25,871 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:25,893 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:25,895 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:25,896 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:25,899 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:25,969 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:25,970 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:25,971 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:25,973 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:25,973 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:25,975 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:25,975 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:25,976 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:25,982 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:25,982 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:25,983 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:25,984 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:25,984 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:25,985 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:25,985 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:25,985 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:26,007 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:26,054 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:00:26,315 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:00:26,487 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:26,488 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:26,489 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:26,489 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:26,490 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:26,490 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:26,490 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:26,491 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:26,493 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:26,493 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:26,494 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:26,495 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:26,501 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:26,518 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:26,519 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:26,522 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:26,527 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:26,552 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:26,555 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:26,578 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:26,582 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:26,582 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:26,583 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:26,583 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:26,586 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:26,587 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:26,587 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:26,588 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:26,588 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:26,610 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:26.610587+07:00
2025-10-11 05:00:26,612 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:26.610587+07:00
2025-10-11 05:00:26,613 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:26.610587+07:00 trong DST: True
2025-10-11 05:00:26,613 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:26,614 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:26,614 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:26,615 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:26,616 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:26,621 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:26,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:26,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:26,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:26,644 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:26,645 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:26,646 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:26,646 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:26,646 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:26,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:26,647 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:26,648 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:26,648 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:26,648 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:26,649 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:26,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:26,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:26,650 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:26,651 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:26,651 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:26,652 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:26,652 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:26,653 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:26,653 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:26,655 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:26,656 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:26,676 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:26,678 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:26,679 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:26,679 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:26,680 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:26,681 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:26,681 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:26,682 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:26,682 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:26,682 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:26,683 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:26,684 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:26,684 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:26,684 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:26,685 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:26.685015+07:00
2025-10-11 05:00:26,685 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:26.685015+07:00
2025-10-11 05:00:26,686 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:26.685015+07:00 trong DST: True
2025-10-11 05:00:26,686 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:26,686 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:26,687 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:26,688 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,689 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:26,689 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:26,689 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:26,707 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,709 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:26,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:26,713 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:26,713 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:26,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:26,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:26,715 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:26,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:26,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:26,717 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:26,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:26,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:26,718 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:26,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:26,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:26,720 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:26,721 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:26,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:26,722 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:26,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:26,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:26,752 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:26,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:26,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:26,788 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:26,789 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,790 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:26,791 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:26,791 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:26,792 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:26,792 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:26,793 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:26,793 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:26,794 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:26,794 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:26,795 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:26,795 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:26,795 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:26,796 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:26,796 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:26,797 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:26,797 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:26,798 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:26,798 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,798 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:26,799 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:26,799 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:26,800 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:26,800 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:26,801 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:26,802 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:26,804 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,805 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:26,806 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:26,806 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:26,806 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:26,831 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:26,832 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:26,832 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:26,832 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,833 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:26,834 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,834 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:26,834 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:26,835 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:26,835 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:26,835 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:26,836 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:26,838 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 05:00:26,859 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:26,865 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:26,865 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:26,866 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:26,870 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:26,944 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:26,945 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:26,946 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 05:00:26,977 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:26,977 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:26,979 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:26,981 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:26,981 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:00:26,981 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:26,983 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:26,983 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:26,984 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:27,000 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:27,019 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:27,019 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:27,020 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:27,020 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:27,021 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:27,021 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:27,024 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:27,083 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:27,449 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:00:27,463 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:00:27,545 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:27,547 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:27,548 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:27,548 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:27,548 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:27,549 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:27,549 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:27,550 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:27,552 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:27,553 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:27,553 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:27,554 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:27,561 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:27,580 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:27,581 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:27,582 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:27,585 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:27,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:27,586 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:27,586 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:27,589 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:27,590 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:27,599 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:27,611 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:27,614 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:27,615 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:27,616 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:27,616 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:27,617 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:27,617 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:27.617560+07:00
2025-10-11 05:00:27,617 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:27.617560+07:00
2025-10-11 05:00:27,618 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:27.617560+07:00 trong DST: True
2025-10-11 05:00:27,619 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:27,619 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:27,620 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:27,621 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:27,622 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:27,628 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:27,645 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:27,646 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:27,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:27,648 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:27,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:27,649 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:27,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:27,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:27,650 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:27,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:27,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:27,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:27,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:27,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:27,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:27,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:27,654 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:27,654 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:27,655 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:27,656 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:27,656 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:27,657 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:27,657 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:27,658 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:27,681 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:27,706 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:27,731 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:27,732 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:27,733 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:27,734 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:27,734 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:27,735 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:27,735 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:27,735 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:27,736 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:27,736 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:27,737 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:27,737 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:27,740 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:27,740 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:27.740616+07:00
2025-10-11 05:00:27,767 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:27.740616+07:00
2025-10-11 05:00:27,768 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:27.740616+07:00 trong DST: True
2025-10-11 05:00:27,769 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:27,769 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:27,769 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:27,770 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,771 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:27,771 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:27,774 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:27,774 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,797 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:27,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:27,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:27,800 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:27,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:27,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:27,803 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:27,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:27,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:27,804 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:27,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:27,830 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:27,832 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:27,832 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:27,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:27,835 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:27,835 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:27,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:27,836 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:27,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:27,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:27,838 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:27,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:27,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:27,864 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:27,866 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,867 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:27,868 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:27,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:27,870 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:27,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:27,871 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:27,871 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:27,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:27,873 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:27,876 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:27,897 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:27,902 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:27,903 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:27,903 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:27,904 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:27,904 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:27,904 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:27,905 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,905 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:27,905 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:27,906 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:27,908 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:27,908 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:27,933 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:27,936 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:27,937 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:27,938 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,938 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:27,957 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:27,961 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:27,962 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:27,963 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:27,963 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:27,964 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,964 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:27,965 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,965 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:27,966 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:27,966 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:27,966 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:27,967 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:27,967 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:27,968 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.99s
2025-10-11 05:00:27,981 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:27,999 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:28,001 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:28,003 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:28,005 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:28,008 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:28,036 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:28,038 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:28,039 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 05:00:28,041 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:28,042 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:28,044 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:28,067 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:28,069 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:28,346 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:28,346 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:28,347 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:28,348 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:28,348 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:28,349 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:28,349 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:28,350 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:28,850 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:28,852 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:28,853 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:28,853 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:28,853 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:28,854 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:28,854 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:28,855 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:28,857 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:28,857 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:28,857 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:28,858 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:28,862 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:28,884 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:28,885 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:28,886 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:28,889 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:28,890 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:28,890 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:28,891 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:28,896 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:28,914 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:28,915 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:28,916 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:28,918 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:28,919 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:28,919 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:28,920 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:28,920 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:28,920 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:28.920698+07:00
2025-10-11 05:00:28,921 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:28.920698+07:00
2025-10-11 05:00:28,921 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:28.920698+07:00 trong DST: True
2025-10-11 05:00:28,921 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:28,922 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:28,922 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:28,923 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:28,923 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:28,927 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:28,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:28,950 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:28,950 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:28,951 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:28,951 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:28,952 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:28,952 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:28,952 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:28,953 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:28,953 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:28,954 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:28,954 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:28,955 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:28,955 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:28,956 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:28,956 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:28,956 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:28,957 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:28,957 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:28,958 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:28,959 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:28,959 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:28,960 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:28,960 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:28,980 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:28,981 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:28,982 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:28,982 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:28,983 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:28,983 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:28,983 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:28,984 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:28,984 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:28,985 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:28,985 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:28,986 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:28,986 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:28,986 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:28,987 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:28,987 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:28.987550+07:00
2025-10-11 05:00:28,987 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:28.987550+07:00
2025-10-11 05:00:28,988 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:28.987550+07:00 trong DST: True
2025-10-11 05:00:28,988 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:28,989 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:28,989 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:28,989 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:28,990 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:28,990 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:28,991 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:28,991 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:28,992 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:28,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:28,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:28,994 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:29,016 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:29,019 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:29,021 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:29,022 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:29,023 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:29,023 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:29,025 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:29,026 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:29,026 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:29,027 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:29,049 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 05:00:29,052 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:29,053 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:29,054 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:29,054 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:29,055 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:29,055 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:29,056 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:29,056 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:29,057 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:29,058 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:29,059 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:29,060 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:29,061 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:29,061 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:29,071 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:29,086 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:29,086 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:29,087 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:29,088 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:29,089 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:29,089 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:29,089 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:29,090 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:29,090 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:29,091 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:29,092 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:29,092 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:29,093 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:29,093 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:29,094 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:29,094 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:29,116 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:29,118 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:29,119 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:29,120 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:29,120 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:29,121 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:29,121 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:29,122 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:29,122 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:29,123 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:29,124 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:29,126 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:29,131 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:29,135 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:29,150 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:29,154 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:29,155 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:29,155 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:29,156 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:29,189 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:29,244 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:29,298 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:29,335 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:29,359 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:29,380 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:29,381 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:29,382 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:29,398 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:29,426 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:29,458 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.46s
2025-10-11 05:00:29,648 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:29,664 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:29,665 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:29,676 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:29,682 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:30,020 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:30,021 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:30,022 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:30,024 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:30,025 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:30,026 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:30,026 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:30,027 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:30,052 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:30,053 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:30,054 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:30,055 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:30,056 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:30,057 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:30,057 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:30,058 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:30,135 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:30,559 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:30,561 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:30,561 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:30,562 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:30,562 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:30,563 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:30,563 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:30,564 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:30,566 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:30,566 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:30,567 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:30,567 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:30,573 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:30,591 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:30,593 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:30,594 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:30,596 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:30,596 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:30,597 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:30,597 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:30,600 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:30,600 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:30,600 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:30,601 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:30,604 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:30,604 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:30,605 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:30,605 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:30,605 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:30,606 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:30.606296+07:00
2025-10-11 05:00:30,606 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:30.606296+07:00
2025-10-11 05:00:30,607 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:30.606296+07:00 trong DST: True
2025-10-11 05:00:30,607 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:30,607 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:30,608 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:30,609 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:30,610 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:30,616 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:30,635 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:30,636 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:30,636 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:30,637 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:30,637 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:30,638 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:30,638 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:30,638 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:30,639 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:30,639 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:30,640 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:30,640 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:30,640 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:30,641 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:30,641 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:30,641 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:30,642 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:30,642 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:30,644 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:30,645 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:30,664 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:30,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:30,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:30,667 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:30,668 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:30,668 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:30,669 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:30,669 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:30,670 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:30,670 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:30,671 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:30,671 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:30,671 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:30,672 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:30,672 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:30,673 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:30,673 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:30,674 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:30,674 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:30,675 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:30.675083+07:00
2025-10-11 05:00:30,675 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:30.675083+07:00
2025-10-11 05:00:30,675 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:30.675083+07:00 trong DST: True
2025-10-11 05:00:30,676 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:30,676 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:30,677 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:30,677 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,678 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:30,678 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:30,679 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:30,679 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,704 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:30,706 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:30,708 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:30,708 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:30,709 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:30,710 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:30,710 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:30,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:30,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:30,712 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:30,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:30,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:30,736 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:30,737 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:30,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:30,796 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:30,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:30,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:30,798 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:30,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:30,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:30,800 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:30,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:30,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:30,802 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:30,802 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,802 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:30,803 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:30,803 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:30,804 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:30,804 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:30,804 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:30,805 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:30,805 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:30,805 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:30,806 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:30,806 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:30,806 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:30,807 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:30,807 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:30,807 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:30,808 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:30,808 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:30,808 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,809 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:30,809 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:30,809 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:30,811 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:30,811 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:30,812 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:30,824 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:00:30,840 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:30,841 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:30,842 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,844 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:30,860 - APP.services.fmp_service - INFO - Lấy thành công 400 sự kiện từ investpy cho 7 ngày tới.
2025-10-11 05:00:30,872 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:30,875 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:30,876 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 7.97s
2025-10-11 05:00:30,876 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:30,877 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:30,897 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:30,906 - APP.ui.app_ui - DEBUG - Callback nhận được 138 sự kiện tin tức mới.
2025-10-11 05:00:30,907 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,908 - APP.services.news_service - INFO - NewsService làm mới cache (138 sự kiện, priority=autorun, source=network, latency=8.02s)
2025-10-11 05:00:30,908 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:30,909 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 8.03s
2025-10-11 05:00:30,909 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,910 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:30,910 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:30,911 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:30,911 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:30,912 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:30,912 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:30,929 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.91s
2025-10-11 05:00:31,004 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:00:31,007 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:31,008 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:31,009 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:31,010 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:31,011 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:31,038 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:31,043 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:31,044 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:31,045 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:31,055 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:31,066 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:31,068 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:31,068 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:31,069 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-11 05:00:31,117 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:31,117 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:31,118 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:31,118 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:31,119 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:31,119 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:31,120 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:31,120 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:31,156 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:31,621 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:31,623 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:31,624 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:31,624 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:31,625 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:31,625 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:31,625 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:31,626 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:31,628 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:31,629 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:31,629 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:31,630 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:31,636 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:31,653 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:31,654 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:31,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:31,658 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:31,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:31,658 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:31,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:31,662 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:31,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:31,663 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:31,663 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:31,688 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:31,688 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:31,689 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:31,690 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:31,690 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:31,690 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:31.690762+07:00
2025-10-11 05:00:31,691 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:31.690762+07:00
2025-10-11 05:00:31,691 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:31.690762+07:00 trong DST: True
2025-10-11 05:00:31,692 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:31,692 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:31,692 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:31,694 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:31,694 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:31,699 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:31,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:31,718 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:31,719 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:31,719 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:31,720 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:31,720 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:31,720 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:31,721 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:31,721 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:31,722 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:31,722 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:31,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:31,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:31,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:31,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:31,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:31,725 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:31,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:31,726 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:31,726 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:31,727 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:31,727 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:31,728 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:31,728 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:31,729 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:31,730 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:31,730 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:31,731 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:31,756 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:31,758 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:31,758 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:31,759 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:31,759 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:31,760 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:31,760 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:31,761 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:31,762 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:31,763 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:31,764 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:31,764 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:31.764670+07:00
2025-10-11 05:00:31,765 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:31.764670+07:00
2025-10-11 05:00:31,791 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:31.764670+07:00 trong DST: True
2025-10-11 05:00:31,792 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:31,793 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:31,794 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:31,794 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,794 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:31,795 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:31,796 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:31,797 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,797 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:31,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:31,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:31,817 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:31,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:31,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:31,819 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:31,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:31,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:31,820 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:31,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:31,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:31,821 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:31,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:31,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:31,823 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:31,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:31,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:31,825 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:31,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:31,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:31,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:31,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:31,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:31,828 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:31,829 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,830 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:31,830 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:31,831 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:31,833 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:31,855 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:31,856 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:31,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:31,857 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:31,857 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:31,857 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:31,858 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:31,858 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:31,858 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:31,859 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:31,859 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:31,860 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:31,860 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:31,860 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,861 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:31,861 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:31,862 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:31,862 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:31,862 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:31,863 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:31,867 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:31,892 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,893 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:31,893 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:31,893 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:31,897 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:31,918 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:31,919 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:31,920 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:31,921 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,921 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:31,922 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,922 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:31,923 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:31,923 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:31,924 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:31,924 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:31,924 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:31,926 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-11 05:00:31,994 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:31,995 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:31,996 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:31,996 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:31,999 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:32,075 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:32,076 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:32,077 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:32,080 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:32,081 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:32,082 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:32,083 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:32,083 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:32,086 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:32,087 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:32,088 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:32,088 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:32,089 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:32,089 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:32,089 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:32,090 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:32,106 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:32,591 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:32,592 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:32,593 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:32,594 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:32,594 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:32,595 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:32,595 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:32,595 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:32,598 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:32,598 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:32,598 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:32,599 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:32,605 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:32,622 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:32,622 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:32,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:32,626 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:32,627 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:32,627 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:32,628 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:32,633 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:32,648 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:32,649 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:32,651 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:32,653 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:32,654 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:32,654 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:32,655 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:32,655 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:32,655 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:32.655911+07:00
2025-10-11 05:00:32,656 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:32.655911+07:00
2025-10-11 05:00:32,656 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:32.655911+07:00 trong DST: True
2025-10-11 05:00:32,656 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:32,657 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:32,657 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:32,658 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:32,659 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:32,662 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:32,684 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:32,686 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:32,687 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:32,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:32,708 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:32,709 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:32,710 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:32,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:32,711 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:32,711 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:32,730 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:32,732 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:32,732 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:32,733 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:32,733 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:32,734 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:32,757 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:32,759 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:32,787 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:32,788 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:32,789 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:32,789 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:32,789 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:32,790 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:32,790 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:32,791 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:32,791 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:32,792 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:32,793 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:32,793 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:32,794 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:32,794 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:32,795 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:32,795 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:32,819 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:32,820 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:32,821 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:32,821 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:32,821 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:32,822 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:32.822395+07:00
2025-10-11 05:00:32,822 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:32.822395+07:00
2025-10-11 05:00:32,823 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:32.822395+07:00 trong DST: True
2025-10-11 05:00:32,823 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:32,824 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:32,824 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:32,824 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,825 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:32,825 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:32,825 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:32,826 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,828 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:32,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:32,833 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:32,852 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:32,853 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:32,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:32,854 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:32,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:32,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:32,856 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:32,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:32,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:32,858 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:32,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:32,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:32,860 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:32,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:32,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:32,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:32,888 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:32,889 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:32,890 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:32,890 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:32,891 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:32,892 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:32,892 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,893 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:32,893 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:32,894 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:32,894 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:32,895 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:32,895 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:32,895 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:32,896 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:32,919 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:32,920 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:32,921 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:32,921 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:32,922 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:32,922 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:32,923 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:32,923 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:32,924 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:32,924 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,924 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:32,925 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:32,925 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:32,926 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:32,926 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:32,927 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:32,929 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:32,954 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,955 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:32,955 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:32,955 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:32,959 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:32,959 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:32,960 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:32,960 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:32,962 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:32,963 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,963 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:32,964 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:32,984 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:32,985 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:32,987 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:32,988 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:32,989 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.91s
2025-10-11 05:00:33,053 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:33,054 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:33,054 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:33,057 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:33,060 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:33,104 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:33,105 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:33,106 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:33,108 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:33,109 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:33,110 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:33,111 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:33,111 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:33,118 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:33,118 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:33,119 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:33,119 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:33,120 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:33,120 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:33,121 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:33,121 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:33,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:33,622 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:33,624 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:33,625 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:33,625 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:33,625 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:33,626 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:33,626 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:33,627 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:33,629 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:33,629 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:33,630 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:33,630 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:33,636 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:33,654 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:33,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:33,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:33,658 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:33,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:33,658 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:33,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:33,662 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:33,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:33,663 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:33,663 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:33,669 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:33,687 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:33,688 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:33,689 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:33,689 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:33,690 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:33.690069+07:00
2025-10-11 05:00:33,690 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:33.690069+07:00
2025-10-11 05:00:33,691 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:33.690069+07:00 trong DST: True
2025-10-11 05:00:33,691 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:33,691 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:33,692 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:33,693 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:33,693 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:33,699 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:33,719 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:33,719 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:33,720 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:33,721 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:33,721 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:33,721 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:33,722 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:33,722 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:33,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:33,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:33,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:33,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:33,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:33,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:33,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:33,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:33,726 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:33,726 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:33,727 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:33,727 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:33,728 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:33,729 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:33,730 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:33,730 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:33,731 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:33,756 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:33,757 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:33,757 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:33,758 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:33,758 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:33,759 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:33,759 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:33,760 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:33,760 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:33,760 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:33,762 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:33,763 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:33,788 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:33,790 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:33,790 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:33.790888+07:00
2025-10-11 05:00:33,791 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:33.790888+07:00
2025-10-11 05:00:33,791 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:33.790888+07:00 trong DST: True
2025-10-11 05:00:33,792 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:33,792 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:33,793 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:33,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,794 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:33,794 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:33,795 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:33,795 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,796 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:33,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:33,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:33,797 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:33,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:33,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:33,821 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:33,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:33,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:33,823 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:33,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:33,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:33,825 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:33,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:33,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:33,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:33,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:33,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:33,828 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:33,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:33,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:33,830 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:33,830 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:33,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:33,854 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:33,854 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,855 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:33,855 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:33,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:33,883 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:33,884 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:33,884 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:33,885 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:33,909 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:33,911 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:33,912 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:33,912 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:33,913 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:33,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:33,914 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:33,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:33,938 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:33,939 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:33,939 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,940 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:33,940 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:33,941 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:33,941 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:33,942 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:33,942 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:33,944 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:33,945 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,946 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:33,946 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:33,947 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:33,952 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:33,973 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:33,975 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:33,975 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:33,976 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,977 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:33,977 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,977 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:33,978 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:33,978 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:33,978 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:33,979 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:33,980 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:33,983 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-11 05:00:34,012 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:34,014 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:34,020 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:34,042 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:34,044 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:34,111 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:34,112 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:34,113 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:34,115 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:34,116 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:34,117 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:34,117 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:34,118 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:34,122 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:34,123 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:34,124 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:34,124 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:34,125 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:34,125 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:34,126 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:34,126 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:34,151 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:34,628 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:34,629 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:34,630 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:34,630 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:34,631 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:34,631 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:34,632 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:34,632 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:34,634 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:34,635 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:34,635 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:34,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:34,642 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:34,659 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:34,660 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:34,660 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:34,663 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:34,664 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:34,665 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:34,665 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:34,670 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:34,688 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:34,690 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:34,691 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:34,693 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:34,694 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:34,694 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:34,695 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:34,695 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:34,696 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:34.696095+07:00
2025-10-11 05:00:34,697 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:34.696095+07:00
2025-10-11 05:00:34,697 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:34.696095+07:00 trong DST: True
2025-10-11 05:00:34,697 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:34,698 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:34,698 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:34,702 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:34,722 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:34,726 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:34,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:34,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:34,728 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:34,728 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:34,729 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:34,730 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:34,730 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:34,731 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:34,735 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:34,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:34,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:34,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:34,757 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:34,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:34,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:34,759 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:34,759 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:34,760 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:34,761 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:34,761 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:34,762 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:34,763 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:34,764 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:34,764 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:34,789 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:34,792 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:34,793 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:34,793 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:34,794 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:34,794 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:34,795 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:34,796 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:34,796 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:34,797 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:34,820 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:34,822 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:34,823 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:34,824 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:34,825 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:34,825 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:34.825427+07:00
2025-10-11 05:00:34,825 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:34.825427+07:00
2025-10-11 05:00:34,826 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:34.825427+07:00 trong DST: True
2025-10-11 05:00:34,826 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:34,826 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:34,827 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:34,827 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,827 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:34,828 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:34,828 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:34,830 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,831 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:34,831 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:34,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:34,854 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:34,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:34,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:34,856 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:34,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:34,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:34,858 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:34,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:34,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:34,860 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:34,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:34,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:34,861 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:34,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:34,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:34,864 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:34,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:34,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:34,890 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:34,891 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:34,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:34,893 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:34,893 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,894 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:34,894 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:34,894 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:34,895 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:34,895 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:34,896 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:34,896 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:34,896 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:34,897 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:34,897 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:34,898 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:34,898 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:34,899 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:34,922 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:34,923 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:34,924 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:34,925 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:34,926 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,926 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:34,926 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:34,927 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:34,927 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:34,928 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:34,929 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:34,930 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:34,956 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,957 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:34,957 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:34,958 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:34,961 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:34,961 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:34,962 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:34,964 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:34,964 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,965 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:34,965 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,966 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:34,966 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:34,966 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:34,967 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:34,977 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:34,988 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:34,990 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.88s
2025-10-11 05:00:35,062 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:35,063 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:35,063 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:35,066 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:35,069 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:35,116 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:35,116 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:35,118 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:35,120 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:35,121 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:35,122 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:35,123 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:35,123 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:35,131 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:35,132 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:35,132 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:35,133 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:35,134 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:35,134 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:35,156 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:35,157 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:35,178 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:35,659 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:35,661 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:35,661 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:35,662 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:35,662 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:35,663 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:35,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:35,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:35,666 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:35,666 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:35,667 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:35,668 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:35,673 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:35,692 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:35,693 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:35,694 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:35,696 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:35,696 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:35,696 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:35,697 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:35,700 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:35,701 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:35,723 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:35,723 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:35,726 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:35,727 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:35,727 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:35,728 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:35,728 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:35,729 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:35.729035+07:00
2025-10-11 05:00:35,729 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:35.729035+07:00
2025-10-11 05:00:35,729 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:35.729035+07:00 trong DST: True
2025-10-11 05:00:35,730 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:35,730 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:35,731 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:35,732 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:35,732 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:35,738 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:35,765 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:35,766 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:35,766 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:35,767 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:35,767 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:35,768 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:35,768 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:35,768 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:35,769 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:35,770 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:35,772 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:35,772 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:35,796 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:35,797 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:35,797 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:35,798 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:35,798 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:35,799 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:35,800 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:35,800 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:35,801 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:35,801 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:35,808 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:35,823 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:35,824 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:35,825 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:35,826 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:35,826 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:35,827 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:35,827 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:35,827 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:35,828 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:35,828 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:35,829 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:35,829 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:35,830 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:35,830 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:35,831 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:35,831 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:35,831 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:35.831541+07:00
2025-10-11 05:00:35,831 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:35.831541+07:00
2025-10-11 05:00:35,832 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:35.831541+07:00 trong DST: True
2025-10-11 05:00:35,832 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:35,832 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:35,833 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:35,834 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,834 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:35,835 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:35,854 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:35,854 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,855 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:35,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:35,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:35,857 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:35,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:35,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:35,859 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:35,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:35,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:35,860 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:35,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:35,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:35,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:35,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:35,863 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:35,863 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:35,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:35,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:35,865 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:35,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:35,866 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:35,867 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:35,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:35,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:35,869 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:35,893 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,894 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:35,895 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:35,896 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:35,897 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:35,897 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:35,898 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:35,898 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:35,898 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:35,899 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:35,899 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:35,900 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:35,900 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:35,901 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:35,901 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:35,902 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:35,916 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:35,926 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:35,927 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,928 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:35,928 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:35,929 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:35,929 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:35,930 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:35,930 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:35,932 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:35,933 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,934 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:35,936 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:35,943 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:35,956 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:35,959 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:35,959 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:35,960 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:35,960 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,961 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:35,961 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,961 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:35,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:35,962 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:35,963 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:35,963 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:35,963 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:35,965 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 05:00:35,999 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:36,000 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:36,001 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:36,029 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:36,032 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:36,121 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:36,121 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:36,123 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:36,125 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:36,126 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:36,127 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:36,127 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:36,128 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:36,151 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:36,345 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:36,346 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:36,346 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:36,347 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:36,347 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:36,348 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:36,348 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:36,349 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:36,850 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:36,852 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:36,852 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:36,852 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:36,853 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:36,853 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:36,854 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:36,854 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:36,856 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:36,856 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:36,857 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:36,857 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:36,864 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:36,884 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:36,885 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:36,886 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:36,888 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:36,888 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:36,888 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:36,889 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:36,892 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:36,892 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:36,893 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:36,893 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:36,896 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:36,896 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:36,897 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:36,897 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:36,897 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:36,898 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:36.898325+07:00
2025-10-11 05:00:36,898 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:36.898325+07:00
2025-10-11 05:00:36,899 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:36.898325+07:00 trong DST: True
2025-10-11 05:00:36,899 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:36,899 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:36,900 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:36,901 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:36,902 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:36,908 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:36,927 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:36,928 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:36,928 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:36,929 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:36,929 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:36,930 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:36,930 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:36,930 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:36,931 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:36,931 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:36,931 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:36,932 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:36,932 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:36,933 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:36,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:36,934 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:36,934 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:36,935 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:36,936 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:36,936 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:36,957 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:36,958 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:36,959 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:36,959 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:36,960 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:36,960 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:36,961 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:36,961 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:36,962 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:36,962 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:36,962 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:36,963 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:36,963 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:36,964 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:36,964 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:36,965 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:36,965 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:36,965 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:36,966 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:36,966 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:36.966756+07:00
2025-10-11 05:00:36,967 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:36.966756+07:00
2025-10-11 05:00:36,967 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:36.966756+07:00 trong DST: True
2025-10-11 05:00:36,968 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:36,969 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:36,969 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:36,969 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:36,970 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:36,972 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:36,989 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:36,990 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:36,990 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:36,991 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:36,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:36,992 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:36,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:36,994 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:36,995 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:36,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:36,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:36,996 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:36,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:36,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:36,998 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:36,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:36,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:36,999 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:37,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:37,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:37,001 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:37,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:37,002 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:37,003 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:37,003 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:37,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:37,033 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:37,034 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:37,035 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:37,035 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:37,037 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:37,037 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:37,037 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:37,061 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:37,064 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:37,065 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:37,065 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:37,066 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:37,066 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:37,067 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:37,067 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:37,067 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:37,068 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:37,068 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:37,068 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:37,069 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:37,070 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:37,070 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:37,094 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:37,095 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:37,097 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:37,098 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:37,100 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:37,102 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:37,103 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:37,103 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:37,103 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:37,109 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:37,126 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:37,126 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:37,129 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:37,130 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:37,132 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:37,133 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:37,134 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:37,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:37,135 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:37,136 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:37,137 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:37,137 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:37,138 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:37,138 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:37,159 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:37,159 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:37,160 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:37,170 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:37,255 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:37,310 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.19s
2025-10-11 05:00:37,315 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:37,316 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:37,317 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:37,318 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:37,321 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:38,133 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:38,134 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:38,135 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:38,137 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:38,138 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:38,139 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:38,140 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:38,141 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:38,169 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:38,169 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:38,170 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:38,170 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:38,171 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:38,172 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:38,172 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:38,173 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:38,193 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:38,693 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:38,695 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:38,695 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:38,696 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:38,696 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:38,697 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:38,697 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:38,698 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:38,700 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:38,700 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:38,701 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:38,701 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:38,707 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:38,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:38,726 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:38,727 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:38,729 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:38,730 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:38,730 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:38,730 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:38,758 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:38,758 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:38,759 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:38,759 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:38,763 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:38,763 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:38,764 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:38,790 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:38,792 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:38,792 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:38.792917+07:00
2025-10-11 05:00:38,793 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:38.792917+07:00
2025-10-11 05:00:38,794 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:38.792917+07:00 trong DST: True
2025-10-11 05:00:38,794 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:38,795 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:38,795 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:38,796 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:38,797 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:38,803 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:38,821 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:38,823 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:38,824 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:38,825 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:38,825 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:38,826 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:38,826 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:38,827 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:38,827 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:38,828 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:38,828 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:38,829 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:38,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:38,830 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:38,830 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:38,831 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:38,831 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:38,832 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:38,853 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:38,854 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:38,854 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:38,855 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:38,855 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:38,855 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:38,856 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:38,856 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:38,857 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:38,857 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:38,857 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:38,858 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:38,858 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:38,858 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:38,858 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:38,859 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:38,859 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:38,860 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:38,860 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:38,861 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:38,861 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:38,862 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:38.861950+07:00
2025-10-11 05:00:38,862 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:38.861950+07:00
2025-10-11 05:00:38,863 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:38.861950+07:00 trong DST: True
2025-10-11 05:00:38,864 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:38,864 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:38,865 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:38,865 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:38,887 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:38,890 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:38,891 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:38,891 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:38,892 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:38,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:38,893 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:38,894 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:38,894 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:38,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:38,896 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:38,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:38,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:38,898 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:38,898 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:38,921 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:38,922 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:38,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:38,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:38,924 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:38,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:38,925 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:38,926 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:38,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:38,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:38,928 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:38,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:38,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:38,929 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:38,930 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:38,930 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:38,931 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:38,931 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:38,932 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:38,932 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:38,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:38,956 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:38,957 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:38,957 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:38,958 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:38,958 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:38,959 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:38,959 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:38,960 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:38,960 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:38,960 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:38,961 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:38,961 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:38,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:38,963 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:38,964 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:38,965 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:38,965 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:38,988 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:38,990 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:38,992 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:38,993 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:38,993 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:38,993 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:38,994 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:38,997 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:38,998 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:39,014 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:39,024 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,025 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:39,026 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,026 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,027 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:39,027 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:39,028 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:39,028 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:39,028 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:39,030 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.90s
2025-10-11 05:00:39,131 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:39,132 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:39,132 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:39,133 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:39,135 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:39,184 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:39,185 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:39,186 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:39,188 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:39,190 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:39,191 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:39,192 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:39,192 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:00:39,196 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:39,197 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:39,198 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:39,199 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:39,199 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:39,201 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:39,222 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:39,223 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:39,258 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:39,725 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:39,726 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:39,727 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:39,727 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:39,728 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:39,728 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:39,728 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:39,729 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:39,731 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:39,731 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:39,731 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:39,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:39,735 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:39,762 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:39,763 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:39,764 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:39,766 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:39,768 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:39,794 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:39,795 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:39,798 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:39,799 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:39,800 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:39,800 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:39,805 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:39,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:39,826 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:39,826 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:39,827 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:39,827 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:39.827891+07:00
2025-10-11 05:00:39,828 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:39.827891+07:00
2025-10-11 05:00:39,828 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:39.827891+07:00 trong DST: True
2025-10-11 05:00:39,829 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:39,829 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:39,829 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:39,830 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:39,831 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:39,837 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:39,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:39,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:39,856 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:39,856 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:39,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:39,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:39,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:39,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:39,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:39,859 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:39,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:39,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:39,861 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:39,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:39,861 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:39,862 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:39,862 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:39,862 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:39,863 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:39,864 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:39,864 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:39,866 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:39,866 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:39,867 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:39,867 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:39,891 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:39,892 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:39,894 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:39,895 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:39,895 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:39,896 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:39,896 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:39,896 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:39,897 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:39,897 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:39,899 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:39,899 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:39,900 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:39,900 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:39,921 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:39.921677+07:00
2025-10-11 05:00:39,922 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:39.921677+07:00
2025-10-11 05:00:39,923 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:39.921677+07:00 trong DST: True
2025-10-11 05:00:39,924 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:39,924 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:39,925 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:39,925 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,925 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:39,926 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:39,927 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:39,927 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,927 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:39,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:39,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:39,929 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:39,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:39,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:39,931 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:39,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:39,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:39,933 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:39,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:39,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:39,952 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:39,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:39,956 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:39,957 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:39,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:39,966 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:39,978 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:39,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:39,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:39,982 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:39,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:39,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:39,984 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:39,985 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,985 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:39,985 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:39,986 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:39,986 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:39,987 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:39,987 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:39,988 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:39,988 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:39,988 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:39,989 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:39,989 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:39,989 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:39,990 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:39,990 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:39,990 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:39,991 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:39,991 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:39,992 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,992 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:39,992 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:39,993 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:39,993 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:39,993 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:39,994 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:39,995 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:39,997 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:39,999 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:39,999 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:39,999 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:40,005 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:40,025 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:40,027 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:40,027 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:40,028 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:40,029 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:40,029 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:40,030 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:40,030 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:40,031 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:40,031 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:40,032 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:40,033 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:40,034 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-11 05:00:40,100 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:40,102 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:40,103 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:40,104 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:40,106 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:40,190 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:40,191 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:40,192 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:40,195 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:40,196 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:40,197 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:40,198 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:40,199 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:40,259 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:40,264 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:40,323 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:40,379 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:40,403 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:40,572 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:40,602 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:40,643 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:40,712 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:41,195 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:41,263 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:41,265 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:41,266 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:41,266 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:41,267 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:41,268 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:41,269 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:41,270 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:41,270 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:41,271 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:41,271 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-11 05:00:41,272 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:41,273 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:41,296 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:41,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:41,297 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:41,310 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:41,337 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:41,374 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:41,403 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:41,425 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:41,459 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:41,503 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:41,535 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:41,561 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:41,566 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:41,570 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:41,597 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:41,637 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:41,659 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:41,663 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:41,665 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:41,667 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:41,668 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:41,670 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:41,697 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:41.697482+07:00
2025-10-11 05:00:41,698 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:41.697482+07:00
2025-10-11 05:00:41,699 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:41.697482+07:00 trong DST: True
2025-10-11 05:00:41,699 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:41,704 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:41,727 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:41,731 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:41,732 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:41,740 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:41,784 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:41,817 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:41,822 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:41,826 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:41,828 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:41,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:41,895 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:41,896 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:41,925 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:41,929 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:41,931 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:41,933 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:41,959 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:41,961 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:41,965 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:41,966 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:41,966 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:41,968 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:41,969 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:41,970 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:41,970 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:41,971 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:41,995 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:42,022 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:42,050 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:42,050 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:42,051 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:42,052 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 05:00:42,052 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:42,055 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:42,055 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:42,056 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:42,082 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:42,083 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:42,084 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:42,084 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:42,085 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:42,085 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:42,086 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:42,087 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:42,088 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:42,088 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:42,088 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:42.088804+07:00
2025-10-11 05:00:42,089 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:42.088804+07:00
2025-10-11 05:00:42,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:42.088804+07:00 trong DST: True
2025-10-11 05:00:42,110 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:42,110 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:42,111 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:42,111 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,112 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:42,112 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:42,113 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:42,113 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,114 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:42,114 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:42,115 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:42,115 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:42,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:42,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:42,117 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:42,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:42,119 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:42,120 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:42,121 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:42,122 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:42,122 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:42,147 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:42,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:42,149 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:42,150 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:42,150 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:00:42,151 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:42,152 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:42,152 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:42,153 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:42,154 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:42,154 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:42,155 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:42,155 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:42,156 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,159 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:42,179 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:42,180 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:42,181 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:42,181 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:42,182 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:42,182 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:42,182 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:42,183 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:42,183 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:42,184 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:42,184 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:42,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:42,186 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:42,186 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:42,187 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:42,187 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:42,188 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,188 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:42,189 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:42,189 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:42,190 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:42,191 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:42,193 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:42,196 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:42,218 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:42,219 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,222 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:42,222 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:42,240 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:42,241 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:42,243 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:42,244 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:42,247 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:42,249 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:42,249 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:42,250 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:42,250 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:42,251 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,252 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-11 05:00:42,252 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:42,253 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,254 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:42,254 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:42,255 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:42,256 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:42,256 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:42,257 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:42,280 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.09s
2025-10-11 05:00:42,352 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:42,534 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:42,573 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:42,613 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:42,615 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:42,650 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:43,222 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:43,228 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:43,230 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:43,239 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:43,444 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:43,566 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:43,575 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:43,605 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:43,617 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:43,653 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:43,654 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:43,655 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:43,657 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:43,658 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.42s
2025-10-11 05:00:43,659 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:43,722 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:43,729 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:44,240 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:44,426 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:44,427 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:44,429 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:44,429 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:44,430 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:44,430 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:44,432 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:44,433 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:44,434 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:44,436 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:44,437 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.20s
2025-10-11 05:00:44,439 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:44,462 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:44,469 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:44,470 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:44,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:44,471 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:44,475 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:44,475 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:44,476 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:44,477 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:44,480 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:44,480 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:44,481 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:44,481 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:44,486 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:44,512 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:44,513 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:44,514 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:44,517 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:44,543 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:44,543 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:44,545 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:44,652 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:44,714 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:44,719 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:44.719857+07:00
2025-10-11 05:00:44,753 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:44.719857+07:00
2025-10-11 05:00:44,761 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:44.719857+07:00 trong DST: True
2025-10-11 05:00:44,768 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:44,802 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:44,806 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:44,878 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:44,908 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:45,020 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:45,024 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:45,049 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:45,152 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:45,355 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:45,684 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:45,747 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:45,792 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:45,872 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:45,912 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:46,006 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:46,025 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:46,028 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:46,113 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:46,128 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:46,142 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:46,143 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.27s
2025-10-11 05:00:46,169 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:46,171 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:46,172 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:46,201 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:46,202 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:46,452 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:46,506 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:46,524 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:46,600 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:46,823 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:46,834 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:46,894 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:46,951 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:46,999 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:47,017 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:47,166 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:47,240 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:47,705 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:47,836 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:47,939 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:48,572 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:49,442 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:49,751 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:49,849 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:50,065 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:50,193 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:50,359 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:50,384 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 2.45s
2025-10-11 05:00:50,469 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:50,537 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:50,560 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:50,599 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:50,863 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:50,957 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:51,091 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:51,127 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:51,140 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:51,219 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:51,232 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:51,240 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:51,246 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:51.246105+07:00
2025-10-11 05:00:51,266 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:51,275 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:51.246105+07:00
2025-10-11 05:00:51,283 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:51,284 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:51.246105+07:00 trong DST: True
2025-10-11 05:00:51,291 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-11 05:00:51,300 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:51,306 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:51,308 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:51,309 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,310 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:51,311 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:51,313 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:51,314 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,316 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:51,316 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:51,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:51,322 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:51,323 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:51,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:51,326 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:51,328 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:51,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:51,331 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:51,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:51,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:51,333 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:51,334 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:51,335 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:51,336 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:51,337 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:51,338 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:51,339 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:51,339 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:51,340 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:51,341 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:51,342 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:51,342 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:51,343 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:51,343 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,344 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:51,344 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:51,345 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:51,345 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:51,346 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:51,348 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:51,349 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:51,349 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:51,349 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:51,350 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:51,351 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:51,351 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:51,352 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:51,352 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:51,353 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:51,353 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:51,354 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:51,359 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,359 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:51,360 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:51,360 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:51,361 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:51,362 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:51,363 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:51,371 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:51,377 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:51,377 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,378 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:51,381 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:51,385 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:51,387 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:51,388 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:51,389 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:51,390 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,391 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:51,392 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,392 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:51,392 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:51,393 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:51,393 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:51,394 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:51,394 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:51,396 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 8.17s
2025-10-11 05:00:52,159 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:52,412 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:52,521 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:52,529 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:52,532 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:52,535 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:52,539 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:52,540 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:52,542 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:00:52,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:52,550 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:52,552 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:52,588 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:52,591 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 05:00:53,691 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:53,859 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:53,863 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:53,864 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:53,866 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:53,868 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:53,871 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:00:54,116 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:54,555 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:54,556 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:54,557 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:54,558 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:00:54,558 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:00:54,559 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:00:54,559 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:00:54,560 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:00:54,926 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:55,062 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:00:55,064 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:00:55,065 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:55,066 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:00:55,066 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:55,067 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:00:55,069 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:55,069 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:00:55,070 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:55,070 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:00:55,134 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.21s
2025-10-11 05:00:55,188 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:00:55,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:55,259 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:00:55,311 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:55,316 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:00:55,336 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:55,366 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:00:55,425 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:00:55,430 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:55,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:00:55,493 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:00:55,690 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:00:55,710 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:55,714 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:00:55,715 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:00:55,724 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:00:55,749 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:55,750 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:00:55,821 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:00:55,842 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:55,900 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:00:55,921 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:00:55,962 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:00:56,005 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:56,032 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:56,084 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:56.082201+07:00
2025-10-11 05:00:56,096 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:56,099 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:56.082201+07:00
2025-10-11 05:00:56,100 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:56,106 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:56.082201+07:00 trong DST: True
2025-10-11 05:00:56,110 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:56,111 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:56,113 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:56,114 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-11 05:00:56,115 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:56,163 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:00:56,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:56,173 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:00:56,277 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:00:56,374 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:00:56,431 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:56,438 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:00:56,500 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:56,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:00:56,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:00:56,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:00:56,786 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:00:56,840 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:00:56,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:00:56,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:00:56,939 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:00:56,993 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:00:57,003 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:00:57,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:00:57,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:00:57,056 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:57,094 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:00:57,100 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:00:57,101 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 05:00:57,160 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:00:57,169 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:57,215 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:00:57,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:57,220 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:00:57,222 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:00:57,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:57,226 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:57,228 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:57,229 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:00:57,233 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:57,269 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-11 05:00:57,272 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:00:57,274 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:00:57,274 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:00:57,278 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:00:57,282 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:00:57,285 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:00:57,290 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:00:57,349 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:57,358 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:00:57,454 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:00:57,469 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:00:57,568 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:00:57,653 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:00:57,670 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:57,673 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:00:57,674 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:00:57,675 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:00:57,676 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:00:57,677 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:00:57,678 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:00:57.678458+07:00
2025-10-11 05:00:57,679 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:00:57.678458+07:00
2025-10-11 05:00:57,680 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:00:57.678458+07:00 trong DST: True
2025-10-11 05:00:57,681 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:00:57,684 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:00:57,696 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 60
2025-10-11 05:00:57,749 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:57,757 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:57,819 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:00:57,875 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:00:57,878 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:57,880 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:57,883 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:57,885 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:57,942 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:58,031 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:58,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:58,135 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:00:58,223 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:58,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:00:58,314 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:58,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:00:58,495 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:58,623 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:58,760 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:58,883 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:00:58,896 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:58,897 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:58,956 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.70s
2025-10-11 05:00:59,008 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:00:59,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:00:59,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:00:59,013 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:00:59,016 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:00:59,017 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:59,018 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:00:59,018 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:00:59,019 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:00:59,020 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:00:59,020 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:00:59,022 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:00:59,022 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:00:59,183 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:59,236 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:59,257 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:59,318 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:59,389 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:59,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:59,439 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:59,439 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:59,440 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:59,440 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:59,441 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:59,443 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:00:59,444 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:00:59,444 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:00:59,445 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:00:59,445 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:00:59,445 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:00:59,446 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:00:59,446 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:00:59,446 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:59,446 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:00:59,447 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:59,450 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:00:59,450 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:00:59,452 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:00:59,502 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:00:59,555 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:00:59,558 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:00:59,559 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:00:59,570 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:00:59,610 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.16s
2025-10-11 05:00:59,623 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:59,630 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:00:59,632 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:59,633 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:00:59,633 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:00:59,635 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:00:59,641 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:00:59,646 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:00:59,690 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:00:59,690 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:00:59,696 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:59,697 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:59,749 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:59,751 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:00:59,751 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:00:59,752 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:00:59,752 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:00:59,754 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:00:59,755 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:00:59,757 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 7.22s
2025-10-11 05:00:59,773 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:59,945 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:00:59,948 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:00:59,949 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:00:59,950 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:00:59,954 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:00,552 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:00,553 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:00,555 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:00,557 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:00,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:00,559 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:00,560 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:00,561 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:00,695 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:00,999 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:01,000 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:01,001 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:01,001 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:01,002 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:01,002 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:01,003 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:01,003 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:01,504 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:01,506 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:01,507 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:01,507 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:01,508 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:01,508 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:01,508 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:01,509 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:01,512 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:01,513 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:01,513 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:01,513 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:01,523 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:01,544 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:01,545 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:01,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:01,551 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:01,551 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:01,552 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:01,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:01,555 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:01,556 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:01,556 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:01,556 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:01,559 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:01,559 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:01,560 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:01,563 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:01,564 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:01,565 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:01,565 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:01,566 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:01,566 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:01,567 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:01,568 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:01,568 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:01.568650+07:00
2025-10-11 05:01:01,569 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:01.568650+07:00
2025-10-11 05:01:01,569 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:01.568650+07:00 trong DST: True
2025-10-11 05:01:01,569 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:01,570 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:01,570 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:01,571 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:01,572 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:01,577 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:01,577 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:01,608 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:01,609 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:01,609 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:01,610 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:01,611 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:01,612 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:01,613 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:01,613 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:01,613 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:01,614 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:01,614 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:01,614 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:01,615 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:01,615 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:01,616 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:01,618 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:01,618 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:01,619 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:01,619 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:01,620 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:01,620 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:01,621 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:01,621 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:01,622 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:01,622 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:01,623 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:01,623 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:01,624 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:01,624 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:01,624 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:01,625 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:01,625 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:01,625 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:01,626 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:01,626 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:01,627 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:01,627 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:01,628 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:01,628 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:01.628382+07:00
2025-10-11 05:01:01,628 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:01.628382+07:00
2025-10-11 05:01:01,629 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:01.628382+07:00 trong DST: True
2025-10-11 05:01:01,629 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:01,629 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:01,630 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:01,630 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:01,631 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:01,631 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:01,632 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:01,632 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:01,632 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:01,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:01,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:01,634 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:01,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:01,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:01,636 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:01,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:01,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:01,639 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:01,639 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:01,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:01,671 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:01,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:01,673 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:01,674 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:01,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:01,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:01,676 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:01,676 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:01,688 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:01,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:01,712 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:01,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:01,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:01,873 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:01,874 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:01,875 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:01,886 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:01,936 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:01,937 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:01,938 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:01,941 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:01,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:01,945 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:01,947 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:01,951 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:01,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:02,001 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:02,010 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:02,063 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:02,065 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:02,066 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:02,069 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:02,076 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:02,077 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:02,128 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:02,131 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:02,132 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:02,132 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:02,133 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:02,136 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:02,138 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:02,138 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:02,139 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:02,177 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:02,178 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:02,179 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:02,180 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:02,182 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:02,182 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:02,183 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:02,183 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:02,184 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:02,184 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:02,185 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:02,185 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:02,185 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:02,186 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:02,187 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.63s
2025-10-11 05:01:02,242 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:02,244 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:02,245 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:02,246 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:02,250 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:02,693 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:02,694 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:02,695 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:02,697 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:02,698 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:02,699 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:02,706 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:02,707 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:02,729 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:02,746 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:02,750 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:02,754 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:02,755 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:02,756 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:02,756 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:02,756 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:02,800 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:03,257 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:03,259 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:03,260 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:03,260 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:03,260 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:03,261 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:03,261 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:03,262 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:03,264 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:03,265 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:03,265 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:03,266 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:03,275 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:03,297 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:03,298 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:03,299 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:03,303 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:03,305 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:03,306 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:03,307 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:03,310 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:03,311 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:03,311 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:03,312 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:03,315 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:03,315 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:03,316 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:03,317 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:03,317 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:03,317 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:03.317847+07:00
2025-10-11 05:01:03,318 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:03.317847+07:00
2025-10-11 05:01:03,318 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:03.317847+07:00 trong DST: True
2025-10-11 05:01:03,319 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:03,319 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:03,319 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:03,321 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:03,321 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:03,325 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:03,326 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:03,327 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:03,328 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:03,356 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:03,356 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:03,358 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:03,359 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:03,359 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:03,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:03,360 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:03,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:03,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:03,362 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:03,362 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:03,363 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:03,363 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:03,363 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:03,364 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:03,365 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:03,366 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:03,366 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:03,367 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:03,367 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:03,367 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:03,368 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:03,368 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:03,369 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:03,369 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:03,369 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:03,370 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:03,370 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:03,371 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:03,371 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:03,371 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:03,372 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:03,373 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:03,374 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:03,375 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:03,375 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:03,375 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:03.375677+07:00
2025-10-11 05:01:03,376 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:03.375677+07:00
2025-10-11 05:01:03,376 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:03.375677+07:00 trong DST: True
2025-10-11 05:01:03,377 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:03,377 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:03,377 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:03,378 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,378 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:03,379 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:03,379 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:03,380 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,380 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:03,380 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:03,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:03,381 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:03,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:03,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:03,384 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:03,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:03,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:03,385 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:03,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:03,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:03,388 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:03,389 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:03,395 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:03,422 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:03,423 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:03,423 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:03,425 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:03,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:03,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:03,426 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:03,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:03,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:03,428 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:03,429 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,429 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:03,430 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:03,430 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:03,431 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:03,431 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:03,432 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:03,432 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:03,433 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:03,433 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:03,433 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:03,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:03,434 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:03,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:03,435 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:03,435 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:03,435 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:03,436 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:03,436 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,436 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:03,437 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:03,437 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:03,438 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:03,438 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:03,439 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:03,441 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:03,442 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,443 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:03,443 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:03,443 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:03,447 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:03,447 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:03,448 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:03,449 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:03,451 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,452 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:03,452 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:03,486 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:03,488 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:03,488 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:03,488 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:03,489 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:03,490 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 05:01:03,527 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:03,547 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:03,548 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:03,549 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:03,554 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:03,698 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:03,699 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:03,701 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:03,703 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:03,703 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:03,705 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:03,706 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:03,707 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:03,711 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:03,712 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:03,713 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:03,714 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:03,714 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:03,715 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:03,715 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:03,716 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:03,767 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:04,217 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:04,219 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:04,219 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:04,220 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:04,220 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:04,221 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:04,221 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:04,221 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:04,224 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:04,225 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:04,225 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:04,226 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:04,236 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:04,256 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:04,257 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:04,258 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:04,262 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:04,264 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:04,264 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:04,265 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:04,268 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:04,268 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:04,274 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:04,297 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:04,301 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:04,301 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:04,302 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:04,303 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:04,303 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:04,304 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:04.304084+07:00
2025-10-11 05:01:04,304 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:04.304084+07:00
2025-10-11 05:01:04,304 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:04.304084+07:00 trong DST: True
2025-10-11 05:01:04,305 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:04,306 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:04,306 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:04,308 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:04,308 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:04,313 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:04,313 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:04,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:04,315 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:04,316 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:04,316 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:04,316 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:04,317 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:04,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:04,317 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:04,318 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:04,318 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:04,319 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:04,319 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:04,320 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:04,320 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:04,320 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:04,321 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:04,322 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:04,322 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:04,323 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:04,323 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:04,324 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:04,324 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:04,325 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:04,326 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:04,327 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:04,327 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:04,328 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:04,362 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:04,363 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:04,364 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:04,365 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:04,366 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:04,366 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:04,367 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:04,367 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:04,368 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:04,368 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:04,369 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:04,370 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:04.370294+07:00
2025-10-11 05:01:04,371 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:04.370294+07:00
2025-10-11 05:01:04,371 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:04.370294+07:00 trong DST: True
2025-10-11 05:01:04,372 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:04,372 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:04,373 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:04,373 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,374 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:04,375 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:04,375 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:04,375 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,376 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:04,377 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:04,378 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:04,379 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:04,379 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:04,380 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:04,380 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:04,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:04,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:04,382 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:04,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:04,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:04,384 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:04,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:04,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:04,386 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:04,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:04,390 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:04,426 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:04,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:04,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:04,430 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:04,431 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:04,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:04,433 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:04,433 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,434 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:04,434 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:04,435 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:04,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:04,437 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:04,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:04,438 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:04,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:04,439 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:04,439 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:04,440 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:04,440 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:04,440 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:04,441 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:04,441 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:04,441 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:04,442 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:04,442 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,443 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:04,444 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:04,444 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:04,445 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:04,445 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:04,446 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:04,447 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:04,448 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:04,449 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:04,450 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,461 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:04,486 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:04,487 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:04,488 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:04,489 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:04,489 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,490 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:04,490 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,491 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:04,492 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:04,492 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:04,493 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:04,493 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:04,493 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:04,495 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 05:01:04,513 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:04,514 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:04,514 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:04,524 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:04,548 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:04,703 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:04,704 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:04,706 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:04,707 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:04,708 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:04,709 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:04,710 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:04,711 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:04,744 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:04,745 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:04,747 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:04,748 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:04,748 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:04,749 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:04,749 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:04,750 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:04,750 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:05,251 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:05,253 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:05,254 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:05,254 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:05,255 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:05,255 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:05,255 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:05,256 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:05,258 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:05,259 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:05,260 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:05,260 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:05,272 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:05,294 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:05,296 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:05,296 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:05,299 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:05,300 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:05,301 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:05,303 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:05,305 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:05,306 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:05,307 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:05,307 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:05,311 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:05,311 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:05,312 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:05,312 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:05,313 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:05,315 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:05.315204+07:00
2025-10-11 05:01:05,316 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:05.315204+07:00
2025-10-11 05:01:05,317 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:05.315204+07:00 trong DST: True
2025-10-11 05:01:05,317 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:05,318 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:05,319 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:05,320 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:05,323 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:05,334 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:05,357 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:05,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:05,362 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:05,363 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:05,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:05,364 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:05,365 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:05,366 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:05,366 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:05,368 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:05,368 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:05,368 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:05,369 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:05,369 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:05,369 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:05,370 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:05,370 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:05,371 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:05,372 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:05,372 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:05,373 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:05,373 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:05,374 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:05,374 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:05,375 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:05,375 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:05,376 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:05,376 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:05,382 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:05,383 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:05,383 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:05,384 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:05,384 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:05,386 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:05,390 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:05,424 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:05,426 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:05,428 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:05,429 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:05,430 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:05.429995+07:00
2025-10-11 05:01:05,430 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:05.429995+07:00
2025-10-11 05:01:05,432 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:05.429995+07:00 trong DST: True
2025-10-11 05:01:05,432 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:05,433 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:05,434 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:05,434 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:05,435 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:05,435 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:05,436 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:05,436 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:05,437 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:05,437 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:05,439 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:05,440 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:05,440 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:05,441 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:05,442 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:05,442 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:05,443 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:05,443 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:05,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:05,445 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:05,445 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:05,446 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:05,447 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:05,447 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:05,448 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:05,449 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:05,451 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:05,451 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:05,486 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:05,489 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:05,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:05,532 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:05,571 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:05,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:05,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:05,575 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:05,614 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:05,614 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:05,616 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:05,617 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:05,617 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:05,652 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:05,654 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:05,655 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:05,656 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:05,657 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:05,658 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:05,696 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:05,697 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:05,699 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:05,700 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:05,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:05,735 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:05,735 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:05,738 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:05,773 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:05,774 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:05,775 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:05,775 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:05,777 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:05,807 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:05,808 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:05,810 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-11 05:01:05,811 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:05,886 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:05,994 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:06,041 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:06,041 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:06,042 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:06,116 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:06,182 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:06,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:06,186 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:06,186 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:06,187 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:06,233 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:06,257 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:06,259 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:06,261 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:06,263 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:06,291 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:06,310 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:06,327 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:06,374 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.67s
2025-10-11 05:01:06,437 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:06,438 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:06,438 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:06,439 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:06,442 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:06,739 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:06,740 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:06,741 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:06,743 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:06,744 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:06,745 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:06,746 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:06,746 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:06,748 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:07,002 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,003 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:07,004 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,004 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,005 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:07,006 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,006 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:07,006 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:07,508 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:07,509 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:07,510 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:07,510 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:07,511 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:07,512 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:07,512 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:07,512 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:07,515 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:07,515 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:07,516 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:07,516 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:07,526 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:07,532 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:07,538 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:07,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:07,551 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:07,552 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:07,552 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:07,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:07,555 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:07,556 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:07,556 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:07,556 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:07,560 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:07,561 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:07,561 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:07,562 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:07,562 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:07,562 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:07.562787+07:00
2025-10-11 05:01:07,563 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:07.562787+07:00
2025-10-11 05:01:07,563 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:07.562787+07:00 trong DST: True
2025-10-11 05:01:07,564 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:07,564 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:07,564 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:07,566 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:07,566 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:07,570 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:07,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:07,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:07,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:07,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:07,572 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:07,572 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:07,573 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:07,573 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:07,573 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:07,574 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:07,574 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:07,575 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:07,576 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:07,576 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:07,578 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:07,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:07,591 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:07,598 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:07,599 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:07,601 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:07,604 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:07,609 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:07,610 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:07,611 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:07,611 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:07,612 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:07,613 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:07,613 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:07,614 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:07,614 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:07,614 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:07,615 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:07,615 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:07,615 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:07,616 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:07,616 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:07,617 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:07,618 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:07,618 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:07,618 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:07.618947+07:00
2025-10-11 05:01:07,619 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:07.618947+07:00
2025-10-11 05:01:07,619 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:07.618947+07:00 trong DST: True
2025-10-11 05:01:07,620 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:07,620 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:07,621 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:07,621 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,622 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:07,622 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:07,623 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:07,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:07,624 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:07,624 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:07,625 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:07,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:07,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:07,626 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:07,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:07,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:07,628 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:07,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:07,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:07,629 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:07,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:07,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:07,631 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:07,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:07,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:07,633 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:07,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:07,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:07,634 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:07,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:07,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:07,636 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:07,636 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,637 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:07,637 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:07,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:07,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:07,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:07,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:07,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:07,639 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:07,640 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:07,640 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:07,657 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:07,662 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:07,664 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:07,667 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:07,675 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:07,678 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:07,678 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:07,679 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,679 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:07,679 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:07,680 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:07,681 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:07,681 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:07,682 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:07,683 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:07,685 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,686 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:07,686 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:07,686 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:07,690 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:07,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:07,691 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:07,691 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:07,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,692 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:07,692 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,693 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:07,693 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:07,694 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:07,694 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:07,694 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:07,695 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:07,696 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.96s
2025-10-11 05:01:07,745 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:07,745 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:07,747 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:07,749 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:07,749 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:07,751 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:07,751 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:07,752 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:07,758 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,759 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:07,760 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,760 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,761 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:07,761 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:07,762 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:07,763 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:07,790 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:07,793 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:07,795 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:07,799 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:07,802 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:07,803 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:08,264 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:08,266 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:08,266 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:08,267 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:08,267 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:08,268 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:08,268 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:08,269 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:08,271 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:08,272 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:08,272 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:08,273 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:08,284 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:08,304 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:08,304 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:08,308 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:08,310 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:08,311 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:08,311 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:08,312 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:08,315 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:08,315 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:08,316 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:08,316 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:08,319 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:08,319 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:08,320 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:08,320 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:08,320 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:08,321 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:08.321330+07:00
2025-10-11 05:01:08,322 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:08.321330+07:00
2025-10-11 05:01:08,322 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:08.321330+07:00 trong DST: True
2025-10-11 05:01:08,323 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:08,323 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:08,323 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:08,325 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:08,325 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:08,336 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:08,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:08,364 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:08,365 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:08,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:08,367 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:08,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:08,368 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:08,368 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:08,369 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:08,370 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:08,370 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:08,370 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:08,371 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:08,371 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:08,371 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:08,372 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:08,372 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:08,372 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:08,374 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:08,375 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:08,375 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:08,376 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:08,376 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:08,376 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:08,377 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:08,377 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:08,378 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:08,378 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:08,379 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:08,379 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:08,379 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:08,380 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:08,380 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:08,380 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:08,381 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:08,381 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:08,382 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:08,382 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:08,383 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:08,383 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:08.383529+07:00
2025-10-11 05:01:08,383 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:08.383529+07:00
2025-10-11 05:01:08,384 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:08.383529+07:00 trong DST: True
2025-10-11 05:01:08,384 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:08,384 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:08,385 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:08,386 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,386 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:08,386 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:08,387 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:08,388 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,388 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:08,390 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:08,396 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:08,420 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:08,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:08,422 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:08,423 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:08,423 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:08,424 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:08,425 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:08,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:08,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:08,426 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:08,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:08,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:08,428 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:08,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:08,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:08,430 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:08,431 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:08,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:08,432 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:08,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:08,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:08,434 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:08,434 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,435 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:08,435 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:08,436 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:08,436 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:08,436 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:08,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:08,437 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:08,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:08,438 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:08,438 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:08,439 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:08,439 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:08,439 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:08,440 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:08,440 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:08,441 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:08,441 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:08,442 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,442 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:08,443 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:08,443 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:08,444 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:08,444 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:08,445 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:08,446 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:08,448 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,448 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:08,449 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:08,449 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:08,452 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:08,468 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:08,485 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:08,488 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:08,489 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,489 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:08,490 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,490 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:08,491 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:08,492 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:08,492 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:08,493 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:08,493 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:08,495 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.75s
2025-10-11 05:01:08,587 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:08,588 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:08,588 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:08,589 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:08,592 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:08,750 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:08,751 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:08,753 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:08,755 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:08,756 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:08,757 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:08,759 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:08,760 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:08,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:09,026 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:09,026 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:09,027 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:09,028 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:09,028 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:09,029 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:09,029 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:09,030 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:09,531 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:09,532 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:09,533 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:09,533 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:09,534 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:09,534 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:09,534 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:09,535 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:09,538 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:09,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:09,539 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:09,539 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:09,555 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:09,571 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:09,572 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:09,573 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:09,575 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:09,576 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:09,576 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:09,577 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:09,580 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:09,580 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:09,581 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:09,581 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:09,593 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:09,613 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:09,613 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:09,614 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:09,614 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:09,615 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:09.615319+07:00
2025-10-11 05:01:09,615 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:09.615319+07:00
2025-10-11 05:01:09,616 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:09.615319+07:00 trong DST: True
2025-10-11 05:01:09,616 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:09,616 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:09,617 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:09,618 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:09,619 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:09,623 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:09,624 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:09,624 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:09,625 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:09,625 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:09,626 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:09,626 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:09,626 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:09,627 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:09,627 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:09,627 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:09,628 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:09,628 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:09,629 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:09,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:09,629 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:09,630 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:09,630 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:09,630 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:09,632 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:09,632 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:09,633 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:09,633 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:09,634 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:09,634 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:09,634 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:09,635 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:09,635 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:09,636 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:09,636 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:09,636 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:09,637 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:09,638 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:09,638 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:09,639 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:09,639 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:09,640 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:09,676 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:09,677 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:09,677 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:09,678 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:09.678577+07:00
2025-10-11 05:01:09,679 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:09.678577+07:00
2025-10-11 05:01:09,679 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:09.678577+07:00 trong DST: True
2025-10-11 05:01:09,679 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:09,680 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:09,680 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:09,681 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:09,681 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:09,682 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:09,682 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:09,682 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:09,683 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:09,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:09,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:09,684 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:09,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:09,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:09,686 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:09,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:09,687 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:09,688 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:09,688 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:09,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:09,689 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:09,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:09,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:09,691 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:09,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:09,692 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:09,692 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:09,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:09,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:09,694 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:09,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:09,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:09,695 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:09,695 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:09,803 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:09,805 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:09,809 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:09,811 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:09,812 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:09,813 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:09,960 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:10,077 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:10,126 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:10,227 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:10,228 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:10,229 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:10,230 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:10,232 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:10,233 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:10,234 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:10,235 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:10,235 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:10,236 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:10,236 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:10,237 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:10,237 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:10,238 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:10,239 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:10,240 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:10,240 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:10,241 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.34s
2025-10-11 05:01:10,241 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:10,243 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:10,244 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:10,245 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:10,247 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:10,248 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:10,248 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:10,248 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:10,252 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:10,255 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:10,256 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:10,257 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:10,334 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:10,399 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:10,407 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:10,417 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:10,461 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:10,525 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:10,528 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:10,537 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:10,583 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:10,594 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:10,595 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.84s
2025-10-11 05:01:10,737 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:10,738 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:10,738 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:10,739 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:10,743 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:10,901 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:10,902 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:10,903 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:10,905 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:10,905 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:10,907 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:10,907 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:10,908 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:10,942 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:10,943 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:10,944 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:10,945 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:10,946 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:10,946 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:10,946 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:10,995 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:11,009 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:11,524 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:11,526 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:11,527 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:11,527 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:11,528 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:11,528 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:11,529 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:11,529 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:11,532 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:11,532 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:11,532 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:11,533 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:11,543 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:11,563 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:11,564 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:11,565 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:11,568 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:11,568 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:11,569 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:11,570 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:11,573 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:11,574 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:11,574 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:11,576 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:11,584 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:11,606 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:11,607 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:11,609 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:11,609 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:11,610 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:11.609938+07:00
2025-10-11 05:01:11,610 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:11.609938+07:00
2025-10-11 05:01:11,610 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:11.609938+07:00 trong DST: True
2025-10-11 05:01:11,611 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:11,611 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:11,611 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:11,613 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:11,613 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:11,616 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:11,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:11,617 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:11,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:11,618 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:11,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:11,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:11,619 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:11,620 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:11,620 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:11,620 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:11,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:11,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:11,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:11,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:11,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:11,623 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:11,623 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:11,623 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:11,624 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:11,624 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:11,625 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:11,626 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:11,626 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:11,626 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:11,627 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:11,627 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:11,628 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:11,628 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:11,628 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:11,629 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:11,629 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:11,630 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:11,630 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:11,630 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:11,631 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:11,631 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:11,632 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:11,632 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:11,632 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:11,633 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:11.633151+07:00
2025-10-11 05:01:11,633 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:11.633151+07:00
2025-10-11 05:01:11,634 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:11.633151+07:00 trong DST: True
2025-10-11 05:01:11,634 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:11,635 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:11,635 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:11,635 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:11,636 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:11,637 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:11,637 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,639 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:11,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:11,671 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:11,672 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:11,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:11,673 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:11,674 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:11,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:11,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:11,675 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:11,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:11,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:11,677 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:11,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:11,678 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:11,679 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:11,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:11,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:11,681 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:11,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:11,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:11,683 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:11,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:11,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:11,684 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:11,685 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,685 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:11,686 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:11,686 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:11,687 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:11,687 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:11,687 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:11,688 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:11,688 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:11,688 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:11,689 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:11,689 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:11,690 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:11,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:11,690 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:11,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:11,691 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:11,691 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:11,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,692 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:11,692 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:11,693 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:11,693 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:11,693 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:11,694 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:11,695 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:11,696 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,697 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:11,697 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:11,698 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:11,701 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:11,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:11,703 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:11,709 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:11,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,738 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:11,739 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,739 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:11,740 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:11,740 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:11,741 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:11,741 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:11,742 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:11,743 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-11 05:01:11,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:11,797 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:11,798 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:11,799 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:11,802 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:11,907 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:11,908 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:11,909 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:11,911 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:11,912 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:11,913 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:11,914 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:11,915 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:11,917 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:11,918 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:11,918 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:11,920 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:11,920 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:11,921 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:11,921 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:11,927 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:12,020 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:12,251 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:12,251 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:12,453 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:12,455 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:12,455 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.20s
2025-10-11 05:01:12,456 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:12,457 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:01:12,457 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:12,458 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:12,458 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:12,459 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:12,459 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:12,461 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:12,462 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:12,462 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:12,463 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:12,466 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:12,467 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:12,467 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:12,468 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:12,470 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:12,470 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:12,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:12,471 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:12,473 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:12,473 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:12,474 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:12,474 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:12,476 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:12,477 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:12,477 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:12,478 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:12,478 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:12,479 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:12.479099+07:00
2025-10-11 05:01:12,480 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:12.479099+07:00
2025-10-11 05:01:12,480 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:12.479099+07:00 trong DST: True
2025-10-11 05:01:12,481 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:12,481 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:12,481 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:12,482 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:12,483 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:12,492 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:12,520 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:12,523 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:12,524 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:12,524 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:12,525 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:12,525 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:12,526 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:12,526 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:12,527 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:12,527 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:12,527 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:12,527 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:12,528 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:12,528 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:12,528 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:12,529 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:12,530 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:12,531 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:12,531 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:12,532 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:12,532 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:12,533 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:12,533 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:12,534 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:12,534 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:12,535 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:12,535 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:12,535 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:12,536 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:12,536 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:12,536 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:12,537 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:12,537 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:12,538 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:12,538 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:12,539 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:12,539 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:12,540 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:12,540 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:12,540 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:12.540815+07:00
2025-10-11 05:01:12,541 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:12.540815+07:00
2025-10-11 05:01:12,541 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:12.540815+07:00 trong DST: True
2025-10-11 05:01:12,541 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:12,542 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:12,542 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:12,542 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,543 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:12,543 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:12,544 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:12,544 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,545 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:12,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:12,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:12,577 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:12,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:12,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:12,579 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:12,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:12,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:12,582 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:12,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:12,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:12,584 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:12,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:12,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:12,586 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:12,586 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:12,587 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:12,588 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:12,588 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:12,589 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:12,589 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:12,590 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:12,590 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:12,591 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:12,591 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,592 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:12,592 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:12,592 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:12,593 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:12,593 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:12,594 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:12,594 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:12,595 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:12,595 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:12,595 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:12,596 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:12,596 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:12,596 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:12,597 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:12,597 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:12,597 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:12,597 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:12,598 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,598 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:12,599 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:12,599 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:12,600 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:12,600 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:12,601 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:12,602 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:12,603 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,604 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:12,604 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:12,604 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:12,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:12,609 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:12,609 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:12,639 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:12,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:12,641 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,643 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:12,644 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:12,644 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:12,645 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:12,645 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:12,645 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:12,646 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.74s
2025-10-11 05:01:12,688 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:12,702 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:12,703 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:12,704 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:12,708 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:12,912 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:12,913 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:12,914 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:12,916 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:12,917 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:12,918 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:12,919 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:12,919 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:12,955 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:12,957 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:12,958 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:12,959 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:12,959 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:12,960 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:12,960 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:12,961 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:13,019 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:13,462 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:13,464 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:13,464 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:13,465 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:13,465 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:13,466 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:13,466 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:13,467 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:13,470 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:13,470 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:13,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:13,471 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:13,504 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:13,504 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:13,504 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:13,505 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:13,508 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:13,509 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:13,511 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:13,511 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:13,514 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:13,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:13,540 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:13,540 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:13,543 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:13,546 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:13,574 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:13,576 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:13,577 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:13,578 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:13.578213+07:00
2025-10-11 05:01:13,579 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:13.578213+07:00
2025-10-11 05:01:13,579 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:13.578213+07:00 trong DST: True
2025-10-11 05:01:13,580 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:13,580 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:13,580 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:13,582 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:13,582 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:13,586 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:13,586 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:13,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:13,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:13,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:13,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:13,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:13,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:13,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:13,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:13,590 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:13,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:13,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:13,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:13,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:13,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:13,593 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:13,593 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:13,593 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:13,594 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:13,594 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:13,595 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:13,595 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:13,596 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:13,596 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:13,597 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:13,597 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:13,598 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:13,598 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:13,598 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:13,599 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:13,599 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:13,600 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:13,600 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:13,600 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:13,601 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:13,601 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:13,602 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:13,602 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:13,603 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:13,603 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:13.603451+07:00
2025-10-11 05:01:13,603 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:13.603451+07:00
2025-10-11 05:01:13,604 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:13.603451+07:00 trong DST: True
2025-10-11 05:01:13,604 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:13,604 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:13,605 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:13,605 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,605 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:13,606 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:13,609 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:13,609 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:13,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:13,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:13,639 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:13,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:13,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:13,642 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:13,642 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:13,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:13,644 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:13,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:13,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:13,646 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:13,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:13,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:13,648 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:13,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:13,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:13,650 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:13,650 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:13,651 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:13,651 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:13,652 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:13,653 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:13,653 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:13,654 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,654 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:13,654 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:13,655 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:13,655 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:13,655 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:13,656 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:13,656 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:13,657 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:13,657 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:13,658 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:13,658 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:13,658 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:13,659 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:13,659 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:13,659 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:13,660 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:13,660 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:13,660 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,661 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:13,661 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:13,662 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:13,662 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:13,663 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:13,663 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:13,664 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:13,666 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,666 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:13,667 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:13,667 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:13,670 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:13,671 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:13,677 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:13,698 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:13,699 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,701 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:13,701 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,702 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:13,734 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:13,735 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:13,736 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:13,737 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:13,738 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:13,739 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.83s
2025-10-11 05:01:13,799 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:13,801 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:13,801 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:13,802 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:13,806 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:13,917 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:13,918 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:13,919 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:13,921 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:13,922 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:13,924 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:13,924 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:13,925 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:13,960 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:13,961 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:13,962 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:13,962 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:13,963 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:13,963 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:13,964 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:13,964 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:14,019 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:14,466 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:14,467 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:14,468 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:14,469 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:14,469 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:14,469 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:14,470 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:14,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:14,473 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:14,474 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:14,474 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:14,474 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:14,485 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:14,505 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:14,506 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:14,507 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:14,510 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:14,511 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:14,511 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:14,512 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:14,515 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:14,515 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:14,515 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:14,516 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:14,519 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:14,525 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:14,548 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:14,549 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:14,550 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:14,550 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:14.550482+07:00
2025-10-11 05:01:14,551 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:14.550482+07:00
2025-10-11 05:01:14,551 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:14.550482+07:00 trong DST: True
2025-10-11 05:01:14,551 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:14,559 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:14,584 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:14,586 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:14,587 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:14,622 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:14,624 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:14,624 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:14,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:14,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:14,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:14,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:14,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:14,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:14,657 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:14,658 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:14,685 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:14,686 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:14,687 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:14,688 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:14,688 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:14,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:14,689 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:14,690 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:14,722 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:14,723 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:14,724 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:14,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:14,726 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:14,727 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:14,727 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:14,728 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:14,728 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:14,729 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:14,729 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:14,729 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:14,730 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:14,730 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:14,731 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:14,732 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:14,733 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:14,734 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:14,735 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:14,735 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:14,760 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:14,761 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:14.761447+07:00
2025-10-11 05:01:14,762 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:14.761447+07:00
2025-10-11 05:01:14,762 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:14.761447+07:00 trong DST: True
2025-10-11 05:01:14,764 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:14,764 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:14,765 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:14,765 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,798 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:14,798 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:14,799 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:14,801 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,802 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:14,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:14,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:14,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:14,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:14,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:14,805 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:14,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:14,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:14,806 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:14,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:14,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:14,808 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:14,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:14,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:14,810 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:14,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:14,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:14,812 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:14,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:14,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:14,813 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:14,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:14,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:14,815 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:14,815 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:14,816 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:14,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:14,817 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:14,817 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:14,817 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:14,818 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:14,818 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:14,819 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:14,819 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:14,819 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:14,820 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:14,820 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:14,820 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:14,821 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:14,822 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:14,822 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:14,823 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,823 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:14,823 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:14,824 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:14,824 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:14,824 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:14,827 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:14,828 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:14,861 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:14,862 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:14,862 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,867 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:14,868 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:14,868 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:14,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:14,870 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:14,870 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,871 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:14,871 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,872 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:14,872 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:14,873 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:14,873 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:14,873 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:14,874 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:14,875 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.96s
2025-10-11 05:01:14,924 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:14,925 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:14,926 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:14,928 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:14,928 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:14,929 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:14,930 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:14,931 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:14,936 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:14,937 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:14,938 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:14,938 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:14,939 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:14,939 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:14,940 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:14,940 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:14,975 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:14,987 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:14,988 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:14,989 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:14,991 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:14,993 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:15,441 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:15,443 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:15,443 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:15,444 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:15,444 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:15,445 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:15,445 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:15,445 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:15,448 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:15,448 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:15,448 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:15,449 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:15,457 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:15,480 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:15,481 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:15,482 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:15,484 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:15,485 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:15,486 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:15,486 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:15,488 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:15,489 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:15,489 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:15,489 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:15,492 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:15,493 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:15,493 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:15,493 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:15,494 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:15,494 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:15.494576+07:00
2025-10-11 05:01:15,495 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:15.494576+07:00
2025-10-11 05:01:15,495 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:15.494576+07:00 trong DST: True
2025-10-11 05:01:15,495 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:15,495 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:15,496 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:15,497 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:15,497 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:15,500 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:15,501 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:15,501 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:15,501 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:15,502 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:15,502 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:15,503 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:15,503 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:15,503 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:15,504 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:15,504 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:15,505 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:15,505 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:15,506 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:15,506 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:15,506 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:15,507 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:15,507 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:15,507 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:15,508 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:15,508 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:15,509 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:15,509 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:15,510 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:15,510 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:15,511 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:15,511 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:15,512 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:15,512 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:15,513 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:15,514 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:15,515 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:15,515 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:15,537 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:15,538 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:15,542 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:15,548 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:15,549 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:15,550 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:15,551 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:15,551 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:15.551487+07:00
2025-10-11 05:01:15,552 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:15.551487+07:00
2025-10-11 05:01:15,552 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:15.551487+07:00 trong DST: True
2025-10-11 05:01:15,552 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:15,553 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:15,553 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:15,554 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,554 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:15,555 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:15,555 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:15,555 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,556 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:15,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:15,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:15,558 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:15,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:15,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:15,560 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:15,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:15,561 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:15,561 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:15,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:15,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:15,563 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:15,563 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:15,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:15,564 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:15,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:15,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:15,566 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:15,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:15,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:15,567 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:15,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:15,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:15,569 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:15,569 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,570 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:15,570 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:15,570 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:15,571 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:15,571 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:15,571 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:15,571 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:15,572 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:15,572 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:15,573 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:15,573 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:15,573 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:15,574 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:15,574 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:15,574 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:15,575 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:15,575 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:15,577 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,577 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:15,578 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:15,578 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:15,586 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:15,588 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:15,596 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:15,604 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:15,609 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,611 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:15,612 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:15,613 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:15,619 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:15,620 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:15,622 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:15,622 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:15,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:15,623 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,624 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:15,624 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:15,625 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:15,625 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:15,626 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:15,626 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:15,627 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.70s
2025-10-11 05:01:15,673 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:15,675 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:15,676 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:15,677 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:15,680 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:15,929 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:15,930 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:15,931 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:15,933 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:15,934 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:15,935 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:15,936 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:15,937 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:15,940 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:15,941 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:15,941 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:15,942 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:15,942 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:15,943 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:15,943 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:15,944 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:15,990 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:16,445 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:16,447 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:16,447 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:16,448 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:16,448 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:16,449 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:16,449 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:16,449 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:16,452 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:16,452 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:16,453 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:16,453 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:16,463 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:16,483 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:16,484 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:16,485 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:16,488 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:16,489 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:16,489 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:16,490 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:16,493 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:16,493 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:16,493 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:16,494 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:16,497 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:16,497 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:16,497 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:16,498 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:16,498 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:16,498 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:16.498946+07:00
2025-10-11 05:01:16,499 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:16.498946+07:00
2025-10-11 05:01:16,499 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:16.498946+07:00 trong DST: True
2025-10-11 05:01:16,500 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:16,500 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:16,500 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:16,502 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:16,502 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:16,506 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:16,506 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:16,507 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:16,509 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:16,510 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:16,511 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:16,511 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:16,511 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:16,512 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:16,548 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:16,549 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:16,553 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:16,560 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:16,562 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:16,563 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:16,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:16,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:16,570 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:16,571 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:16,571 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:16,572 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:16,574 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:16,574 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:16,576 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:16,578 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:16,616 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:16,622 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:16,627 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:16,628 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:16,629 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:16,630 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:16,631 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:16,632 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:16,633 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:16,634 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:16,634 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:16,635 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:16,636 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:16,637 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:16,638 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:16,638 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:16.638483+07:00
2025-10-11 05:01:16,641 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:16.638483+07:00
2025-10-11 05:01:16,677 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:16.638483+07:00 trong DST: True
2025-10-11 05:01:16,679 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:16,683 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:16,683 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:16,684 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,685 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:16,686 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:16,687 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:16,688 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,688 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:16,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:16,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:16,695 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:16,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:16,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:16,700 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:16,739 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:16,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:16,747 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:16,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:16,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:16,750 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:16,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:16,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:16,759 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:16,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:16,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:16,761 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:16,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:16,763 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:16,766 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:16,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:16,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:16,809 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:16,809 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,810 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:16,810 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:16,811 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:16,811 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:16,811 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:16,812 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:16,813 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:16,813 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:16,814 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:16,815 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:16,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:16,816 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:16,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:16,817 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:16,818 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:16,818 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:16,819 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:16,819 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,819 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:16,820 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:16,820 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:16,821 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:16,821 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:16,822 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:16,823 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:16,824 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,825 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:16,826 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:16,826 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:16,827 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:16,837 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:16,862 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:16,863 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:16,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,864 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:16,865 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,865 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:16,866 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:16,866 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:16,867 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:16,868 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:16,868 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:16,869 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-11 05:01:16,917 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:16,923 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:16,924 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:16,925 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:16,929 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:16,936 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:16,937 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:16,938 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:16,940 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:16,941 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:16,942 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:16,943 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:16,944 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:16,949 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:16,950 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:16,952 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:16,953 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:16,954 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:16,981 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:16,982 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:16,984 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:17,046 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:17,486 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:17,488 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:17,488 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:17,489 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:17,489 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:17,490 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:17,490 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:17,491 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:17,493 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:17,494 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:17,495 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:17,495 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:17,499 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:17,500 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:17,500 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:17,501 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:17,503 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:17,503 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:17,504 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:17,504 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:17,507 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:17,508 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:17,508 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:17,508 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:17,511 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:17,512 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:17,512 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:17,514 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:17,516 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:17,516 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:17.516448+07:00
2025-10-11 05:01:17,517 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:17.516448+07:00
2025-10-11 05:01:17,521 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:17.516448+07:00 trong DST: True
2025-10-11 05:01:17,549 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:17,553 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:17,553 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:17,556 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:17,556 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:17,561 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:17,562 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:17,562 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:17,563 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:17,563 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:17,564 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:17,564 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:17,564 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:17,565 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:17,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:17,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:17,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:17,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:17,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:17,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:17,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:17,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:17,569 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:17,570 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:17,570 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:17,571 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:17,571 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:17,572 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:17,572 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:17,573 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:17,573 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:17,574 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:17,574 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:17,575 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:17,576 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:17,578 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:17,579 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:17,616 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:17,617 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:17,617 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:17,618 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:17,619 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:17,620 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:17,620 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:17,620 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:17,621 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:17.621148+07:00
2025-10-11 05:01:17,621 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:17.621148+07:00
2025-10-11 05:01:17,622 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:17.621148+07:00 trong DST: True
2025-10-11 05:01:17,622 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:17,622 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:17,623 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:17,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,624 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:17,624 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:17,624 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:17,625 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,625 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:17,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:17,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:17,627 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:17,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:17,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:17,629 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:17,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:17,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:17,630 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:17,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:17,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:17,632 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:17,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:17,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:17,634 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:17,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:17,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:17,635 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:17,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:17,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:17,637 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:17,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:17,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:17,640 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:17,641 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:17,641 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:17,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:17,679 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:17,679 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:17,680 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:17,681 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:17,683 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:17,683 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:17,684 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:17,684 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:17,684 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:17,685 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:17,685 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:17,685 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:17,686 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:17,686 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:17,687 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,687 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:17,688 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:17,688 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:17,688 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:17,689 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:17,690 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:17,691 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:17,692 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,693 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:17,693 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:17,693 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:17,696 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:17,697 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:17,699 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:17,699 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:17,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,700 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:17,701 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:17,702 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:17,737 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:17,738 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:17,739 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:17,740 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:17,742 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 05:01:17,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:17,797 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:17,798 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:17,799 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:17,803 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:17,939 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:17,940 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:17,942 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:17,944 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:17,944 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:17,946 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:17,946 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:17,947 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:17,961 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:17,985 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:17,986 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:17,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:17,989 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:17,989 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:17,990 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:17,990 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:18,005 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:18,492 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:18,493 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:18,494 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:18,494 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:18,495 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:18,495 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:18,496 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:18,496 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:18,498 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:18,498 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:18,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:18,499 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:18,508 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:18,532 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:18,534 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:18,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:18,539 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:18,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:18,540 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:18,540 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:18,543 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:18,543 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:18,543 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:18,544 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:18,555 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:18,575 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:18,578 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:18,579 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:18,579 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:18,579 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:18.579839+07:00
2025-10-11 05:01:18,580 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:18.579839+07:00
2025-10-11 05:01:18,580 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:18.579839+07:00 trong DST: True
2025-10-11 05:01:18,581 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:18,581 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:18,582 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:18,583 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:18,584 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:18,587 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:18,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:18,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:18,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:18,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:18,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:18,590 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:18,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:18,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:18,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:18,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:18,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:18,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:18,593 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:18,593 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:18,594 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:18,594 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:18,594 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:18,595 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:18,595 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:18,596 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:18,596 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:18,597 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:18,597 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:18,598 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:18,598 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:18,599 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:18,599 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:18,600 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:18,600 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:18,600 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:18,601 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:18,601 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:18,601 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:18,602 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:18,602 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:18,603 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:18,603 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:18,604 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:18,604 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:18,605 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:18.604947+07:00
2025-10-11 05:01:18,605 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:18.604947+07:00
2025-10-11 05:01:18,605 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:18.604947+07:00 trong DST: True
2025-10-11 05:01:18,606 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:18,606 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:18,606 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:18,609 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:18,610 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:18,637 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:18,637 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,639 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:18,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:18,642 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:18,643 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:18,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:18,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:18,645 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:18,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:18,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:18,648 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:18,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:18,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:18,650 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:18,650 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:18,651 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:18,651 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:18,652 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:18,652 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:18,653 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:18,653 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:18,654 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:18,655 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:18,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:18,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:18,657 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:18,657 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,657 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:18,658 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:18,658 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:18,658 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:18,659 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:18,659 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:18,659 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:18,660 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:18,660 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:18,660 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:18,661 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:18,661 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:18,662 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:18,662 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:18,662 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:18,663 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:18,663 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:18,663 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,664 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:18,664 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:18,664 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:18,665 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:18,665 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:18,666 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:18,667 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:18,668 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,670 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:18,670 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:18,672 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:18,682 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:18,706 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:18,707 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:18,708 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:18,710 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,710 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:18,711 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,711 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:18,711 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:18,712 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:18,712 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:18,712 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:18,713 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:18,715 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.77s
2025-10-11 05:01:18,784 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:18,785 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:18,786 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:18,787 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:18,790 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:18,944 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:18,945 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:18,946 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:18,948 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:18,949 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:18,951 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:18,952 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:18,953 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:18,956 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:18,957 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:18,958 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:18,958 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:18,959 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:18,959 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:18,960 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:18,960 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:19,004 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:19,462 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:19,463 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:19,464 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:19,464 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:19,465 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:19,465 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:19,466 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:19,466 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:19,468 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:19,469 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:19,469 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:19,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:19,472 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:19,473 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:19,473 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:19,474 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:19,476 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:19,476 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:19,477 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:19,477 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:19,480 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:19,481 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:19,481 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:19,482 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:19,491 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:19,508 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:19,509 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:19,510 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:19,511 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:19,511 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:19.511630+07:00
2025-10-11 05:01:19,511 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:19.511630+07:00
2025-10-11 05:01:19,512 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:19.511630+07:00 trong DST: True
2025-10-11 05:01:19,512 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:19,513 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:19,513 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:19,514 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:19,515 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:19,519 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:19,519 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:19,520 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:19,520 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:19,521 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:19,521 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:19,522 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:19,522 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:19,523 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:19,531 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:19,553 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:19,554 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:19,555 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:19,556 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:19,556 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:19,557 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:19,557 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:19,557 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:19,558 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:19,559 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:19,559 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:19,560 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:19,560 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:19,561 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:19,562 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:19,563 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:19,563 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:19,564 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:19,564 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:19,564 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:19,565 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:19,565 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:19,565 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:19,566 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:19,566 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:19,566 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:19,567 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:19,567 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:19,568 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:19,568 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:19,569 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:19.569030+07:00
2025-10-11 05:01:19,569 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:19.569030+07:00
2025-10-11 05:01:19,569 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:19.569030+07:00 trong DST: True
2025-10-11 05:01:19,570 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:19,570 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:19,570 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:19,571 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,571 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:19,572 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:19,572 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:19,572 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,573 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:19,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:19,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:19,574 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:19,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:19,576 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:19,576 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:19,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:19,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:19,578 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:19,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:19,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:19,612 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:19,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:19,613 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:19,614 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:19,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:19,616 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:19,616 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:19,617 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:19,618 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:19,618 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:19,619 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:19,620 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:19,620 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:19,620 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,621 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:19,622 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:19,622 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:19,622 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:19,623 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:19,623 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:19,624 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:19,624 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:19,624 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:19,625 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:19,625 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:19,625 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:19,626 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:19,626 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:19,626 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:19,627 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:19,627 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:19,627 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,628 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:19,628 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:19,628 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:19,629 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:19,629 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:19,630 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:19,631 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:19,632 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,634 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:19,634 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:19,634 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:19,637 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:19,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:19,638 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:19,639 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:19,639 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,640 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:19,641 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,641 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:19,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:19,642 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:19,675 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:19,675 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:19,676 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:19,678 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.73s
2025-10-11 05:01:19,775 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:19,776 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:19,776 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:19,777 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:19,779 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:19,959 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:20,024 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:20,026 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:20,050 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:20,083 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:20,085 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:20,086 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:20,088 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:20,144 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.10s
2025-10-11 05:01:20,152 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:20,184 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:20,185 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:20,190 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:20,204 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:20,346 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:20,409 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:20,413 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:20,967 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:20,968 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:20,969 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:20,969 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:20,970 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:20,970 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:20,970 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:20,971 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:20,973 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:20,973 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:20,973 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:20,974 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:20,977 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:20,977 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:20,977 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:20,978 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:20,981 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:20,981 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:20,982 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:20,982 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:20,990 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:21,013 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:21,013 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:21,016 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:21,019 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:21,020 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:21,020 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:21,021 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:21,021 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:21,022 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:21.022044+07:00
2025-10-11 05:01:21,022 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:21.022044+07:00
2025-10-11 05:01:21,023 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:21.022044+07:00 trong DST: True
2025-10-11 05:01:21,023 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:21,023 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:21,024 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:21,024 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:21,025 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:21,028 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:21,028 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:21,029 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:21,029 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:21,029 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:21,030 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:21,030 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:21,030 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:21,031 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:21,031 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:21,031 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:21,032 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:21,033 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:21,033 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:21,034 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:21,034 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:21,034 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:21,035 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:21,035 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:21,036 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:21,036 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:21,037 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:21,037 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:21,037 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:21,038 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:21,038 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:21,039 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:21,039 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:21,039 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:21,040 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:21,040 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:21,040 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:21,041 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:21,041 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:21,042 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:21,042 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:21,043 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:21,043 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:21,043 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:21,044 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:21,044 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:21.044524+07:00
2025-10-11 05:01:21,044 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:21.044524+07:00
2025-10-11 05:01:21,045 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:21.044524+07:00 trong DST: True
2025-10-11 05:01:21,047 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:21,047 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:21,048 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:21,052 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,076 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:21,078 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:21,078 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:21,079 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:21,082 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,082 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:21,084 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:21,085 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:21,086 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:21,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:21,088 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:21,089 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:21,089 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:21,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:21,091 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:21,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:21,092 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:21,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:21,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:21,094 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:21,094 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:21,095 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:21,096 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:21,096 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:21,097 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:21,097 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:21,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:21,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:21,099 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:21,099 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:21,100 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:21,100 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:21,101 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:21,102 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:21,102 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:21,103 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,103 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:21,103 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:21,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:21,104 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:21,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:21,105 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:21,105 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:21,105 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:21,105 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:21,106 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:21,108 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:21,109 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:21,109 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:21,109 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:21,151 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:21,156 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:21,156 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:21,157 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,157 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:21,158 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:21,159 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:21,159 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:21,160 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:21,161 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:21,163 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:21,164 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,165 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:21,165 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:21,165 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:21,169 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:21,171 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:21,172 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:21,204 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:21,207 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:21,207 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,220 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:21,226 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,282 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:21,337 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:21,407 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:21,423 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:21,474 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:21,476 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:21,480 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.46s
2025-10-11 05:01:21,648 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:21,649 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:21,650 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:21,651 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:21,653 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:22,086 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:22,087 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:22,089 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:22,091 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:22,091 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:22,093 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:22,094 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:22,095 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:22,105 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:22,106 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:22,107 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:22,108 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:22,108 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:22,109 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:22,110 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:22,110 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:22,159 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:22,645 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:22,647 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:22,647 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:22,648 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:22,648 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:22,649 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:22,649 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:22,650 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:22,652 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:22,652 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:22,653 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:22,653 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:22,662 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:22,685 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:22,686 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:22,686 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:22,688 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:22,689 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:22,689 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:22,689 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:22,693 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:22,694 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:22,694 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:22,695 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:22,698 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:22,698 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:22,699 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:22,699 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:22,699 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:22,700 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:22.700266+07:00
2025-10-11 05:01:22,701 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:22.700266+07:00
2025-10-11 05:01:22,702 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:22.700266+07:00 trong DST: True
2025-10-11 05:01:22,703 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:22,703 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:22,704 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:22,740 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:22,740 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:22,744 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:22,745 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:22,745 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:22,746 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:22,746 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:22,747 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:22,747 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:22,748 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:22,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:22,749 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:22,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:22,750 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:22,751 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:22,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:22,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:22,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:22,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:22,752 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:22,753 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:22,753 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:22,754 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:22,754 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:22,755 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:22,755 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:22,756 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:22,756 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:22,757 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:22,757 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:22,757 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:22,758 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:22,758 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:22,758 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:22,759 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:22,759 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:22,759 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:22,760 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:22,760 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:22,761 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:22,761 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:22,761 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:22,762 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:22.762354+07:00
2025-10-11 05:01:22,763 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:22.762354+07:00
2025-10-11 05:01:22,764 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:22.762354+07:00 trong DST: True
2025-10-11 05:01:22,764 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:22,765 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:22,766 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:22,766 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,766 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:22,795 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:22,796 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:22,797 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:22,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:22,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:22,801 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:22,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:22,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:22,803 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:22,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:22,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:22,804 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:22,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:22,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:22,806 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:22,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:22,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:22,808 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:22,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:22,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:22,810 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:22,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:22,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:22,811 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:22,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:22,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:22,813 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:22,814 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,814 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:22,814 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:22,815 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:22,815 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:22,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:22,816 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:22,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:22,817 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:22,817 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:22,817 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:22,818 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:22,818 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:22,819 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:22,819 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:22,819 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:22,819 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:22,820 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:22,820 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,820 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:22,821 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:22,821 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:22,822 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:22,822 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:22,823 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:22,825 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:22,826 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,827 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:22,827 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:22,828 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:22,828 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:22,863 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:22,864 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:22,865 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:22,865 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,867 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:22,867 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,868 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:22,868 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:22,868 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:22,869 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:22,870 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:22,871 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:22,872 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.78s
2025-10-11 05:01:22,915 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:22,922 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:22,923 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:22,927 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:22,931 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:23,091 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:23,092 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:23,094 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:23,096 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:23,097 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:23,098 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:23,099 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:23,100 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:23,140 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:23,376 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:23,377 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:23,378 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:23,378 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:23,378 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:23,379 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:23,379 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:23,380 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:23,881 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:23,882 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:23,883 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:23,884 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:23,884 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:23,885 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:23,885 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:23,886 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:23,888 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:23,889 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:23,889 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:23,890 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:23,898 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:23,921 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:23,921 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:23,922 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:23,925 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:23,925 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:23,926 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:23,926 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:23,930 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:23,930 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:23,931 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:23,931 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:23,934 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:23,934 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:23,935 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:23,935 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:23,935 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:23,936 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:23.936278+07:00
2025-10-11 05:01:23,936 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:23.936278+07:00
2025-10-11 05:01:23,937 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:23.936278+07:00 trong DST: True
2025-10-11 05:01:23,937 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:23,937 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:23,938 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:23,939 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:23,939 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:23,942 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:23,942 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:23,943 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:23,943 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:23,944 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:23,944 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:23,945 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:23,945 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:23,946 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:23,946 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:23,947 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:23,947 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:23,947 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:23,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:23,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:23,949 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:23,949 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:23,950 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:23,950 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:23,951 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:23,953 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:23,959 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:23,986 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:23,987 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:23,987 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:23,989 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:23,990 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:23,990 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:23,991 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:23,991 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:23,992 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:23,992 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:23,992 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:23,993 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:23,993 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:23,994 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:23,994 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:23,995 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:23,995 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:23,995 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:23,996 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:23.996225+07:00
2025-10-11 05:01:23,996 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:23.996225+07:00
2025-10-11 05:01:23,997 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:23.996225+07:00 trong DST: True
2025-10-11 05:01:23,997 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:23,998 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:23,998 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:23,998 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:23,999 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:23,999 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:24,000 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:24,000 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,000 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:24,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:24,002 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:24,002 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:24,003 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,003 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:24,004 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:24,005 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:24,005 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:24,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:24,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,007 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:24,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:24,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:24,008 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:24,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:24,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,010 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:24,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:24,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:24,012 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:24,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:24,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,015 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:24,016 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,016 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,049 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:24,049 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:24,050 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:24,050 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:24,051 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:24,052 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:24,052 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:24,052 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:24,053 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:24,053 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:24,054 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:24,054 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:24,055 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:24,055 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:24,055 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:24,056 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:24,056 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,057 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,057 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:24,057 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:24,058 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:24,058 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:24,059 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:24,060 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:24,061 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,062 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:24,062 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:24,062 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:24,063 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:24,066 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:24,067 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:24,067 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:24,068 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,068 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,069 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,069 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,069 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,070 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:24,070 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:24,071 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:24,071 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:24,072 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.98s
2025-10-11 05:01:24,124 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:24,125 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:24,126 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:24,127 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:24,129 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:24,133 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:24,133 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:24,135 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:24,136 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:24,137 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:24,139 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:24,140 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:24,141 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:24,180 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,181 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:24,182 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,182 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,182 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:24,183 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,184 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:24,185 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:24,235 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:24,577 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-11 05:01:24,578 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.autorun.guard' vào nhóm 'ui.autorun' (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-11 05:01:24,578 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.autorun.guard vào group ui.autorun (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-11 05:01:24,578 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-11 05:01:24,686 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:24,687 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:24,688 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-11 05:01:24,689 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:24,689 - APP.utils.threading_utils - DEBUG - Task 'ui.autorun.guard' (group=ui.autorun) hoàn tất sau 0.11s
2025-10-11 05:01:24,690 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:24,690 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:24,691 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:24,691 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:24,692 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:24,694 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:24,694 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:24,695 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:24,695 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:24,699 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:24,700 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:24,700 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:24,701 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:24,703 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:24,703 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:24,704 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:24,715 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:24,720 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:24,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:24,731 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:24,732 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:24,736 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:24,737 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:24,737 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:24,738 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:24,738 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:24,739 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:24.739012+07:00
2025-10-11 05:01:24,739 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:24.739012+07:00
2025-10-11 05:01:24,739 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:24.739012+07:00 trong DST: True
2025-10-11 05:01:24,740 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:24,740 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:24,740 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:24,742 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:24,742 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:24,745 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:24,746 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:24,747 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:24,747 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:24,747 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:24,748 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:24,748 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:24,748 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:24,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:24,749 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:24,750 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:24,750 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:24,750 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:24,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:24,751 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:24,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:24,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:24,752 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:24,753 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:24,753 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:24,754 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:24,754 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:24,755 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:24,755 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:24,755 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:24,756 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:24,757 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:24,757 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:24,757 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:24,758 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:24,759 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:24,759 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:24,759 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:24,760 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:24,760 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:24,761 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:24,761 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:24,762 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:24,762 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:24,762 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:24,763 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:24.763195+07:00
2025-10-11 05:01:24,763 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:24.763195+07:00
2025-10-11 05:01:24,764 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:24.763195+07:00 trong DST: True
2025-10-11 05:01:24,765 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:24,765 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:24,765 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:24,766 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,766 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,782 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _request_autorun_start
2025-10-11 05:01:24,794 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:24,796 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:24,796 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:24,796 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,799 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,800 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:24,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:24,801 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:24,803 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:24,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:24,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:24,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,805 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:24,806 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:24,807 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:24,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:24,808 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:24,809 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:24,809 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-11 05:01:24,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:24,810 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-11 05:01:24,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,811 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-11 05:01:24,812 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:24,813 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-11 05:01:24,813 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251011-050124' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050124', 'priority': 'autorun'})
2025-10-11 05:01:24,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:24,814 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-11 05:01:24,814 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-11 05:01:24,815 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251011-050124 (priority=autorun)
2025-10-11 05:01:24,815 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-11 05:01:24,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:24,816 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-11 05:01:24,817 - APP.ui.app_ui - INFO - Autorun autorun-20251011-050124 bắt đầu ngay lập tức.
2025-10-11 05:01:24,818 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-11 05:01:24,818 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:24,819 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-11 05:01:24,821 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:01:24,821 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:24,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:24,824 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-11 05:01:24,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,825 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:24,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:24,826 - APP.ui.app_ui - INFO - Phiên autorun-20251011-050124 bắt đầu (priority=autorun, source=autorun).
2025-10-11 05:01:24,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:24,828 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:24,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:24,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:24,862 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-11 05:01:24,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:24,864 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,865 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-11 05:01:24,865 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,866 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (TaskGroup analysis.upload).
2025-10-11 05:01:24,866 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-11 05:01:24,866 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:24,867 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-11 05:01:24,868 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:24,871 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:24,871 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:24,874 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:24,875 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:24,876 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:24,877 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:24,877 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy vào cuối tuần.
2025-10-11 05:01:24,878 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:24,878 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy vào cuối tuần.
2025-10-11 05:01:24,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:24,879 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-11 05:01:24,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:24,881 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:24,885 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:24,887 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-11 05:01:24,887 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:24,888 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050124.0' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050124', 'index': 0})
2025-10-11 05:01:24,956 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:24,962 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050124.1' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050124', 'index': 1})
2025-10-11 05:01:24,963 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:24,964 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:24,965 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050124.2' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050124', 'index': 2})
2025-10-11 05:01:24,965 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 13067:1760147730:262e74bf02a1c2b2
2025-10-11 05:01:24,966 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:24,966 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251011-050124.3' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251011-050124', 'index': 3})
2025-10-11 05:01:24,967 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:24,967 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/x6cackq4w5ls
2025-10-11 05:01:24,967 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251011.jsonl.
2025-10-11 05:01:24,968 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,969 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-11 05:01:24,969 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-11 05:01:24,969 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:24,971 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy vào cuối tuần.
2025-10-11 05:01:24,974 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:24,976 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:24,977 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_2_logic' hoàn tất thành công.
2025-10-11 05:01:24,977 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:24,977 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:24,978 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:24,979 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:24,981 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:24,982 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:24,982 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:25,029 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:25,032 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:25,035 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:25,036 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:25,036 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:25,037 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:25,037 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:25,037 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:25,038 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:25,038 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:25,038 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:25,039 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:25,040 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:25,040 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:25,041 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.91s
2025-10-11 05:01:25,047 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11958:1760147795:513f8e5839ff7a34
2025-10-11 05:01:25,048 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/oqaz6abzw1q3
2025-10-11 05:01:25,048 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-11 05:01:25,091 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,095 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050124.0' (group=analysis.upload) hoàn tất sau 0.13s
2025-10-11 05:01:25,096 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-11 05:01:25,100 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14388:1760147725:aafea65d11833a75
2025-10-11 05:01:25,100 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-11 05:01:25,101 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:25,101 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/cbqd2j9q86jf
2025-10-11 05:01:25,102 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.29s
2025-10-11 05:01:25,102 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-11 05:01:25,106 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:25,107 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 11602:1760147800:c0e0245d791aa20d
2025-10-11 05:01:25,107 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/tmyqg1ktggaa
2025-10-11 05:01:25,108 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-11 05:01:25,157 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050124.1' (group=analysis.upload) hoàn tất sau 0.12s
2025-10-11 05:01:25,158 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050124.2' (group=analysis.upload) hoàn tất sau 0.06s
2025-10-11 05:01:25,165 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:25,168 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:25,208 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,210 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251011-050124.3' (group=analysis.upload) hoàn tất sau 0.11s
2025-10-11 05:01:25,212 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:25,213 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-11 05:01:25,215 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:25,216 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:25,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:25,221 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-11 05:01:25,222 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:25,223 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_3_logic' hoàn tất thành công.
2025-10-11 05:01:25,227 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:25,228 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-11 05:01:25,229 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:25,230 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-11 05:01:25,230 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:25,231 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:25,235 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-11 05:01:25,272 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:25,282 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-11 05:01:25,284 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:25,285 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251011-050124' (group=analysis.session) hoàn tất sau 0.47s
2025-10-11 05:01:25,286 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:25,291 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:25,297 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:25,340 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,341 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:25,346 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:25,444 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,446 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,548 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,649 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,650 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,752 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,753 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,856 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:25,858 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,862 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:25,863 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,864 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:25,865 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:25,866 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:25,867 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:25,867 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:25,868 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:25,870 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:25,871 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:25,871 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:25,872 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:25,875 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:25,875 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:25,875 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:25,876 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:25,879 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:25,879 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:25,879 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:25,880 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:25,883 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:25,883 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:25,883 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:25,884 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:25,886 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:25,887 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:25,887 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:25,888 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:25,888 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:25,892 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:25.892676+07:00
2025-10-11 05:01:25,897 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:25.892676+07:00
2025-10-11 05:01:25,921 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:25.892676+07:00 trong DST: True
2025-10-11 05:01:25,921 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:25,922 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:25,923 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:25,924 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:25,925 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:25,929 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:25,930 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:25,930 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:25,931 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:25,931 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:25,932 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:25,932 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:25,932 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:25,933 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:25,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:25,933 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:25,934 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:25,934 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:25,934 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:25,935 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:25,935 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:25,936 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:25,936 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:25,936 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:25,937 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:25,937 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:25,938 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:25,938 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:25,939 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:25,940 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:25,940 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:25,941 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:25,941 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:25,942 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:25,942 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:25,942 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:25,942 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:25,943 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:25,943 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:25,943 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:25,944 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:25,944 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:25,945 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:25,945 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:25,946 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:25,946 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:25.946286+07:00
2025-10-11 05:01:25,946 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:25.946286+07:00
2025-10-11 05:01:25,946 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:25.946286+07:00 trong DST: True
2025-10-11 05:01:25,947 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:25,947 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:25,948 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:25,948 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:25,948 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:25,949 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:25,949 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:25,949 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:25,950 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:25,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:25,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:25,953 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:25,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:25,985 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:25,988 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:25,988 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:26,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:26,054 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:26,125 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:26,140 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:01:26,143 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:26,152 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:26,154 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:26,154 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-11 05:01:26,156 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:26,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:26,160 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:26,160 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-11 05:01:26,162 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:26,163 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-11 05:01:26,163 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:26,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:26,165 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:26,165 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251011-050124: {'status': 'completed', 'early_exit': True}
2025-10-11 05:01:26,166 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:26,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:26,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:26,218 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:26,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:26,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:26,287 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:26,288 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:26,293 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:26,304 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:26,349 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:26,350 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:26,351 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:26,353 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:26,354 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:26,354 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:26,355 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:26,357 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:26,402 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:26,412 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:26,413 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:26,416 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:26,416 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:26,418 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:26,418 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:26,465 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:26,474 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:26,479 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:26,484 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:26,500 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:01:26,527 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:26,527 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:26,532 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:26,532 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:26,533 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:26,534 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:26,536 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:26,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:26,538 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:26,539 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:26,540 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:26,540 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:26,541 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:26,545 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:26,589 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:26,590 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:26,591 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:26,592 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:26,592 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:26,593 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:26,593 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:26,594 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:26,596 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:26,597 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:26,597 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:26,598 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:26,598 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:26,600 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.38s
2025-10-11 05:01:26,649 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:26,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:26,800 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:26,800 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:26,802 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:26,805 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:27,253 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:27,254 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:27,256 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 05:01:27,283 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:01:27,534 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:27,535 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:27,536 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:27,538 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:27,539 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:27,541 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:27,542 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:01:27,543 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:27,584 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:27,590 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-11 05:01:27,596 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:27,598 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:27,598 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:27,599 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:27,599 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:27,600 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:27,601 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:27,646 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:01:27,708 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:28,103 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:28,104 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:28,106 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:28,107 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:28,107 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:28,108 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:28,109 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:28,109 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:28,113 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:28,160 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:28,161 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:28,162 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:28,168 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:28,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:28,171 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:28,172 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:28,181 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:28,215 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:28,216 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:28,219 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:28,223 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:28,223 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:28,224 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:28,225 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:28,229 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:28,230 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:28,230 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:28,231 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:28,231 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:28,232 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:28.231966+07:00
2025-10-11 05:01:28,234 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:28.231966+07:00
2025-10-11 05:01:28,273 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:28.231966+07:00 trong DST: True
2025-10-11 05:01:28,276 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:28,278 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:28,278 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:28,280 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:28,280 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:28,287 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:28,288 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:28,289 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:28,289 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:28,290 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:28,290 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:28,291 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:28,291 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:28,292 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:28,292 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:28,293 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:28,294 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:28,294 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:28,297 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:28,331 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:28,334 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:28,338 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:28,339 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:28,340 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:28,341 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:28,342 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:28,342 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:28,343 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:28,343 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:28,345 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:28,345 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:28,346 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:28,347 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:28,348 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:28,348 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:28,349 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:28,349 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:28,350 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:28,350 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:28,351 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:28,351 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:28,352 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:28,353 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:28,354 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:28,354 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:28,355 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:28.354982+07:00
2025-10-11 05:01:28,355 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:28.354982+07:00
2025-10-11 05:01:28,355 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:28.354982+07:00 trong DST: True
2025-10-11 05:01:28,356 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:28,356 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:28,356 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:28,357 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,358 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:28,358 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:28,360 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:28,361 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,361 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:28,393 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:28,395 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:28,396 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:28,397 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:28,398 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:28,398 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:28,399 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:28,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:28,400 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:28,401 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:28,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:28,403 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:28,403 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:28,404 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:28,405 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:28,405 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:28,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:28,407 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:28,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:28,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:28,408 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:28,408 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:28,409 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:28,410 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:28,411 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,411 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:28,411 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:28,412 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:28,412 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:28,413 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:28,413 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:28,413 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:28,414 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:28,414 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:28,415 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:28,415 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:28,416 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:28,417 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:28,417 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:28,417 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:28,418 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:28,418 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:28,418 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,419 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:28,419 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:28,419 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:28,422 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:28,428 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:28,458 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:28,460 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:28,462 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:28,463 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:28,464 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,467 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:28,468 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:28,469 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:28,469 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:28,469 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:28,470 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,470 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:28,471 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,471 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:28,471 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:28,472 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:28,472 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:28,472 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:28,473 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:28,474 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-11 05:01:28,522 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:28,524 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:28,524 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:28,525 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:28,528 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:28,539 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:28,540 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:28,541 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:28,543 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:28,544 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:28,545 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:28,548 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:01:28,557 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:28,584 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 05:01:28,594 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-11 05:01:28,597 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:28,597 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:28,598 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:28,598 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:28,599 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:28,600 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:28,600 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:28,601 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:28,647 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:29,102 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:29,104 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:29,105 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:29,105 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:29,106 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:29,106 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:29,107 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:29,107 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:29,109 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:29,109 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:29,110 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:29,111 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:29,115 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:29,157 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:29,161 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:29,162 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:29,166 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:29,168 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:29,169 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:29,169 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:29,172 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:29,208 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:29,209 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:29,211 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:29,215 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:29,217 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:29,218 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:29,219 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:29,219 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:29,220 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:29.220094+07:00
2025-10-11 05:01:29,220 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:29.220094+07:00
2025-10-11 05:01:29,221 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:29.220094+07:00 trong DST: True
2025-10-11 05:01:29,221 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:29,222 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:29,222 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:29,223 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:29,224 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:29,229 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:29,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:29,230 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:29,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:29,231 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:29,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:29,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:29,234 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:29,235 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:29,267 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:29,268 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:29,269 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:29,270 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:29,272 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:29,273 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:29,273 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:29,274 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:29,274 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:29,275 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:29,275 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:29,276 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:29,277 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:29,278 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:29,279 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:29,279 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:29,279 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:29,280 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:29,280 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:29,281 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:29,281 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:29,281 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:29,282 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:29,282 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:29,282 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:29,282 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:29,283 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:29,283 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:29,284 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:29,285 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:29,285 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:29,286 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:29.286183+07:00
2025-10-11 05:01:29,286 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:29.286183+07:00
2025-10-11 05:01:29,286 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:29.286183+07:00 trong DST: True
2025-10-11 05:01:29,287 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:29,287 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:29,287 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:29,288 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:29,288 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:29,289 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:29,289 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:29,289 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:29,290 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:29,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:29,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:29,291 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:29,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:29,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:29,293 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:29,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:29,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:29,295 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:29,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:29,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:29,297 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:29,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:29,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:29,374 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:29,375 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:29,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:29,378 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:29,378 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:29,379 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:29,498 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:29,535 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-11 05:01:29,572 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:29,590 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:29,665 - APP.services.fmp_service - INFO - Lấy thành công 400 sự kiện từ investpy cho 7 ngày tới.
2025-10-11 05:01:29,729 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:29,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:29,802 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 4.99s
2025-10-11 05:01:29,803 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:29,805 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:29,813 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:29,816 - APP.ui.app_ui - DEBUG - Callback nhận được 138 sự kiện tin tức mới.
2025-10-11 05:01:29,817 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:29,818 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:29,818 - APP.services.news_service - INFO - NewsService làm mới cache (138 sự kiện, priority=autorun, source=network, latency=5.00s)
2025-10-11 05:01:29,819 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-11 05:01:29,819 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:29,820 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 5.01s
2025-10-11 05:01:29,821 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:29,822 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:29,822 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:29,822 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:29,823 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:29,823 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:29,824 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:29,824 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:29,825 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:29,914 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:01:29,922 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:29,967 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:29,968 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:29,968 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:29,969 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:29,969 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:29,970 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:29,972 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:29,972 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:29,972 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:29,984 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:30,059 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:30,167 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:30,186 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:30,187 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:30,187 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:30,189 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:30,190 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:30,191 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:30,191 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:30,192 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:30,195 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:30,196 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:30,197 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:30,198 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:30,199 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:30,199 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:30,200 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:30,200 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:30,202 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:30,203 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:30,203 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:30,204 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:30,243 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:30,244 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.70s
2025-10-11 05:01:30,459 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:30,460 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:30,461 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:30,463 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:30,466 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:30,730 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:30,730 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:30,732 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:30,734 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:30,734 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:30,735 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:30,736 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:30,736 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:30,770 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:30,770 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:30,771 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:30,783 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:30,882 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:30,920 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:30,933 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:30,948 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:30,953 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:31,506 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:31,507 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:31,508 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:31,508 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:31,509 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:31,509 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:31,510 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:31,510 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:31,512 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:31,513 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:31,513 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:31,514 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:31,523 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:31,545 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:31,545 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:31,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:31,549 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:31,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:31,550 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:31,550 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:31,553 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:31,553 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:31,553 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:31,554 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:31,557 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:31,557 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:31,558 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:31,558 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:31,558 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:31,559 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:31.559111+07:00
2025-10-11 05:01:31,559 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:31.559111+07:00
2025-10-11 05:01:31,560 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:31.559111+07:00 trong DST: True
2025-10-11 05:01:31,560 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:31,560 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:31,561 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:31,562 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:31,562 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:31,565 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:31,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:31,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:31,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:31,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:31,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:31,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:31,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:31,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:31,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:31,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:31,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:31,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:31,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:31,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:31,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:31,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:31,572 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:31,572 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:31,573 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:31,573 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:31,574 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:31,574 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:31,574 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:31,575 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:31,575 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:31,576 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:31,577 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:31,577 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:31,578 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:31,579 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:31,579 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:31,588 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:31,590 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:31,596 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:31,602 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:31,610 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:31,614 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:31,615 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:31,615 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:31,616 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:31.616118+07:00
2025-10-11 05:01:31,616 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:31.616118+07:00
2025-10-11 05:01:31,617 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:31.616118+07:00 trong DST: True
2025-10-11 05:01:31,617 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:31,617 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:31,618 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:31,618 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,619 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:31,619 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:31,620 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:31,620 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,621 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:31,621 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:31,622 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:31,622 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:31,623 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:31,624 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:31,624 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:31,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:31,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:31,626 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:31,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:31,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:31,627 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:31,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:31,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:31,629 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:31,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:31,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:31,630 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:31,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:31,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:31,632 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:31,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:31,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:31,633 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:31,634 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,634 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:31,635 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:31,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:31,635 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:31,636 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:31,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:31,636 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:31,637 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:31,637 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:31,637 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:31,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:31,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:31,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:31,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:31,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:31,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:31,648 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:31,665 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,674 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:31,675 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:31,676 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:31,676 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:31,677 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:31,677 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:31,679 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:31,681 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,681 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:31,681 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:31,682 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:31,685 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:31,685 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:31,686 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:31,687 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:31,687 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,688 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:31,688 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,688 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:31,688 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:31,689 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:31,689 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:31,689 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:31,690 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:31,691 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.96s
2025-10-11 05:01:31,731 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:31,736 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:31,737 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:31,738 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:31,741 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:31,742 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:31,743 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:31,744 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:31,746 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:31,747 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:31,748 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:31,749 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:31,750 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:31,753 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:31,754 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:31,755 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:31,755 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:31,755 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:31,756 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:31,756 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:31,757 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:31,846 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:32,258 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:32,260 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:32,261 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:32,261 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:32,262 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:32,262 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:32,262 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:32,263 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:32,266 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:32,266 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:32,267 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:32,268 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:32,277 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:32,298 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:32,301 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:32,302 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:32,452 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:32,452 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:32,453 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:32,453 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:32,456 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:32,456 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:32,456 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:32,457 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:32,460 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:32,460 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:32,461 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:32,461 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:32,462 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:32,462 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:32.462324+07:00
2025-10-11 05:01:32,462 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:32.462324+07:00
2025-10-11 05:01:32,463 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:32.462324+07:00 trong DST: True
2025-10-11 05:01:32,463 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:32,463 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:32,464 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:32,465 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:32,465 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:32,469 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:32,469 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:32,470 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:32,470 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:32,470 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:32,471 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:32,471 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:32,472 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:32,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:32,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:32,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:32,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:32,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:32,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:32,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:32,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:32,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:32,476 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:32,477 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:32,477 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:32,478 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:32,478 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:32,479 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:32,479 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:32,480 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:32,480 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:32,481 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:32,481 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:32,482 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:32,482 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:32,483 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:32,483 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:32,484 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:32,484 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:32,485 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:32,485 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:32,486 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:32,486 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:32,519 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:32,519 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:32,520 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:32.520392+07:00
2025-10-11 05:01:32,521 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:32.520392+07:00
2025-10-11 05:01:32,522 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:32.520392+07:00 trong DST: True
2025-10-11 05:01:32,522 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:32,522 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:32,523 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:32,523 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,524 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:32,524 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:32,525 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:32,525 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,526 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:32,526 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:32,527 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:32,528 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:32,528 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:32,529 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:32,529 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:32,530 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:32,530 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:32,531 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:32,531 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:32,532 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:32,532 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:32,532 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:32,533 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:32,534 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:32,534 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:32,535 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:32,536 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:32,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:32,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:32,537 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:32,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:32,539 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:32,539 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:32,540 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,540 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:32,541 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:32,541 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:32,541 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:32,542 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:32,542 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:32,543 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:32,543 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:32,544 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:32,544 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:32,544 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:32,545 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:32,546 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:32,548 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:32,548 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:32,548 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:32,583 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:32,584 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,585 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:32,586 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:32,586 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:32,587 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:32,587 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:32,588 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:32,589 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:32,590 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,591 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:32,591 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:32,592 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:32,595 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:32,596 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:32,596 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:32,597 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:32,597 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,598 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:32,598 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,599 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:32,599 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:32,599 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:32,600 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:32,600 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:32,601 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:32,602 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-11 05:01:32,655 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:32,656 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:32,656 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:32,659 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:32,662 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:32,745 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:32,746 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:32,748 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:32,749 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:32,750 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:32,751 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:32,752 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:32,753 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:32,756 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:32,756 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:32,757 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:32,757 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:32,758 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:32,759 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:32,760 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:32,760 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:32,763 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:33,261 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:33,263 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:33,264 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:33,264 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:33,264 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:33,265 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:33,265 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:33,266 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:33,268 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:33,269 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:33,270 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:33,271 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:33,282 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:33,302 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:33,303 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:33,304 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:33,307 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:33,307 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:33,308 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:33,309 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:33,312 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:33,312 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:33,312 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:33,313 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:33,316 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:33,316 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:33,317 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:33,317 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:33,318 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:33,318 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:33.318340+07:00
2025-10-11 05:01:33,318 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:33.318340+07:00
2025-10-11 05:01:33,319 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:33.318340+07:00 trong DST: True
2025-10-11 05:01:33,319 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:33,320 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:33,320 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:33,321 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:33,322 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:33,326 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:33,328 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:33,329 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:33,329 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:33,360 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:33,361 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:33,362 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:33,362 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:33,362 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:33,363 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:33,364 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:33,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:33,365 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:33,365 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:33,366 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:33,366 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:33,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:33,367 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:33,367 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:33,368 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:33,369 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:33,370 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:33,370 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:33,371 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:33,371 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:33,372 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:33,372 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:33,373 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:33,373 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:33,373 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:33,374 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:33,374 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:33,375 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:33,375 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:33,376 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:33,376 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:33,377 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:33,377 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:33,378 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:33,378 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:33,378 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:33.378864+07:00
2025-10-11 05:01:33,379 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:33.378864+07:00
2025-10-11 05:01:33,379 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:33.378864+07:00 trong DST: True
2025-10-11 05:01:33,379 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:33,380 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:33,380 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:33,381 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:33,382 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:33,382 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:33,382 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,383 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:33,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:33,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:33,384 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:33,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:33,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:33,386 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:33,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:33,388 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:33,388 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:33,389 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:33,391 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:33,392 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:33,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:33,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:33,410 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:33,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:33,422 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:33,426 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:33,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:33,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:33,428 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:33,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:33,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:33,431 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:33,431 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,432 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:33,432 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:33,432 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:33,433 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:33,433 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:33,433 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:33,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:33,434 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:33,434 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:33,435 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:33,435 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:33,435 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:33,436 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:33,436 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:33,437 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:33,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:33,437 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:33,438 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,438 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:33,439 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:33,439 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:33,439 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:33,440 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:33,441 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:33,442 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:33,443 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,444 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:33,444 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:33,445 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:33,448 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:33,448 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:33,449 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:33,450 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:33,450 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,451 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:33,451 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,451 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:33,452 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:33,453 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:33,453 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:33,454 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:33,454 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:33,463 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.72s
2025-10-11 05:01:33,536 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:33,548 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:33,549 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:33,551 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:33,554 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:33,750 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:33,751 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:33,752 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:33,754 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:33,755 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:33,756 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:33,757 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:33,758 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:33,787 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:33,999 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,000 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:34,001 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,001 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,002 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:34,002 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,003 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:34,003 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:34,504 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:34,505 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:34,506 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:34,506 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:34,507 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:34,507 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:34,508 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:34,508 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:34,510 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:34,510 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:34,511 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:34,512 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:34,515 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:34,516 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:34,516 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:34,517 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:34,525 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:34,546 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:34,546 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:34,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:34,550 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:34,551 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:34,551 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:34,552 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:34,554 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:34,555 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:34,555 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:34,556 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:34,556 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:34,556 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:34.556739+07:00
2025-10-11 05:01:34,557 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:34.556739+07:00
2025-10-11 05:01:34,557 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:34.556739+07:00 trong DST: True
2025-10-11 05:01:34,558 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:34,558 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:34,558 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:34,559 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:34,560 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:34,562 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:34,563 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:34,563 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:34,564 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:34,564 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:34,564 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:34,565 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:34,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:34,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:34,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:34,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:34,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:34,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:34,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:34,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:34,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:34,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:34,569 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:34,570 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:34,570 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:34,571 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:34,571 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:34,571 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:34,572 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:34,572 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:34,573 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:34,573 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:34,574 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:34,574 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:34,574 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:34,575 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:34,575 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:34,575 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:34,576 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:34,578 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:34,579 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:34,585 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:34,616 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:34,617 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:34,617 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:34,618 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:34.618180+07:00
2025-10-11 05:01:34,620 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:34.618180+07:00
2025-10-11 05:01:34,620 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:34.618180+07:00 trong DST: True
2025-10-11 05:01:34,621 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:34,622 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:34,622 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:34,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:34,623 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:34,624 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:34,624 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,624 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:34,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:34,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:34,626 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:34,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:34,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:34,628 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:34,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:34,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:34,629 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:34,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:34,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:34,630 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:34,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:34,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:34,632 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:34,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:34,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:34,634 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:34,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:34,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:34,635 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:34,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:34,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:34,637 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:34,637 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,637 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:34,638 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:34,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:34,639 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:34,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:34,639 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:34,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:34,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:34,640 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:34,641 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:34,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:34,642 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:34,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:34,679 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:34,680 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:34,680 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:34,681 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:34,681 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,682 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:34,684 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:34,684 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:34,684 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:34,685 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:34,686 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:34,687 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:34,688 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,689 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:34,689 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:34,690 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:34,693 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:34,693 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:34,694 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:34,694 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:34,695 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,695 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:34,696 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,696 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:34,696 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:34,697 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:34,698 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:34,698 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:34,699 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:34,700 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.95s
2025-10-11 05:01:34,755 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:34,755 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:34,757 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:34,758 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:34,759 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:34,760 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:34,761 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:34,761 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:34,797 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:34,800 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:34,801 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:34,802 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:34,805 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:34,806 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:34,996 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,997 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:34,998 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,998 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,999 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:34,999 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:34,999 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:35,000 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:35,501 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:35,503 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:35,503 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:35,504 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:35,504 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:35,505 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:35,505 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:35,506 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:35,508 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:35,509 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:35,509 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:35,510 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:35,517 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:35,523 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:35,545 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:35,546 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:35,549 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:35,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:35,550 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:35,550 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:35,553 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:35,554 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:35,554 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:35,554 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:35,558 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:35,558 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:35,559 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:35,559 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:35,560 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:35,560 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:35.560413+07:00
2025-10-11 05:01:35,560 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:35.560413+07:00
2025-10-11 05:01:35,561 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:35.560413+07:00 trong DST: True
2025-10-11 05:01:35,562 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:35,562 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:35,563 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:35,564 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:35,564 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:35,568 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:35,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:35,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:35,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:35,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:35,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:35,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:35,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:35,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:35,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:35,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:35,572 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:35,572 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:35,573 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:35,573 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:35,574 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:35,574 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:35,575 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:35,575 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:35,576 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:35,576 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:35,577 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:35,577 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:35,579 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:35,579 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:35,586 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:35,613 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:35,614 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:35,614 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:35,615 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:35,616 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:35,617 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:35,617 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:35,618 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:35,618 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:35,619 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:35,619 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:35,620 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:35,620 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:35,620 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:35,621 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:35.621173+07:00
2025-10-11 05:01:35,621 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:35.621173+07:00
2025-10-11 05:01:35,621 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:35.621173+07:00 trong DST: True
2025-10-11 05:01:35,622 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:35,622 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:35,622 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:35,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:35,623 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:35,624 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:35,625 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,625 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:35,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:35,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:35,627 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:35,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:35,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:35,628 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:35,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:35,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:35,630 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:35,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:35,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:35,631 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:35,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:35,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:35,633 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:35,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:35,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:35,634 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:35,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:35,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:35,636 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:35,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:35,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:35,638 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:35,638 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,638 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:35,639 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:35,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:35,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:35,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:35,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:35,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:35,642 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:35,642 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:35,648 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:35,652 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:35,660 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:35,663 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:35,665 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:35,674 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:35,676 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:35,678 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:35,680 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,680 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:35,680 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:35,681 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:35,681 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:35,682 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:35,683 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:35,684 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:35,685 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,686 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:35,686 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:35,687 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:35,690 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:35,691 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:35,691 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:35,692 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:35,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,693 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:35,693 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,693 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:35,694 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:35,694 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:35,694 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:35,695 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:35,695 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:35,696 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-11 05:01:35,737 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:35,739 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:35,739 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:35,740 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:35,743 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:35,759 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:35,760 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:35,761 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:35,763 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:35,764 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:35,765 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:35,767 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:35,767 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:35,800 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:35,801 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:35,802 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:35,802 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:35,803 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:35,803 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:35,803 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:35,804 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:35,848 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:36,305 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:36,307 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:36,308 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:36,308 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:36,309 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:36,309 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:36,310 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:36,310 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:36,313 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:36,313 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:36,314 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:36,314 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:36,325 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:36,346 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:36,352 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:36,353 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:36,356 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:36,356 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:36,357 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:36,357 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:36,360 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:36,361 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:36,384 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:36,388 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:36,392 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:36,424 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:36,425 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:36,427 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:36,428 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:36,429 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:36.428945+07:00
2025-10-11 05:01:36,429 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:36.428945+07:00
2025-10-11 05:01:36,430 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:36.428945+07:00 trong DST: True
2025-10-11 05:01:36,431 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:36,431 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:36,432 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:36,435 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:36,435 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:36,440 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:36,441 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:36,441 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:36,442 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:36,442 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:36,443 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:36,443 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:36,444 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:36,444 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:36,444 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:36,445 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:36,445 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:36,446 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:36,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:36,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:36,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:36,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:36,450 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:36,490 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:36,491 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:36,499 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:36,500 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:36,501 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:36,503 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:36,505 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:36,505 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:36,506 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:36,506 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:36,507 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:36,507 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:36,507 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:36,508 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:36,508 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:36,508 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:36,509 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:36,509 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:36,510 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:36,511 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:36,511 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:36,512 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:36,512 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:36.512449+07:00
2025-10-11 05:01:36,512 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:36.512449+07:00
2025-10-11 05:01:36,513 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:36.512449+07:00 trong DST: True
2025-10-11 05:01:36,513 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:36,513 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:36,514 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:36,514 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,514 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:36,517 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:36,518 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:36,547 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,548 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:36,549 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:36,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:36,551 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:36,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:36,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:36,553 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:36,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:36,554 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:36,554 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:36,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:36,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:36,556 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:36,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:36,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:36,558 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:36,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:36,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:36,560 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:36,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:36,561 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:36,562 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:36,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:36,563 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:36,563 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:36,564 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,564 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:36,565 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:36,565 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:36,566 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:36,566 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:36,567 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:36,567 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:36,567 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:36,567 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:36,568 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:36,568 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:36,568 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:36,569 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:36,569 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:36,569 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:36,570 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:36,570 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:36,571 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,571 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:36,572 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:36,572 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:36,573 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:36,573 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:36,573 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:36,574 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:36,576 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,577 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:36,577 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:36,577 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:36,586 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:36,612 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:36,613 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:36,613 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:36,615 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,615 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:36,616 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,616 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:36,617 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:36,617 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:36,618 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:36,618 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:36,619 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:36,620 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-11 05:01:36,699 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:36,702 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:36,702 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:36,704 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:36,707 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:36,764 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:36,766 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:36,767 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:36,770 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:36,771 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:36,772 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:36,772 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:36,773 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:36,777 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:36,777 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:36,778 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:36,778 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:36,779 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:36,779 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:36,780 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:36,780 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:36,813 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:37,281 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:37,283 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:37,284 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:37,284 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:37,285 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:37,285 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:37,285 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:37,286 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:37,289 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:37,289 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:37,290 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:37,290 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:37,324 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:37,325 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:37,325 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:37,326 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:37,329 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:37,329 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:37,330 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:37,354 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:37,358 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:37,360 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:37,361 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:37,393 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:37,398 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:37,398 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:37,399 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:37,399 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:37,400 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:37,401 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:37.401095+07:00
2025-10-11 05:01:37,402 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:37.401095+07:00
2025-10-11 05:01:37,402 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:37.401095+07:00 trong DST: True
2025-10-11 05:01:37,402 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:37,403 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:37,403 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:37,404 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:37,405 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:37,408 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:37,409 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:37,409 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:37,409 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:37,409 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:37,410 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:37,410 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:37,410 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:37,411 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:37,411 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:37,412 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:37,412 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:37,412 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:37,413 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:37,413 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:37,414 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:37,414 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:37,414 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:37,415 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:37,415 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:37,416 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:37,416 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:37,417 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:37,417 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:37,417 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:37,418 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:37,418 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:37,419 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:37,419 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:37,419 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:37,420 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:37,420 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:37,420 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:37,421 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:37,421 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:37,422 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:37,422 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:37,424 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:37,424 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:37,429 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:37,430 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:37.430575+07:00
2025-10-11 05:01:37,432 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:37.430575+07:00
2025-10-11 05:01:37,433 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:37.430575+07:00 trong DST: True
2025-10-11 05:01:37,459 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:37,460 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:37,462 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:37,462 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,463 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:37,464 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:37,464 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:37,465 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,465 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:37,466 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:37,467 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:37,467 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:37,468 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:37,469 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:37,470 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:37,470 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:37,471 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:37,471 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:37,472 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:37,472 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:37,473 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:37,473 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:37,474 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:37,474 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:37,475 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:37,476 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:37,476 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:37,477 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:37,478 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:37,478 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:37,479 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:37,479 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:37,480 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:37,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,481 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:37,481 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:37,482 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:37,482 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:37,482 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:37,483 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:37,483 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:37,484 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:37,484 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:37,485 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:37,486 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:37,486 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:37,516 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:37,523 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:37,524 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:37,527 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:37,527 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:37,527 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,528 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:37,528 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:37,529 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:37,529 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:37,530 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:37,530 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:37,531 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:37,532 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:37,533 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,533 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:37,534 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:37,537 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:37,538 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:37,538 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:37,538 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:37,539 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,540 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:37,540 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,541 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:37,541 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:37,541 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:37,542 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:37,542 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:37,543 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:37,544 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.78s
2025-10-11 05:01:37,582 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:37,586 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:37,586 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:37,588 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:37,591 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:37,769 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:37,770 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:37,771 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:37,773 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:37,774 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:37,775 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:37,776 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:37,777 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:37,809 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:38,013 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,014 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:38,015 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,016 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,016 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:38,017 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,017 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:38,018 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:38,518 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:38,520 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:38,521 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:38,521 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:38,522 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:38,522 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:38,523 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:38,523 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:38,526 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:38,526 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:38,527 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:38,527 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:38,541 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:38,559 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:38,560 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:38,560 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:38,563 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:38,563 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:38,563 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:38,564 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:38,566 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:38,567 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:38,567 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:38,567 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:38,571 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:38,571 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:38,572 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:38,572 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:38,573 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:38,573 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:38.573547+07:00
2025-10-11 05:01:38,573 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:38.573547+07:00
2025-10-11 05:01:38,574 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:38.573547+07:00 trong DST: True
2025-10-11 05:01:38,574 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:38,574 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:38,575 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:38,576 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:38,576 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:38,595 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:38,611 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:38,613 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:38,613 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:38,614 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:38,614 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:38,615 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:38,615 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:38,615 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:38,616 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:38,616 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:38,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:38,617 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:38,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:38,618 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:38,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:38,618 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:38,619 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:38,619 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:38,620 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:38,621 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:38,621 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:38,622 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:38,622 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:38,623 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:38,623 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:38,624 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:38,624 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:38,624 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:38,625 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:38,625 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:38,625 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:38,626 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:38,626 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:38,626 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:38,627 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:38,627 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:38,628 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:38,628 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:38,629 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:38,629 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:38.629609+07:00
2025-10-11 05:01:38,630 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:38.629609+07:00
2025-10-11 05:01:38,630 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:38.629609+07:00 trong DST: True
2025-10-11 05:01:38,630 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:38,631 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:38,631 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:38,632 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,632 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:38,632 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:38,633 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:38,633 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,634 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:38,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:38,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:38,635 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:38,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:38,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:38,637 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:38,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:38,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:38,639 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:38,639 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:38,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:38,640 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:38,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:38,642 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:38,643 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:38,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:38,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:38,678 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:38,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:38,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:38,680 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:38,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:38,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:38,682 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:38,682 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,683 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:38,683 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:38,683 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:38,684 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:38,684 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:38,685 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:38,685 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:38,686 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:38,686 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:38,687 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:38,687 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:38,688 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:38,688 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:38,689 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:38,689 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:38,689 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:38,690 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:38,690 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,691 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:38,691 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:38,691 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:38,692 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:38,692 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:38,693 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:38,694 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:38,695 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,696 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:38,696 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:38,696 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:38,697 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:38,700 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:38,700 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:38,701 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:38,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,702 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:38,704 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,704 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:38,704 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:38,736 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:38,737 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:38,737 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:38,738 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:38,740 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.97s
2025-10-11 05:01:38,791 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:38,797 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:38,799 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:38,801 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:38,802 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:38,804 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:38,805 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:38,806 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:38,808 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,809 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:38,810 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,811 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,811 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:38,812 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:38,812 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:38,813 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:38,838 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:38,861 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:38,861 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:38,862 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:38,865 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:38,866 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:39,314 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:39,315 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:39,316 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:39,316 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:39,317 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:39,317 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:39,318 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:39,318 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:39,321 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:39,321 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:39,322 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:39,322 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:39,334 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:39,354 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:39,354 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:39,355 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:39,358 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:39,358 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:39,359 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:39,359 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:39,361 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:39,362 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:39,362 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:39,362 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:39,365 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:39,366 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:39,367 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:39,372 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:39,394 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:39,395 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:39.394949+07:00
2025-10-11 05:01:39,395 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:39.394949+07:00
2025-10-11 05:01:39,397 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:39.394949+07:00 trong DST: True
2025-10-11 05:01:39,397 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:39,398 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:39,398 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:39,399 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:39,400 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:39,404 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:39,405 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:39,406 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:39,406 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:39,407 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:39,407 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:39,407 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:39,408 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:39,408 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:39,409 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:39,409 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:39,410 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:39,410 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:39,410 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:39,411 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:39,411 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:39,411 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:39,412 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:39,412 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:39,413 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:39,413 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:39,414 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:39,415 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:39,415 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:39,416 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:39,416 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:39,417 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:39,417 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:39,417 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:39,418 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:39,418 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:39,419 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:39,419 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:39,420 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:39,422 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:39,422 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:39,423 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:39,451 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:39,452 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:39,453 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:39,454 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:39.453967+07:00
2025-10-11 05:01:39,454 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:39.453967+07:00
2025-10-11 05:01:39,454 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:39.453967+07:00 trong DST: True
2025-10-11 05:01:39,455 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:39,455 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:39,455 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:39,456 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,456 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:39,457 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:39,458 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:39,458 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,458 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:39,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:39,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:39,460 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:39,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:39,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:39,462 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:39,462 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:39,463 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:39,463 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:39,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:39,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:39,465 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:39,465 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:39,466 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:39,466 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:39,467 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:39,467 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:39,468 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:39,468 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:39,469 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:39,469 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:39,470 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:39,470 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:39,471 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:39,471 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,472 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:39,472 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:39,472 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:39,473 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:39,473 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:39,473 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:39,474 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:39,474 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:39,474 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:39,474 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:39,475 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:39,475 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:39,475 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:39,476 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:39,476 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:39,476 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:39,477 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:39,477 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,478 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:39,478 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:39,479 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:39,479 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:39,479 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:39,480 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:39,481 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:39,482 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,483 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:39,484 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:39,484 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:39,490 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:39,519 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:39,521 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:39,523 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:39,523 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,524 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:39,524 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,525 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:39,525 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:39,526 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:39,526 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:39,526 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:39,527 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:39,528 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.73s
2025-10-11 05:01:39,620 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:39,621 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:39,621 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:39,622 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:39,624 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:39,802 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:39,803 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:39,804 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:39,806 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:39,807 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:39,808 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:39,808 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:39,809 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:39,844 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:40,042 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:40,043 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:40,044 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:40,044 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:40,045 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:40,045 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:40,045 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:40,046 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:40,547 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:40,548 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:40,549 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:40,549 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:40,550 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:40,550 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:40,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:40,551 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:40,553 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:40,553 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:40,554 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:40,554 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:40,564 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:40,586 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:40,587 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:40,587 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:40,590 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:40,591 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:40,592 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:40,592 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:40,595 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:40,595 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:40,596 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:40,596 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:40,599 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:40,600 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:40,600 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:40,601 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:40,601 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:40,601 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:40.601926+07:00
2025-10-11 05:01:40,674 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:40.601926+07:00
2025-10-11 05:01:40,679 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:40.601926+07:00 trong DST: True
2025-10-11 05:01:40,680 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:40,745 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:40,819 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:40,822 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:40,844 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:40,940 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:40,949 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:40,964 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:40,994 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:40,997 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:40,999 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:41,000 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:41,001 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:41,002 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-11 05:01:41,002 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:41,003 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:41,003 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:41,004 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:41,004 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:41,005 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:41,005 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:41,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:41,006 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:41,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:41,007 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:41,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:41,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:41,008 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:41,009 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:41,009 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:41,010 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:41,010 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:41,011 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:41,011 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:41,012 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:41,012 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:41,013 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:41,013 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:41,014 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:41,015 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:41,015 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:41,016 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:41,016 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:41,016 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:41,017 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:41,017 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:41,032 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:41,033 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:41,034 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:41,035 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:41,041 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:41,042 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:41.042232+07:00
2025-10-11 05:01:41,042 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:41.042232+07:00
2025-10-11 05:01:41,043 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:41.042232+07:00 trong DST: True
2025-10-11 05:01:41,044 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:41,044 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:41,045 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:41,076 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:41,164 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,234 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:41,243 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:41,265 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:41,312 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,373 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:41,375 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:41,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:41,389 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:41,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:41,446 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:41,448 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:41,450 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:41,451 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:41,493 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:41,504 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:41,512 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:41,512 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:41,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:41,517 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:41,562 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:41,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:41,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:41,573 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:41,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:41,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:41,626 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:41,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:41,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:41,631 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:41,631 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,633 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:41,634 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:41,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:41,635 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:41,636 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:41,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:41,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:41,637 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:41,638 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:41,638 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:41,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:41,639 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:41,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:41,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:41,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:41,642 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:41,643 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:41,679 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,679 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:41,680 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:41,681 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:41,682 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:41,682 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:41,683 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:41,685 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:41,687 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,688 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:41,688 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:41,688 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:41,692 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:41,692 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:41,693 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:41,693 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:41,694 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,694 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:41,694 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,695 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:41,695 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:41,696 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:41,696 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:41,697 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:41,697 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:41,698 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.89s
2025-10-11 05:01:41,737 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:41,739 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:41,739 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:41,740 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:41,743 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:41,941 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:41,941 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:41,943 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:41,945 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:41,946 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:41,947 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:41,948 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:41,948 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:41,983 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:41,983 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:41,986 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:41,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:41,987 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:41,988 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:41,988 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:41,989 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:42,051 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:42,299 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:42,299 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:42,490 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:42,492 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:42,493 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.19s
2025-10-11 05:01:42,493 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:42,494 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:42,494 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:42,495 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:42,495 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:42,496 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:42,498 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:42,498 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:42,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:42,499 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:42,502 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:42,502 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:01:42,502 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:42,503 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:42,504 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:42,506 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:42,506 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:42,507 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:42,507 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:42,509 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:42,510 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:42,510 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:42,510 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:42,513 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:42,514 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:42,514 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:42,515 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:42,515 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:42,516 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:42.516176+07:00
2025-10-11 05:01:42,516 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:42.516176+07:00
2025-10-11 05:01:42,516 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:42.516176+07:00 trong DST: True
2025-10-11 05:01:42,517 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:42,517 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:42,518 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:42,544 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:42,545 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:42,579 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:42,581 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:42,581 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:42,582 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:42,582 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:42,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:42,583 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:42,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:42,584 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:42,584 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:42,585 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:42,585 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:42,585 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:42,586 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:42,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:42,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:42,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:42,588 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:42,589 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:42,589 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:42,590 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:42,590 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:42,591 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:42,591 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:42,591 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:42,592 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:42,592 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:42,593 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:42,593 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:42,593 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:42,594 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:42,594 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:42,594 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:42,595 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:42,595 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:42,596 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:42,596 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:42,597 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:42,598 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:42,598 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:42,598 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:42.598759+07:00
2025-10-11 05:01:42,599 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:42.598759+07:00
2025-10-11 05:01:42,599 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:42.598759+07:00 trong DST: True
2025-10-11 05:01:42,600 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:42,600 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:42,600 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:42,601 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,601 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:42,602 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:42,602 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:42,602 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,603 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:42,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:42,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:42,604 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:42,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:42,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:42,606 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:42,606 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:42,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:42,608 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:42,608 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:42,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:42,609 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:42,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:42,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:42,612 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:42,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:42,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:42,647 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:42,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:42,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:42,649 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:42,650 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:42,651 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:42,651 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:42,651 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,652 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:42,652 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:42,652 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:42,653 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:42,653 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:42,653 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:42,654 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:42,654 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:42,655 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:42,655 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:42,656 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:42,656 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:42,656 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:42,656 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:42,657 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:42,657 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:42,657 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:42,658 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,658 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:42,659 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:42,659 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:42,659 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:42,660 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:42,660 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:42,662 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:42,663 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,663 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:42,664 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:42,664 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:42,667 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:42,667 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:42,668 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:42,668 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:42,669 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,669 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:42,669 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,670 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:42,670 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:42,670 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:42,671 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:42,671 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:42,672 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:42,673 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.73s
2025-10-11 05:01:42,705 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:42,707 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:42,708 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:42,711 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:42,714 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:42,944 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:42,945 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:42,946 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:42,948 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:42,949 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:42,950 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:42,951 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:42,952 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:42,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:42,988 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:42,988 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:42,989 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:42,989 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:42,990 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:42,990 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:42,991 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:43,016 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:43,492 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:43,493 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:43,494 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:43,494 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:43,495 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:43,496 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:43,496 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:43,497 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:43,499 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:43,499 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:43,500 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:43,500 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:43,509 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:43,531 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:43,532 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:43,532 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:43,535 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:43,536 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:43,537 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:43,537 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:43,540 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:43,540 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:43,541 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:43,541 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:43,543 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:43,544 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:43,545 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:43,545 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:43,545 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:43,546 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:43.546068+07:00
2025-10-11 05:01:43,546 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:43.546068+07:00
2025-10-11 05:01:43,547 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:43.546068+07:00 trong DST: True
2025-10-11 05:01:43,547 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:43,548 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:43,549 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:43,556 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:43,576 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:43,588 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:43,616 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:43,616 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:43,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:43,617 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:43,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:43,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:43,619 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:43,620 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:43,627 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:43,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:43,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:43,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:43,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:43,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:43,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:43,683 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:43,684 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:43,687 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:43,721 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:43,722 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:43,723 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:43,724 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:43,731 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:43,754 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:43,756 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:43,756 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:43,758 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:43,791 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:43,791 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:43,792 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:43,793 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:43,793 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:43,794 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:43,828 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:43,831 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:43,832 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:43,845 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:43,855 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:43,857 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:43,862 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:43.862382+07:00
2025-10-11 05:01:43,866 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:43.862382+07:00
2025-10-11 05:01:43,867 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:43.862382+07:00 trong DST: True
2025-10-11 05:01:43,867 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:43,868 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:43,868 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:43,868 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:43,869 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:43,869 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:43,870 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:43,870 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:43,870 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:43,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:43,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:43,904 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:43,905 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:43,907 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:43,908 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:43,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:43,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:43,934 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:43,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:43,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:43,937 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:43,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:43,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:43,967 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:43,968 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:43,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:43,969 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:43,971 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:43,974 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:43,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:43,975 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:43,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:43,978 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:43,978 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:43,979 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:43,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:43,980 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:43,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:43,981 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:43,982 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:43,982 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:43,982 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:43,983 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:43,983 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:43,984 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:43,984 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:43,985 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:43,986 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:43,986 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:44,018 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:44,019 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:44,022 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:44,023 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:44,024 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:44,024 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:44,025 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:44,025 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:44,026 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:44,026 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:44,027 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:44,027 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:44,028 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:44,029 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:44,030 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:44,031 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:44,032 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:44,033 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:44,033 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:44,033 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:44,033 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:44,037 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:44,037 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:44,038 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:44,038 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:44,038 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:44,088 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:44,157 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:44,209 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:44,226 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:44,277 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:44,281 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:44,283 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:44,284 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:44,289 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.34s
2025-10-11 05:01:44,426 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:44,427 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:44,428 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:44,429 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:44,431 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:44,974 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:44,975 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:44,976 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:44,978 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:44,979 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:44,980 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:44,980 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:44,981 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:45,016 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:45,019 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:45,020 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:45,021 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:45,021 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:45,023 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:45,023 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:45,024 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:45,083 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:45,526 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:45,527 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:45,528 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:45,528 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:45,529 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:45,529 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:45,530 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:45,530 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:45,532 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:45,532 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:45,533 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:45,533 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:45,543 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:45,569 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:45,570 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:45,571 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:45,574 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:45,575 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:45,576 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:45,576 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:45,580 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:45,580 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:45,581 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:45,582 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:45,591 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:45,612 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:45,613 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:45,613 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:45,613 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:45,614 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:45.614623+07:00
2025-10-11 05:01:45,615 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:45.614623+07:00
2025-10-11 05:01:45,615 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:45.614623+07:00 trong DST: True
2025-10-11 05:01:45,615 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:45,616 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:45,616 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:45,617 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:45,618 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:45,621 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:45,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:45,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:45,623 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:45,623 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:45,624 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:45,624 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:45,624 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:45,625 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:45,625 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:45,625 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:45,626 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:45,626 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:45,626 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:45,627 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:45,627 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:45,628 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:45,628 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:45,629 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:45,630 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:45,630 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:45,630 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:45,631 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:45,631 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:45,631 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:45,632 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:45,632 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:45,633 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:45,633 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:45,633 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:45,634 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:45,634 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:45,634 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:45,635 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:45,635 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:45,635 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:45,636 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:45,636 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:45,637 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:45,637 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:45,637 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:45.637764+07:00
2025-10-11 05:01:45,638 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:45.637764+07:00
2025-10-11 05:01:45,638 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:45.637764+07:00 trong DST: True
2025-10-11 05:01:45,638 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:45,639 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:45,640 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:45,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:45,641 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:45,642 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:45,642 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,651 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:45,654 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:45,657 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:45,660 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:45,666 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:45,670 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:45,675 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:45,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:45,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:45,677 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:45,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:45,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:45,679 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:45,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:45,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:45,681 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:45,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:45,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:45,682 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:45,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:45,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:45,684 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:45,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:45,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:45,686 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:45,686 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,687 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:45,687 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:45,687 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:45,688 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:45,688 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:45,688 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:45,689 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:45,689 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:45,689 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:45,690 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:45,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:45,690 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:45,691 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:45,691 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:45,691 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:45,692 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:45,692 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:45,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,693 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:45,693 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:45,694 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:45,694 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:45,694 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:45,695 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:45,696 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:45,697 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,698 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:45,698 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:45,698 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:45,701 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:45,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:45,702 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:45,703 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:45,704 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,705 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:45,705 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,706 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:45,706 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:45,712 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:45,713 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:45,717 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:45,719 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:45,736 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.76s
2025-10-11 05:01:45,783 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:45,798 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:45,799 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:45,801 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:45,805 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:45,978 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:45,979 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:45,980 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:45,982 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:45,983 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:45,984 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:45,985 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:45,985 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:46,020 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:46,126 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:46,127 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:46,141 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:46,180 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:46,182 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:46,184 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:46,187 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:46,188 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:46,691 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:46,693 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:46,693 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:46,694 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:46,694 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:46,694 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:46,695 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:46,695 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:46,697 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:46,697 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:46,698 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:46,698 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:46,709 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:46,731 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:46,732 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:46,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:46,735 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:46,736 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:46,736 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:46,737 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:46,740 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:46,741 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:46,741 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:46,742 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:46,744 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:46,745 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:46,745 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:46,746 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:46,746 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:46,747 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:46.747543+07:00
2025-10-11 05:01:46,747 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:46.747543+07:00
2025-10-11 05:01:46,748 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:46.747543+07:00 trong DST: True
2025-10-11 05:01:46,749 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:46,749 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:46,749 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:46,750 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:46,751 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:46,754 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:46,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:46,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:46,755 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:46,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:46,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:46,756 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:46,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:46,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:46,757 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:46,758 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:46,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:46,758 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:46,759 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:46,759 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:46,760 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:46,760 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:46,761 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:46,761 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:46,762 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:46,762 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:46,763 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:46,763 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:46,764 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:46,764 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:46,765 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:46,766 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:46,767 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:46,767 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:46,768 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:46,768 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:46,783 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:46,791 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:46,800 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:46,802 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:46,804 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:46,807 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:46,808 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:46,808 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:46,809 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:46,809 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:46.809449+07:00
2025-10-11 05:01:46,809 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:46.809449+07:00
2025-10-11 05:01:46,811 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:46.809449+07:00 trong DST: True
2025-10-11 05:01:46,811 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:46,812 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:46,812 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:46,812 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,813 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:46,813 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:46,814 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:46,814 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,814 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:46,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:46,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:46,816 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:46,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:46,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:46,818 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:46,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:46,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:46,819 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:46,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:46,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:46,821 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:46,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:46,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:46,822 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:46,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:46,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:46,824 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:46,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:46,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:46,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:46,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:46,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:46,828 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:46,829 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,829 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:46,830 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:46,845 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:46,852 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:46,861 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:46,866 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:46,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:46,867 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:46,868 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:46,868 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:46,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:46,869 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:46,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:46,870 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:46,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:46,870 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:46,871 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:46,871 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,871 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:46,872 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:46,872 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:46,873 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:46,873 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:46,874 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:46,875 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:46,876 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,877 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:46,877 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:46,878 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:46,881 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:46,881 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:46,882 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:46,882 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:46,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,883 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:46,883 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:46,884 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:46,884 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:46,884 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:46,885 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:46,885 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:46,887 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.91s
2025-10-11 05:01:46,975 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:46,987 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:46,988 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:46,989 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:46,992 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:46,994 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:46,994 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:46,996 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:46,997 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:46,998 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:47,000 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:47,000 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:47,001 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:47,059 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:47,060 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:47,060 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:47,061 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:47,061 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:47,062 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:47,062 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:47,063 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:47,128 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:47,564 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:47,565 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:47,566 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:47,566 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:47,567 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:47,567 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:47,568 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:47,568 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:47,570 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:47,571 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:47,571 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:47,572 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:47,583 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:47,606 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:47,606 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:47,607 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:47,609 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:47,609 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:47,610 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:47,610 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:47,613 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:47,613 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:47,614 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:47,614 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:47,617 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:47,618 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:47,618 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:47,624 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:47,646 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:47,647 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:47.647401+07:00
2025-10-11 05:01:47,649 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:47.647401+07:00
2025-10-11 05:01:47,650 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:47.647401+07:00 trong DST: True
2025-10-11 05:01:47,650 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:47,651 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:47,651 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:47,652 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:47,653 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:47,657 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:47,658 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:47,658 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:47,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:47,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:47,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:47,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:47,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:47,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:47,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:47,661 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:47,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:47,662 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:47,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:47,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:47,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:47,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:47,664 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:47,665 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:47,665 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:47,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:47,666 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:47,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:47,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:47,667 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:47,668 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:47,668 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:47,669 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:47,669 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:47,670 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:47,670 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:47,670 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:47,671 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:47,671 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:47,674 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:47,709 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:47,710 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:47,711 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:47,712 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:47,712 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:47,712 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:47.712775+07:00
2025-10-11 05:01:47,713 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:47.712775+07:00
2025-10-11 05:01:47,713 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:47.712775+07:00 trong DST: True
2025-10-11 05:01:47,713 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:47,714 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:47,714 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:47,714 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,715 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:47,716 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:47,716 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:47,716 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,717 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:47,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:47,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:47,719 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:47,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:47,721 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:47,721 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:47,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:47,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:47,723 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:47,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:47,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:47,724 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:47,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:47,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:47,726 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:47,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:47,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:47,728 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:47,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:47,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:47,729 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:47,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:47,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:47,731 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:47,731 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,732 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:47,732 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:47,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:47,733 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:47,733 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:47,734 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:47,734 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:47,734 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:47,735 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:47,736 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:47,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:47,737 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:47,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:47,737 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:47,774 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:47,775 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:47,775 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:47,776 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,776 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:47,777 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:47,777 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:47,778 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:47,778 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:47,779 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:47,780 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:47,782 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,782 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:47,782 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:47,783 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:47,783 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:47,787 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:47,787 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:47,788 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:47,788 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:47,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:47,790 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:47,791 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:47,791 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:47,791 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:47,792 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:47,793 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-11 05:01:47,832 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:47,835 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:47,836 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:47,838 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:47,840 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:48,000 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:48,001 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:48,002 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:48,004 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:48,005 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:48,007 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:48,007 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:48,008 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:48,015 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:48,016 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:48,024 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:48,044 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:48,046 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:48,058 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:48,127 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:48,185 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:48,195 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:48,698 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:48,699 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:48,700 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:48,700 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:48,701 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:48,701 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:48,701 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:48,702 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:48,704 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:48,704 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:48,704 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:48,705 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:48,714 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:48,739 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:48,739 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:48,740 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:48,743 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:48,743 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:48,744 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:48,745 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:48,747 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:48,747 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:48,747 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:48,748 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:48,751 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:48,751 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:48,752 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:48,753 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:48,753 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:48,753 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:48.753691+07:00
2025-10-11 05:01:48,754 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:48.753691+07:00
2025-10-11 05:01:48,754 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:48.753691+07:00 trong DST: True
2025-10-11 05:01:48,754 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:48,755 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:48,755 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:48,756 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:48,756 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:48,760 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:48,760 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:48,761 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:48,761 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:48,762 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:48,762 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:48,763 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:48,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:48,764 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:48,764 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:48,764 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:48,765 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:48,765 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:48,766 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:48,767 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:48,768 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:48,768 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:48,768 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:48,769 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:48,801 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:48,801 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:48,803 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:48,803 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:48,804 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:48,804 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:48,805 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:48,805 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:48,806 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:48,806 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:48,807 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:48,807 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:48,807 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:48,808 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:48,808 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:48,808 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:48,809 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:48,810 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:48,810 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:48,811 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:48,811 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:48,812 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:48.812450+07:00
2025-10-11 05:01:48,813 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:48.812450+07:00
2025-10-11 05:01:48,813 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:48.812450+07:00 trong DST: True
2025-10-11 05:01:48,813 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:48,814 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:48,814 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:48,814 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,815 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:48,815 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:48,816 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:48,816 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:48,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:48,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:48,818 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:48,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:48,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:48,819 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:48,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:48,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:48,821 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:48,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:48,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:48,822 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:48,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:48,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:48,824 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:48,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:48,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:48,825 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:48,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:48,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:48,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:48,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:48,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:48,830 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:48,830 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,830 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:48,866 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:48,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:48,868 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:48,869 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:48,869 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:48,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:48,870 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:48,871 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:48,872 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:48,872 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:48,872 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:48,873 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:48,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:48,874 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:48,874 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:48,874 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:48,875 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,875 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:48,875 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:48,876 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:48,876 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:48,877 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:48,878 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:48,879 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:48,880 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,881 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:48,881 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:48,881 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:48,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:48,885 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:48,885 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:48,886 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:48,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,887 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:48,887 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,887 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:48,888 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:48,888 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:48,889 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:48,889 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:48,890 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:48,892 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.89s
2025-10-11 05:01:48,985 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:48,986 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:48,987 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:48,988 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:48,991 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:49,056 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:49,057 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:49,058 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:49,060 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:49,061 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:49,063 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:49,063 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:49,064 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:49,067 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:49,067 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:49,068 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:49,068 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:49,069 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:49,070 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:49,070 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:49,070 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:49,125 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:49,571 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:49,573 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:49,574 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:49,574 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:49,574 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:49,575 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:49,575 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:49,576 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:49,578 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:49,578 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:49,578 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:49,579 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:49,588 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:49,612 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:49,612 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:49,613 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:49,615 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:49,616 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:49,616 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:49,617 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:49,619 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:49,620 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:49,621 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:49,621 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:49,624 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:49,624 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:49,625 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:49,625 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:49,626 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:49,626 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:49.626631+07:00
2025-10-11 05:01:49,627 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:49.626631+07:00
2025-10-11 05:01:49,627 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:49.626631+07:00 trong DST: True
2025-10-11 05:01:49,628 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:49,628 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:49,628 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:49,629 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:49,630 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:49,632 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:49,633 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:49,633 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:49,634 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:49,634 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:49,634 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:49,635 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:49,635 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:49,635 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:49,636 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:49,636 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:49,636 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:49,637 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:49,637 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:49,638 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:49,638 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:49,639 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:49,639 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:49,639 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:49,640 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:49,641 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:49,641 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:49,642 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:49,642 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:49,643 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:49,655 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:49,677 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:49,678 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:49,678 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:49,678 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:49,679 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:49,680 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:49,680 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:49,680 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:49,681 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:49,681 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:49,682 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:49,682 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:49,683 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:49,683 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:49,683 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:49.683937+07:00
2025-10-11 05:01:49,684 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:49.683937+07:00
2025-10-11 05:01:49,684 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:49.683937+07:00 trong DST: True
2025-10-11 05:01:49,685 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:49,685 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:49,686 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:49,687 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,688 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:49,689 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:49,689 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:49,689 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,690 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:49,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:49,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:49,691 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:49,691 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:49,692 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:49,692 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:49,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:49,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:49,694 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:49,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:49,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:49,695 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:49,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:49,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:49,697 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:49,697 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:49,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:49,698 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:49,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:49,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:49,700 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:49,700 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:49,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:49,701 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:49,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,702 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:49,702 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:49,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:49,703 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:49,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:49,705 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:49,706 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:49,706 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:49,742 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:49,742 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:49,743 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:49,743 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:49,744 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:49,744 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:49,746 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:49,746 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:49,746 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:49,747 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,748 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:49,748 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:49,749 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:49,749 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:49,749 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:49,750 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:49,752 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:49,753 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,754 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:49,754 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:49,754 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:49,757 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:49,757 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:49,758 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:49,758 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:49,760 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,760 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:49,761 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,761 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:49,761 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:49,762 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:49,762 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:49,762 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:49,763 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:49,764 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.71s
2025-10-11 05:01:49,801 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:49,802 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:49,803 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:49,804 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:49,808 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:50,061 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:50,062 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:50,063 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:50,065 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:50,066 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:50,067 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:50,067 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:50,068 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:50,108 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:50,110 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:50,111 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:50,159 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:50,165 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:50,227 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:50,299 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:50,348 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:50,403 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:50,909 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:50,911 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:50,911 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:50,912 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:50,912 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:50,913 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:50,913 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:50,914 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:50,916 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:50,916 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:50,917 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:50,917 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:50,920 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:50,921 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:50,921 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:50,923 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:50,931 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:50,957 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:50,957 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:50,958 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:50,961 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:50,961 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:50,962 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:50,962 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:50,966 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:50,967 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:50,967 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:50,968 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:50,968 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:50,968 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:50.968909+07:00
2025-10-11 05:01:50,969 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:50.968909+07:00
2025-10-11 05:01:50,969 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:50.968909+07:00 trong DST: True
2025-10-11 05:01:50,970 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:50,970 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:50,970 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:50,971 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:50,971 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:50,975 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:50,975 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:50,975 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:50,976 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:50,976 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:50,976 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:50,977 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:50,977 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:50,978 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:50,978 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:50,978 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:50,979 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:50,979 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:50,980 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:50,980 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:50,981 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:50,981 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:50,981 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:50,982 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:50,982 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:50,982 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:50,983 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:50,983 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:50,984 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:50,985 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:50,986 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:50,986 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:50,987 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:51,023 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:51,024 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:51,025 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:51,025 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:51,026 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:51,026 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:51,027 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:51,027 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:51,028 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:51,028 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:51,101 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:51,167 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:51,177 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:51,276 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:51,357 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:51,375 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:51.375732+07:00
2025-10-11 05:01:51,408 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:51,436 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:51.375732+07:00
2025-10-11 05:01:51,436 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:51,437 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:51.375732+07:00 trong DST: True
2025-10-11 05:01:51,438 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.26s
2025-10-11 05:01:51,438 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:51,441 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:51,442 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:51,445 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:51,446 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:51,446 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:51,447 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:51,448 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:51,449 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:51,449 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:51,450 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:51,450 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:51,451 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:51,452 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:51,453 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:51,454 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:51,455 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:51,456 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:51,456 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:51,457 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:51,458 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:51,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:51,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:51,460 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:51,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:51,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:51,462 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:51,463 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:51,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:51,465 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:51,466 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:51,467 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:51,467 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:51,468 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:51,589 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:51,590 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:51,673 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:51,683 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:51,718 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:51,782 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:51,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:51,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:51,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:51,786 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:51,799 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:51,846 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:51,855 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:51,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:51,857 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:51,862 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:51,901 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:51,904 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:51,906 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:51,908 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:51,910 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:51,921 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:51,962 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:51,977 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:51,980 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:51,983 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:52,019 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:52,020 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:52,021 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:52,031 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:52,034 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:52,036 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:52,036 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:52,040 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:52,040 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:52,042 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:52,043 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:52,045 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:52,047 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:52,091 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:52,092 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:52,093 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:52,094 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:52,097 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.03s
2025-10-11 05:01:52,178 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:52,179 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:52,180 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:52,182 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:52,183 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:52,185 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:52,185 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:52,186 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:52,192 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:52,193 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:52,194 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:52,195 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:52,197 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:52,201 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:52,340 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:52,340 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:52,341 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:52,342 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:52,342 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:52,343 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:52,344 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:52,344 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:52,845 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:52,847 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:52,848 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:52,848 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:52,849 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:52,849 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:52,850 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:52,850 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:52,853 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:52,853 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:52,854 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:52,854 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:52,864 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:52,883 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:52,884 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:52,885 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:52,888 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:52,890 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:52,890 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:52,891 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:52,893 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:52,895 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:52,896 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:52,896 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:52,926 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:52,928 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:52,929 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:52,929 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:52,930 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:52,930 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:52.930575+07:00
2025-10-11 05:01:52,930 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:52.930575+07:00
2025-10-11 05:01:52,931 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:52.930575+07:00 trong DST: True
2025-10-11 05:01:52,931 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:52,931 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:52,932 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:52,933 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:52,933 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:52,936 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:52,937 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:52,937 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:52,938 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:52,938 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:52,938 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:52,939 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:52,939 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:52,939 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:52,940 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:52,940 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:52,940 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:52,941 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:52,941 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:52,941 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:52,942 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:52,942 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:52,943 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:52,943 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:52,944 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:52,944 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:52,945 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:52,945 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:52,945 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:52,946 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:52,946 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:52,946 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:52,947 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:52,947 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:52,948 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:52,948 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:52,948 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:52,949 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:52,949 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:52,950 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:52,950 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:52,951 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:52,951 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:52,952 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:52,952 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:52,952 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:52.952703+07:00
2025-10-11 05:01:52,953 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:52.952703+07:00
2025-10-11 05:01:52,953 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:52.952703+07:00 trong DST: True
2025-10-11 05:01:52,954 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:52,954 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:52,955 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:52,955 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:52,963 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:52,969 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:52,986 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:52,987 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:52,988 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:52,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:52,989 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:52,989 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:52,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:52,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:52,991 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:52,991 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:52,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:52,992 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:52,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:52,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:52,994 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:52,994 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:52,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:52,995 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:52,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:52,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:52,997 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:52,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:52,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:52,998 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:52,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:52,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:53,000 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:53,000 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,001 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,001 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:53,001 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:53,002 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:53,002 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:53,002 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:53,003 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:53,003 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:53,003 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:53,004 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:53,004 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:53,004 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:53,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:53,005 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:53,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:53,006 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:53,006 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:53,006 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,007 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,007 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:53,007 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:53,008 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:53,008 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:53,009 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:53,010 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:53,012 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,012 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:53,013 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:53,013 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:53,013 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:53,016 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:53,017 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:53,018 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:53,019 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,025 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,027 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,030 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,037 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,040 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:53,042 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:53,043 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:53,051 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:53,053 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-11 05:01:53,153 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:53,154 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:53,155 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:53,156 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:53,160 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:53,264 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:53,265 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:53,268 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:53,270 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:53,271 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:53,273 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:53,274 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:53,275 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:53,294 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:53,309 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:53,310 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:53,312 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:53,313 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:53,313 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:53,314 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:53,316 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:53,371 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:53,817 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:53,819 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:53,820 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:53,820 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:53,821 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:53,821 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:53,822 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:53,822 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:53,825 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:53,825 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:53,826 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:53,826 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:53,837 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:53,857 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:53,858 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:53,859 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:53,863 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:53,863 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:53,864 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:53,865 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:53,867 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:53,868 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:53,868 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:53,868 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:53,871 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:53,871 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:53,872 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:53,872 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:53,872 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:53,873 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:53.873176+07:00
2025-10-11 05:01:53,873 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:53.873176+07:00
2025-10-11 05:01:53,874 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:53.873176+07:00 trong DST: True
2025-10-11 05:01:53,874 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:53,875 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:53,875 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:53,876 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:53,877 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:53,879 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:53,880 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:53,880 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:53,881 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:53,881 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:53,881 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:53,882 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:53,882 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:53,882 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:53,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:53,883 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:53,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:53,884 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:53,884 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:53,885 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:53,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:53,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:53,887 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:53,887 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:53,888 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:53,888 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:53,889 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:53,889 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:53,890 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:53,890 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:53,891 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:53,893 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:53,893 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:53,894 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:53,899 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:53,930 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:53,931 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:53,931 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:53,932 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:53,933 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:53,933 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:53,934 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:53,934 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:53,934 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:53,935 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:53,935 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:53.935736+07:00
2025-10-11 05:01:53,936 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:53.935736+07:00
2025-10-11 05:01:53,936 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:53.935736+07:00 trong DST: True
2025-10-11 05:01:53,937 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:53,937 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:53,938 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:53,938 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,938 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,939 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:53,939 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:53,940 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,940 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:53,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:53,942 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:53,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:53,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:53,943 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:53,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:53,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:53,945 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:53,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:53,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:53,946 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:53,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:53,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:53,948 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:53,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:53,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:53,949 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:53,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:53,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:53,951 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:53,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:53,952 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:53,952 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:53,954 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,954 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,954 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:53,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:53,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:53,956 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:53,992 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:53,992 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:53,993 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:53,993 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:53,994 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:53,995 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:53,995 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:53,996 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:53,996 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:53,997 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:53,997 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:53,997 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:53,998 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:53,998 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:53,999 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:53,999 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:53,999 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:54,000 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:54,001 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:54,002 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:54,003 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,004 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:54,004 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:54,004 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:54,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:54,007 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:54,008 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:54,008 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:54,009 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,009 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:54,010 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,010 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,010 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:54,010 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:54,011 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:54,011 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:54,012 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:54,013 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.75s
2025-10-11 05:01:54,050 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:54,052 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:54,052 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:54,054 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:54,056 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:54,271 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:54,271 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:54,273 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:54,275 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:54,275 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:54,277 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:54,277 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:54,278 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:54,315 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:54,316 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:54,317 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:54,317 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:54,319 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:54,320 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:54,320 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:54,321 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:54,363 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:54,822 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:54,824 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:54,824 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:54,825 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:54,825 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:54,825 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:54,826 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:54,826 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:54,828 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:54,829 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:54,829 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:54,830 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:54,838 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:54,863 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:54,863 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:54,864 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:54,867 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:54,867 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:54,867 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:54,868 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:54,870 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:54,870 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:54,871 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:54,871 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:54,874 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:54,875 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:54,875 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:54,876 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:54,876 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:54,876 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:54.876840+07:00
2025-10-11 05:01:54,877 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:54.876840+07:00
2025-10-11 05:01:54,877 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:54.876840+07:00 trong DST: True
2025-10-11 05:01:54,878 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:54,878 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:54,878 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:54,880 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:54,880 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:54,883 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:54,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:54,884 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:54,884 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:54,885 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:54,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:54,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:54,886 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:54,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:54,887 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:54,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:54,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:54,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:54,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:54,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:54,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:54,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:54,890 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:54,890 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:54,891 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:54,892 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:54,893 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:54,925 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:54,926 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:54,926 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:54,927 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:54,928 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:54,928 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:54,929 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:54,929 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:54,930 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:54,930 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:54,931 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:54,931 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:54,931 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:54,932 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:54,932 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:54,933 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:54,933 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:54,934 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:54,934 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:54.934496+07:00
2025-10-11 05:01:54,934 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:54.934496+07:00
2025-10-11 05:01:54,935 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:54.934496+07:00 trong DST: True
2025-10-11 05:01:54,935 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:54,936 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:54,937 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:54,937 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,937 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:54,938 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:54,938 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:54,938 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,939 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:54,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:54,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:54,940 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:54,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:54,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:54,942 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:54,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:54,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:54,943 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:54,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:54,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:54,945 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:54,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:54,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:54,947 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:54,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:54,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:54,948 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:54,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:54,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:54,949 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:54,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:54,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:54,951 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:54,951 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,952 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:54,952 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:54,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:54,954 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:54,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:54,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:54,956 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:54,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:54,956 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:54,992 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:54,993 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:54,994 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:54,995 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:54,997 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:54,997 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:54,998 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:54,998 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:54,999 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:54,999 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:55,000 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:55,000 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:55,000 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:55,001 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:55,001 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:55,002 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:55,004 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:55,004 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:55,005 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:55,008 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:55,008 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:55,009 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:55,009 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:55,010 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:55,010 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:55,010 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:55,011 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:55,011 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:55,012 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:55,012 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:55,012 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:55,013 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:55,013 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:55,014 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.74s
2025-10-11 05:01:55,117 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:55,124 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:55,125 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:55,126 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:55,129 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:55,275 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:55,276 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:55,278 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:55,279 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:55,280 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:55,281 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:55,282 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:55,283 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:55,293 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:55,294 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:55,294 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:55,295 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:55,295 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:55,296 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:55,297 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:55,298 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:55,338 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:55,799 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:55,801 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:55,801 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:55,802 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:55,802 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:55,803 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:55,803 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:55,804 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:55,805 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:55,806 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:55,806 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:55,807 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:55,816 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:55,839 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:55,839 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:55,840 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:55,844 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:55,844 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:55,845 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:55,846 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:55,848 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:55,849 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:55,849 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:55,850 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:55,852 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:55,853 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:55,853 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:55,854 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:55,854 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:55,854 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:55.854724+07:00
2025-10-11 05:01:55,855 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:55.854724+07:00
2025-10-11 05:01:55,855 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:55.854724+07:00 trong DST: True
2025-10-11 05:01:55,856 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:55,856 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:55,857 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:55,858 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:55,858 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:55,868 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:55,897 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:55,897 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:55,898 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:55,900 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:55,900 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:55,901 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:55,901 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:55,901 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:55,902 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:55,902 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:55,903 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:55,903 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:55,903 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:55,904 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:55,904 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:55,904 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:55,905 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:55,905 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:55,906 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:55,907 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:55,908 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:55,908 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:55,908 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:55,909 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:55,909 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:55,910 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:55,910 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:55,910 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:55,911 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:55,911 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:55,911 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:55,912 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:55,912 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:55,913 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:55,914 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:55,914 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:55,915 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:55,915 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:55,915 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:55,916 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:55.916054+07:00
2025-10-11 05:01:55,916 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:55.916054+07:00
2025-10-11 05:01:55,916 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:55.916054+07:00 trong DST: True
2025-10-11 05:01:55,917 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:55,917 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:55,918 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:55,918 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:55,918 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:55,919 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:55,919 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:55,919 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:55,920 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:55,920 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:55,921 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:55,921 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:55,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:55,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:55,923 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:55,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:55,925 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:55,925 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:55,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:55,956 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:55,958 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:55,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:55,959 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:56,037 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:56,123 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:56,126 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:56,126 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:56,127 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:56,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:56,133 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:56,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:56,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:56,135 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:56,135 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,136 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,136 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:56,137 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:56,138 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:56,138 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:56,138 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:56,139 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:56,139 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:56,140 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:56,140 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:56,140 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:56,184 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:56,185 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:56,186 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:56,188 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:56,189 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:56,190 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:56,190 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,191 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,192 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:56,192 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:56,193 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:56,194 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:56,195 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:56,197 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:56,198 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,199 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:56,199 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:56,199 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:56,203 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:56,204 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:56,205 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:56,206 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:56,206 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,239 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,241 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,242 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,243 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,244 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:56,244 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:56,244 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:56,245 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:56,246 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.97s
2025-10-11 05:01:56,301 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:56,302 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:56,304 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:56,306 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:56,307 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:56,308 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:56,309 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:56,310 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:56,317 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:56,318 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:56,318 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:56,319 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:56,319 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:56,320 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:56,321 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:56,321 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:56,343 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:56,372 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:56,373 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:56,374 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:56,378 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:56,380 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:56,823 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:56,824 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:56,825 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:56,825 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:56,826 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:56,826 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:56,826 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:56,827 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:56,829 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:56,829 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:56,830 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:56,830 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:56,839 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:56,861 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:56,862 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:56,863 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:56,865 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:56,866 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:56,866 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:56,867 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:56,869 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:56,870 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:56,870 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:56,871 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:56,873 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:56,874 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:56,874 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:56,875 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:56,875 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:56,875 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:56.875655+07:00
2025-10-11 05:01:56,876 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:56.875655+07:00
2025-10-11 05:01:56,876 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:56.875655+07:00 trong DST: True
2025-10-11 05:01:56,877 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:56,877 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:56,877 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:56,878 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:56,879 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:56,882 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:56,882 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:56,883 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:56,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:56,883 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:56,884 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:56,884 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:56,884 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:56,885 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:56,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:56,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:56,886 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:56,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:56,887 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:56,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:56,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:56,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:56,889 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:56,889 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:56,889 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:56,890 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:56,891 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:56,891 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:56,892 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:56,893 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:56,893 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:56,894 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:56,928 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:56,929 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:56,929 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:56,930 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:56,930 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:56,931 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:56,931 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:56,932 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:56,933 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:56,934 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:56,935 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:56,935 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:56,936 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:56,936 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:56.936441+07:00
2025-10-11 05:01:56,936 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:56.936441+07:00
2025-10-11 05:01:56,937 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:56.936441+07:00 trong DST: True
2025-10-11 05:01:56,937 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:56,938 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:56,938 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:56,939 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,939 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,939 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:56,940 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:56,940 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,941 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:56,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:56,942 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:56,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:56,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:56,944 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:56,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:56,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:56,946 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:56,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:56,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:56,947 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:56,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:56,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:56,949 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:56,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:56,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:56,951 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:56,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:56,952 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:56,953 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:56,954 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:56,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:56,956 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:56,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:56,957 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:56,995 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:56,996 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:56,996 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:56,997 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:56,998 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:56,999 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:57,000 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:57,001 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:57,001 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:57,002 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:57,002 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:57,003 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:57,003 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:57,004 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:57,005 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:57,005 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:57,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,006 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,006 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:57,007 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:57,007 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:57,008 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:57,008 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:57,009 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:57,010 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,011 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:57,011 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:57,012 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:57,013 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:57,016 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:57,016 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:57,017 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:57,019 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,052 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,054 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,054 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,054 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,055 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:57,056 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:57,057 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:57,057 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:57,059 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.76s
2025-10-11 05:01:57,152 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:57,154 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:57,154 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:57,156 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:57,160 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:57,300 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:57,301 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-11 05:01:57,303 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-11 05:01:57,306 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:57,307 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:57,309 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:57,311 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:57,312 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:57,313 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:57,313 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:57,314 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:01:57,319 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:57,320 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:57,321 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:57,321 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:57,322 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:57,323 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:57,323 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:57,323 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:57,369 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-11 05:01:57,370 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:57,824 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:57,826 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:57,827 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:57,827 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:57,827 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:57,828 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:57,828 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:57,829 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:57,831 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:57,831 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:57,831 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:57,832 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:57,840 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:57,863 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:57,864 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:57,865 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:57,868 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:57,868 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:57,869 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:57,869 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:57,872 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:57,873 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:57,873 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:57,874 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:57,877 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:57,877 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:57,878 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:57,878 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:57,879 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:57,879 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:57.879532+07:00
2025-10-11 05:01:57,879 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:57.879532+07:00
2025-10-11 05:01:57,880 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:57.879532+07:00 trong DST: True
2025-10-11 05:01:57,880 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:57,880 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:57,881 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:57,882 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:57,883 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:57,886 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:57,886 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:57,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:57,887 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:57,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:57,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:57,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:57,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:57,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:57,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:57,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:57,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:57,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:57,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:57,893 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:57,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:57,894 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:57,922 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:57,923 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:57,924 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:57,924 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:57,925 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:57,925 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:57,926 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:57,926 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:57,927 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:57,927 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:57,927 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:57,928 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:57,928 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:57,928 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:57,929 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:57,929 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:57,929 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:57,930 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:57,930 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:57,931 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:57,932 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:57,932 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:57,932 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:57,933 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:57.933193+07:00
2025-10-11 05:01:57,933 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:57.933193+07:00
2025-10-11 05:01:57,933 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:57.933193+07:00 trong DST: True
2025-10-11 05:01:57,934 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:57,934 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:57,934 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:57,935 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,935 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,935 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:57,936 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:57,936 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,936 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:57,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:57,938 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:57,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:57,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:57,940 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:57,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:57,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:57,941 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:57,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:57,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:57,942 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:57,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:57,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:57,944 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:57,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:57,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:57,946 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:57,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:57,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:57,947 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:57,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:57,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:57,949 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:57,949 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,950 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,950 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:57,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:57,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:57,951 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:57,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:57,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:57,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:57,952 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:57,954 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:57,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:57,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:57,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:57,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:57,956 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:57,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:57,990 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:57,990 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,991 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:57,991 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:57,992 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:57,992 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:57,994 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:57,994 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:57,996 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:57,997 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:57,998 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:57,998 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:57,999 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:58,003 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:58,004 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:58,004 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:58,004 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:58,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:58,005 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:58,006 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:58,006 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:58,007 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:58,007 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:58,007 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:58,008 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:58,008 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:58,009 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.70s
2025-10-11 05:01:58,045 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:58,053 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:58,053 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:58,054 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:58,057 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:58,312 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:58,312 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:58,314 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:01:58,316 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:58,317 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:58,319 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:58,320 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:58,320 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-11 05:01:58,357 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:58,358 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:58,358 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:58,359 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:01:58,360 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:01:58,360 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:01:58,361 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:01:58,361 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:01:58,365 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:58,862 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:01:58,864 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:01:58,864 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:01:58,865 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:01:58,865 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:01:58,866 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:01:58,866 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:01:58,867 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:58,869 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:01:58,870 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:58,870 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:01:58,870 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:01:58,879 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:01:58,902 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:58,904 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:01:58,906 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:01:58,909 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:01:58,910 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:58,910 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:01:58,911 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:01:58,913 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:01:58,914 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:58,914 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:01:58,915 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:01:58,918 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:58,918 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:01:58,919 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:01:58,919 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:01:58,919 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:58,920 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:58.920532+07:00
2025-10-11 05:01:58,921 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:58.920532+07:00
2025-10-11 05:01:58,922 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:58.920532+07:00 trong DST: True
2025-10-11 05:01:58,924 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:58,925 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:58,983 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:01:59,044 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:01:59,046 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:01:59,108 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:01:59,109 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:59,110 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:01:59,153 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:59,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:01:59,157 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:01:59,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:01:59,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:01:59,160 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:01:59,161 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:01:59,163 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:01:59,163 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:01:59,165 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:01:59,165 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:01:59,166 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:01:59,166 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:01:59,167 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:01:59,168 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:01:59,169 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:01:59,170 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:01:59,170 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:59,171 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:01:59,228 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:01:59,231 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:01:59,231 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:01:59,232 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:01:59,233 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:01:59,236 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:01:59,272 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:01:59,275 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:01:59,276 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:01:59,277 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:01:59,278 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:01:59,279 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:01:59,280 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:59,281 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:01:59,282 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:01:59,282 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:01:59,283 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:01:59,283 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:01:59,284 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:01:59.284219+07:00
2025-10-11 05:01:59,284 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:01:59.284219+07:00
2025-10-11 05:01:59,285 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:01:59.284219+07:00 trong DST: True
2025-10-11 05:01:59,285 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:01:59,285 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:01:59,286 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 59
2025-10-11 05:01:59,286 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,286 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:59,287 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:01:59,287 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:01:59,287 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,288 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:59,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:59,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:59,290 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:59,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:59,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:59,292 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:01:59,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:01:59,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:01:59,293 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:59,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:01:59,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:59,295 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:01:59,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:01:59,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:01:59,297 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:01:59,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:01:59,346 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:59,347 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:01:59,347 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:01:59,348 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:01:59,349 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:01:59,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:01:59,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:01:59,352 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:01:59,352 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:01:59,354 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:01:59,354 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,355 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:01:59,355 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:59,357 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:01:59,357 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:59,358 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:01:59,411 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-11 05:01:59,418 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:59,419 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:59,422 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:59,422 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:59,482 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:59,484 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:59,490 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:59,491 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:01:59,491 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:01:59,492 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:01:59,541 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:59,543 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:01:59,692 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:01:59,713 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:01:59,714 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:01:59,714 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:01:59,715 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,715 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:59,716 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:01:59,717 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:01:59,717 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:01:59,718 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:01:59,719 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:59,720 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:01:59,721 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,723 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:01:59,723 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:01:59,724 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:01:59,747 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:01:59,785 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:01:59,788 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:01:59,789 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:01:59,791 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:59,795 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,796 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:01:59,797 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:01:59,839 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:01:59,850 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:01:59,852 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:01:59,854 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:01:59,856 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.54s
2025-10-11 05:01:59,966 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:01:59,967 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:01:59,968 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:01:59,969 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:01:59,971 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:02:00,355 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:02:00,356 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:02:00,357 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:02:00,359 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:02:00,359 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:02:00,361 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:02:00,361 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:00,362 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:02:00,394 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:02:00,396 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:02:00,396 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:02:00,397 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:02:00,409 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:02:00,416 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:02:00,431 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:02:00,486 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:02:00,539 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:02:01,047 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:02:01,048 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:02:01,049 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:02:01,049 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:02:01,050 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:02:01,050 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:02:01,051 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:02:01,051 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:02:01,053 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:02:01,053 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:01,054 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:02:01,054 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:02:01,060 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:02:01,085 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:01,086 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:02:01,087 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:02:01,091 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:02:01,091 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:01,092 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:02:01,093 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:02:01,101 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:02:01,101 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:01,101 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:02:01,102 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:02:01,105 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:02:01,106 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:02:01,106 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:02:01,107 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:02:01,107 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:02:01,108 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:02:01.108147+07:00
2025-10-11 05:02:01,108 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:02:01.108147+07:00
2025-10-11 05:02:01,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:02:01.108147+07:00 trong DST: True
2025-10-11 05:02:01,109 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:02:01,109 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:02:01,109 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:02:01,111 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:02:01,113 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:02:01,122 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:02:01,151 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:02:01,154 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:02:01,154 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:02:01,155 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:02:01,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:02:01,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:02:01,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:02:01,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:02:01,157 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:02:01,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:02:01,158 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:02:01,158 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:02:01,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:02:01,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:02:01,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:02:01,160 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:02:01,161 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:02:01,162 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:02:01,162 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:02:01,163 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:02:01,163 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:02:01,164 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:02:01,164 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:02:01,165 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:02:01,165 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:02:01,166 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:02:01,167 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:02:01,168 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:02:01,168 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:02:01,168 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:02:01,169 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:02:01,169 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:02:01,169 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:02:01,170 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:02:01,170 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:02:01,171 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-11 05:02:01,171 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-11 05:02:01,172 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:02:01,173 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:02:01,173 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:02:01.173854+07:00
2025-10-11 05:02:01,174 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:02:01.173854+07:00
2025-10-11 05:02:01,174 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:02:01.173854+07:00 trong DST: True
2025-10-11 05:02:01,175 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:02:01,209 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:02:01,210 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 58
2025-10-11 05:02:01,212 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,212 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:01,213 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:02:01,243 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:02:01,244 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,245 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:01,279 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:02:01,281 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:02:01,282 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:02:01,283 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:02:01,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:01,315 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:02:01,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:02:01,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:02:01,386 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:02:01,423 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:02:01,438 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:02:01,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:02:01,460 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:02:01,463 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:02:01,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:01,465 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:01,465 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:02:01,466 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-11 05:02:01,467 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:02:01,468 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:02:01,469 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:02:01,469 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:02:01,471 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:01,471 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:02:01,471 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:02:01,472 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:02:01,473 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:02:01,473 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:02:01,474 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:01,475 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:02:01,475 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,476 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:01,476 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:02:01,477 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:02:01,477 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:02:01,478 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:02:01,478 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:02:01,478 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:02:01,479 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:02:01,479 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:02:01,480 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:02:01,480 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:02:01,481 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:02:01,481 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:02:01,481 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:02:01,482 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:02:01,482 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:02:01,482 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:02:01,483 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,483 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:01,483 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:02:01,484 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:02:01,484 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:02:01,484 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:02:01,486 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:02:01,487 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:02:01,494 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:02:01,494 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:02:01,495 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,529 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-11 05:02:01,530 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:02:01,531 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:02:01,532 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:02:01,533 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:02:01,533 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,533 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:02:01,534 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:01,549 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,650 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:01,687 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:01,687 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:02:01,688 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:02:01,688 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:02:01,689 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:02:01,702 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.35s
2025-10-11 05:02:01,890 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:02:01,908 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:02:01,908 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-11 05:02:01,915 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-11 05:02:01,932 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:02:02,425 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:02:02,426 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-11 05:02:02,427 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-11 05:02:02,429 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-11 05:02:02,429 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:02:02,431 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-11 05:02:02,431 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:02,432 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-11 05:02:02,455 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-11 05:02:02,670 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:02:02,671 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:02:02,671 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:02:02,672 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-11 05:02:02,672 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-11 05:02:02,673 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-11 05:02:02,673 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-11 05:02:02,674 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-11 05:02:03,167 - APP.ui.app_ui - INFO - Bắt đầu quy trình tắt ứng dụng an toàn.
2025-10-11 05:02:03,175 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-11 05:02:03,177 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-11 05:02:03,207 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-11 05:02:03,210 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-11 05:02:03,212 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-11 05:02:03,213 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-11 05:02:03,214 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-11 05:02:03,215 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-11 05:02:03,220 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-11 05:02:03,221 - APP.ui.controllers.chart_controller - INFO - Dừng ChartController stream hiện tại.
2025-10-11 05:02:03,222 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:03,223 - APP.utils.threading_utils - INFO - Cancel group 'chart.refresh' → task 'chart.info'
2025-10-11 05:02:03,224 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-11 05:02:03,224 - APP.ui.components.chart_tab - INFO - ChartTab đã dừng làm mới dữ liệu.
2025-10-11 05:02:03,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-11 05:02:03,228 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-11 05:02:03,230 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:03,230 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-11 05:02:03,231 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-11 05:02:03,233 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-11 05:02:03,234 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:03,234 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-11 05:02:03,273 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-11 05:02:03,280 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-11 05:02:03,280 - APP.ui.app_ui - DEBUG - Bắt đầu thu thập dữ liệu cấu hình từ UI.
2025-10-11 05:02:03,280 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-11 05:02:03,281 - APP.configs.workspace_config - DEBUG - Bắt đầu lưu cấu hình vào file.
2025-10-11 05:02:03,282 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-11 05:02:03,282 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-11 05:02:03,283 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-11 05:02:03,283 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-11 05:02:03,286 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:02:03,287 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-11 05:02:03,287 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-11 05:02:03,288 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-11 05:02:03,288 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-11 05:02:03,289 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-11 05:02:03,289 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-11 05:02:03,289 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'token' trong nhóm 'telegram'.
2025-10-11 05:02:03,290 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:02:03,290 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-11 05:02:03,291 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:02:03.290950+07:00
2025-10-11 05:02:03,291 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-11 05:02:03,291 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:02:03.290950+07:00
2025-10-11 05:02:03,292 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-11 05:02:03,292 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:02:03.290950+07:00 trong DST: True
2025-10-11 05:02:03,293 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-11 05:02:03,293 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:02:03,293 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-11 05:02:03,294 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:02:03,294 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'te'.
2025-10-11 05:02:03,294 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-11 05:02:03,295 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-11 05:02:03,296 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-11 05:02:03,296 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-11 05:02:03,296 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-11 05:02:03,297 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-11 05:02:03,305 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-11 05:02:03,308 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-11 05:02:03,314 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:02:03,316 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-11 05:02:03,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-11 05:02:03,324 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'fmp'.
2025-10-11 05:02:03,326 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:02:03,333 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-11 05:02:03,334 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-11 05:02:03,335 - APP.configs.workspace_config - INFO - Cấu hình đã được lưu thành công vào C:\Users\leanhchi\.gemini_folder_analyze\workspace.json
2025-10-11 05:02:03,336 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-11 05:02:03,336 - APP.configs.workspace_config - DEBUG - Kết thúc lưu cấu hình vào file.
2025-10-11 05:02:03,337 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-11 05:02:03,337 - APP.ui.app_ui - INFO - Đã lưu cấu hình workspace thành công.
2025-10-11 05:02:03,337 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-11 05:02:03,338 - APP.services.mt5_service - INFO - Đang ngắt kết nối khỏi MetaTrader 5.
2025-10-11 05:02:03,338 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-11 05:02:03,339 - APP.services.mt5_service - INFO - Đã ngắt kết nối MT5 thành công.
2025-10-11 05:02:03,340 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-11 05:02:03,340 - APP.ui.app_ui - INFO - UI queue backlog khi shutdown: 0
2025-10-11 05:02:03,341 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-11 05:02:03,342 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-11 05:02:03,342 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-11 05:02:03,343 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-11 05:02:03,343 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-11 05:02:03,344 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-11 05:02:03,344 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-11 05:02:03,345 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-11 05:02:03,346 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-11 05:02:03,346 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:02:03,347 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-11 05:02:03,347 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-11 05:02:03,348 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-11 05:02:03,348 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-11 05:02:03,349 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-11 05:02:03,349 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-11 05:02:03,349 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-11 05:02:03,350 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-11 05:02:03,350 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-11 05:02:03,350 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-11 05:02:03,350 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-11 05:02:03,351 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-11 05:02:03,351 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-11 05:02:03,352 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:02:03,352 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-11 05:02:03,353 - APP.services.mt5_service - WARNING - Không đủ dữ liệu D1 để tính adr_stats cho XAUUSD.
2025-10-11 05:02:03,353 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-11 05:02:03,353 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-11 05:02:03,354 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-11 12:02:03.354326+07:00
2025-10-11 05:02:03,354 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 12:02:03.354326+07:00
2025-10-11 05:02:03,355 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 12:02:03.354326+07:00 trong DST: True
2025-10-11 05:02:03,355 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-11 05:02:03,356 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-11 05:02:03,356 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 58
2025-10-11 05:02:03,357 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,357 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:03,359 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-11 05:02:03,360 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-11 05:02:03,363 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,370 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:03,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:02:03,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:02:03,395 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:02:03,396 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:02:03,397 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:03,398 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-11 05:02:03,398 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-11 05:02:03,399 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-11 05:02:03,399 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:02:03,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-11 05:02:03,400 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:03,401 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-11 05:02:03,401 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-11 05:02:03,402 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-11 05:02:03,403 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-11 05:02:03,403 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-11 05:02:03,404 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:03,404 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-11 05:02:03,404 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-11 05:02:03,405 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-11 05:02:03,406 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-11 05:02:03,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-11 05:02:03,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-11 05:02:03,408 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-11 05:02:03,408 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,408 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:03,409 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:02:03,409 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:02:03,409 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:02:03,410 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:02:03,410 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:02:03,410 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:02:03,411 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:02:03,411 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:02:03,412 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-11 05:02:03,412 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-11 05:02:03,412 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-11 05:02:03,413 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-11 05:02:03,413 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-11 05:02:03,413 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-11 05:02:03,414 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-11 05:02:03,414 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-11 05:02:03,414 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,414 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:03,415 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-11 05:02:03,415 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-11 05:02:03,416 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-11 05:02:03,416 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-11 05:02:03,417 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-11 05:02:03,418 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-11 05:02:03,419 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,420 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-11 05:02:03,421 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-11 05:02:03,421 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-11 05:02:03,421 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-11 05:02:03,422 - APP.services.mt5_service - WARNING - MT5 chưa kết nối, không thể lấy lịch sử deals.
2025-10-11 05:02:03,422 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-11 05:02:03,423 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,424 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-11 05:02:03,424 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:03,424 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,425 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-11 05:02:03,432 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-11 05:02:03,437 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-11 05:02:03,440 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-11 05:02:03,442 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-11 05:02:03,455 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-11 05:02:03,458 - APP.utils.threading_utils - INFO - Task 'chart.info' (group=chart.refresh) bị hủy sau 1.03s
2025-10-11 05:02:03,459 - APP.ui.controllers.chart_controller - DEBUG - Future chart.info bị cancel, không cập nhật UI.
2025-10-11 05:02:03,459 - APP.utils.threading_utils - INFO - ThreadingManager.shutdown(wait=True, timeout=5.0, force=False)
2025-10-11 05:02:04,433 - APP.ui.app_ui - INFO - Ứng dụng đã đóng thành công.
2025-10-11 05:02:04,433 - __main__ - INFO - Ứng dụng đã đóng thành công.
