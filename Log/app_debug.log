2025-10-12 11:01:38,612 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:38,621 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:38,622 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:38,684 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:38,686 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:38,687 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:38,689 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-12 11:01:38,690 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:38,691 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-12 11:01:38,691 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:38,691 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-12 11:01:38,692 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:01:38,693 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-12 11:01:38,693 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:38,695 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251012-110138' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110138', 'priority': 'autorun'})
2025-10-12 11:01:38,695 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-12 11:01:38,696 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-12 11:01:38,697 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:01:38,753 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251012-110138 (priority=autorun)
2025-10-12 11:01:38,754 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-12 11:01:38,756 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-12 11:01:38,903 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:01:38,905 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.61s
2025-10-12 11:01:38,907 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-12 11:01:38,908 - APP.ui.app_ui - INFO - Autorun autorun-20251012-110138 bắt đầu ngay lập tức.
2025-10-12 11:01:38,908 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-12 11:01:38,910 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:39,152 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:39,153 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-12 11:01:39,155 - APP.ui.app_ui - INFO - Phiên autorun-20251012-110138 bắt đầu (priority=autorun, source=autorun).
2025-10-12 11:01:39,155 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:39,156 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:39,157 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:01:39,158 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:01:39,162 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:39,164 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-12 11:01:39,167 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-12 11:01:39,168 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-12 11:01:39,171 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (TaskGroup analysis.upload).
2025-10-12 11:01:39,188 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-12 11:01:39,216 - APP.core.trading.conditions - DEBUG - Điều kiện NO-RUN được thỏa mãn. Lý do: Các điều kiện cho phép.
2025-10-12 11:01:39,245 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-12 11:01:39,261 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-12 11:01:39,350 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.59s
2025-10-12 11:01:39,465 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-12 11:01:39,475 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110138.0' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110138', 'index': 0})
2025-10-12 11:01:39,560 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110138.1' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110138', 'index': 1})
2025-10-12 11:01:39,568 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 16736:1760266841:0672e05dcd1c284d
2025-10-12 11:01:39,587 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110138.2' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110138', 'index': 2})
2025-10-12 11:01:39,588 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11924:1760266825:8fd56fde81c82966
2025-10-12 11:01:39,638 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png, nhưng chữ ký không khớp.
2025-10-12 11:01:39,638 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110138.3' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110138', 'index': 3})
2025-10-12 11:01:39,640 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 16567:1760266835:734f880feb046a76
2025-10-12 11:01:39,640 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png, nhưng chữ ký không khớp.
2025-10-12 11:01:39,641 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_H1.png, Tối ưu hóa: False
2025-10-12 11:01:39,642 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png, nhưng chữ ký không khớp.
2025-10-12 11:01:39,646 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 12112:1760266830:9c602a62c841301a
2025-10-12 11:01:39,650 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M1.png, Tối ưu hóa: False
2025-10-12 11:01:39,651 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:01:39,652 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M15.png, Tối ưu hóa: False
2025-10-12 11:01:39,653 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png, nhưng chữ ký không khớp.
2025-10-12 11:01:39,653 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:01:39,656 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_H1.png' lên Gemini File API...
2025-10-12 11:01:39,656 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:01:39,657 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M5.png, Tối ưu hóa: False
2025-10-12 11:01:39,657 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M1.png' lên Gemini File API...
2025-10-12 11:01:39,658 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:39,659 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:01:39,660 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M15.png' lên Gemini File API...
2025-10-12 11:01:39,667 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:01:39,670 - APP.analysis.context_builder - DEBUG - Bắt đầu xây dựng ngữ cảnh lịch sử với budget: 2000 chars.
2025-10-12 11:01:39,673 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:39,683 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:39,760 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:39,762 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:01:39,764 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M5.png' lên Gemini File API...
2025-10-12 11:01:39,765 - APP.analysis.context_builder - DEBUG - Parsing last 20 context files from: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\Reports
2025-10-12 11:01:39,766 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:01:39,993 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:40,282 - APP.analysis.context_builder - WARNING - Thư mục báo cáo không tồn tại: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\Reports
2025-10-12 11:01:40,313 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:40,400 - APP.analysis.context_builder - DEBUG - Bắt đầu tóm tắt xu hướng checklist từ 0 items.
2025-10-12 11:01:40,405 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:40,569 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:40,670 - APP.analysis.context_builder - DEBUG - Không có items, trả về trend 'unknown'.
2025-10-12 11:01:40,848 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:01:40,849 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:40,858 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 4 tên file.
2025-10-12 11:01:41,029 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:41,049 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:01:41,163 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:41,262 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_H1.png
2025-10-12 11:01:41,318 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:01:41,350 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:41,470 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:41,483 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'H1' cho 'XAUUSD_H1.png' bằng pattern đã biên dịch.
2025-10-12 11:01:41,563 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:01:41,607 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:41,610 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M1.png
2025-10-12 11:01:41,621 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:01:41,742 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:41,822 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:01:41,826 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M1' cho 'XAUUSD_M1.png' bằng pattern đã biên dịch.
2025-10-12 11:01:41,982 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:01:42,110 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:01:42,201 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M15.png
2025-10-12 11:01:42,293 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:42,297 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:01:42,299 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M15' cho 'XAUUSD_M15.png' bằng pattern đã biên dịch.
2025-10-12 11:01:42,305 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M5.png
2025-10-12 11:01:42,346 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M5' cho 'XAUUSD_M5.png' bằng pattern đã biên dịch.
2025-10-12 11:01:42,477 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:42,504 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {'XAUUSD_H1.png': 'H1', 'XAUUSD_M1.png': 'M1', 'XAUUSD_M15.png': 'M15', 'XAUUSD_M5.png': 'M5'}
2025-10-12 11:01:42,668 - APP.analysis.context_builder - DEBUG - Ngữ cảnh lịch sử có kích thước 606 chars (trong budget).
2025-10-12 11:01:42,829 - APP.utils.threading_utils - DEBUG - Task song song 'build_historical_context_async' hoàn tất thành công.
2025-10-12 11:01:42,854 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:01:42,950 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:01:42,950 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:42,956 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:01:43,045 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:01:43,159 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:01:43,168 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:43,169 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:01:43,170 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:01:43,175 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:01:43,297 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:01:43,359 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:01:43,475 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:01:43,700 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:01:43,702 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:43,703 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:43,756 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:01:43,778 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:01:43,985 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:01:43,999 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:01:44,112 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:44,191 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:01:44,216 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:01:44,437 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:01:44,459 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:01:44,514 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:01:44,612 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:01:44,626 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:44,760 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:01:45,103 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:01:45,223 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:45,288 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:01:45,485 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:01:45,540 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:01:45,568 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:01:45,577 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:01:45,631 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:01:45,642 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:01:45,782 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:45,952 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:01:45,959 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:01:46,107 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:46,158 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:01:46,243 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:01:46,381 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:46,595 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:01:46,595 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:01:46,642 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:01:46,798 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:01:46,843 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:46,955 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:01:47,060 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:01:47,069 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:47,070 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:01:47,070 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:47,074 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:47,286 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:47,393 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:01:47,571 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:47,661 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:01:47,751 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:47,921 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:01:48,031 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:01:48,131 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:48,227 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:01:48,255 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:48,347 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:01:48,438 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:48,456 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:01:48,539 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:48,670 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:48,695 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:48,766 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:01:48,877 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:01:48,907 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:48,936 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:01:48,981 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:01:49,049 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:01:49,066 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:01:49,074 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:01:49,078 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:01:49,102 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/4ntutfi7gw3h. Đang chờ trạng thái ACTIVE.
2025-10-12 11:01:49,140 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:49,145 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:01:49,168 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:01:49,169 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:01:49,169 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:49,170 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:01:49,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:01:49,234 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:01:49,236 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:01:49,237 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:01:49,238 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:01:49,309 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:01:49,313 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:01:49,314 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:01:49,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:01:49,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:01:49,320 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:49,389 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:01:49,394 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:01:49,472 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:49,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:01:49,482 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:01:49,485 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:01:49,485 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:01:49,487 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:01:49,501 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:01:49,507 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:49,575 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:01:49,576 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:01:49,577 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:49,577 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:49,578 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:01:49,578 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:01:49,579 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:01:49,580 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:01:49,580 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:01:49,580 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:01:49,581 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:49,582 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:01:49,582 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:01:49,667 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:49,667 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:01:49,669 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:01:49,670 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:01:49,670 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:01:49,671 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:49,671 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:01:49,672 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:01:49,672 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:49,672 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:01:49,673 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:01:49,675 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:01:49,676 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:01:49,676 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:01:49,752 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:01:49,753 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:01:49,754 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:49,755 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:49,756 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:01:49,757 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:01:49,759 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:01:49,760 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:01:49,761 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:01:49,819 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:01:49,820 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:01:49,822 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:01:49,824 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:49,828 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:01:49,829 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:49,830 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:49,830 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:49,830 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:01:49,831 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:49,831 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:01:49,832 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:49,832 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:01:49,876 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M1.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-12 11:01:49,909 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:01:49,912 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:01:49,912 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M1.png'.
2025-10-12 11:01:49,917 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:49,917 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:49,919 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:49,919 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11924:1760266825:8fd56fde81c82966
2025-10-12 11:01:50,006 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:50,012 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:50,014 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M1.png trong cache với tên từ xa files/4ntutfi7gw3h.
2025-10-12 11:01:50,014 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:01:50,017 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:50,018 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110138.1' (group=analysis.upload) hoàn tất sau 10.43s
2025-10-12 11:01:50,020 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/sx0trajzg3l6. Đang chờ trạng thái ACTIVE.
2025-10-12 11:01:50,026 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:01:50,065 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/2pgolyf8f9g0. Đang chờ trạng thái ACTIVE.
2025-10-12 11:01:50,070 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:50,071 - APP.utils.threading_utils - WARNING - Task 'chart.info' (group=chart.refresh) vượt timeout 10.00s → cancel
2025-10-12 11:01:50,076 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:50,079 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:01:50,081 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:50,082 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:50,088 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:50,089 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:50,089 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:50,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:50,092 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:50,092 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:50,094 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:50,096 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:50,158 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:01:50,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:50,160 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-12 11:01:50,160 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:01:50,161 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:50,163 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:01:50,165 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:50,166 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:01:50,168 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:50,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:01:50,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:50,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:01:50,235 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:50,237 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:50,251 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:50,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:50,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:01:50,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:50,259 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:50,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:50,261 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:01:50,348 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:01:50,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:01:50,414 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/f88go63ia1r8. Đang chờ trạng thái ACTIVE.
2025-10-12 11:01:50,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:01:50,509 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:01:50,657 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:01:50,672 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:50,748 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:01:50,749 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:50,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:01:50,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:01:50,751 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:50,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:50,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:50,756 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:50,756 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:01:50,758 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:01:50,760 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:50,830 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_H1.png': ACTIVE. Thời gian đã trôi qua: 0.8s
2025-10-12 11:01:50,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:50,845 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M15.png': ACTIVE. Thời gian đã trôi qua: 0.8s
2025-10-12 11:01:50,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:50,942 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:50,947 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_H1.png'.
2025-10-12 11:01:50,949 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M15.png'.
2025-10-12 11:01:50,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:01:50,952 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:50,953 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:51,041 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 16736:1760266841:0672e05dcd1c284d
2025-10-12 11:01:51,097 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:01:51,103 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 16567:1760266835:734f880feb046a76
2025-10-12 11:01:51,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:51,105 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.35s
2025-10-12 11:01:51,164 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_H1.png trong cache với tên từ xa files/sx0trajzg3l6.
2025-10-12 11:01:51,194 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110138.0' (group=analysis.upload) hoàn tất sau 11.63s
2025-10-12 11:01:51,257 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M15.png trong cache với tên từ xa files/2pgolyf8f9g0.
2025-10-12 11:01:51,264 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:51,284 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:51,312 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M5.png': ACTIVE. Thời gian đã trôi qua: 0.8s
2025-10-12 11:01:51,357 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110138.2' (group=analysis.upload) hoàn tất sau 11.72s
2025-10-12 11:01:51,358 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:01:51,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:01:51,360 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M5.png'.
2025-10-12 11:01:51,372 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:51,410 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:51,421 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:51,422 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 12112:1760266830:9c602a62c841301a
2025-10-12 11:01:51,425 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:01:51,426 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:51,429 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M5.png trong cache với tên từ xa files/f88go63ia1r8.
2025-10-12 11:01:51,432 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110138.3' (group=analysis.upload) hoàn tất sau 11.79s
2025-10-12 11:01:51,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:51,434 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:51,436 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-12 11:01:51,437 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:51,438 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:51,439 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:51,505 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-12 11:01:51,507 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:51,509 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:51,568 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_3_logic' hoàn tất thành công.
2025-10-12 11:01:51,577 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:51,592 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:51,676 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:51,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:51,869 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:51,873 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:01:51,883 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:51,890 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:51,954 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:51,958 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:51,963 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:51,964 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:51,964 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:51,965 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:51,965 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:51,967 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:51,968 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:51,969 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:51,970 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:51,971 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:51,972 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:52,034 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,040 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:52,054 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:52,193 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:52,252 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:01:52,260 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:52,264 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:01:52,266 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:52,283 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:01:52,286 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:52,345 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:01:52,351 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:52,354 - APP.utils.threading_utils - DEBUG - Task song song 'get_market_data_async' hoàn tất thành công.
2025-10-12 11:01:52,356 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:52,425 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:52,427 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:52,429 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:52,519 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:01:52,546 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:52,546 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:52,547 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:01:52,548 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:52,549 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:52,549 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:01:52,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:52,550 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:52,550 - APP.utils.safe_data - DEBUG - Get top-level key 'symbol': XAUUSD
2025-10-12 11:01:52,551 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.58s
2025-10-12 11:01:52,551 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:52,552 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:52,621 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:52,626 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:52,626 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:52,627 - APP.utils.safe_data - DEBUG - Get top-level key 'volatility_regime': trending
2025-10-12 11:01:52,627 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:52,628 - APP.utils.safe_data - DEBUG - Get top-level key 'ict_patterns': {'liquidity_h1': {'swing_highs_BSL': [{'price': 4059.382, 'bar_index': -11}, {'price': 4058.033, 'bar_index': 9}, {'price': 4049.726, 'bar_index': -17}, {'price': 4043.805, 'bar_index': 1}, {'price': 4036.362, 'bar_index': -3}], 'swing_lows_SSL': [{'price': 3922.438, 'bar_index': -67}, {'price': 3926.534, 'bar_index': -61}, {'price': 3940.881, 'bar_index': -42}, {'price': 3944.632, 'bar_index': 13}, {'price': 3947.001, 'bar_index': 23}]}, 'fvgs_h1': [{'type': 'Bullish', 'top': 4008.953, 'bottom': 4000.903}, {'type': 'Bearish', 'top': 4037.43, 'bottom': 4029.14}], 'order_blocks_h1': [{'type': 'Bearish', 'top': 4053.838, 'bottom': 4037.43, 'bar_index': 88}], 'liquidity_voids_h1': [{'type': 'Bullish', 'top': 3994.894, 'bottom': 3970.215, 'bar_index': 77}, {'type': 'Bearish', 'top': 3979.339, 'bottom': 3960.856, 'bar_index': 72}, {'type': 'Bearish', 'top': 3992.47, 'bottom': 3969.968, 'bar_index': 70}], 'premium_discount_h1': {'high': 4058.033, 'low': 3947.001, 'equilibrium': 4002.517, 'status': 'Premium'}, 'mss_h1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 3947.001, 'break_bar_index': 10}, 'liquidity_m15': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': -30}, {'price': 4021.448, 'bar_index': -13}, {'price': 4009.139, 'bar_index': -19}, {'price': 4006.822, 'bar_index': -53}, {'price': 4000.153, 'bar_index': -50}], 'swing_lows_SSL': [{'price': 3947.001, 'bar_index': -76}, {'price': 3952.655, 'bar_index': -64}, {'price': 3958.576, 'bar_index': -100}, {'price': 3965.671, 'bar_index': -70}, {'price': 3969.968, 'bar_index': -86}]}, 'fvgs_m15': [{'type': 'Bullish', 'top': 4005.302, 'bottom': 4005.203}], 'order_blocks_m15': [], 'liquidity_voids_m15': [{'type': 'Bullish', 'top': 4013.091, 'bottom': 4005.731, 'bar_index': 39}, {'type': 'Bullish', 'top': 4017.929, 'bottom': 4005.302, 'bar_index': 36}, {'type': 'Bearish', 'top': 4007.945, 'bottom': 3994.604, 'bar_index': 21}], 'premium_discount_m15': {'high': 4021.448, 'low': 3952.655, 'equilibrium': 3987.0515, 'status': 'Premium'}, 'mss_m15': None, 'liquidity_m5': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': 94}, {'price': 4021.448, 'bar_index': 147}, {'price': 4013.091, 'bar_index': 153}, {'price': 4009.139, 'bar_index': 128}, {'price': 4006.822, 'bar_index': 25}], 'swing_lows_SSL': [{'price': 3952.655, 'bar_index': -7}, {'price': 3967.683, 'bar_index': -18}, {'price': 3968.37, 'bar_index': -13}, {'price': 3970.666, 'bar_index': 77}, {'price': 3975.036, 'bar_index': 114}]}, 'fvgs_m5': [{'type': 'Bullish', 'top': 3995.454, 'bottom': 3994.286}], 'order_blocks_m5': [{'type': 'Bullish', 'top': 3997.645, 'bottom': 3993.04, 'bar_index': 152}], 'liquidity_voids_m5': [{'type': 'Bullish', 'top': 4009.556, 'bottom': 4005.302, 'bar_index': 162}, {'type': 'Bullish', 'top': 4005.203, 'bottom': 4000.209, 'bar_index': 158}, {'type': 'Bullish', 'top': 3999.818, 'bottom': 3994.595, 'bar_index': 153}], 'premium_discount_m5': {'high': 4013.091, 'low': 3975.036, 'equilibrium': 3994.0635, 'status': 'Premium'}, 'mss_m5': None, 'liquidity_m1': {'swing_highs_BSL': [{'price': 4021.448, 'bar_index': -22}, {'price': 4020.939, 'bar_index': 37}, {'price': 4018.51, 'bar_index': -33}, {'price': 4018.008, 'bar_index': -30}, {'price': 4015.696, 'bar_index': -15}], 'swing_lows_SSL': [{'price': 3995.782, 'bar_index': -70}, {'price': 3997.946, 'bar_index': -75}, {'price': 4002.278, 'bar_index': -60}, {'price': 4004.779, 'bar_index': -50}, {'price': 4005.731, 'bar_index': -3}]}, 'fvgs_m1': [{'type': 'Bullish', 'top': 4009.818, 'bottom': 4009.616}, {'type': 'Bearish', 'top': 4011.981, 'bottom': 4010.544}], 'order_blocks_m1': [], 'liquidity_voids_m1': [{'type': 'Bullish', 'top': 4016.499, 'bottom': 4012.638, 'bar_index': 83}, {'type': 'Bullish', 'top': 4012.165, 'bottom': 4009.678, 'bar_index': 75}, {'type': 'Bullish', 'top': 4009.971, 'bottom': 4008.033, 'bar_index': 73}], 'premium_discount_m1': {'high': 4020.939, 'low': 4005.731, 'equilibrium': 4013.335, 'status': 'Discount'}, 'mss_m1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 4005.731, 'break_bar_index': 0}}
2025-10-12 11:01:52,629 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:52,630 - APP.utils.safe_data - DEBUG - Get top-level key 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_14/10/2025_10:00_NFIB Small Business Optimism  (Sep)', 'when_utc': datetime.datetime(2025, 10, 14, 10, 0, tzinfo=<UTC>), 'title': 'NFIB Small Business Optimism  (Sep)', 'country': 'united states', 'impact': 'low', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '46h 58m'}, {'id': 'investpy_14/10/2025_16:20_Fed Chair Powell Speaks', 'when_utc': datetime.datetime(2025, 10, 14, 16, 20, tzinfo=<UTC>), 'title': 'Fed Chair Powell Speaks', 'country': 'united states', 'impact': 'high', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 23, 20, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '53h 18m'}, {'id': 'investpy_15/10/2025_12:30_Core CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 15, 12, 30, tzinfo=<UTC>), 'title': 'Core CPI (YoY)  (Sep)', 'country': 'united states', 'impact': 'medium', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 19, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '73h 28m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 12, 10, 59, 18, 128084, tzinfo=<UTC>), 'latency_sec': 14.195359000004828}
2025-10-12 11:01:52,630 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,631 - APP.utils.safe_data - DEBUG - Get top-level key 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_14/10/2025_10:00_NFIB Small Business Optimism  (Sep)', 'when_utc': datetime.datetime(2025, 10, 14, 10, 0, tzinfo=<UTC>), 'title': 'NFIB Small Business Optimism  (Sep)', 'country': 'united states', 'impact': 'low', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '46h 58m'}, {'id': 'investpy_14/10/2025_16:20_Fed Chair Powell Speaks', 'when_utc': datetime.datetime(2025, 10, 14, 16, 20, tzinfo=<UTC>), 'title': 'Fed Chair Powell Speaks', 'country': 'united states', 'impact': 'high', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 23, 20, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '53h 18m'}, {'id': 'investpy_15/10/2025_12:30_Core CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 15, 12, 30, tzinfo=<UTC>), 'title': 'Core CPI (YoY)  (Sep)', 'country': 'united states', 'impact': 'medium', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 19, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '73h 28m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 12, 10, 59, 18, 128084, tzinfo=<UTC>), 'latency_sec': 14.195359000004828}
2025-10-12 11:01:52,632 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:52,633 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:01:52,634 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:01:52,634 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:01:52,635 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:01:52,637 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:01:52,639 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:01:52,640 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:01:52,641 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,642 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:52,642 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:01:52,696 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:01:52,697 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:01:52,697 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:01:52,699 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,700 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:01:52,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,700 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:01:52,700 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:01:52,701 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:52,704 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:01:52,705 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:01:52,706 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,706 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:01:52,706 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:01:52,707 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,766 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:52,778 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,783 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:52,784 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:52,785 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:52,786 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:52,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,854 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:52,855 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:01:52,858 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:52,859 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:52,859 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:52,860 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_2_logic' hoàn tất thành công.
2025-10-12 11:01:52,861 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:01:52,863 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 4: Gọi Model AI
2025-10-12 11:01:52,871 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:52,936 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:52,937 - APP.ui.components.prompt_manager - DEBUG - Đang lấy nội dung prompts từ UI.
2025-10-12 11:01:52,983 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:01:52,985 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:52,987 - APP.utils.threading_utils - INFO - Task 'chart.info' (group=chart.refresh) bị hủy sau 13.22s
2025-10-12 11:01:52,988 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:52,995 - APP.ui.controllers.chart_controller - DEBUG - Future chart.info bị cancel, không cập nhật UI.
2025-10-12 11:01:52,997 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:52,998 - APP.ui.components.prompt_manager - DEBUG - Đang lấy nội dung prompts từ UI.
2025-10-12 11:01:52,999 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:53,001 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:53,001 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:01:53,001 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:53,002 - APP.analysis.prompt_builder - DEBUG - Không có vị thế, chọn prompt 'no_entry' để tìm kiếm setup.
2025-10-12 11:01:53,002 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:01:53,003 - APP.analysis.prompt_builder - DEBUG - Bắt đầu xây dựng prompt cuối cùng.
2025-10-12 11:01:53,004 - APP.analysis.prompt_builder - DEBUG - Đã xây dựng xong prompt cuối cùng.
2025-10-12 11:01:53,006 - APP.core.analysis_worker - DEBUG - --- PROMPT FINAL GỬI ĐẾN AI ---
VAI TRÒ & BỐI CẢNH
- Bạn là một nhà giao dịch ICT chuyên nghiệp và một nhà quản lý rủi ro.
- Nhiệm vụ của bạn là phân tích thị trường theo phương pháp Top-Down VÀ quản lý các lệnh đang mở một cách hiệu quả.
- Bạn phải suy luận logic, dựa trên bằng chứng từ dữ liệu thị trường.

---
### NHIỆM VỤ 1: XÁC ĐỊNH BỐI CẢNH VÀ HÀNH ĐỘNG CẦN THIẾT

**DỰA VÀO `CONTEXT.HAS_ACTIVE_POSITIONS`, HÃY CHỌN MỘT TRONG HAI LUỒNG SAU:**

---
#### LUỒNG A: CHƯA CÓ LỆNH (HAS_ACTIVE_POSITIONS = false)

**A1. QUY TRÌNH PHÂN TÍCH TOP-DOWN 4 BƯỚC**
   - Thực hiện phân tích Top-Down (H1 -> M15 -> M5) để tìm kiếm cơ hội giao dịch chất lượng cao.
   - **Bằng chứng**: Luôn trích dẫn dữ liệu cụ thể từ `EXTRACT_JSON` và `CONCEPT_VALUE_TABLE`.
   - **Kết quả**: Xây dựng một "câu chuyện thị trường", xếp hạng setup (`A+`, `B`, `C`), và lập kế hoạch giao dịch chi tiết nếu phù hợp.

**A2. TẠO ĐỐI TƯỢNG JSON - ĐÁNH GIÁ SETUP**
   - Tổng hợp kết quả phân tích vào đối tượng JSON sau. **Đây phải là phần đầu tiên trong phản hồi của bạn.**
   ```json
   {
     "cycle": "[ĐIỀN THỜI GIAN HIỆN TẠI]",
     "symbol": "[LẤY TỪ DỮ LIỆU]",
     "mode": "expert_setup_evaluation",
     "market_narrative": "[CÂU CHUYỆN THỊ TRƯỜNG TỪ BƯỚC A1]",
     "setup_grade": "[A+/B/C/Không có]",
     "reasoning_summary": "[GIẢI THÍCH NGẮN GỌN VÌ SAO XẾP HẠNG SETUP NHƯ VẬY]",
     "top_down_analysis": {
       "h1_context": { "order_flow": "[...]", "draw_on_liquidity": "[...]" },
       "m15_poi": { "type": "[...]", "price_zone": "[...]", "quality_assessment": "[...]" },
       "m5_m1_confirmation": { "status": "[...]", "signal": "[...]" }
     },
     "proposed_plan": {
       "direction": "[long/short hoặc null]",
       "entry": "[Giá hoặc 0.0]",
       "sl": "[Giá hoặc 0.0]",
       "tp1": "[Giá hoặc 0.0]",
       "tp2": "[Giá hoặc 0.0]",
       "risk_multiplier": "[1.0 cho A+, 0.5 cho B, 0.0 cho các trường hợp khác]"
     }
   }
   ```

---
#### LUỒNG B: ĐANG CÓ LỆNH (HAS_ACTIVE_POSITIONS = true)

**B1. PHÂN TÍCH BỐI CẢNH ĐỂ QUẢN LÝ LỆNH**
   - **Đánh giá lại Draw on Liquidity (H1)**: Mục tiêu giá ban đầu còn hợp lệ không? Có mục tiêu nào mới xuất hiện không?
   - **Phân tích cấu trúc M5/M1**: Cấu trúc thị trường gần nhất (`EXTRACT_JSON.tf.M5.mss_bos`) đang ủng hộ hay chống lại lệnh hiện tại?
   - **Tìm kiếm các vùng cản/hỗ trợ mới**: Có FVG hoặc Order Block nào mới hình thành có thể ảnh hưởng đến lệnh không?

**B2. TẠO ĐỐI TƯỢNG JSON - KẾ HOẠCH QUẢN LÝ**
   - Dựa trên phân tích ở B1, hãy tạo kế hoạch quản lý cho TỪNG lệnh đang mở.
   - **Đây phải là phần đầu tiên trong phản hồi của bạn.**
   ```json
   {
     "cycle": "[ĐIỀN THỜI GIAN HIỆN TẠI]",
     "symbol": "[LẤY TỪ DỮ LIỆU]",
     "mode": "trade_management",
     "market_narrative": "[TÓM TẮT BỐI CẢNH THỊ TRƯỜNG HIỆN TẠI ẢNH HƯỞNG ĐẾN LỆNH]",
     "reasoning_summary": "[GIẢI THÍCH NGẮN GỌN CHO CÁC HÀNH ĐỘNG QUẢN LÝ]",
     "management_plan": {
       "[TICKET_LỆNH_1]": {
         "action": "[HOLD/CLOSE_PARTIAL/MOVE_SL_TO_ENTRY/TRAIL_SL]",
         "percentage": "[50 nếu CLOSE_PARTIAL, ngược lại 0]",
         "sl": "[Giá SL mới, 'entry', 'last_swing_low_m5', 'last_swing_high_m5' hoặc null nếu không đổi]",
         "tp": "[Giá TP mới hoặc null nếu không đổi]",
         "reason": "[Lý do ngắn gọn cho hành động này]"
       },
       "[TICKET_LỆNH_2]": {
         "...": "..."
       },
       "ALL": {
         "action": "[HOLD/CLOSE_ALL]",
         "reason": "[Áp dụng nếu muốn thực hiện hành động cho tất cả lệnh]"
       }
     }
   }
   ```

---
### NHIỆM VỤ 2: VIẾT BÁO CÁO PHÂN TÍCH CHI TIẾT

Dựa vào đối tượng JSON bạn vừa tạo (từ Luồng A hoặc B), hãy viết một báo cáo chuyên nghiệp.

A) **TÓM TẮT NHANH (7 DÒNG):**
   - **(Luồng A)**: Trình bày tóm tắt về cơ hội giao dịch như prompt cũ.
   - **(Luồng B)**: Trình bày tóm tắt về các hành động quản lý được đề xuất cho mỗi lệnh.

B) **PHÂN TÍCH CHUYÊN SÂU:**
   - Diễn giải chi tiết về `market_narrative`.
   - Giải thích lý do đằng sau `setup_grade` (Luồng A) hoặc các quyết định trong `management_plan` (Luồng B), luôn sử dụng bằng chứng từ dữ liệu.

---
**Dữ liệu thị trường và tài khoản (MT5):**
```json
{'symbol': 'XAUUSD', 'generated_at': '2025-10-12 18:01:51', 'broker_time': '2025-10-11T03:57:58+07:00', 'timezone': 'Asia/Ho_Chi_Minh', 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}, 'positions': [], 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}, 'symbol_rules': {'volume_min': 0.01, 'volume_max': 200.0, 'volume_step': 0.01, 'trade_tick_value': 0.1, 'trade_tick_size': 0.001, 'stop_level_points': 0, 'freeze_level_points': 0, 'margin_initial': 0.0, 'margin_maintenance': 0.0}, 'pip': {'points_per_pip': 10, 'value_per_point': 0.1, 'pip_value_per_lot': 1.0}, 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}, 'tick_stats_5m': {}, 'tick_stats_30m': {}, 'levels': {'daily': {}, 'prev_day': {'high': 4058.033, 'low': 3944.632}, 'weekly': {'open': 3909.548, 'high': 4059.382, 'low': 3898.998}, 'prev_week': {'high': 3897.216, 'low': 3763.408}, 'monthly': {'open': 3863.002, 'high': 4059.382, 'low': 3819.397}}, 'day_open': None, 'prev_day_close': 3989.994, 'adr': {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}, 'day_range': None, 'day_range_pct_of_adr20': None, 'position_in_day_range': None, 'sessions_today': {'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, 'session_liquidity': {}, 'volatility': {'ATR': {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}}, 'volatility_regime': 'trending', 'trend_refs': {'EMA': {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}}, 'vwap': {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}, 'kills': {'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, 'is_silver_bullet_window': False, 'killzone_active': None, 'mins_to_next_killzone': 123, 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}], 'round_levels': [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}], 'atr_norm': {'spread_as_pct_of_atr_m5': 0.6349797540000889}, 'ict_patterns': {'liquidity_h1': {'swing_highs_BSL': [{'price': 4059.382, 'bar_index': -11}, {'price': 4058.033, 'bar_index': 9}, {'price': 4049.726, 'bar_index': -17}, {'price': 4043.805, 'bar_index': 1}, {'price': 4036.362, 'bar_index': -3}], 'swing_lows_SSL': [{'price': 3922.438, 'bar_index': -67}, {'price': 3926.534, 'bar_index': -61}, {'price': 3940.881, 'bar_index': -42}, {'price': 3944.632, 'bar_index': 13}, {'price': 3947.001, 'bar_index': 23}]}, 'fvgs_h1': [{'type': 'Bullish', 'top': 4008.953, 'bottom': 4000.903}, {'type': 'Bearish', 'top': 4037.43, 'bottom': 4029.14}], 'order_blocks_h1': [{'type': 'Bearish', 'top': 4053.838, 'bottom': 4037.43, 'bar_index': 88}], 'liquidity_voids_h1': [{'type': 'Bullish', 'top': 3994.894, 'bottom': 3970.215, 'bar_index': 77}, {'type': 'Bearish', 'top': 3979.339, 'bottom': 3960.856, 'bar_index': 72}, {'type': 'Bearish', 'top': 3992.47, 'bottom': 3969.968, 'bar_index': 70}], 'premium_discount_h1': {'high': 4058.033, 'low': 3947.001, 'equilibrium': 4002.517, 'status': 'Premium'}, 'mss_h1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 3947.001, 'break_bar_index': 10}, 'liquidity_m15': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': -30}, {'price': 4021.448, 'bar_index': -13}, {'price': 4009.139, 'bar_index': -19}, {'price': 4006.822, 'bar_index': -53}, {'price': 4000.153, 'bar_index': -50}], 'swing_lows_SSL': [{'price': 3947.001, 'bar_index': -76}, {'price': 3952.655, 'bar_index': -64}, {'price': 3958.576, 'bar_index': -100}, {'price': 3965.671, 'bar_index': -70}, {'price': 3969.968, 'bar_index': -86}]}, 'fvgs_m15': [{'type': 'Bullish', 'top': 4005.302, 'bottom': 4005.203}], 'order_blocks_m15': [], 'liquidity_voids_m15': [{'type': 'Bullish', 'top': 4013.091, 'bottom': 4005.731, 'bar_index': 39}, {'type': 'Bullish', 'top': 4017.929, 'bottom': 4005.302, 'bar_index': 36}, {'type': 'Bearish', 'top': 4007.945, 'bottom': 3994.604, 'bar_index': 21}], 'premium_discount_m15': {'high': 4021.448, 'low': 3952.655, 'equilibrium': 3987.0515, 'status': 'Premium'}, 'mss_m15': None, 'liquidity_m5': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': 94}, {'price': 4021.448, 'bar_index': 147}, {'price': 4013.091, 'bar_index': 153}, {'price': 4009.139, 'bar_index': 128}, {'price': 4006.822, 'bar_index': 25}], 'swing_lows_SSL': [{'price': 3952.655, 'bar_index': -7}, {'price': 3967.683, 'bar_index': -18}, {'price': 3968.37, 'bar_index': -13}, {'price': 3970.666, 'bar_index': 77}, {'price': 3975.036, 'bar_index': 114}]}, 'fvgs_m5': [{'type': 'Bullish', 'top': 3995.454, 'bottom': 3994.286}], 'order_blocks_m5': [{'type': 'Bullish', 'top': 3997.645, 'bottom': 3993.04, 'bar_index': 152}], 'liquidity_voids_m5': [{'type': 'Bullish', 'top': 4009.556, 'bottom': 4005.302, 'bar_index': 162}, {'type': 'Bullish', 'top': 4005.203, 'bottom': 4000.209, 'bar_index': 158}, {'type': 'Bullish', 'top': 3999.818, 'bottom': 3994.595, 'bar_index': 153}], 'premium_discount_m5': {'high': 4013.091, 'low': 3975.036, 'equilibrium': 3994.0635, 'status': 'Premium'}, 'mss_m5': None, 'liquidity_m1': {'swing_highs_BSL': [{'price': 4021.448, 'bar_index': -22}, {'price': 4020.939, 'bar_index': 37}, {'price': 4018.51, 'bar_index': -33}, {'price': 4018.008, 'bar_index': -30}, {'price': 4015.696, 'bar_index': -15}], 'swing_lows_SSL': [{'price': 3995.782, 'bar_index': -70}, {'price': 3997.946, 'bar_index': -75}, {'price': 4002.278, 'bar_index': -60}, {'price': 4004.779, 'bar_index': -50}, {'price': 4005.731, 'bar_index': -3}]}, 'fvgs_m1': [{'type': 'Bullish', 'top': 4009.818, 'bottom': 4009.616}, {'type': 'Bearish', 'top': 4011.981, 'bottom': 4010.544}], 'order_blocks_m1': [], 'liquidity_voids_m1': [{'type': 'Bullish', 'top': 4016.499, 'bottom': 4012.638, 'bar_index': 83}, {'type': 'Bullish', 'top': 4012.165, 'bottom': 4009.678, 'bar_index': 75}, {'type': 'Bullish', 'top': 4009.971, 'bottom': 4008.033, 'bar_index': 73}], 'premium_discount_m1': {'high': 4020.939, 'low': 4005.731, 'equilibrium': 4013.335, 'status': 'Discount'}, 'mss_m1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 4005.731, 'break_bar_index': 0}}, 'risk_model': {}, 'rr_projection': {}, 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_14/10/2025_10:00_NFIB Small Business Optimism  (Sep)', 'when_utc': datetime.datetime(2025, 10, 14, 10, 0, tzinfo=<UTC>), 'title': 'NFIB Small Business Optimism  (Sep)', 'country': 'united states', 'impact': 'low', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 17, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '46h 58m'}, {'id': 'investpy_14/10/2025_16:20_Fed Chair Powell Speaks', 'when_utc': datetime.datetime(2025, 10, 14, 16, 20, tzinfo=<UTC>), 'title': 'Fed Chair Powell Speaks', 'country': 'united states', 'impact': 'high', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 23, 20, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '53h 18m'}, {'id': 'investpy_15/10/2025_12:30_Core CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 15, 12, 30, tzinfo=<UTC>), 'title': 'Core CPI (YoY)  (Sep)', 'country': 'united states', 'impact': 'medium', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 19, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '73h 28m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 12, 10, 59, 18, 128084, tzinfo=<UTC>), 'latency_sec': 14.195359000004828}, 'concept_value_table': '| Khái niệm (Concept) | Giá trị (Value) |\n|---|---|\n| Symbol | XAUUSD |\n| Chế độ Biến động | trending |\n| H1 Order Flow | Bearish |\n| M15 Structure | Không rõ |\n| Trong Cửa sổ Tin tức | False |\n| Tin tức Sắp tới | 46h 58m - NFIB Small Business Optimism  (Sep) |\n'}
```

---
**Bối cảnh bổ sung từ các báo cáo trước:**


[CONTEXT_COMPOSED]
{"CONTEXT_COMPOSED": {"cycle": "2025-10-12 11:01:42", "trend_checklist": {"trend": "unknown", "enough_ratio": null}, "latest_plan": null, "latest_summary_lines": null, "recent_history_summary": null, "run_meta": {"analysis_id": "2025-10-12T11:01:40Z", "folder_signature": "sha1:49c2e050742d71fcee49851b6f2172d1f5ebc9b1", "images_tf_map": {"XAUUSD_H1.png": "H1", "XAUUSD_M1.png": "M1", "XAUUSD_M15.png": "M15", "XAUUSD_M5.png": "M5"}}, "running_stats": {"backtest_results": {"status": "not_implemented"}}, "risk_rules": {"max_risk_per_trade_pct": 1.0, "daily_loss_limit_pct": 3.0, "max_trades_per_day": 3}}}

---
**Phân tích các hình ảnh được cung cấp.**
--- KẾT THÚC PROMPT ---
2025-10-12 11:01:53,010 - APP.services.gemini_service - DEBUG - Bắt đầu stream tới Gemini API với 5 lần thử.
2025-10-12 11:01:53,093 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:53,094 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:53,357 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:53,363 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:53,365 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:53,443 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:01:53,548 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:01:53,734 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:54,009 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:54,009 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:54,011 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:01:54,013 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:54,013 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:54,015 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:54,015 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:54,016 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:01:54,078 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:54,079 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:54,079 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:54,080 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:54,081 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:54,082 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:54,083 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:01:54,094 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:01:54,109 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:54,597 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:01:54,598 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:01:54,599 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:01:54,599 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:01:54,600 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:01:54,601 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:01:54,601 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:01:54,601 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:54,604 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:01:54,605 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:54,605 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:01:54,605 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:01:54,609 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:01:54,610 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:54,610 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:01:54,611 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:01:54,613 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:01:54,614 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:54,615 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:01:54,618 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:01:54,626 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:01:54,643 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:54,644 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:01:54,645 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:01:54,652 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:54,653 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:01:54,654 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:01:54,654 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:01:54,655 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:54,655 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:54,655 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:54,656 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:54,656 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:54,656 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:01:54,658 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:01:54,658 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:01:54,663 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:01:54,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:54,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:01:54,664 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:54,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:01:54,665 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:01:54,665 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:01:54,666 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:01:54,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:01:54,666 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:01:54,667 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:01:54,667 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:01:54,667 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:01:54,668 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:54,668 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:01:54,668 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:54,669 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:01:54,669 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:01:54,670 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:01:54,670 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:01:54,671 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:54,671 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:01:54,671 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:01:54,672 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:01:54,672 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:54,673 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:01:54,673 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:01:54,674 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:01:54,674 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:54,674 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:01:54,675 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:01:54,675 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:01:54,675 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:01:54,676 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:01:54,676 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:54,676 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:01:54,677 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:01:54,677 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:01:54,734 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:01:54,738 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:54,742 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:54,744 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:54,746 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:54,747 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:54,747 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:01:54,748 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:54,749 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:54,750 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:01:54,751 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:01:54,751 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:54,751 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:54,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:54,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:54,790 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:54,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:54,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:54,793 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:01:54,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:01:54,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:01:54,796 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:54,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:01:54,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:54,798 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:01:54,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:01:54,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:01:54,800 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:54,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:01:54,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:54,802 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:01:54,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:54,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:54,869 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:54,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:54,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:54,872 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:01:54,875 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:54,876 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:54,877 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:54,877 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:54,936 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:54,937 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:54,937 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:54,937 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:54,938 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:54,938 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:54,939 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:54,940 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:54,941 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:54,941 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:54,942 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:54,942 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:54,943 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:54,943 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:54,943 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:54,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:54,944 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:01:54,945 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:01:54,946 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:01:54,946 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:01:54,947 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:54,949 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:01:54,950 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:54,951 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:01:54,952 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:01:54,952 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:01:54,955 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:01:54,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:01:54,956 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:01:54,956 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:01:54,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:54,958 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:54,959 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:55,018 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:55,018 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:55,023 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:55,028 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:55,030 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:55,030 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:55,032 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:55,032 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:01:55,033 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:55,034 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:55,035 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:01:55,036 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:01:55,300 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:55,354 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.34s
2025-10-12 11:01:55,986 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:55,987 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:55,988 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:01:55,989 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:01:55,996 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:56,063 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:01:56,115 - APP.services.fmp_service - INFO - Lấy thành công 418 sự kiện từ investpy cho 7 ngày tới.
2025-10-12 11:01:56,160 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 17.46s
2025-10-12 11:01:56,254 - APP.ui.app_ui - DEBUG - Callback nhận được 141 sự kiện tin tức mới.
2025-10-12 11:01:56,256 - APP.services.news_service - INFO - NewsService làm mới cache (141 sự kiện, priority=autorun, source=network, latency=17.56s)
2025-10-12 11:01:56,259 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 17.56s
2025-10-12 11:01:56,505 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:56,506 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:56,508 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:01:56,510 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:56,510 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:01:56,511 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:56,513 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:56,514 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:56,515 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:01:56,517 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:56,518 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:56,976 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:56,977 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:56,978 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:56,978 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:56,979 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:56,980 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:56,981 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:01:56,981 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:01:57,482 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:01:57,484 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:01:57,485 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:01:57,485 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:01:57,485 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:01:57,486 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:01:57,486 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:01:57,487 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:57,490 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:01:57,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:57,539 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:57,539 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:01:57,541 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:01:57,543 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:57,546 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:01:57,548 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:57,548 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:57,550 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:57,550 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:01:57,550 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:57,551 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:01:57,552 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:01:57,556 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:01:57,628 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:57,629 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:01:57,631 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:01:57,639 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:01:57,730 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:57,730 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:01:57,731 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:57,731 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:01:57,808 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:57,876 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:01:57,883 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:01:57,902 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:01:57,908 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:57,970 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:58,049 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:58,075 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:58,157 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:58,208 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:01:58,318 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:01:58,329 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:01:58,345 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:01:58,347 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:58,350 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:01:58,408 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:58,410 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:01:58,418 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:01:58,487 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:01:58,488 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:01:58,489 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:01:58,489 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:01:58,490 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:01:58,504 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:01:58,509 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:01:58,510 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:01:58,511 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:01:58,511 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:01:58,512 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:01:58,512 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:01:58,513 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:01:58,514 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:01:58,515 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:58,516 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:01:58,517 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:01:58,518 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:01:58,518 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:01:58,640 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:58,641 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:01:58,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:58,644 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:01:58,645 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:58,645 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:01:58,647 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:58,653 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:01:58,653 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:58,654 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:01:58,654 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:01:58,655 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:01:58,655 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:01:58,656 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:01:58,656 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:01:58,657 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:58,657 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:01:58,658 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:01:58,660 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:01:58,660 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:01:58,661 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:01:58,661 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:01:58,662 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:01:58,662 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:01:58,663 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:01:58,663 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:01:58,663 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:58,664 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:58,667 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:01:58,668 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:01:58,717 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:58,718 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:58,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:58,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:58,721 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:58,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:58,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:58,724 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:01:58,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:01:58,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:01:58,726 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:58,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:01:58,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:58,727 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:01:58,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:01:58,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:01:58,731 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:01:58,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:01:58,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:58,734 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:01:58,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:01:58,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:01:58,793 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:58,794 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:01:58,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:01:58,878 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:01:58,880 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:01:58,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:58,971 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:59,040 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:59,043 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:59,123 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:59,142 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:59,158 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:59,171 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:59,261 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:59,263 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:59,265 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:01:59,266 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:01:59,268 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:01:59,269 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:01:59,271 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:01:59,340 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:01:59,351 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:01:59,418 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:01:59,421 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:59,423 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:59,425 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:01:59,426 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:01:59,426 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:01:59,434 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:01:59,439 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:59,448 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:01:59,452 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:59,452 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:01:59,513 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:01:59,514 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:01:59,517 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:01:59,521 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:01:59,539 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:01:59,592 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:01:59,595 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:59,598 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:59,599 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:59,601 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:01:59,604 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:01:59,608 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:59,609 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:01:59,611 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:01:59,612 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:01:59,615 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.11s
2025-10-12 11:01:59,627 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:01:59,636 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:01:59,675 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:01:59,676 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:01:59,680 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:01:59,686 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:59,687 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:01:59,689 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:01:59,692 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:01:59,744 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:01:59,749 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:59,750 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:01:59,751 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:59,751 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:01:59,752 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:59,752 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:01:59,753 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:01:59,754 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:01:59,756 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:01:59,757 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:01:59,757 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:01:59,827 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:00,258 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:00,260 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:00,261 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:00,261 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:00,262 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:00,262 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:00,262 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:00,263 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:00,265 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:00,266 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:00,266 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:00,267 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:00,270 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:00,270 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:00,271 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:00,271 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:00,285 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:00,313 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:00,315 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:00,316 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:00,319 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:00,319 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:00,320 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:00,320 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:00,323 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:00,324 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:00,325 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:00,325 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:00,326 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:00,326 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:00,327 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:00,327 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:00,328 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:00,329 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:00,330 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:00,331 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:00,335 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:00,388 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:00,389 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:00,390 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:00,393 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:00,394 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:00,395 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:00,396 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:00,396 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:00,405 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:00,405 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:00,405 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:00,406 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:00,406 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:00,407 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:00,407 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:00,407 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:00,408 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:00,408 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:00,409 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:00,411 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:00,412 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:00,412 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:00,413 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:00,414 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:00,414 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:00,415 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:00,415 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:00,416 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:00,416 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:00,417 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:00,417 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:00,418 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:00,418 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:00,419 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:00,419 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:00,420 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:00,421 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:00,422 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:00,422 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:00,422 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:00,423 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:00,426 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:00,469 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:00,472 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:00,473 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,473 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:00,474 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:00,474 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:00,475 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,475 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:00,476 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:00,477 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:00,478 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:00,478 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:00,480 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:00,480 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:00,481 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:00,482 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:00,482 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:00,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:00,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:00,484 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:00,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:00,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:00,486 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:00,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:00,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:00,488 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:00,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:00,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:00,491 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:00,491 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:00,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:00,493 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:00,498 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,498 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:00,499 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:00,499 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:00,500 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:00,500 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:00,501 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:00,501 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:00,504 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:00,505 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:00,505 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:00,565 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:00,566 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:00,567 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:00,567 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:00,568 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:00,568 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:00,569 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:00,570 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,570 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:00,571 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:00,572 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:00,573 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:00,573 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:00,574 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:00,576 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:00,577 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,578 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:00,579 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:00,579 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:00,582 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:00,584 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:00,630 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:00,633 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:00,635 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,637 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:00,638 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,638 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:00,639 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:00,639 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:00,639 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:00,640 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:00,640 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:00,641 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.95s
2025-10-12 11:02:00,724 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:00,726 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:00,727 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:00,730 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:00,789 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:00,793 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:00,794 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:00,796 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:00,797 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:00,798 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:00,800 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:00,800 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:00,801 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:00,861 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:00,862 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:00,864 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:02:00,870 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:00,872 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:00,873 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:00,873 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:00,874 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:00,875 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:00,876 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:00,876 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:00,948 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:01,111 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:02:01,378 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:01,380 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:01,381 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:01,381 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:01,382 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:01,382 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:01,382 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:01,383 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:01,385 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:01,386 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:01,387 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:01,387 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:01,391 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:01,391 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:01,391 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:01,392 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:01,394 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:01,395 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:01,395 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:01,396 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:01,399 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:01,400 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:01,402 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:01,435 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:01,490 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:01,573 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:01,574 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:01,574 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:01,575 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:01,575 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:01,576 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:01,577 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:01,579 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:01,580 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:01,581 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:01,581 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:01,640 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:01,641 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:01,642 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:01,642 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:01,643 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:01,643 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:01,644 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:01,644 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:01,645 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:01,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:01,648 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:01,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:01,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:01,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:01,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:01,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:01,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:01,712 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:01,716 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:01,717 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:01,717 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:01,718 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:01,719 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:01,720 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:01,721 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:01,722 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:01,723 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:01,723 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:01,724 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:01,725 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:01,725 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:01,726 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:01,727 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:01,727 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:01,730 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:01,730 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:01,731 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:01,731 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:01,731 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:01,732 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:01,732 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:01,733 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:01,733 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:01,733 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:01,734 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:01,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:01,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:01,737 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:01,737 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:01,737 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:01,738 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:01,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:01,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:01,786 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:01,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:01,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:01,788 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:01,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:01,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:01,790 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:01,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:01,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:01,792 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:01,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:01,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:01,794 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:01,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:01,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:01,796 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:01,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:01,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:01,797 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:01,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:01,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:01,799 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:01,799 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:01,800 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:01,800 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:01,803 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:01,803 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:01,803 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:01,804 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:01,869 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:01,872 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:01,873 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:01,874 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:01,874 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-12 11:02:01,875 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:01,877 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:01,877 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:01,878 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:01,878 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:01,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:01,879 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:01,926 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:01,927 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:01,927 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:01,928 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:01,928 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:01,928 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:01,929 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:01,934 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:01,937 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:01,938 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:01,938 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:01,997 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:01,999 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:02,008 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:02,068 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:02,079 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:02,079 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:02,236 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:02,248 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:02,276 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:02,328 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:02,413 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:02,469 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:02,478 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:02,532 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:02,546 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:02,553 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:02,621 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:02,623 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:02,628 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:02,696 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:02,782 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.99s
2025-10-12 11:02:02,916 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:02,920 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:02,921 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:02,924 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:02,928 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:02,936 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:02,938 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:02,939 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:02,988 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:03,003 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:03,007 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:03,009 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:03,010 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-12 11:02:03,012 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,013 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:03,014 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,015 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,016 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:03,016 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,017 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:03,017 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:03,107 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:03,519 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:03,520 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:03,521 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:03,521 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:03,522 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:03,522 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:03,526 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:03,527 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:03,529 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:03,530 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:03,530 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:03,531 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:03,534 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:03,535 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:03,535 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:03,535 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:03,538 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:03,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:03,539 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:03,540 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:03,542 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:03,543 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:03,543 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:03,543 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:03,546 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:03,546 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:03,547 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:03,547 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:03,548 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:03,548 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:03,549 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:03,549 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:03,549 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:03,550 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:03,551 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:03,551 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:03,557 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:03,558 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:03,559 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:03,559 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:03,559 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:03,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:03,582 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:03,593 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:03,594 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:03,595 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:03,596 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:03,597 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:03,597 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:03,598 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:03,598 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:03,599 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:03,599 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:03,600 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:03,600 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:03,601 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:03,601 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:03,602 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:03,602 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:03,603 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:03,603 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:03,604 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:03,605 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:03,605 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:03,605 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:03,606 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:03,606 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:03,606 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:03,607 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:03,607 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:03,607 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:03,607 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:03,608 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:03,609 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:03,609 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:03,609 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:03,609 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:03,610 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:03,610 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:03,611 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:03,611 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:03,612 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,612 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:03,613 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:03,613 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:03,613 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,614 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:03,614 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:03,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:03,615 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:03,616 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:03,617 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:03,662 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:03,663 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:03,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:03,667 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:03,668 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:03,669 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:03,670 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:03,670 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:03,671 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:03,672 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:03,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:03,673 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:03,675 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:03,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:03,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:03,677 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:03,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:03,678 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:03,679 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:03,684 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,686 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:03,687 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:03,687 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:03,688 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:03,688 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:03,689 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:03,689 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:03,690 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:03,691 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:03,692 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:03,693 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:03,693 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:03,693 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:03,694 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:03,694 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:03,694 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:03,695 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:03,696 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,697 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:03,699 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:03,700 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:03,700 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:03,700 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:03,701 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:03,702 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:03,705 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,706 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:03,706 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:03,781 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:03,785 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:03,786 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:03,787 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:03,787 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:03,788 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:03,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:03,791 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:03,791 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:03,792 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:03,792 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:03,793 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:03,834 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.90s
2025-10-12 11:02:03,888 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:03,890 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:03,890 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:03,892 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:03,896 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:03,958 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:03,962 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:03,966 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:03,969 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:03,971 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:03,972 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:03,973 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:03,975 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:03,986 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,986 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:03,988 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,989 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,990 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:03,990 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:03,991 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:03,991 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:04,006 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:04,497 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:04,500 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:04,500 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:04,501 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:04,502 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:04,503 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:04,503 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:04,505 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:04,508 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:04,508 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:04,509 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:04,509 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:04,514 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:04,514 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:04,515 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:04,515 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:04,517 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:04,517 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:04,518 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:04,518 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:04,520 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:04,521 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:04,521 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:04,521 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:04,540 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:04,576 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:04,577 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:04,578 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:04,579 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:04,579 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:04,580 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:04,580 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:04,581 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:04,581 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:04,583 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:04,583 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:04,588 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:04,595 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:04,596 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:04,597 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:04,597 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:04,598 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:04,598 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:04,599 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:04,600 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:04,600 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:04,602 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:04,603 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:04,603 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:04,604 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:04,605 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:04,605 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:04,606 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:04,606 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:04,607 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:04,608 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:04,609 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:04,609 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:04,610 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:04,610 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:04,611 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:04,611 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:04,612 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:04,613 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:04,613 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:04,614 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:04,614 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:04,615 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:04,615 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:04,616 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:04,671 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:04,673 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:04,674 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:04,675 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:04,676 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:04,676 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:04,677 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:04,677 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:04,677 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:04,678 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:04,678 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:04,679 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,679 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:04,728 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:04,730 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:04,731 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,732 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:04,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:04,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:04,734 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:04,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:04,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:04,737 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:04,738 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:04,740 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:04,740 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:04,741 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:04,742 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:04,747 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:04,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:04,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:04,750 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:04,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:04,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:04,752 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:04,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:04,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:04,755 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:04,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:04,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:04,757 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:04,757 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,758 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:04,758 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:04,760 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:04,761 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:04,762 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:04,763 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:04,764 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:04,821 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:04,825 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:04,826 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:04,826 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:04,827 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:04,827 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:04,828 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:04,828 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:04,828 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:04,829 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:04,830 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,831 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:04,831 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:04,832 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:04,832 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:04,833 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:04,834 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:04,835 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:04,843 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,844 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:04,844 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:04,844 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:04,854 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:04,888 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:04,890 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:04,890 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:04,891 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,891 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:04,892 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,892 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:04,893 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:04,893 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:04,894 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:04,895 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:04,896 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:04,897 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.93s
2025-10-12 11:02:05,002 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:05,134 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:05,236 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:05,347 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:05,411 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:05,414 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:05,416 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:05,417 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:05,420 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:05,421 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:05,422 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:05,423 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:05,423 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:05,573 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:05,988 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:05,989 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:05,990 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:05,990 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:05,991 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:05,997 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:05,998 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:05,999 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:06,422 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:06,501 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:06,503 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:06,504 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:06,505 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:06,505 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:06,506 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:06,508 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:06,509 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:06,509 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:06,510 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:06,510 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-12 11:02:06,511 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:06,512 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:06,515 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:06,516 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:06,516 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:06,518 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:06,523 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:06,571 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:06,572 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:06,572 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:06,576 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:06,577 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:06,577 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:06,578 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:06,581 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:06,581 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:06,582 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:06,582 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:06,585 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:06,639 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:06,641 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:06,642 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:06,642 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:06,692 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:06,814 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:06,910 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:06,921 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:06,984 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:07,018 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:07,116 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:07,125 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:07,148 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:07,204 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:07,210 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:07,222 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:07,228 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:07,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:07,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:07,235 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:07,237 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:07,239 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:07,240 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:07,250 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:07,251 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:07,253 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:07,267 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:07,286 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:07,330 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:07,344 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:07,346 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:07,352 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:07,364 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:07,367 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:07,429 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:07,508 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:07,511 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:07,517 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:07,520 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:07,613 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:07,613 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:07,614 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:07,614 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:07,616 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:07,617 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:07,678 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:07,679 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:07,686 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:07,688 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:07,689 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:07,689 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:07,691 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:07,692 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:07,692 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:07,693 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:07,693 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:07,695 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:07,695 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:07,696 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:07,696 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:07,697 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:07,697 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:07,698 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:07,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:07,700 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:07,701 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:07,701 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:07,702 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:07,702 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:07,702 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:07,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:07,704 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:07,705 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:07,706 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:07,707 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:07,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:07,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:07,758 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:07,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:07,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:07,762 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:07,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:07,764 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:07,765 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:07,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:07,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:07,767 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:07,767 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:07,768 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:07,769 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:07,769 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:07,770 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:07,770 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:07,771 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:07,771 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:07,773 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:07,776 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:07,777 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:07,777 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:07,780 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:07,781 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:07,781 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:07,782 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:07,782 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:07,783 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:07,783 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:07,783 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:07,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:07,784 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:07,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:07,786 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:07,788 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:07,790 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:07,846 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:07,858 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:07,917 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:08,008 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:08,105 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:08,132 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:08,136 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:08,138 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:08,200 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:08,210 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:08,226 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:08,226 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:08,309 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:08,321 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:08,366 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:08,379 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:08,456 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:08,539 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:08,613 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:08,694 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:08,760 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:08,763 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:08,765 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:08,768 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:08,771 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.35s
2025-10-12 11:02:08,943 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:08,946 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:08,946 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:08,948 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:08,953 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:09,100 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:09,101 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:09,103 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:09,105 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:09,106 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:09,108 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:09,108 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:09,109 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:09,177 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:09,178 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:09,179 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:09,179 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:09,180 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:09,182 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:09,190 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:09,192 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:09,200 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:09,693 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:09,695 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:09,696 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:09,696 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:09,697 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:09,697 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:09,697 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:09,698 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:09,700 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:09,701 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:09,701 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:09,702 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:09,705 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:09,705 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:09,706 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:09,706 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:09,708 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:09,708 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:09,709 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:09,709 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:09,726 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:09,755 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:09,757 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:09,757 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:09,761 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:09,762 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:09,762 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:09,763 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:09,763 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:09,764 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:09,764 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:09,765 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:09,765 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:09,765 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:09,767 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:09,767 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:09,770 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:09,771 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:09,771 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:09,771 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:09,772 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:09,772 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:09,772 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:09,773 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:09,773 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:09,774 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:09,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:09,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:09,859 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:09,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:09,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:09,861 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:09,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:09,862 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:09,862 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:09,863 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:09,863 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:09,865 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:09,865 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:09,866 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:09,866 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:09,867 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:09,867 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:09,868 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:09,943 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:09,948 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:09,949 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:09,950 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:09,950 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:09,951 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:10,009 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:10,009 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:10,011 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:10,011 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:10,012 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:10,013 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:10,013 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:10,014 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:10,014 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:10,014 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:10,015 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:10,015 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:10,016 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:10,016 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:10,016 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:10,017 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:10,017 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:10,018 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:10,019 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:10,019 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:10,020 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:10,021 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:10,021 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:10,022 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:10,022 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:10,023 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:10,023 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:10,102 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:10,104 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:10,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:10,106 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:10,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:10,109 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:10,110 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:10,111 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:10,111 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:10,112 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:10,113 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:10,114 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:10,114 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:10,115 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:10,115 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:10,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:10,117 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:10,196 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:10,256 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:10,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:10,271 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:10,403 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:10,491 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:10,573 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:10,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:10,646 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:10,667 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:10,669 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:10,669 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:10,670 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:10,816 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:10,828 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:10,919 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:10,921 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:10,923 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:10,924 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:10,925 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:10,927 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:10,928 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:11,008 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:11,010 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:11,016 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:11,086 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:11,107 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:11,178 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:11,180 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:11,196 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:11,205 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:11,208 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:11,270 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:11,286 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:11,304 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:11,305 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:11,313 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:11,314 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:11,321 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:11,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:11,382 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:11,383 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:11,388 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:11,390 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:11,391 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:11,391 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:11,392 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:11,393 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.29s
2025-10-12 11:02:11,481 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:11,482 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:11,483 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:11,485 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:11,535 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:11,542 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:11,544 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:11,546 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:11,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:11,548 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:11,550 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:11,551 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:11,552 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:11,565 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:11,567 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:11,570 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:11,571 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:11,571 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:11,572 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:11,573 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:11,573 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:11,646 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:12,075 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:12,076 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:12,077 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:12,077 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:12,078 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:12,079 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:12,079 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:12,079 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:12,082 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:12,082 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:12,083 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:12,083 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:12,086 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:12,086 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:12,087 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:12,091 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:12,100 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:12,137 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:12,139 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:12,140 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:12,143 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:12,144 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:12,144 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:12,145 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:12,148 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:12,148 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:12,149 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:12,221 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:12,222 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:12,223 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:12,223 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:12,224 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:12,224 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:12,224 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:12,227 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:12,228 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:12,231 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:12,232 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:12,234 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:12,234 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:12,235 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:12,235 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:12,289 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:12,295 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:12,298 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:12,298 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:12,299 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:12,300 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:12,300 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:12,301 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:12,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:12,302 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:12,302 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:12,303 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:12,304 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:12,305 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:12,305 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:12,306 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:12,374 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:12,375 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:12,375 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:12,376 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:12,377 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:12,378 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:12,378 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:12,379 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:12,379 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:12,379 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:12,380 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:12,380 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:12,381 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:12,381 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:12,382 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:12,382 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:12,384 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:12,385 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:12,386 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:12,386 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:12,387 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:12,387 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:12,388 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:12,388 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:12,390 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:12,390 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:12,391 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:12,391 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:12,392 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:12,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:12,443 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:12,498 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:12,500 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:12,501 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:12,502 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:12,503 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:12,506 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:12,506 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:12,507 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:12,515 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:12,578 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:12,579 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:12,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:12,582 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:12,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:12,583 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:12,584 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:12,585 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:12,586 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:12,587 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:12,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:12,646 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-12 11:02:12,648 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:12,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:12,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:12,724 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:12,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:12,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:12,727 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:12,727 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:12,728 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:12,729 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:12,730 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:12,730 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:12,731 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:12,731 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:12,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:12,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:12,733 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:12,733 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:12,734 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:12,735 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:12,736 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:12,737 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:12,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:12,738 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:12,739 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:12,740 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:12,740 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:12,741 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:12,741 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:12,742 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:12,742 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:12,743 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:12,804 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:12,876 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:13,013 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:13,013 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:13,014 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:13,024 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:13,130 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:13,190 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:13,267 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:13,272 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:13,273 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:13,294 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:13,300 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:13,367 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:13,387 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:13,392 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:13,413 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:13,415 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:13,477 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:13,495 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.95s
2025-10-12 11:02:13,777 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:13,780 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:13,781 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:13,783 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:13,785 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:13,788 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:13,789 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:13,791 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:13,792 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:13,793 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:13,795 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:13,796 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:13,797 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:13,806 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:13,845 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:13,848 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:13,849 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:13,850 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:13,851 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:13,851 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:13,852 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:13,928 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:14,353 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:14,354 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:14,355 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:14,355 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:14,356 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:14,356 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:14,357 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:14,357 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:14,360 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:14,360 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:14,361 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:14,361 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:14,364 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:14,364 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:14,365 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:14,365 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:14,368 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:14,474 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:14,476 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:14,477 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:14,698 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:14,699 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:14,700 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:14,700 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:14,706 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:14,707 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:14,707 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:14,708 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:14,708 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:14,709 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:14,709 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:14,709 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:14,710 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:14,710 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:14,711 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:14,711 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:14,789 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:14,877 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:14,879 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:14,882 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:14,883 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:14,884 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:14,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:14,886 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:14,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:14,888 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:14,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:14,889 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:14,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:14,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:14,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:14,891 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:14,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:14,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:14,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:14,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:14,894 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:14,894 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:14,895 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:14,895 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:14,896 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:14,897 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:14,897 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:14,898 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:14,901 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:14,902 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:14,976 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:14,977 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:14,979 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:14,979 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:14,981 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:15,117 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:15,189 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:15,224 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:15,318 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:15,322 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:15,323 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:15,323 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:15,324 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:15,353 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:15,420 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:15,505 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:15,508 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:15,509 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:15,511 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:15,512 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:15,515 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:15,519 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:15,530 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:15,605 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:15,679 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:15,927 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:16,004 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:16,050 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:16,130 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:16,132 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:02:16,223 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:16,229 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:16,235 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:16,237 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:16,238 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:02:16,238 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:16,239 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:16,242 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:16,249 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:16,250 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:16,252 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:02:16,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:16,385 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:16,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:16,488 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:16,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:16,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:16,721 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:16,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:16,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:16,886 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:16,895 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:16,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:16,975 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:16,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:17,100 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:17,119 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:17,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:17,192 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:17,194 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:17,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:17,267 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:17,274 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:17,355 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:17,422 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:17,424 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:17,427 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:17,427 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:17,431 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:17,438 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:17,440 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:17,445 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:17,507 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:17,513 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:17,513 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:17,514 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:17,514 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:17,515 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:17,516 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:17,517 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:17,517 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:17,518 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:17,519 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:17,519 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:17,520 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:17,520 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:17,521 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:17,522 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:17,523 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:17,524 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:17,529 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:17,542 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:17,565 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:17,572 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:17,576 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:17,578 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:17,579 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:17,579 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:17,580 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:17,580 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:17,582 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:17,583 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:17,583 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:17,584 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:17,585 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:17,585 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:17,586 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:17,587 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:17,587 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:17,588 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:17,589 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:17,592 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:17,595 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.80s
2025-10-12 11:02:17,665 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:17,892 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:17,893 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:17,894 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:17,895 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:17,897 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:18,578 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:18,579 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:18,580 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:18,582 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:18,583 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:18,585 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:18,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:18,586 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:18,628 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:18,924 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:18,924 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:18,925 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:18,926 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:18,926 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:18,927 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:18,927 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:18,928 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:19,429 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:19,431 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:19,431 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:19,432 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:19,432 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:19,434 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:19,435 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:19,437 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:19,440 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:19,441 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:19,441 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:19,441 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:19,445 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:19,446 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:19,446 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:19,447 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:19,450 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:19,450 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:19,451 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:19,451 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:19,454 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:19,455 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:19,455 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:19,455 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:19,458 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:19,459 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:19,460 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:19,460 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:19,461 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:19,461 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:19,461 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:19,462 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:19,462 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:19,462 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:19,512 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:19,513 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:19,516 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:19,516 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:19,517 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:19,518 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:19,518 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:19,519 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:19,519 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:19,519 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:19,520 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:19,520 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:19,521 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:19,521 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:19,521 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:19,522 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:19,522 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:19,523 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:19,523 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:19,524 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:19,524 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:19,525 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:19,525 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:19,595 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:19,603 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:19,604 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:19,604 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:19,606 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:19,607 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:19,610 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:19,611 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:19,611 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:19,612 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:19,621 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:19,667 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:19,668 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:19,669 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:02:19,670 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:19,671 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:19,671 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:19,672 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:19,672 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:19,673 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:19,673 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:19,674 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:19,675 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:19,676 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:19,676 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:19,677 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:19,677 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:19,678 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:19,679 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:19,679 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:19,680 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:19,680 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:19,680 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:19,681 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:19,681 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:19,682 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:19,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:19,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:19,735 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:19,736 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:19,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:19,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:19,818 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:19,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:19,843 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:19,896 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:19,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:19,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:20,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:20,053 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:20,068 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:20,071 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:20,071 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:20,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:20,074 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:20,082 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:20,149 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:20,231 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:20,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:20,237 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:20,239 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:20,241 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:20,242 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:20,316 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:20,319 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:20,321 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:20,330 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:20,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:20,420 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:20,428 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:20,564 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:20,577 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:20,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:20,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:20,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:20,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:20,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:20,643 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:20,644 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:20,645 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:20,646 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:20,647 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:20,648 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:20,648 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:20,649 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:20,650 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:20,651 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:20,653 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:20,702 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:20,704 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:20,704 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:20,705 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:20,705 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:20,705 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:20,709 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:20,712 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:20,715 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:20,718 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:20,720 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:20,721 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:20,721 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:02:20,723 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:20,725 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:20,726 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:20,727 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:20,728 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:20,780 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:20,847 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:20,848 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:20,962 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:20,982 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:20,994 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.41s
2025-10-12 11:02:21,187 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:21,188 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:21,189 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:21,190 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:21,192 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:21,705 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:21,706 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:21,707 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:21,709 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:21,710 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:21,712 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:21,712 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:21,713 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:21,771 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:21,772 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:21,772 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:21,773 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:21,773 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:21,774 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:21,775 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:21,775 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:21,914 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:22,331 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:22,333 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:22,333 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:22,334 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:22,334 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:22,335 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:22,335 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:22,336 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:22,339 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:22,388 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:22,390 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:22,391 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:22,395 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:22,396 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:22,396 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:22,397 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:22,399 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:22,399 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:22,400 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:22,400 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:22,724 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:22,741 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:22,743 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:22,743 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:22,744 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:22,744 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:22,745 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:22,749 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:22,750 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:22,783 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:22,785 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-12 11:02:22,786 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:22,787 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:22,788 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:22,788 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:22,789 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:22,789 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:22,789 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:22,790 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:22,790 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:22,792 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:22,792 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:22,798 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:22,798 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:22,799 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:22,799 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:22,800 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:22,801 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:22,801 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:22,802 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:22,802 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:22,802 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:22,803 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:22,803 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:22,803 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:22,804 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:22,804 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:22,804 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:22,805 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:22,805 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:22,806 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:22,807 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:22,807 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:22,812 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:22,866 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:22,868 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:22,931 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:22,944 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:23,006 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:23,023 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:23,071 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:23,181 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:23,240 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:23,290 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:23,294 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:23,383 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:23,390 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:23,518 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:23,526 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:23,604 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:23,606 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:23,607 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:23,608 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:23,610 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:23,679 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:23,693 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:23,697 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:23,698 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:23,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:23,765 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:23,771 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:23,774 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:23,778 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:23,780 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:23,784 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:23,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:23,849 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:23,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:23,909 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:23,911 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:23,913 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:24,081 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:24,083 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:24,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:24,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:24,237 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:24,244 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:24,245 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:24,327 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:24,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:24,334 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:24,397 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:24,415 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:24,416 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:24,417 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:24,417 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:24,419 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:24,421 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:24,421 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:24,425 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:24,425 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:24,486 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:24,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:24,488 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:24,488 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:24,489 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:24,489 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:24,490 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:24,490 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:24,490 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:24,491 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:24,491 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:24,491 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:24,492 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:24,492 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:24,492 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:24,493 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:24,493 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:24,493 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:24,494 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:24,494 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:24,568 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:24,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:24,578 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:24,579 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:24,581 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:24,582 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:24,583 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:24,641 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:24,645 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:24,646 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:24,704 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:24,705 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:24,706 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:24,855 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:24,919 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:24,975 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:24,990 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:25,077 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:25,128 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:25,137 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:25,150 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:25,210 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:25,237 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:25,240 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:25,303 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:25,307 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:25,321 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:25,328 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.62s
2025-10-12 11:02:25,587 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:25,588 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:25,602 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:25,604 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:25,610 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:25,651 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:25,712 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:25,714 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:25,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:25,727 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:25,731 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:25,796 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:25,798 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-12 11:02:25,806 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:25,807 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:25,858 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:25,859 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:25,860 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:25,861 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:25,862 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:25,862 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:25,928 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:26,364 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:26,365 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:26,366 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:26,366 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:26,367 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:26,367 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:26,367 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:26,368 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:26,371 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:26,374 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:26,375 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:26,376 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:26,379 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:26,379 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:26,380 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:26,380 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:26,384 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:26,384 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:26,385 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:26,385 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:26,388 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:26,388 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:26,388 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:26,389 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:26,391 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:26,392 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:26,392 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:26,393 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:26,393 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:26,394 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:26,394 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:26,394 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:26,395 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:26,395 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:26,396 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:26,396 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:26,400 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:26,401 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:26,401 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:26,401 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:26,404 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:26,406 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:26,406 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:26,442 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:26,443 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:26,444 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:26,459 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:26,491 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:26,492 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:26,494 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:26,502 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:26,542 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:26,545 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:26,547 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:26,548 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:26,549 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:26,549 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:26,550 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:26,550 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:26,551 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:26,551 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:26,552 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:26,552 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:26,553 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:26,554 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:26,555 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:26,555 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:26,556 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:26,556 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:26,556 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:26,557 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:26,557 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:26,558 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:26,561 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:26,562 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:26,563 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:26,564 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:26,565 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:26,566 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:26,566 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:26,567 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:26,567 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:26,568 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:26,568 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:26,569 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:26,570 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:26,571 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:26,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:26,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:26,573 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:26,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:26,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:26,575 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:26,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:26,576 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:26,579 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:26,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:26,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:26,582 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:26,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:26,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:26,648 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:26,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:26,704 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:26,704 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:26,706 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:26,707 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:26,708 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:26,708 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:26,709 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:26,709 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:26,710 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:26,710 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:26,711 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:26,711 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:26,713 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:26,713 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:26,713 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:26,714 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:26,714 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:26,771 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:26,773 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:26,775 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:26,776 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:26,777 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:26,779 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:26,779 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:26,783 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:26,784 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:26,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:26,785 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:26,785 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:26,785 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:26,787 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:26,788 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:26,789 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:26,834 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:26,836 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:26,837 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:02:26,837 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:26,839 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:26,846 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:26,847 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:26,848 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:26,849 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:26,849 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:26,849 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:26,855 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:26,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:26,912 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:26,913 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:26,913 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:26,914 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:26,987 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:27,086 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:27,239 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:27,255 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:27,338 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:27,360 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:27,422 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:27,443 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:27,713 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.00s
2025-10-12 11:02:27,920 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:27,972 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:27,976 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:27,979 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:27,985 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:27,991 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:27,992 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:27,993 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:27,995 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:28,006 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:28,008 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:28,009 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:28,010 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:02:28,068 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:28,094 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:28,148 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:28,166 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:28,255 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:28,307 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:28,369 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:28,382 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:28,450 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:28,956 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:28,958 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:28,959 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:28,959 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:28,960 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:28,960 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:28,961 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:28,961 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:28,964 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:28,967 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:28,967 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:28,968 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:28,977 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:29,004 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:29,005 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:29,005 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:29,006 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:29,009 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:29,011 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:29,011 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:29,012 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:29,013 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:29,014 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:29,014 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:29,015 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:29,015 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:29,018 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:29,019 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:29,020 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:29,020 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:29,023 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:29,023 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:29,024 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:29,024 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:29,025 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:29,025 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:29,026 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:29,026 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:29,027 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:29,027 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:29,089 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:29,095 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:29,101 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:29,105 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:29,106 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:29,116 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:29,143 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:29,144 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:29,145 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:29,208 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:29,233 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:29,351 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:29,380 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:29,432 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:29,509 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:29,561 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:29,620 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:29,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:29,632 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:29,637 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:29,638 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:29,641 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:29,645 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:29,648 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:29,708 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:29,710 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:29,712 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:29,713 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:29,834 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:29,894 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:29,896 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:29,897 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:29,898 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:29,900 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:29,900 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:29,902 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:29,961 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:30,052 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:30,055 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:30,126 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:30,128 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:30,191 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:30,197 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:30,200 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:30,201 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:30,204 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:30,213 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:30,308 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:30,308 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:30,309 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:30,312 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:30,316 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:30,317 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:30,317 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:30,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:30,319 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:30,320 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:30,321 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:30,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:30,324 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:30,380 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:30,380 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:30,381 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:30,383 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:30,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:30,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:30,385 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:30,386 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:30,387 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:02:30,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:30,388 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:30,388 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:30,390 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:30,391 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:30,392 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:30,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:30,394 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:30,394 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:30,395 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:30,396 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:30,396 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:30,397 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:30,451 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:30,452 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:30,518 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:30,602 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:30,680 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:30,768 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:30,842 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:30,853 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:30,855 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:30,856 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:30,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:30,988 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:31,001 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:31,059 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:31,066 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:31,068 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:31,070 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:31,071 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:31,073 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:31,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:31,076 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:31,078 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:31,080 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:31,082 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:31,085 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:31,102 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:31,146 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:31,158 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:31,168 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:31,233 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:31,242 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:31,243 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:31,245 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:31,294 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:31,307 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:31,318 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:31,321 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:31,424 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:31,425 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:31,425 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:31,427 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:31,428 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:31,428 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:31,429 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:31,429 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:31,430 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:31,432 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.44s
2025-10-12 11:02:31,510 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:31,512 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:31,513 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:31,515 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:31,518 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:31,519 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:31,521 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:31,522 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:02:31,523 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:31,526 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:31,586 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:31,603 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:31,604 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:31,606 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:31,606 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:31,608 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:31,656 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:02:31,669 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:32,031 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:32,032 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:32,033 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:32,033 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:32,034 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:32,034 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:32,035 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:32,035 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:32,537 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:32,538 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:32,539 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:32,539 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:32,540 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:32,540 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:32,541 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:32,541 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:32,544 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:32,544 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:32,545 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:32,545 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:32,549 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:32,550 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:32,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:32,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:32,554 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:32,555 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:32,555 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:32,556 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:32,558 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:32,561 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:32,562 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:32,563 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:32,570 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:32,597 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:32,597 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:32,598 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:32,599 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:32,631 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:32,633 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:32,633 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:32,635 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:32,636 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:32,638 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:32,638 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:32,639 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:32,641 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:32,642 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:32,643 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:32,644 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:32,648 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:32,649 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:32,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:32,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:32,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:32,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:32,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:32,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:32,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:32,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:32,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:32,661 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:32,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:32,662 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:32,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:32,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:32,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:32,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:32,664 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:32,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:32,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:32,668 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:32,724 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:32,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:32,725 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:32,726 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:32,727 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:32,728 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:32,728 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:32,728 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:32,729 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:32,730 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:32,730 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:32,730 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:32,731 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:32,731 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:32,732 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:32,732 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:32,733 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:32,733 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:32,733 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:32,734 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:32,734 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:32,737 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:32,737 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:32,738 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:32,738 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:32,739 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:32,739 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:32,739 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:32,752 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:32,808 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:32,830 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:32,907 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:33,020 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:33,023 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:33,024 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:33,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:33,115 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:33,174 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:33,184 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:33,193 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:33,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:33,212 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:33,268 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:33,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:33,272 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:33,279 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:33,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:33,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:33,361 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:33,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:33,388 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:33,443 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:33,453 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:33,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:33,473 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:33,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:33,483 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:33,490 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:33,541 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:33,542 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:33,600 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:33,602 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:33,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:33,607 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:33,607 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:33,608 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:33,608 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:33,609 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:33,610 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:33,611 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:33,612 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:33,613 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:33,613 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:33,614 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:33,615 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:33,616 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:33,616 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:33,617 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:33,617 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:33,618 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:33,619 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:33,621 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:33,625 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:33,627 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:33,627 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:33,629 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:33,633 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:33,636 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:33,678 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:33,679 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:33,679 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:33,680 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:33,683 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:33,683 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:33,684 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:33,684 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:33,690 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:33,691 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:33,691 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:33,691 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:33,692 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:33,693 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:33,694 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:33,695 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:33,696 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.17s
2025-10-12 11:02:33,707 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:33,871 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:33,874 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:33,874 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:33,877 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:33,881 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:34,681 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:34,682 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:34,683 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:34,687 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:34,690 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:34,692 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:34,692 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:34,693 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:34,706 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:34,707 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:34,708 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:34,708 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:34,709 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:34,710 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:34,710 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:34,711 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:34,769 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:35,212 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:35,213 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:35,214 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:35,214 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:35,215 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:35,215 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:35,216 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:35,219 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:35,222 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:35,223 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:35,223 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:35,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:35,228 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:35,228 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:35,229 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:35,230 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:35,232 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:35,233 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:35,233 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:35,234 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:35,238 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:35,239 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:35,239 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:35,239 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:35,242 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:35,242 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:35,243 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:35,243 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:35,244 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:35,244 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:35,245 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:35,245 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:35,246 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:35,246 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:35,247 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:35,247 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:35,255 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:35,258 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:35,304 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:35,307 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:35,308 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:35,309 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:35,310 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:35,379 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:35,380 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:35,380 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:35,381 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:35,381 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:35,383 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:35,384 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:35,384 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:35,384 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:35,385 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:35,385 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:35,386 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:35,387 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:35,387 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:35,388 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:35,390 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:35,390 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:35,391 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:35,391 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:35,392 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:35,392 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:35,393 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:35,394 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:35,395 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:35,395 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:35,397 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:35,397 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:35,398 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:35,398 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:35,399 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:35,451 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:35,452 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:35,452 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:35,453 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:35,454 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:35,454 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:35,455 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:35,456 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:35,456 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,456 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:35,457 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:35,457 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:35,458 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,458 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:35,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:35,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:35,460 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:35,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:35,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:35,462 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:35,462 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:35,463 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:35,463 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:35,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:35,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:35,465 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:35,465 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:35,466 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:35,535 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:35,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:35,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:35,538 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:35,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:35,539 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:35,541 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:35,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:35,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:35,543 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:35,543 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,544 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:35,544 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:35,544 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:35,545 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:35,545 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:35,547 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:35,548 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:35,548 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:35,549 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:35,549 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:35,550 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:35,551 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:35,551 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:35,552 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:35,552 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:35,553 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:35,610 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:35,610 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,611 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:35,611 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:35,612 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:35,612 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:35,612 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:35,665 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:35,669 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:35,676 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:35,709 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,709 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:35,710 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:35,714 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:35,719 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:35,724 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:35,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:35,725 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:35,726 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:35,726 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:35,728 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:35,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,731 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:35,786 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:02:35,787 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:35,788 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,788 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:35,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:35,790 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:35,790 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:35,800 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:35,865 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:36,166 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:36,242 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.56s
2025-10-12 11:02:36,246 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:36,247 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:36,253 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:36,256 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:36,260 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:36,725 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:36,725 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:36,727 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:36,729 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:36,730 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:36,731 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:36,732 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:36,733 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:36,746 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:36,747 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:36,793 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:36,795 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:36,796 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:36,798 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:36,801 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:36,801 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:36,803 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:37,303 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:37,304 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:37,305 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:37,305 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:37,306 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:37,307 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:37,307 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:37,307 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:37,311 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:37,314 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:37,315 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:37,316 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:37,320 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:37,321 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:37,321 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:37,322 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:37,324 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:37,324 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:37,325 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:37,325 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:37,327 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:37,327 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:37,328 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:37,329 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:37,332 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:37,333 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:37,333 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:37,334 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:37,334 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:37,335 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:37,335 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:37,336 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:37,336 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:37,337 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:37,338 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:37,338 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:37,343 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:37,344 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:37,344 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:37,345 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:37,345 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:37,357 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:37,383 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:37,384 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:37,386 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:37,386 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:37,387 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:37,388 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:37,389 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:37,390 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:37,390 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:37,391 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:37,391 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:37,392 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:37,393 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:37,394 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:37,394 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:37,395 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:37,396 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:37,397 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:37,398 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:37,398 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:37,399 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:37,399 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:37,400 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:37,400 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:37,401 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:37,401 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:37,403 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:37,404 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:37,406 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:37,406 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:37,407 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:37,411 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:37,412 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:37,412 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:37,413 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:37,413 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:37,413 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:37,414 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:37,414 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:37,415 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,415 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:37,416 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:37,417 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:37,417 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,418 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:37,419 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:37,420 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:37,421 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:37,422 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:37,477 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:37,481 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:37,481 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:37,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:37,483 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:37,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:37,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:37,485 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:37,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:37,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:37,488 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:37,488 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:37,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:37,490 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:37,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:37,491 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:37,492 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:37,492 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:37,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:37,495 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:37,495 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,496 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:37,496 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:37,497 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:37,497 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:37,497 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:37,508 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:37,508 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:37,509 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:37,509 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:37,510 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:37,510 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:37,511 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:37,511 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:37,512 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:37,516 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:37,579 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:37,580 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:37,582 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,582 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:37,583 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:37,583 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:37,584 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:37,584 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:37,585 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:37,586 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:37,588 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,589 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:37,589 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:37,589 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:37,590 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:37,607 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:37,651 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:37,653 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,658 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:37,660 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:37,661 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,662 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:37,662 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:37,663 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:37,663 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:37,664 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:37,668 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:37,671 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-12 11:02:37,729 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:37,731 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:37,732 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:37,735 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:37,738 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:37,744 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:37,745 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:37,747 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:37,798 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:37,798 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:37,800 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:37,800 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:37,801 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:37,810 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:37,907 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:37,907 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:37,921 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:38,184 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:38,289 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:38,518 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:38,534 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:38,548 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:38,877 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:39,203 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:39,204 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:39,206 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:39,206 - APP.services.gemini_service - INFO - Lần thử 1: Kết nối stream tới Gemini API thành công.
2025-10-12 11:02:39,207 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:39,208 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:39,209 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:39,210 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:39,211 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:39,211 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:39,212 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:39,213 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.33s
2025-10-12 11:02:39,213 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:39,215 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:39,218 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:39,218 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:39,222 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:39,259 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:39,264 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:39,265 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:39,265 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:39,266 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:39,269 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:39,269 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:39,269 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:39,270 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:39,272 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:39,273 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:39,273 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:39,273 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:39,276 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:39,277 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:39,278 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:39,278 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:39,279 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:39,330 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:39,333 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:39,346 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:39,354 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:39,356 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:39,416 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:39,503 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:39,582 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:39,590 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:39,590 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:39,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:39,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:39,597 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:39,599 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:39,599 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:39,600 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:39,600 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:39,600 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:39,601 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:39,603 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:39,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:39,629 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:39,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:39,649 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:39,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:39,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:39,660 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:39,660 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:39,662 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:39,663 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:39,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:39,742 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:39,743 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:39,754 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:39,778 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:39,836 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:39,848 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:39,860 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:39,862 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:39,865 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:39,867 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:39,869 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:39,871 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:39,875 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:39,932 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:39,936 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:39,940 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:39,946 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:39,948 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:39,949 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:39,951 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:39,954 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:39,955 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:39,956 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:39,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:39,960 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:39,962 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:39,962 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:39,966 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,014 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:40,060 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:40,063 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:40,065 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:40,067 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:40,068 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:40,068 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:40,069 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:40,069 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:40,070 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:40,070 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:40,070 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:40,073 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:40,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:40,075 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:40,076 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:40,077 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:40,078 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:40,079 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:40,080 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:40,080 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:40,081 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,081 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:40,082 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:40,084 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:40,085 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:40,086 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,086 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:40,087 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:40,087 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:40,088 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:40,088 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:40,089 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:40,090 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:40,091 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:40,092 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:40,095 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:40,097 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:40,098 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:40,099 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:40,100 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:40,101 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:40,101 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:40,102 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:40,103 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:40,103 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:40,104 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,104 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:40,105 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:40,151 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:40,153 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:40,157 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:40,159 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-12 11:02:40,160 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:40,163 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:40,164 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:40,164 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:40,166 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:40,167 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,168 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:40,168 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:40,169 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:40,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:40,174 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:40,175 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:40,175 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:40,177 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,178 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:40,178 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,179 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:40,179 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:40,179 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:40,180 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:40,180 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:40,181 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:40,184 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.44s
2025-10-12 11:02:40,189 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,395 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,397 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:40,397 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:40,398 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:40,401 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:40,451 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,463 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,827 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:40,942 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:41,092 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:41,095 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:41,097 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:41,099 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:41,100 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:41,101 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:41,101 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:41,102 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:41,113 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:41,114 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:41,115 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:41,115 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:41,116 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:41,116 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:41,117 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:41,117 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:41,169 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:41,357 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:41,619 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:41,620 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:41,621 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:41,622 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:41,622 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:41,622 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:41,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:41,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:41,630 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:41,631 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:41,631 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:41,632 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:41,635 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:41,636 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:41,636 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:41,637 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:41,642 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:41,642 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:41,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:41,643 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:41,646 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:41,646 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:41,646 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:41,647 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:41,650 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:41,650 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:41,651 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:41,651 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:41,652 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:41,652 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:41,653 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:41,653 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:41,653 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:41,653 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:41,655 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:41,659 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:41,701 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:41,701 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:41,702 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:41,703 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:41,704 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:41,704 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:41,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:41,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:41,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:41,706 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:41,706 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:41,708 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:41,708 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:41,709 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:41,709 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:41,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:41,710 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:41,711 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:41,711 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:41,712 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:41,712 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:41,713 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:41,714 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:41,714 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:41,715 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:41,716 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:41,717 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:41,786 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:41,787 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:41,788 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:41,788 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:41,789 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:41,789 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:41,790 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:41,791 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:41,791 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:41,792 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:41,792 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:41,797 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:41,798 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:41,838 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:41,841 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:41,847 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:41,847 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:41,848 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:41,849 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:41,850 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:41,850 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:41,897 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:41,901 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:41,903 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:41,909 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:41,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:41,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:41,912 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:41,913 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:41,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:41,914 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:41,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:41,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:41,917 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:41,918 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:41,919 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:41,920 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:41,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:42,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:42,016 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:42,017 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:42,018 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:42,019 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:42,019 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:42,020 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:42,021 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:42,023 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:42,024 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:42,025 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:42,025 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:42,026 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:42,026 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:42,026 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:42,026 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:42,027 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:42,027 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:42,027 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:42,028 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:42,028 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:42,029 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:42,114 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:42,114 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:42,115 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:42,116 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:42,116 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:42,117 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:42,118 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:42,118 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:42,118 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:42,119 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:42,121 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:42,121 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:42,122 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:42,122 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:42,125 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:42,195 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:42,199 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:42,244 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:42,244 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:42,245 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:42,246 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.13s
2025-10-12 11:02:42,247 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:42,315 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:42,320 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:42,321 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:42,322 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:42,322 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:42,440 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:42,517 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:42,563 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:42,630 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:42,640 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:42,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:42,834 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:42,911 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:42,912 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:42,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:42,913 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:42,913 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:42,914 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:42,914 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:42,915 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:42,917 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.82s
2025-10-12 11:02:42,990 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:43,056 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:43,060 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:43,060 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:43,066 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:43,069 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:43,300 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:43,301 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:43,302 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:43,304 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:43,304 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:43,305 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:43,306 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:43,307 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:43,307 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:43,367 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:43,444 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:43,660 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:43,931 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:44,086 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:44,087 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:44,088 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:44,088 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:44,089 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:44,090 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:44,091 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:44,091 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:44,149 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:44,320 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:44,420 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:44,599 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:44,601 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:44,602 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:44,603 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:44,603 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:44,604 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:44,605 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:44,606 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:44,606 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:44,607 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:44,607 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.18s
2025-10-12 11:02:44,608 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:44,609 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:44,611 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:44,611 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:44,611 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:44,612 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:44,615 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:44,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:44,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:44,618 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:44,620 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:44,620 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:44,621 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:44,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:44,743 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:44,755 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:44,761 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:44,798 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:44,824 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:44,837 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:44,848 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:44,911 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:44,925 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:44,929 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:44,929 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:44,983 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:44,985 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:44,986 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:44,986 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:44,987 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:44,988 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:44,990 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:44,994 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:44,997 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:44,998 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:44,999 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:45,017 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:45,019 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:45,020 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:45,021 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:45,024 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:45,094 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:45,096 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:45,105 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:45,106 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:45,107 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:45,108 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:45,109 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:45,113 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:45,114 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:45,115 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:45,116 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:45,117 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:45,119 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:45,119 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:45,120 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:45,120 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:45,121 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:45,122 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:45,122 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:45,123 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:45,123 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:45,131 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:45,182 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:45,183 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:45,183 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:45,184 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:45,185 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:45,185 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:45,186 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:45,232 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:45,234 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:45,235 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:45,270 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:45,270 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:45,271 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:45,273 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:45,274 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:45,275 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,275 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:45,276 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:45,276 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:45,277 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,278 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:45,278 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:45,279 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:45,280 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:45,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:45,285 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:45,285 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:45,286 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:45,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:45,288 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:45,288 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:45,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:45,289 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:45,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:45,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:45,292 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:45,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:45,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:45,295 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:45,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:45,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:45,298 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:45,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:45,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:45,300 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:45,301 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,302 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:45,302 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:45,303 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:45,303 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:45,305 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:45,305 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:45,305 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:45,306 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:45,307 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:45,307 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:45,307 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:45,308 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:45,308 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:45,309 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:45,309 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:45,310 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:45,311 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:45,323 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,371 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:45,379 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:45,380 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:45,381 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:45,381 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:45,382 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:45,383 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:45,385 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,386 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:45,387 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:45,387 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:45,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:45,392 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:45,393 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:45,395 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:45,396 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,397 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:45,398 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,399 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:45,399 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:45,400 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:45,400 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:45,400 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:45,401 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:45,402 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.10s
2025-10-12 11:02:45,473 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:45,572 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:45,670 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:45,786 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:45,790 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:45,791 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:45,793 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:45,798 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:45,804 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:45,947 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:46,058 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:46,169 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:46,288 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:46,289 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:46,291 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:46,292 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:46,293 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:46,294 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:46,295 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:46,296 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:46,544 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:46,724 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:46,830 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:46,968 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:47,117 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:47,264 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:47,430 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:47,430 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:02:47,432 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:02:47,433 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:47,435 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:47,439 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:47,449 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:47,498 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:47,559 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.13s
2025-10-12 11:02:47,806 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:02:47,807 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:47,927 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:48,121 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:48,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:48,487 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:48,612 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:48,746 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:48,913 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:48,915 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:48,916 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:48,917 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:48,918 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:48,918 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:49,195 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:49,386 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:49,672 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:49,909 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:50,256 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:50,461 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:50,592 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:50,745 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:50,852 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:50,854 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:50,855 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:50,856 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:50,857 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:50,866 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:50,873 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:50,924 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:50,936 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-12 11:02:51,017 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:51,095 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:51,158 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:51,245 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:51,252 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:51,624 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:51,766 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:51,815 - APP.services.gemini_service - DEBUG - Stream từ Gemini API hoàn tất.
2025-10-12 11:02:51,852 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:51,861 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 5: Thực thi hoặc quản lý giao dịch.
2025-10-12 11:02:51,863 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:51,863 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:51,865 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:51,866 - APP.core.analysis_worker - INFO - Không có lệnh. Tìm kiếm cơ hội vào lệnh mới.
2025-10-12 11:02:51,867 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:51,885 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-12 11:02:51,886 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:51,887 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:51,891 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:51,894 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots
2025-10-12 11:02:51,897 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:51,903 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 4 tên file.
2025-10-12 11:02:51,957 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:51,960 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_H1.png
2025-10-12 11:02:51,964 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:51,965 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'H1' cho 'XAUUSD_H1.png' bằng pattern đã biên dịch.
2025-10-12 11:02:52,044 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:52,048 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M1.png
2025-10-12 11:02:52,113 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:52,116 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M1' cho 'XAUUSD_M1.png' bằng pattern đã biên dịch.
2025-10-12 11:02:52,117 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:52,118 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M15.png
2025-10-12 11:02:52,118 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:52,119 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M15' cho 'XAUUSD_M15.png' bằng pattern đã biên dịch.
2025-10-12 11:02:52,121 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:52,123 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M5.png
2025-10-12 11:02:52,127 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:52,129 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M5' cho 'XAUUSD_M5.png' bằng pattern đã biên dịch.
2025-10-12 11:02:52,129 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:52,130 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {'XAUUSD_H1.png': 'H1', 'XAUUSD_M1.png': 'M1', 'XAUUSD_M15.png': 'M15', 'XAUUSD_M5.png': 'M5'}
2025-10-12 11:02:52,168 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:52,169 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:52,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:52,178 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-12 11:02:52,196 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:52,243 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251012_110252.md
2025-10-12 11:02:52,240 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-12 11:02:52,252 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:52,280 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-12 11:02:52,321 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-12 11:02:52,324 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:52,385 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:52,385 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-12 11:02:52,386 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-12 11:02:52,386 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:52,389 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251012_110252.md
2025-10-12 11:02:52,390 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-12 11:02:52,396 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:52,396 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-12 11:02:52,398 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 8 khóa.
2025-10-12 11:02:52,398 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:52,402 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251012_103531.md
2025-10-12 11:02:52,402 - APP.persistence.json_handler - DEBUG - Đã thêm 8 khối JSON vào data_to_save.
2025-10-12 11:02:52,403 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:52,405 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-12 11:02:52,405 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-12 11:02:52,406 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:52,453 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-12 11:02:52,455 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-12 11:02:52,458 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-12 11:02:52,459 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-12 11:02:52,459 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:52,460 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-12 11:02:52,461 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:52,461 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-12 11:02:52,462 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:52,462 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-12 11:02:52,463 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:52,464 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:52,465 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:52,466 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 8 khóa.
2025-10-12 11:02:52,467 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:52,468 - APP.analysis.report_parser - INFO - Trích xuất cài đặt thành công từ khối JSON.
2025-10-12 11:02:52,468 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:52,468 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': 'short', 'entry': 4011.0, 'sl': 4022.0, 'tp1': 4000.0, 'tp2': 3950.0, 'risk_multiplier': 0.5}
2025-10-12 11:02:52,474 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:52,476 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251012_110252.json
2025-10-12 11:02:52,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:52,478 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-12 11:02:52,479 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:52,481 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251012_103531.json
2025-10-12 11:02:52,482 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:52,483 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-12 11:02:52,484 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:52,485 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-12 11:02:52,486 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:52,486 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-12 11:02:52,486 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:52,487 - APP.analysis.report_parser - DEBUG - Bắt đầu sửa chuỗi JSON.
2025-10-12 11:02:52,488 - APP.analysis.report_parser - DEBUG - Chuỗi JSON hợp lệ sau khi sửa.
2025-10-12 11:02:52,489 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:52,489 - APP.analysis.report_parser - INFO - Đã tìm thấy và chọn khối JSON tốt nhất với 8 khóa.
2025-10-12 11:02:52,492 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:52,492 - APP.analysis.report_parser - INFO - Trích xuất cài đặt thành công từ khối JSON.
2025-10-12 11:02:52,493 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:52,493 - APP.persistence.json_handler - DEBUG - Tìm thấy setup giao dịch, log cho backtesting.
2025-10-12 11:02:52,494 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:52,494 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: None, Thư mục con: None
2025-10-12 11:02:52,496 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:52,497 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:52,549 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:52,553 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:52,555 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:52,558 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:52,560 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:52,562 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:52,564 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:52,564 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:52,565 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:52,566 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:52,569 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:52,570 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:52,571 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:52,572 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:52,572 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:52,573 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:52,574 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:52,574 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:52,575 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:52,577 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:52,580 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:52,580 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:52,581 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:52,584 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:52,585 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:52,682 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:52,687 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:52,688 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251012.jsonl.
2025-10-12 11:02:52,688 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:52,689 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-12 11:02:52,690 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:52,691 - APP.persistence.json_handler - DEBUG - Đã log proposed trade.
2025-10-12 11:02:52,692 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:52,692 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:52,693 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-12 11:02:52,693 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:52,694 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-12 11:02:52,694 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,696 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-12 11:02:52,697 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:52,698 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-12 11:02:52,699 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:52,699 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251012-110138' (group=analysis.session) hoàn tất sau 73.93s
2025-10-12 11:02:52,700 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:52,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,701 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:52,702 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:52,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:52,703 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:52,705 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:52,707 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:52,708 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:52,708 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:52,709 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:52,710 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:52,710 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:52,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:52,713 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:52,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:52,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:52,718 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:52,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:52,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:52,719 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:52,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:52,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:52,721 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:52,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:52,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:52,772 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:52,773 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,777 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:52,777 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:52,778 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:52,778 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:52,779 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:52,780 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:52,780 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:52,781 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:52,782 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:52,783 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:52,783 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:52,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:52,784 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:52,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:52,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:52,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:52,786 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:52,787 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,788 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:52,790 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:52,791 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:52,791 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:52,792 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:52,792 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:52,794 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:52,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:52,797 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,798 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:52,799 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:52,799 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:52,803 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:52,804 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:52,805 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:52,805 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:52,806 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,806 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:52,807 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,807 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:52,810 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:52,811 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:52,811 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:52,812 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:52,815 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:52,863 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 6.57s
2025-10-12 11:02:52,978 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,089 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,210 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,211 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,211 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,212 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:53,213 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:53,214 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:53,216 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:53,218 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:53,219 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:53,220 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:53,221 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:53,506 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,574 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:53,574 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:53,575 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:53,576 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:53,576 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:53,577 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:53,577 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:53,578 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:53,644 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,747 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,847 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,849 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: refresh_all_lists
2025-10-12 11:02:53,849 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-12 11:02:53,850 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-12 11:02:53,852 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-12 11:02:53,853 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-12 11:02:53,853 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-12 11:02:53,854 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-12 11:02:53,855 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-12 11:02:53,856 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-12 11:02:53,856 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-12 11:02:53,857 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,858 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-12 11:02:53,858 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-12 11:02:53,859 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-12 11:02:53,859 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,860 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251012-110138: {'status': 'completed', 'early_exit': False}
2025-10-12 11:02:53,861 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:53,864 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:53,865 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:53,868 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:53,871 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:53,873 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:54,019 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 Báo cáo.
2025-10-12 11:02:54,020 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 JSON.
2025-10-12 11:02:54,020 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 0.17s
2025-10-12 11:02:54,021 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 0.16s
2025-10-12 11:02:54,084 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:54,096 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:54,098 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:54,144 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:54,151 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:54,152 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:54,156 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:54,158 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:54,162 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:54,163 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:54,218 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:54,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:54,232 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:54,234 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:54,236 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:54,270 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:54,320 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:54,333 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:54,345 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:54,389 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:54,393 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:54,400 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:54,407 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:54,410 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:54,418 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:54,435 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:54,466 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:54,471 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:54,475 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:54,480 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:54,484 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:54,486 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:54,488 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:54,490 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:54,491 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:54,492 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:54,496 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:54,497 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:54,500 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:54,540 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:54,541 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:54,542 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:54,547 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:54,549 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:54,550 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:54,554 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:54,555 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:54,557 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:54,558 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:54,558 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:54,560 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:54,566 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:54,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:54,568 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:54,569 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:54,570 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:54,571 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:54,572 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:54,572 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:54,574 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:54,575 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:54,576 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:54,578 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:54,579 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:54,626 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:54,627 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:54,629 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:54,630 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:54,631 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:54,631 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:54,633 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:54,633 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:54,635 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:54,635 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:54,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:54,638 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:54,639 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:54,640 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:54,640 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:54,641 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:54,642 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:54,642 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:54,644 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:54,644 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:54,644 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:54,645 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:54,645 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:54,646 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:54,647 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:54,647 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,647 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:54,648 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:54,649 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:54,650 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,650 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:54,651 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:54,652 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:54,652 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:54,653 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:54,654 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:54,655 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:54,655 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:54,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:54,656 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:54,657 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:54,658 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:54,659 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:54,660 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:54,661 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:54,662 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:54,662 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:54,663 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:54,664 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:54,666 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:54,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:54,713 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:54,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:54,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:54,719 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:54,720 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,720 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:54,721 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:54,722 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:54,722 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:54,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:54,723 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:54,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:54,726 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:54,727 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:54,727 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:54,728 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:54,728 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:54,729 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:54,729 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:54,730 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:54,730 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:54,731 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:54,733 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,733 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:54,734 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:54,735 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:54,735 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:54,735 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:54,736 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:54,738 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:54,740 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:54,741 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:54,741 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,745 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:54,747 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:54,747 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:54,748 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:54,749 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:54,749 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,749 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:54,750 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:54,751 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,799 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:54,811 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:54,948 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:55,016 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:55,076 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:55,084 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:55,085 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.87s
2025-10-12 11:02:55,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:55,297 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:55,298 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:55,299 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:55,303 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:55,634 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:55,635 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:55,636 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:55,638 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:55,639 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:55,641 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:55,641 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:55,642 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:55,651 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:55,652 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:55,653 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:55,653 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:55,654 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:55,655 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:55,655 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:55,656 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:55,742 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:56,157 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:56,159 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:56,160 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:56,160 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:56,161 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:56,161 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:56,162 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:56,162 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:56,164 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:56,165 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:56,165 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:56,166 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:56,169 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:56,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:56,170 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:56,170 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:56,172 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:56,173 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:56,173 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:56,174 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:56,176 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:56,177 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:56,177 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:56,177 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:56,180 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:56,181 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:56,182 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:56,182 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:56,183 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:56,183 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:56,184 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:56,184 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:56,185 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:56,185 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:56,186 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:56,187 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:56,191 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:56,191 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:56,192 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:56,222 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:56,223 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:56,225 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:56,226 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:56,226 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:56,227 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:56,227 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:56,228 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:56,228 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:56,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:56,229 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:56,230 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:56,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:56,230 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:56,231 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:56,231 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:56,231 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:56,232 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:56,233 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:56,233 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:56,234 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:56,234 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:56,235 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:56,236 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:56,236 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:56,236 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:56,237 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:56,237 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:56,238 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:56,238 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:56,238 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:56,239 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:56,239 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:56,240 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:56,240 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:56,240 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:56,241 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:56,241 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:56,241 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:56,242 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:56,242 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:56,243 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:56,243 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,243 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:56,244 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:56,244 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:56,245 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,245 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:56,246 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:56,246 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:56,247 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:56,247 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:56,248 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:56,248 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:56,249 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:56,250 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:56,251 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:56,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:56,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:56,255 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:56,310 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:56,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:56,313 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:56,314 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:56,315 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:56,316 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:56,316 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:56,317 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:56,318 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:56,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:56,320 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:56,321 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:56,322 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,322 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:56,323 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:56,323 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:56,323 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:56,324 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:56,324 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:56,325 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:56,325 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:56,326 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:56,326 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:56,326 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:56,327 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:56,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:56,330 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:56,330 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:56,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:56,331 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:56,332 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,332 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:56,333 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:56,333 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:56,334 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:56,335 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:56,337 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:56,338 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:56,340 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:56,341 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,341 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:56,342 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:56,346 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:56,349 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:56,391 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:56,399 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:56,405 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,408 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:56,410 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,410 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:56,411 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:56,416 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:56,417 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:56,419 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:56,420 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:56,422 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.79s
2025-10-12 11:02:56,515 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:56,519 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:56,520 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:56,522 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:56,527 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:56,639 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:56,640 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:56,642 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:56,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:56,645 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:56,647 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:56,647 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:56,648 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:56,659 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:56,660 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:56,661 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:56,662 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:56,662 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:56,664 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:56,664 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:56,665 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:56,736 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:57,166 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:57,168 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:57,169 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:57,169 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:57,170 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:57,170 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:57,171 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:57,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:57,173 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:57,173 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:57,174 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:57,174 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:57,178 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:57,178 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:57,179 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:57,180 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:57,182 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:57,182 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:57,183 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:57,183 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:57,186 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:57,186 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:57,187 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:57,187 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:57,190 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:57,191 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:57,191 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:57,192 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:57,224 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:57,225 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:57,225 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:57,232 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:57,262 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:57,264 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:57,323 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:57,324 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:57,373 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:57,374 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:57,375 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:57,376 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:57,376 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:57,377 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:57,378 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:57,379 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:57,380 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:57,381 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:57,381 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:57,382 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:57,382 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:57,382 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:57,383 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:57,383 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:57,383 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:57,384 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:57,385 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:57,387 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:57,388 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:57,434 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:57,435 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:57,436 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:57,437 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:57,439 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:57,440 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:57,440 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:57,441 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:57,441 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:57,442 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:57,443 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:57,443 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:57,445 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:57,445 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:57,446 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:57,447 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:57,447 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:57,447 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:57,448 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:57,448 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:57,449 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:57,449 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:57,450 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:57,452 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:57,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,453 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:57,454 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:57,454 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:57,455 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,455 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:57,456 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:57,457 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:57,457 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:57,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:57,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:57,462 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:57,463 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:57,510 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:57,511 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:57,512 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:57,513 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:57,517 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:57,518 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:57,519 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:57,520 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:57,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:57,523 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:57,523 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:57,524 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:57,525 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:57,526 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:57,526 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:57,527 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:57,528 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:57,530 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,531 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:57,531 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:57,532 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:57,532 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:57,533 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:57,533 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:57,534 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:57,534 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:57,535 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:57,536 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:57,537 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:57,538 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:57,538 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:57,539 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:57,539 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:57,540 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:57,540 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:57,541 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,542 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:57,543 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:57,544 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:57,544 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:57,598 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:57,599 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:57,601 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:57,602 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,604 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:57,605 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:57,605 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:57,609 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:57,609 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:57,610 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:57,612 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:57,613 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,613 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:57,614 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,614 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:57,615 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:57,616 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:57,617 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:57,657 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:57,659 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:57,660 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:57,664 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.02s
2025-10-12 11:02:57,667 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:57,669 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:57,678 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:57,723 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:57,724 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:02:57,779 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:57,784 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:57,785 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:57,835 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:57,842 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:57,847 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:58,668 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:58,669 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:58,671 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:02:58,673 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:58,673 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:58,675 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:58,676 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:58,677 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:02:58,684 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:58,948 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:58,949 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:58,950 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:58,950 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:02:58,950 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:02:58,951 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:02:58,951 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:02:58,952 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:02:59,453 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:02:59,455 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:02:59,455 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:02:59,456 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:02:59,456 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:02:59,457 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:02:59,457 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:02:59,458 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:59,461 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:02:59,461 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:59,461 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:02:59,462 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:02:59,467 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:02:59,467 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:59,468 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:02:59,468 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:02:59,471 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:02:59,471 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:59,472 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:02:59,472 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:02:59,475 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:02:59,476 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:59,476 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:02:59,505 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:02:59,510 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:59,510 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:02:59,511 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:02:59,511 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:02:59,512 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:59,512 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:59,513 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:59,513 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:59,513 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:59,514 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:02:59,515 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:02:59,515 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:02:59,519 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:02:59,520 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:59,520 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:02:59,521 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:59,521 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:02:59,521 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:02:59,522 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:02:59,522 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:02:59,523 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:02:59,523 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:02:59,524 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:02:59,524 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:02:59,525 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:02:59,525 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:02:59,525 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:02:59,526 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:02:59,526 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:02:59,527 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:02:59,527 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:02:59,528 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:02:59,528 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:59,529 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:02:59,529 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:02:59,530 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:02:59,530 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:02:59,531 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:02:59,531 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:02:59,531 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:02:59,532 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:02:59,532 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:02:59,536 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:02:59,537 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:02:59,582 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:02:59,584 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:02:59,584 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:59,585 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:02:59,586 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:02:59,586 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:02:59,587 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:02:59,588 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:02:59,588 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:02:59,589 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:02:59,589 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:02:59,590 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:02:59,590 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:02:59,591 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,592 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:59,593 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:02:59,594 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:02:59,594 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,595 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:59,596 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:59,596 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:59,597 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:59,597 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:59,598 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:59,599 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:02:59,599 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:02:59,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:02:59,602 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:59,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:02:59,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:59,604 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:02:59,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:02:59,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:02:59,606 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:02:59,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:02:59,608 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:59,609 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:02:59,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:02:59,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:02:59,610 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:02:59,611 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:02:59,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:02:59,615 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:02:59,615 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,669 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:59,670 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:59,672 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:59,672 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:59,673 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:02:59,674 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:59,675 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:59,675 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:59,675 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:59,676 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:59,676 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:02:59,677 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:02:59,678 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:02:59,680 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:02:59,680 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:02:59,680 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:02:59,681 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:02:59,681 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:02:59,682 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:02:59,682 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,683 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:02:59,683 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:59,685 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:02:59,686 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:02:59,686 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:02:59,687 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:02:59,687 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:02:59,688 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:02:59,689 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:02:59,690 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:59,693 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:02:59,695 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,734 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:02:59,735 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:02:59,739 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:02:59,742 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:02:59,743 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:02:59,744 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:02:59,746 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:02:59,746 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,747 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:59,747 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,748 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:02:59,748 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:02:59,749 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:02:59,749 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:02:59,749 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:02:59,750 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:02:59,752 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.08s
2025-10-12 11:02:59,811 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:59,956 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:02:59,958 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:02:59,958 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:02:59,960 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:02:59,964 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:00,675 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:00,676 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:00,678 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:00,679 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:00,680 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:00,681 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:00,682 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:00,683 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:00,687 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:00,687 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:00,688 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:00,690 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:00,690 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:00,691 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:00,691 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:00,692 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:00,738 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:01,193 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:01,194 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:01,196 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:01,196 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:01,196 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:01,197 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:01,197 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:01,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:01,200 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:01,200 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:01,200 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:01,201 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:01,204 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:01,204 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:01,204 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:01,205 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:01,207 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:01,207 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:01,207 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:01,208 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:01,210 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:01,211 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:01,211 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:01,212 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:01,214 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:01,214 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:01,215 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:01,215 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:01,216 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:01,216 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:01,217 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:01,217 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:01,217 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:01,218 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:01,219 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:01,219 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:01,223 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:01,224 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:01,224 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:01,259 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:01,260 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:01,261 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:01,262 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:01,262 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:01,263 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:01,263 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:01,264 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:01,264 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:01,265 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:01,265 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:01,265 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:01,266 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:01,267 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:01,267 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:01,267 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:01,268 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:01,269 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:01,269 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:01,270 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:01,271 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:01,271 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:01,272 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:01,272 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:01,273 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:01,273 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:01,273 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:01,274 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:01,274 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:01,274 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:01,275 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:01,275 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:01,275 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:01,276 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:01,277 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:01,277 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:01,277 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:01,278 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:01,278 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:01,279 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:01,279 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:01,279 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:01,280 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,280 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:01,281 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:01,281 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:01,281 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,282 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:01,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:01,283 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:01,283 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:01,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:01,338 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:01,339 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:01,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:01,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:01,342 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:01,343 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:01,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:01,346 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:01,346 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:01,348 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:01,349 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:01,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:01,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:01,355 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:01,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:01,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:01,430 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:01,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:01,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:01,531 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:01,533 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,534 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:01,535 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:01,535 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:01,535 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:01,536 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:01,536 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:01,537 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:01,537 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:01,539 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:01,539 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:01,540 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:01,540 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:01,541 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:01,541 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:01,541 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:01,542 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:01,544 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:01,544 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,545 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:01,545 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:01,546 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:01,592 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:01,592 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:01,593 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:01,594 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:01,596 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:01,597 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,598 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:01,600 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:01,603 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:01,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:01,650 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:01,650 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:01,652 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,652 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:01,653 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,653 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:01,655 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:01,656 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:01,656 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:01,657 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:01,657 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:01,659 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.98s
2025-10-12 11:03:01,722 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:01,723 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:01,724 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:01,725 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:01,726 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:01,729 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:01,729 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:01,730 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:01,731 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:01,732 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:01,733 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:01,733 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:01,738 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:01,744 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:02,070 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:02,071 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:02,072 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:02,072 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:02,073 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:02,073 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:02,074 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:02,074 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:02,450 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:02,452 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:02,576 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:02,577 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:02,579 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.13s
2025-10-12 11:03:02,579 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:02,580 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:02,581 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:02,581 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:02,581 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:02,582 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:02,585 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:02,586 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:02,587 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:02,587 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:02,592 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:02,592 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:02,593 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:02,593 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:02,595 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:02,596 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:02,597 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:02,598 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:02,638 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:02,640 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:02,641 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:02,641 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:02,644 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:02,645 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:02,645 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:02,646 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:02,647 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:02,647 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:02,648 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:02,648 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:02,648 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:02,649 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:02,650 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:02,650 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:02,655 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:02,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:02,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:02,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:02,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:02,657 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:02,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:02,658 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:03:02,658 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:02,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:02,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:02,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:02,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:02,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:02,712 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:02,714 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:02,715 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:02,716 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:02,716 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:02,717 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:02,718 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:02,718 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:02,719 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:02,720 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:02,722 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:02,722 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:02,723 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:02,724 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:02,725 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:02,726 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:02,784 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:02,786 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:02,787 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:02,787 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:02,788 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:02,789 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:02,790 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:02,791 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:02,792 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:02,792 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:02,793 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:02,825 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:02,826 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:02,827 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:02,828 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:02,828 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:02,829 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:02,829 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:02,830 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:02,831 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:02,831 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:02,832 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:02,832 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:02,833 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:02,833 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:02,834 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:02,834 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:02,835 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:02,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:02,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:02,837 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:02,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:02,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:02,839 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:02,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:02,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:02,840 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:02,841 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:02,841 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:02,842 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:02,843 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:02,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:02,844 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:02,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:02,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:02,846 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:02,847 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:02,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:02,848 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:02,849 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:02,850 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:02,851 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:02,851 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:02,852 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:02,852 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:02,911 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:02,911 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:02,912 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:02,913 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:02,981 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:03,045 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:03,055 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:03,137 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:03,166 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:03,168 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:03,169 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:03,178 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:03,190 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:03,245 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:03,342 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:03,344 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:03,346 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:03,349 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:03,355 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:03,357 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:03,359 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:03,360 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:03,363 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:03,366 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:03,374 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:03,374 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:03,375 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:03,485 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:03,488 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:03,491 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:03,491 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:03,495 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:03,513 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:03,515 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:03,515 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:03,519 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:03,522 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:03,574 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:03,586 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:03,599 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:03,607 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:03,610 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.89s
2025-10-12 11:03:03,676 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:03,677 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:03,677 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:03,682 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:03,687 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:03,795 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:03,796 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:03,797 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:03,800 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:03,801 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:03,804 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:03,804 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:03,805 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:03,815 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:03,816 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:03,817 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:03,817 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:03,818 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:03,819 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:03,820 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:03,821 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:03,902 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:04,322 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:04,324 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:04,325 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:04,325 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:04,326 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:04,326 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:04,326 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:04,327 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:04,330 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:04,330 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:04,331 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:04,331 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:04,335 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:04,335 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:04,336 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:04,337 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:04,339 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:04,340 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:04,340 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:04,341 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:04,344 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:04,344 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:04,345 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:04,345 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:04,349 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:04,349 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:04,350 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:04,350 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:04,383 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:04,384 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:04,385 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:04,386 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:04,386 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:04,387 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:04,388 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:04,389 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:04,392 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:04,394 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:04,395 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:04,395 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:04,395 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:04,396 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:04,396 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:04,396 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:04,397 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:04,398 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:04,398 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:04,398 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:04,399 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:04,399 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:04,399 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:04,400 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:04,401 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:04,402 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:04,403 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:04,403 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:04,404 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:04,405 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:04,405 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:04,406 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:04,406 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:04,407 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:04,407 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:04,408 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:04,464 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:04,465 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:04,465 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:04,466 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:04,467 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:04,467 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:04,469 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:04,469 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:04,470 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:04,472 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:04,474 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:04,476 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:04,477 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:04,477 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:04,478 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:04,478 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:04,479 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:04,479 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,480 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:04,480 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:04,482 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:04,483 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,483 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:04,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:04,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:04,485 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:04,485 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:04,486 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:04,486 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:04,488 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:04,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:04,491 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:04,495 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:04,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:04,549 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:04,550 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:04,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:04,551 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:04,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:04,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:04,553 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:04,554 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:04,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:04,556 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:04,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:04,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:04,559 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:04,560 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,560 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:04,560 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:04,561 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:04,561 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:04,562 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:04,563 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:04,563 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:04,564 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:04,565 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:04,566 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:04,567 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:04,567 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:04,567 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:04,568 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:04,568 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:04,568 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:04,569 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:04,569 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,570 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:04,573 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:04,573 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:04,574 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:04,618 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:04,620 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:04,621 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:04,623 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:04,623 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:04,624 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,630 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:04,630 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:04,631 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:04,632 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:04,634 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:04,635 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:04,636 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,637 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:04,687 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:04,688 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:04,690 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:04,691 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:04,691 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:04,692 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.90s
2025-10-12 11:03:04,759 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:04,762 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:04,763 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:04,764 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:04,766 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:04,806 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:04,826 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:04,829 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:04,832 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:04,833 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:04,834 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:04,835 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:04,835 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:04,847 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:04,848 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:04,848 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:04,849 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:04,849 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:04,850 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:04,851 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:04,852 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:04,914 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:05,354 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:05,355 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:05,356 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:05,356 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:05,357 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:05,357 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:05,357 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:05,358 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:05,361 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:05,361 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:05,362 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:05,362 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:05,365 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:05,366 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:05,366 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:05,367 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:05,370 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:05,370 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:05,371 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:05,371 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:05,374 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:05,375 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:05,375 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:05,376 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:05,379 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:05,380 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:05,381 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:05,381 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:05,382 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:05,382 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:05,403 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:05,411 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:05,411 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:05,411 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:05,413 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:05,413 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:05,417 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:05,418 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:05,418 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:05,418 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:05,419 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:05,419 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:05,420 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:05,420 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:05,420 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:05,421 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:05,422 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:05,422 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:05,422 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:05,423 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:05,423 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:05,423 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:05,424 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:05,424 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:05,425 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:05,425 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:05,426 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:05,426 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:05,426 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:05,427 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:05,427 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:05,428 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:05,428 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:05,429 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:05,429 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:05,429 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:05,430 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:05,430 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:05,431 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:05,431 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:05,432 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:05,432 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:05,432 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:05,433 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:05,433 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:05,434 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:05,434 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:05,435 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:05,435 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:05,435 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:05,436 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:05,436 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,436 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:05,437 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:05,437 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:05,438 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,438 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:05,438 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:05,439 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:05,440 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:05,441 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:05,442 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:05,443 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:05,443 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:05,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:05,489 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:05,491 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:05,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:05,494 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:05,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:05,495 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:05,496 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:05,497 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:05,499 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:05,499 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:05,500 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:05,501 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:05,502 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:05,502 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:05,504 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:05,505 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:05,506 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,507 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:05,507 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:05,507 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:05,508 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:05,508 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:05,509 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:05,509 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:05,510 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:05,510 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:05,510 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:05,511 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:05,511 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:05,511 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:05,512 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:05,512 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:05,513 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:05,513 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:05,514 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,515 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:05,516 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:05,517 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:05,517 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:05,518 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:05,518 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:05,520 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:05,574 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:05,575 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,578 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:05,578 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:05,579 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:05,580 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:05,581 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:05,582 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:05,582 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,583 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:05,583 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,584 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:05,584 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:05,585 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:05,585 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:05,586 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:05,586 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:05,588 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.76s
2025-10-12 11:03:05,639 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:05,641 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:05,642 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:05,643 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:05,647 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:05,831 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:05,832 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:05,833 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:05,835 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:05,836 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:05,837 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:05,837 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:05,839 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:05,882 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:06,125 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:06,126 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:06,127 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:06,128 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:06,129 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:06,130 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:06,130 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:06,131 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:06,632 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:06,633 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:06,634 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:06,635 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:06,635 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:06,636 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:06,636 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:06,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:06,638 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:06,639 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:06,639 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:06,640 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:06,645 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:06,645 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:06,646 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:06,646 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:06,648 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:06,649 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:06,649 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:06,650 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:06,652 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:06,652 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:06,653 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:06,653 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:06,657 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:06,658 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:06,658 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:06,658 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:06,659 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:06,660 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:06,660 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:06,661 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:06,661 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:06,662 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:06,663 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:06,663 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:06,702 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:06,703 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:06,704 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:06,704 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:06,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:06,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:06,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:06,706 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:06,706 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:06,706 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:06,707 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:06,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:06,707 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:06,708 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:06,709 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:06,709 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:06,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:06,710 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:06,711 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:06,711 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:06,711 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:06,712 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:06,712 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:06,713 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:06,713 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:06,714 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:06,714 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:06,714 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:06,715 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:06,716 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:06,716 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:06,717 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:06,717 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:06,718 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:06,718 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:06,719 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:06,719 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:06,720 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:06,720 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:06,720 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:06,721 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:06,721 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:06,722 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:06,724 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:06,724 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:06,725 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,765 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:06,768 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:06,769 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:06,770 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,771 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:06,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:06,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:06,772 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:06,773 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:06,774 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:06,774 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:06,775 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:06,777 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:06,777 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:06,778 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:06,779 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:06,779 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:06,780 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:06,780 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:06,781 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:06,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:06,784 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:06,784 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:06,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:06,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:06,786 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:06,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:06,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:06,788 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:06,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,790 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:06,791 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:06,791 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:06,850 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:06,850 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:06,853 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:06,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:06,855 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:06,856 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:06,856 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:06,857 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:06,858 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:06,858 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:06,901 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:06,903 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:06,904 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:06,906 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:06,907 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:06,908 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:06,908 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,908 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:06,909 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:06,910 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:06,911 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:06,911 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:06,912 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:06,913 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:03:06,915 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:06,915 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:06,958 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:06,962 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:06,964 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,964 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:06,965 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:06,965 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:06,969 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:06,970 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:06,970 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:06,971 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:06,972 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,972 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:06,973 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,973 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:06,974 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:06,974 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:06,975 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:06,975 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:06,975 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:06,976 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:06,977 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.14s
2025-10-12 11:03:07,275 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:07,275 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:07,276 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:07,277 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:07,279 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:07,856 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:07,857 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:07,859 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:07,861 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:07,862 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:07,864 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:07,864 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:07,865 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:07,875 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:07,876 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:07,878 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:07,878 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:07,879 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:07,880 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:07,880 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:07,881 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:07,900 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:08,382 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:08,384 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:08,385 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:08,385 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:08,385 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:08,386 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:08,387 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:08,387 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:08,389 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:08,390 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:08,390 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:08,391 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:08,395 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:08,396 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:08,397 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:08,397 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:08,400 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:08,401 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:08,401 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:08,402 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:08,404 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:08,405 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:08,405 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:08,405 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:08,409 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:08,410 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:08,410 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:08,411 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:08,411 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:08,412 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:08,413 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:08,413 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:08,414 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:08,414 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:08,447 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:08,448 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:08,452 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:08,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:08,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:08,454 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:08,454 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:08,455 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:08,455 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:08,455 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:08,456 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:08,457 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:08,457 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:08,457 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:08,458 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:08,458 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:08,459 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:08,459 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:08,460 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:08,460 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:08,461 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:08,461 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:08,462 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:08,462 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:08,463 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:08,463 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:08,464 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:08,465 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:08,466 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:08,466 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:08,466 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:08,467 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:08,467 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:08,467 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:08,468 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:08,468 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:08,469 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:08,469 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:08,470 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:08,470 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:08,470 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:08,471 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:08,471 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:08,472 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:08,472 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:08,472 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:08,483 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:08,515 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,516 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:08,517 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:08,520 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:08,521 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,521 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:08,522 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:08,523 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:08,524 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:08,525 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:08,526 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:08,527 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:08,528 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:08,529 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:08,530 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:08,530 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:08,531 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:08,531 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:08,531 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:08,532 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:08,535 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:08,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:08,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:08,537 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:08,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:08,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:08,539 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:08,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:08,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:08,542 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:08,543 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,543 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:08,543 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:08,544 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:08,544 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:08,545 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:08,546 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:08,546 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:08,547 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:08,547 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:08,548 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:08,548 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:08,549 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:08,550 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:08,551 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:08,552 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:08,553 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:08,554 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:08,554 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,555 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:08,556 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:08,607 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:08,610 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:08,611 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:08,612 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:08,613 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:08,614 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,616 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:08,618 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:08,618 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:08,618 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:08,622 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:08,623 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:08,624 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:08,624 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,625 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:08,625 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,626 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:08,626 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:08,627 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:08,627 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:08,628 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:08,630 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:08,632 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.77s
2025-10-12 11:03:08,676 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:08,678 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:08,679 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:08,680 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:08,684 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:08,861 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:08,862 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:08,864 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:08,866 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:08,867 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:08,868 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:08,868 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:08,869 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:08,897 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:08,902 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:08,911 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:08,922 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:08,944 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:09,003 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:09,019 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:09,021 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:09,100 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:09,641 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:09,642 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:09,643 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:09,644 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:09,644 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:09,645 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:09,645 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:09,646 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:09,648 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:09,648 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:09,649 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:09,649 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:09,653 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:09,653 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:09,654 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:09,654 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:09,656 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:09,656 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:09,657 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:09,657 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:09,660 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:09,661 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:09,662 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:09,662 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:09,670 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:09,694 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:09,695 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:09,696 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:09,696 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:09,697 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:09,698 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:09,699 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:09,699 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:09,699 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:09,701 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:09,701 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:09,704 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:09,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:09,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:09,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:09,706 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:09,706 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:09,706 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:09,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:09,707 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:09,708 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:09,708 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:09,708 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:09,708 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:09,709 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:09,709 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:09,709 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:09,710 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:09,710 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:09,711 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:09,712 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:09,712 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:09,712 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:09,713 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:09,713 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:09,713 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:09,714 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:09,714 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:09,715 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:09,715 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:09,715 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:09,716 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:09,716 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:09,716 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:09,717 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:09,717 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:09,718 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:09,718 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:09,719 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:09,719 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:09,720 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:09,720 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:09,720 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:09,721 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:09,721 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:09,722 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:09,724 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,725 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:09,725 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:09,726 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:09,726 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,764 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:09,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:09,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:09,768 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:09,769 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:09,770 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:09,771 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:09,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:09,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:09,772 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:09,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:09,773 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:09,774 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:09,774 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:09,775 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:09,776 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:09,776 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:09,777 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:09,778 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:09,778 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:09,779 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:09,779 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:09,780 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:09,781 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:09,783 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:09,784 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,784 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:09,785 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:09,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:09,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:09,786 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:09,786 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:09,786 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:09,787 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:09,787 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:09,789 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:09,789 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:09,790 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:09,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:09,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:09,791 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:09,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:09,792 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:09,792 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:09,794 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:09,794 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:09,794 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:09,794 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:09,795 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:09,797 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:09,799 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:09,799 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:09,848 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,854 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:09,855 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:09,855 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:09,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:09,857 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:09,858 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,858 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:09,858 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,859 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:09,859 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:09,859 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:09,860 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:09,860 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:09,861 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:09,862 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.00s
2025-10-12 11:03:09,865 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:09,866 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:09,867 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:09,914 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:09,919 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:09,921 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:09,921 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:09,923 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:09,924 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:09,926 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:09,927 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:09,927 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:09,928 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:09,935 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:09,935 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:09,936 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:09,936 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:09,937 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:09,937 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:09,938 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:09,939 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:10,057 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:10,440 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:10,442 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:10,443 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:10,443 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:10,444 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:10,444 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:10,445 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:10,445 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:10,449 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:10,449 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:10,449 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:10,450 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:10,453 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:10,454 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:10,454 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:10,455 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:10,458 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:10,458 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:10,459 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:10,459 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:10,462 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:10,462 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:10,463 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:10,463 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:10,467 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:10,467 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:10,468 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:10,468 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:10,469 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:10,469 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:10,469 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:10,470 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:10,470 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:10,470 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:10,472 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:10,472 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:10,482 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:10,510 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:10,511 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:10,511 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:10,512 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:10,512 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:10,513 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:10,513 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:10,513 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:10,514 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:10,515 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:10,515 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:10,515 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:10,516 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:10,516 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:10,517 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:10,517 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:10,517 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:10,518 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:10,518 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:10,519 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:10,520 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:10,521 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:10,521 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:10,522 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:10,522 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:10,523 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:10,523 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:10,523 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:10,524 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:10,524 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:10,524 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:10,525 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:10,526 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:10,526 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:10,527 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:10,527 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:10,528 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:10,528 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:10,529 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:10,529 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:10,529 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:10,530 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:10,530 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:10,531 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:10,531 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,531 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:10,532 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:10,532 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:10,532 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,533 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:10,533 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:10,534 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:10,535 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:10,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:10,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:10,580 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:10,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:10,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:10,584 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:10,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:10,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:10,585 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:10,586 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:10,587 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:10,589 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:10,589 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:10,590 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:10,590 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:10,591 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:10,592 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:10,592 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:10,593 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:10,593 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:10,596 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:10,597 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,597 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:10,597 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:10,598 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:10,598 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:10,599 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:10,599 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:10,600 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:10,601 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:10,602 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:10,604 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:10,657 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:10,661 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:10,661 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:10,662 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:10,663 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:10,663 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:10,664 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:10,664 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,665 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:10,666 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:10,667 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:10,668 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:10,669 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:10,718 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:10,722 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:10,724 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:10,725 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,725 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:10,726 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:10,730 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:10,730 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:10,731 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:10,732 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:10,733 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,733 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:10,734 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,737 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:10,737 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:10,784 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:10,785 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:10,786 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:10,786 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:10,788 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-12 11:03:10,911 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:10,915 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:10,916 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:10,917 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:10,920 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:10,926 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:10,926 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:10,928 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:10,930 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:10,931 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:10,933 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:10,933 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:10,934 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:10,984 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:10,986 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:10,987 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:10,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:10,988 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:10,989 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:10,989 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:10,990 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:11,023 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:11,491 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:11,493 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:11,493 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:11,494 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:11,494 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:11,495 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:11,495 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:11,496 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:11,498 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:11,499 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:11,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:11,500 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:11,504 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:11,504 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:11,504 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:11,506 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:11,509 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:11,540 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:11,544 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:11,545 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:11,547 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:11,548 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:11,548 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:11,549 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:11,551 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:11,552 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:11,553 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:11,553 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:11,554 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:11,554 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:11,554 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:11,555 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:11,555 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:11,555 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:11,556 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:11,557 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:11,561 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:11,562 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:11,562 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:11,562 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:11,563 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:11,563 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:11,564 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:11,564 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:11,564 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:11,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:11,565 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:11,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:11,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:11,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:11,570 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:11,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:11,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:11,620 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:11,621 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:11,623 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:11,623 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:11,624 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:11,624 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:11,625 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:11,626 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:11,626 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:11,627 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:11,627 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:11,628 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:11,629 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:11,629 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:11,630 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:11,630 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:11,630 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:11,631 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:11,631 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:11,632 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:11,632 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:11,633 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:11,635 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:11,636 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:11,636 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:11,636 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:11,637 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:11,637 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:11,638 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,638 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:11,639 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:11,639 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:11,639 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:11,642 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:11,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:11,643 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:11,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:11,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:11,645 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:11,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:11,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:11,646 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:11,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:11,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:11,650 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:11,650 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:11,651 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:11,652 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:11,654 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:11,655 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:11,713 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:11,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:11,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:11,717 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:11,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:11,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:11,719 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:11,720 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,722 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:11,723 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:11,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:11,723 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:11,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:11,725 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:11,726 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:11,726 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:11,728 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:11,728 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:11,729 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:11,729 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:11,730 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:11,730 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:11,731 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:11,731 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:11,732 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:11,733 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,735 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:11,736 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:11,736 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:11,737 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:11,739 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:11,741 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:11,797 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:11,799 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:11,801 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,801 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:11,802 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:11,805 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:11,806 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:11,806 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:11,807 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:11,808 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,808 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:11,810 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,810 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:11,810 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:11,811 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:11,813 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:11,813 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:11,814 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:11,815 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.89s
2025-10-12 11:03:11,847 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:11,864 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:11,865 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:11,870 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:11,875 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:11,994 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:12,129 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:12,131 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:12,265 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:12,378 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:12,391 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:12,558 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:12,560 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:12,563 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.30s
2025-10-12 11:03:12,869 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:12,874 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:12,875 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:12,877 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:12,882 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:12,883 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:12,885 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:13,010 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:13,389 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:13,524 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:13,527 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:13,529 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:13,532 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:13,534 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:13,537 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:13,540 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:13,543 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:13,543 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:13,545 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:13,548 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.16s
2025-10-12 11:03:13,550 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:13,586 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:13,590 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:13,594 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:13,595 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:13,597 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:13,658 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:13,661 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:13,664 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:13,666 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:13,668 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:13,670 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:13,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:13,718 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:13,721 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:13,722 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:13,724 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:13,725 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:13,728 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:13,728 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:13,729 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:13,730 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:13,731 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:13,732 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:13,733 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:13,733 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:13,734 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:13,737 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:13,737 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:13,739 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:13,800 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:13,811 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:13,879 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:14,016 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:14,021 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:14,022 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:14,023 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:14,037 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:14,093 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:14,100 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:14,105 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:14,115 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:14,176 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:14,177 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:14,179 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:14,183 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:14,187 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:14,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:14,194 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:14,203 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:14,301 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:14,310 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:14,313 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:14,317 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:14,383 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:14,389 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:14,391 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:14,401 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:14,406 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:14,409 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:14,412 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:14,417 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:14,464 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:14,468 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:14,469 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:14,471 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:14,471 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:14,473 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:14,475 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:14,476 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:14,476 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:14,477 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:14,477 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:14,478 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:14,478 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:14,479 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:14,479 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,479 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:14,480 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:14,480 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:14,481 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,483 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:14,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:14,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:14,485 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:14,486 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:14,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:14,488 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:14,488 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:14,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:14,489 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:14,489 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:14,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:14,492 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:14,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:14,494 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:14,494 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:14,496 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:14,496 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:14,497 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:14,498 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:14,544 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-12 11:03:14,545 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:14,547 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:14,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:14,550 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:14,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:14,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:14,552 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:14,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:14,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:14,553 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:14,554 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,554 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:14,556 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:14,557 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:14,558 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:14,558 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:14,558 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:14,559 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:14,559 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:14,559 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:14,560 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:14,560 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:14,560 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:14,561 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:14,561 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:14,561 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:14,562 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:14,562 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:14,563 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,564 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:14,564 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:14,565 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:14,565 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:14,565 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:14,566 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:14,567 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:14,569 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,571 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:14,571 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:14,571 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:14,572 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:14,575 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:14,576 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:14,577 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:14,577 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,578 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:14,579 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,579 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:14,580 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:14,580 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:14,581 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:14,614 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:14,623 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:14,623 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:14,625 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.49s
2025-10-12 11:03:14,760 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:14,762 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:14,762 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:14,763 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:14,766 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:15,493 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:15,494 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:15,495 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:15,497 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:15,499 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:15,500 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:15,501 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:15,502 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:15,540 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:15,842 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:15,843 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:15,844 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:15,845 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:15,845 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:15,846 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:15,846 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:15,847 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:16,348 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:16,350 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:16,351 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:16,351 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:16,352 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:16,352 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:16,353 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:16,353 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:16,356 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:16,357 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:16,357 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:16,358 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:16,362 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:16,362 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:16,363 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:16,363 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:16,366 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:16,367 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:16,367 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:16,368 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:16,370 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:16,371 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:16,371 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:16,371 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:16,374 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:16,375 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:16,375 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:16,375 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:16,376 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:16,376 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:16,377 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:16,377 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:16,377 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:16,378 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:16,379 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:16,379 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:16,383 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:16,384 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:16,391 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:16,392 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:16,404 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:16,408 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:16,415 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:16,416 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:16,417 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:16,419 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:16,420 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:16,420 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:16,421 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:16,421 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:16,422 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:16,428 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:16,454 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:16,456 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:16,458 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:16,459 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:16,499 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:16,500 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:16,503 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:16,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:16,552 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:16,555 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:16,556 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:16,557 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:16,557 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:16,558 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:16,559 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:16,560 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:16,560 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:16,562 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:16,562 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:16,563 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:16,564 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:16,565 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:16,565 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:16,566 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:16,615 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:16,615 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:16,656 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:16,719 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:16,738 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:16,748 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:16,795 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:16,839 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:16,862 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:16,869 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:16,878 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:16,926 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:16,945 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:16,951 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:17,010 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:17,011 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:17,012 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,015 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:17,018 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:17,021 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:17,024 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:17,027 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:17,029 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:17,035 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:17,037 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:17,038 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:17,042 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:17,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:17,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:17,163 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:17,175 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:17,184 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:17,231 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:17,244 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:17,248 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:17,251 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:17,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:17,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:17,266 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:17,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:17,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:17,335 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:17,336 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,337 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:17,338 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:17,339 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:17,340 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:17,341 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:17,342 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:17,343 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:17,345 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:17,346 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:17,346 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:17,347 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:17,396 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:17,397 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:17,399 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:17,400 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:17,401 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:17,401 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:17,402 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,402 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:17,403 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:17,403 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:17,404 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:17,404 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:17,405 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:17,407 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:17,408 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,409 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:17,409 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:17,410 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:17,458 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:17,465 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:17,466 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:17,466 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:17,468 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:03:17,469 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:17,470 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:17,472 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,472 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:17,473 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,474 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:17,474 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:17,475 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:17,475 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:17,475 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:17,476 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:17,478 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.98s
2025-10-12 11:03:17,536 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:03:17,540 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:17,541 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:17,541 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:17,545 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:17,549 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:17,552 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:17,553 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:17,554 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:17,556 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:17,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:17,560 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:17,560 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:17,604 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-12 11:03:17,652 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:17,950 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:17,951 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:17,952 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:17,952 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:17,953 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:17,954 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:17,954 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:17,955 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:18,456 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:18,458 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:18,459 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:18,459 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:18,460 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:18,460 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:18,461 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:18,461 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:18,463 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:18,464 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:18,464 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:18,465 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:18,467 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:18,468 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:18,468 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:18,468 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:18,472 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:18,472 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:18,472 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:18,473 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:18,475 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:18,476 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:18,476 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:18,476 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:18,485 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:18,510 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:18,511 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:18,511 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:18,512 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:18,512 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:18,513 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:18,513 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:18,519 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:18,550 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:18,552 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:18,552 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:18,557 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:18,557 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:18,558 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:18,561 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:18,561 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:18,562 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:18,562 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:18,563 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:18,564 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:18,564 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:18,565 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:18,566 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:18,566 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:18,567 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:18,568 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:18,568 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:18,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:18,569 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:18,569 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:18,570 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:18,571 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:18,571 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:18,574 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:18,574 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:18,575 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:18,622 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:18,623 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:18,625 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:18,626 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:18,627 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:18,628 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:18,628 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:18,629 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:18,629 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:18,631 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:18,631 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:18,632 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:18,633 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:18,633 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:18,633 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:18,634 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:18,634 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:18,635 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:18,635 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:18,636 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:18,636 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:18,636 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:18,637 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:18,639 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:18,639 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:18,640 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:18,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:18,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:18,641 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:18,642 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:18,642 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:18,642 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:18,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:18,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:18,645 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:18,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:18,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:18,694 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:18,697 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:18,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:18,698 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:18,700 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:18,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:18,770 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:18,777 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:18,890 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:18,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:18,999 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:19,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:19,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:19,004 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:19,015 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:19,029 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:19,097 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:19,101 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:19,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:19,106 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:19,108 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:19,109 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:19,113 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:19,114 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:19,116 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:19,119 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:19,135 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:19,178 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:19,181 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:19,186 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:19,198 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:19,259 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:19,262 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:19,263 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:19,267 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:19,268 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:19,270 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:19,272 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:19,272 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:19,279 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:19,291 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:19,328 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:19,334 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:19,336 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:19,341 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:19,344 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:19,346 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:19,352 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:19,358 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:19,358 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:19,431 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:19,433 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:19,434 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:19,435 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:19,436 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:19,437 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:19,490 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:19,491 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:19,491 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:19,492 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:19,493 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:19,493 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:19,494 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:19,495 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.94s
2025-10-12 11:03:19,562 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:19,563 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:19,564 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:19,565 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:19,569 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:19,571 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:19,571 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:19,573 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:19,574 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:19,575 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:19,578 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:19,579 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:19,580 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:19,585 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:19,586 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:19,587 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:19,587 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:19,588 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:19,588 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:19,589 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:19,589 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:19,671 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:20,091 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:20,092 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:20,093 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:20,093 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:20,094 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:20,094 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:20,095 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:20,095 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:20,097 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:20,098 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:20,098 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:20,099 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:20,102 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:20,134 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:20,134 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:20,135 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:20,138 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:20,138 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:20,139 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:20,139 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:20,141 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:20,141 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:20,142 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:20,142 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:20,145 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:20,145 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:20,146 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:20,146 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:20,147 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:20,147 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:20,148 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:20,148 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:20,148 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:20,149 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:20,150 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:20,150 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:20,154 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:20,154 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:20,155 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:20,155 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:20,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:20,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:20,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:20,157 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:20,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:20,158 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:20,158 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:20,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:20,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:20,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:20,160 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:20,160 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:20,162 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:20,163 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:20,164 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:20,165 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:20,211 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:20,212 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:20,212 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:20,213 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:20,213 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:20,214 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:20,215 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:20,215 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:20,216 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:20,217 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:20,217 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:20,218 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:20,218 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:20,218 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:20,219 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:20,219 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:20,220 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:20,221 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:20,221 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:20,221 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:20,223 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:20,224 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:20,225 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:20,225 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:20,225 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:20,226 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,226 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:20,227 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:20,227 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:20,227 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,228 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:20,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:20,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:20,230 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:20,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:20,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:20,232 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:20,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:20,233 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:20,234 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:20,234 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:20,235 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:20,236 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:20,236 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:20,237 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:20,237 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:20,238 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:20,239 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:20,239 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:20,240 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:20,241 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:20,241 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:20,242 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:20,243 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:20,243 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:20,245 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,246 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:20,301 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:20,302 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:20,303 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:20,304 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:20,304 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:20,305 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:20,305 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:20,306 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:20,306 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:20,306 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:20,307 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:20,307 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:20,307 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:20,308 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:20,309 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:20,310 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:20,310 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,310 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:20,311 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:20,311 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:20,312 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:20,312 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:20,313 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:20,314 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:20,316 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,316 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:20,317 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:20,318 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:20,322 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:20,322 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:20,323 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:20,324 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:20,358 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,359 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:20,360 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,361 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:20,361 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:20,362 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:20,362 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:20,363 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:20,363 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:20,364 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.79s
2025-10-12 11:03:20,438 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:20,439 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:20,440 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:20,441 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:20,443 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:20,574 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:20,575 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:20,577 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:20,578 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:20,580 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:20,582 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:20,582 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:20,583 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:20,589 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:20,590 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:20,591 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:20,591 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:20,592 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:20,593 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:20,593 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:20,594 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:20,657 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:21,095 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:21,097 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:21,097 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:21,098 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:21,098 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:21,100 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:21,101 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:21,101 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:21,103 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:21,104 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:21,104 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:21,105 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:21,108 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:21,109 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:21,109 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:21,110 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:21,113 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:21,114 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:21,114 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:21,114 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:21,116 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:21,117 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:21,117 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:21,117 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:21,120 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:21,121 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:21,121 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:21,122 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:21,122 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:21,123 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:21,123 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:21,123 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:21,124 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:21,124 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:21,125 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:21,125 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:21,129 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:21,129 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:21,131 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:21,131 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:21,132 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:21,132 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:21,132 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:21,133 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:21,133 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:21,134 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:21,165 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:21,167 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:21,170 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:21,171 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:21,171 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:21,171 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:21,172 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:21,172 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:21,172 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:21,173 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:21,173 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:21,174 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:21,174 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:21,175 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:21,176 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:21,177 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:21,177 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:21,178 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:21,178 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:21,178 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:21,179 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:21,179 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:21,180 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:21,180 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:21,180 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:21,181 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:21,182 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:21,182 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:21,183 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:21,183 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:21,184 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:21,184 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:21,185 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:21,185 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:21,185 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:21,186 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,186 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:21,187 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:21,187 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:21,188 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,188 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:21,188 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:21,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:21,189 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:21,190 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:21,190 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:21,191 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:21,191 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:21,192 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:21,192 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:21,193 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:21,195 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:21,195 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:21,196 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:21,197 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:21,205 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:21,247 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:21,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:21,253 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:21,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:21,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:21,255 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:21,256 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:21,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:21,258 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:21,258 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,259 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:21,259 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:21,260 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:21,260 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:21,261 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:21,261 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:21,262 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:21,263 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:21,263 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:21,263 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:21,264 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:21,264 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:21,264 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:21,265 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:21,265 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:21,266 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:21,266 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:21,266 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,267 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:21,268 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:21,269 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:21,270 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:21,271 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:21,322 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:21,326 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:21,328 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:21,328 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:21,329 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,333 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:21,334 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:21,335 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:21,335 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:21,337 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:21,338 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,338 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:21,339 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,341 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:21,341 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:21,342 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:21,343 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:21,384 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:21,387 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:21,391 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-12 11:03:21,462 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:21,464 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:21,465 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:21,466 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:21,470 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:21,579 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:21,580 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:21,582 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:21,584 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:21,585 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:21,587 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:21,588 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:21,588 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:21,639 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:21,640 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:21,642 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:21,643 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:21,644 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:21,645 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:21,645 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:21,646 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:21,712 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:22,147 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:22,149 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:22,150 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:22,150 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:22,151 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:22,151 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:22,152 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:22,152 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:22,155 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:22,156 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:22,156 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:22,156 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:22,160 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:22,161 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:22,162 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:22,163 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:22,165 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:22,198 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:22,200 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:22,202 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:22,234 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:22,235 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:22,235 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:22,236 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:22,240 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:22,241 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:22,242 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:22,243 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:22,243 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:22,243 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:22,244 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:22,244 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:22,245 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:22,245 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:22,246 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:22,247 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:22,251 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:22,252 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:22,253 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:22,254 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:22,254 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:22,255 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:22,255 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:22,256 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:22,256 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:22,257 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:22,257 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:22,258 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:22,258 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:22,259 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:22,259 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:22,260 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:22,260 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:22,260 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:22,261 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:22,261 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:22,262 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:22,262 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:22,263 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:22,263 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:22,264 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:22,264 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:22,266 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:22,266 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:22,266 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:22,267 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:22,267 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:22,276 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:22,316 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:22,318 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:22,319 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:22,319 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:22,320 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:22,321 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:22,321 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:22,322 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:22,323 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:22,324 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:22,325 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:22,325 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:22,326 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:22,326 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,327 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:22,327 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:22,328 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:22,329 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,329 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:22,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:22,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:22,331 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:22,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:22,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:22,333 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:22,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:22,335 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:22,335 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:22,336 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:22,336 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:22,343 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:22,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:22,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:22,384 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:22,385 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:22,386 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:22,388 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:22,389 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:22,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:22,439 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:22,440 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:22,441 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:22,442 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:22,443 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,444 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:22,445 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:22,445 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:22,446 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:22,446 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:22,446 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:22,447 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:22,447 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:22,447 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:22,448 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:22,449 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:22,449 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:22,450 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:22,451 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:22,504 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:22,506 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:22,507 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:22,508 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,508 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:22,509 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:22,509 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:22,510 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:22,510 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:22,511 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:22,513 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:22,515 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,516 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:22,516 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:22,517 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:22,521 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:22,523 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:22,524 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:22,524 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:22,529 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,568 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:22,570 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,572 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:22,573 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:22,615 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:22,620 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:22,624 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:22,624 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:22,625 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:22,625 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:22,626 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:22,627 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:22,629 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:22,630 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:22,630 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.05s
2025-10-12 11:03:22,699 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:22,852 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:22,854 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:22,855 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:22,857 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:22,860 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:23,623 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:23,624 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:23,625 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:23,627 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:23,628 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:23,629 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:23,630 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:23,631 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:23,666 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:23,972 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:23,973 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:23,973 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:23,974 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:23,975 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:23,976 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:23,976 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:23,977 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:24,491 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:24,521 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:24,534 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:24,534 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:24,535 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:24,535 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:24,536 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:24,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:24,539 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:24,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:24,540 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:24,541 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:24,550 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:24,577 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:24,578 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:24,579 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:24,583 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:24,584 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:24,584 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:24,585 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:24,587 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:24,588 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:24,588 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:24,588 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:24,591 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:24,591 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:24,592 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:24,592 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:24,593 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:24,593 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:24,593 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:24,594 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:24,594 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:24,594 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:24,596 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:24,596 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:24,600 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:24,602 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:24,602 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:24,603 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:24,603 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:24,604 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:24,649 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:24,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:24,652 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:24,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:24,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:24,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:24,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:24,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:24,658 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:24,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:24,660 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:24,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:24,661 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:24,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:24,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:24,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:24,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:24,664 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:24,664 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:24,665 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:24,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:24,666 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:24,667 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:24,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:24,668 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:24,669 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:24,670 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:24,670 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:24,671 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:24,671 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:24,671 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:24,672 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:24,672 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:24,673 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:24,673 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:24,674 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:24,680 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:24,689 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:24,721 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:24,725 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:24,726 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:24,726 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:24,727 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:24,727 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:24,728 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:24,729 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:24,729 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:24,730 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:24,731 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:24,732 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:24,732 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:24,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:24,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:24,734 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:24,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:24,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:24,736 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:24,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:24,737 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:24,738 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:24,738 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:24,739 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:24,740 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:24,741 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:24,742 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:24,743 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:24,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:24,744 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:24,744 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:24,745 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:24,746 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:24,747 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:24,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:24,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:24,748 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:24,749 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:24,749 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:24,749 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:24,750 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:24,750 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:24,751 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:24,753 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:24,754 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:24,754 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:24,810 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:24,816 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:24,942 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:24,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:24,962 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:25,030 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:25,051 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:25,052 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:25,054 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:25,061 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:25,111 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:25,139 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:25,141 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:25,192 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:25,195 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:25,198 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:25,201 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:25,204 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:25,207 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:25,211 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:25,211 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:25,211 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:25,276 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:25,285 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:25,287 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:25,288 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:25,290 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:25,290 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:25,293 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:25,331 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:25,430 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:25,437 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:25,437 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:25,439 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:25,441 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:25,446 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.82s
2025-10-12 11:03:25,580 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:25,581 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:25,582 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:25,583 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:25,586 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:25,656 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:25,657 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:25,658 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:25,661 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:25,661 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:25,708 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:25,709 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:25,710 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-12 11:03:25,713 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:25,715 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:25,716 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:25,717 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:25,718 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:25,718 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:25,719 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:25,719 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:25,804 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:26,220 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:26,222 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:26,223 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:26,223 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:26,223 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:26,224 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:26,224 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:26,225 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:26,228 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:26,228 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:26,229 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:26,230 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:26,232 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:26,232 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:26,233 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:26,233 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:26,236 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:26,236 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:26,236 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:26,237 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:26,239 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:26,239 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:26,240 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:26,240 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:26,242 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:26,243 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:26,243 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:26,244 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:26,244 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:26,245 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:26,245 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:26,245 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:26,246 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:26,246 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:26,247 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:26,248 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:26,251 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:26,251 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:26,252 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:26,252 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:26,253 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:26,253 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:26,253 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:26,254 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:26,254 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:26,255 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:26,255 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:26,256 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:26,258 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:26,258 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:26,258 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:26,259 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:26,259 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:26,260 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:26,260 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:26,261 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:26,291 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:26,292 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:26,293 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:26,294 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:26,295 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:26,295 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:26,296 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:26,296 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:26,297 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:26,297 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:26,297 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:26,298 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:26,298 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:26,299 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:26,299 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:26,300 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:26,301 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:26,301 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:26,301 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:26,302 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:26,303 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:26,303 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:26,303 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:26,304 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:26,304 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:26,304 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,305 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:26,305 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:26,306 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:26,306 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,306 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:26,307 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:26,307 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:26,309 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:26,309 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:26,310 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:26,310 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:26,311 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:26,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:26,312 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:26,313 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:26,314 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:26,314 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:26,314 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:26,315 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:26,316 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:26,316 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:26,317 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:26,317 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:26,317 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:26,319 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:26,320 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:26,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:26,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:26,323 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:26,380 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:26,383 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:26,385 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:26,385 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:26,386 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:26,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:26,387 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:26,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:26,389 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:26,390 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:26,390 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:26,391 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:26,401 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:26,440 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:26,441 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:26,442 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:26,442 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:26,443 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,445 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:26,446 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:26,446 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:26,447 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:26,448 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:26,449 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:26,507 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:26,512 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,513 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:26,513 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:26,514 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:26,517 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:26,519 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:26,521 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:26,521 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:26,523 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,575 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:26,576 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,577 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:26,577 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:26,578 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:26,579 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:26,580 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:26,581 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:26,582 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.92s
2025-10-12 11:03:26,660 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:26,660 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:26,662 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:26,674 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:26,710 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:26,711 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:26,714 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:26,714 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:26,714 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:26,715 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:26,716 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-12 11:03:26,718 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:26,721 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:26,723 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:27,000 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:27,001 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:27,002 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:27,002 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:27,003 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:27,003 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:27,004 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:27,004 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:27,506 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:27,508 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:27,508 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:27,509 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:27,509 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:27,510 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:27,510 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:27,511 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:27,513 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:27,514 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:27,514 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:27,515 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:27,524 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:27,524 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:27,525 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:27,525 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:27,528 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:27,528 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:27,528 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:27,529 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:27,532 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:27,533 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:27,533 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:27,533 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:27,537 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:27,538 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:27,539 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:27,539 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:27,540 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:27,541 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:27,575 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:27,577 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:27,578 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:27,579 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:27,581 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:27,581 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:27,585 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:27,586 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:27,586 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:27,586 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:27,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:27,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:27,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:27,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:27,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:27,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:27,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:27,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:27,590 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:27,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:27,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:27,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:27,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:27,593 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:27,593 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:27,594 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:27,595 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:27,595 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:27,596 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:27,596 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:27,597 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:27,597 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:27,598 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:27,598 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:27,598 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:27,599 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:27,599 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:27,599 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:27,600 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:27,600 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:27,603 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:27,604 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:27,657 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:27,658 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:27,659 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:27,660 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:27,661 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:27,662 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:27,663 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:27,663 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:27,664 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:27,664 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:27,665 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:27,666 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:27,668 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:27,669 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:27,669 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:27,670 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:27,671 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:27,672 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:27,672 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:27,672 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:27,673 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:27,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:27,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:27,677 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:27,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:27,678 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:27,678 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:27,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:27,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:27,680 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:27,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:27,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:27,683 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:27,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:27,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:27,695 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:27,740 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:27,745 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:27,748 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:27,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:27,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:27,750 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:27,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:27,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:27,755 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:27,756 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:27,756 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:27,757 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:27,757 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:27,758 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:27,758 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:27,759 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:27,761 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:27,761 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:27,762 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:27,762 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:27,763 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:27,763 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:27,763 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:27,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:27,829 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:27,839 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:27,915 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:28,031 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:28,115 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:28,117 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:28,119 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:28,180 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:28,198 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:28,207 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:28,214 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:28,264 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:28,268 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:28,268 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:28,270 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:28,270 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:28,278 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:28,279 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:28,285 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:28,286 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:28,357 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:28,414 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:28,419 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:28,467 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:28,485 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:28,487 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:28,488 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:28,491 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:28,494 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:28,560 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.90s
2025-10-12 11:03:28,623 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:28,626 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:28,627 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:28,628 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:28,632 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:28,701 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:28,702 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:28,703 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:28,706 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:28,708 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:28,709 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:28,710 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:28,711 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:28,719 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:28,720 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:28,721 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:28,722 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:28,722 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:28,723 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:28,724 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:28,725 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:28,735 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:29,226 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:29,228 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:29,228 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:29,229 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:29,229 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:29,230 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:29,230 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:29,231 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:29,233 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:29,233 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:29,234 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:29,234 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:29,237 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:29,237 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:29,238 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:29,238 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:29,241 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:29,241 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:29,241 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:29,242 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:29,244 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:29,244 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:29,245 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:29,245 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:29,248 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:29,248 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:29,249 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:29,249 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:29,250 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:29,251 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:29,251 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:29,251 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:29,251 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:29,252 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:29,253 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:29,253 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:29,257 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:29,258 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:29,258 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:29,259 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:29,259 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:29,260 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:29,260 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:29,260 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:29,265 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:29,295 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:29,297 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:29,298 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:29,298 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:29,299 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:29,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:29,301 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:29,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:29,302 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:29,302 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:29,303 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:29,304 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:29,304 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:29,304 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:29,305 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:29,305 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:29,306 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:29,307 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:29,308 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:29,308 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:29,308 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:29,309 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:29,309 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:29,310 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:29,310 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:29,310 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:29,311 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:29,311 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:29,312 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:29,312 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:29,313 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:29,313 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:29,314 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:29,314 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:29,315 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:29,315 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:29,316 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,316 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:29,317 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:29,317 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:29,318 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,318 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:29,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:29,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:29,322 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:29,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:29,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:29,366 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:29,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:29,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:29,373 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:29,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:29,374 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:29,375 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:29,375 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:29,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:29,377 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:29,378 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:29,380 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:29,380 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:29,380 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:29,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:29,382 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:29,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:29,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:29,384 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:29,385 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,385 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:29,386 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:29,386 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:29,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:29,387 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:29,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:29,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:29,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:29,389 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:29,389 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:29,390 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:29,390 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:29,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:29,392 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:29,392 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:29,393 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:29,393 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:29,394 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,394 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:29,395 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:29,395 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:29,395 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:29,396 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:29,396 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:29,449 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:29,451 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,451 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:29,452 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:29,452 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:29,456 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:29,457 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:29,457 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:29,458 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:29,459 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,459 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:29,460 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,460 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:29,460 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:29,461 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:29,461 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:29,462 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:29,464 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:29,465 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.76s
2025-10-12 11:03:29,476 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:29,477 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:29,478 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:29,513 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:29,518 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:29,708 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:29,709 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:29,710 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:29,712 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:29,713 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:29,714 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:29,715 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:29,715 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:29,721 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:30,026 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:30,027 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:30,028 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:30,028 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:30,029 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:30,029 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:30,030 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:30,030 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:30,531 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:30,533 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:30,534 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:30,534 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:30,535 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:30,536 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:30,536 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:30,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:30,540 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:30,540 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:30,541 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:30,541 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:30,551 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:30,577 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:30,578 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:30,578 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:30,580 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:30,581 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:30,581 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:30,582 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:30,585 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:30,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:30,586 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:30,586 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:30,589 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:30,589 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:30,590 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:30,591 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:30,591 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:30,592 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:30,592 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:30,592 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:30,593 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:30,593 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:30,594 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:30,594 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:30,599 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:30,599 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:30,600 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:30,600 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:30,603 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:30,603 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:30,604 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:30,647 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:30,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:30,650 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:30,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:30,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:30,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:30,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:30,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:30,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:30,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:30,655 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:30,656 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:30,657 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:30,658 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:30,659 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:30,659 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:30,660 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:30,660 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:30,661 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:30,661 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:30,662 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:30,662 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:30,663 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:30,663 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:30,664 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:30,664 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:30,666 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:30,667 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:30,667 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:30,668 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:30,668 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:30,669 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:30,669 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:30,670 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:30,670 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:30,671 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:30,671 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:30,672 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:30,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:30,710 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:30,710 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:30,712 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:30,713 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:30,714 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:30,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:30,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:30,716 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:30,716 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:30,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:30,719 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:30,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:30,720 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:30,721 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:30,723 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:30,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:30,723 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:30,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:30,725 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:30,726 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:30,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:30,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:30,729 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:30,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:30,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:30,731 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:30,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:30,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:30,732 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:30,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:30,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:30,735 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:30,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:30,737 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:30,737 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:30,738 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:30,739 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:30,740 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:30,742 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:30,796 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:30,798 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:30,798 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:30,799 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:30,800 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:30,801 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:30,801 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:30,802 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:30,802 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:30,803 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:30,804 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:30,805 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:30,805 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:30,806 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:30,806 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:30,806 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:30,807 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:30,853 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:30,854 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:30,855 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:30,855 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:30,856 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:30,874 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:30,951 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:30,963 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:30,964 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:30,973 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:31,044 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:31,052 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:31,061 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:31,061 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:31,064 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:31,074 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:31,122 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:31,128 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:31,195 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:31,197 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:31,199 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:31,201 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:31,204 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:31,211 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.50s
2025-10-12 11:03:31,406 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:31,407 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:31,408 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:31,409 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:31,411 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:31,717 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:31,718 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:31,720 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:31,722 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:31,722 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:31,724 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:31,724 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:31,725 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:31,761 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:32,012 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:32,013 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:32,014 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:32,014 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:32,015 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:32,015 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:32,015 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:32,016 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:32,473 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:32,474 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:32,528 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:32,544 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:32,545 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.07s
2025-10-12 11:03:32,546 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:32,547 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:32,547 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:32,548 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:32,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:32,548 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:32,551 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:32,552 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:32,552 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:32,553 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:32,556 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:32,557 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:32,558 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:32,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:32,561 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:32,562 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:32,562 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:32,562 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:32,565 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:32,565 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:32,566 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:32,566 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:32,570 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:32,571 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:32,572 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:32,572 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:32,573 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:32,618 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:32,621 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:32,622 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:32,623 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:32,623 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:32,625 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:32,625 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:32,631 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:32,632 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:32,632 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:32,633 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:32,634 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:32,635 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:32,636 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:32,636 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:32,637 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:32,637 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:32,638 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:32,638 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:32,639 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:32,639 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:32,640 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:32,640 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:32,641 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:32,641 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:32,641 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:32,642 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:32,643 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:32,643 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:03:32,643 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:32,644 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:32,645 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:32,646 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:32,646 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:32,647 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:32,647 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:32,648 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:32,649 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:32,649 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:32,650 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:32,651 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:32,651 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:32,653 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:32,653 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:32,706 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:32,706 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:32,707 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:32,707 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:32,708 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:32,708 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:32,709 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:32,710 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:32,710 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:32,711 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:32,711 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:32,712 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:32,713 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:32,713 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:32,714 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:32,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:32,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:32,716 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:32,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:32,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:32,717 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:32,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:32,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:32,719 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:32,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:32,721 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:32,722 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:32,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:32,722 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:32,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:32,726 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:32,727 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:32,727 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:32,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:32,730 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:32,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:32,777 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:32,778 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:32,779 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:03:32,780 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:32,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:32,783 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:32,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:32,784 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:32,785 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:32,786 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:32,786 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:32,786 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:32,787 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:32,788 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:32,788 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:32,789 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:32,789 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:32,790 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:32,790 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:32,790 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:32,791 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:32,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:32,791 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:32,792 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:32,792 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:32,793 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:32,793 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:32,794 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:32,795 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:32,795 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:32,796 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:32,796 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:32,796 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:32,797 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:32,799 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:32,801 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:32,847 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:32,848 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:32,849 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:32,855 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:32,855 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:32,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:32,858 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:32,875 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:33,018 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:33,104 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:33,106 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:33,107 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:33,107 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:33,108 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:33,110 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:33,155 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:33,216 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:33,235 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.52s
2025-10-12 11:03:33,430 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:33,431 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:33,432 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:33,433 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:33,436 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:33,724 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:33,725 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:33,727 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:33,729 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:33,730 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:33,731 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:33,732 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:33,732 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:33,773 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:34,244 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:34,245 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:34,246 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:34,246 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:34,247 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:34,248 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:34,248 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:34,249 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:34,731 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:34,750 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:34,751 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:34,752 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:34,753 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:34,753 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:34,754 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:34,755 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:34,755 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:34,756 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:34,757 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:34,757 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-12 11:03:34,758 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:34,759 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:34,761 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:34,792 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:34,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:34,804 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:34,864 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:34,998 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:35,001 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:35,002 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:35,015 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:35,070 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:35,081 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:35,082 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:35,084 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:35,088 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:35,090 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:35,092 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:35,093 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:35,097 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:35,099 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:35,100 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:35,100 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:35,102 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:35,103 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:35,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:35,109 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:35,160 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:35,163 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:35,167 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:35,169 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:35,180 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:35,226 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:35,276 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:35,351 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:35,352 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:35,355 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:35,358 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:35,359 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:35,361 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:35,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:35,418 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:35,420 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:35,422 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:35,427 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:35,429 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:35,430 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:35,434 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:35,437 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:35,438 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:35,440 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:35,443 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:35,445 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:35,447 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:35,502 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:35,507 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:35,508 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:35,509 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:35,509 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:35,510 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:35,512 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:35,513 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:35,513 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:35,513 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:35,514 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:35,514 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:35,515 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:35,516 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:35,517 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:35,520 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:35,521 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:35,559 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:35,560 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:35,562 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:35,562 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:35,563 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:35,563 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,564 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:35,565 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:35,565 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:35,566 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,566 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:35,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:35,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:35,569 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:35,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:35,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:35,571 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:35,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:35,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:35,573 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:35,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:35,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:35,574 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:35,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:35,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:35,576 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:35,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:35,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:35,579 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:35,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:35,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:35,580 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:35,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:35,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:35,582 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:35,583 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,584 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:35,585 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:35,585 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:35,586 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:35,586 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:35,586 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:35,586 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:35,587 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:35,587 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:35,587 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:35,588 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:35,588 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:35,588 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:35,589 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:35,590 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:35,591 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:35,591 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:35,592 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,592 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:35,592 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:35,593 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:35,593 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:35,594 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:35,595 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:35,596 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:35,598 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,600 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:35,601 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:35,601 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:35,605 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:35,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:35,606 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:35,607 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:35,608 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:35,609 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,610 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:35,610 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:35,610 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:35,611 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:35,611 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:35,612 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:35,615 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.89s
2025-10-12 11:03:35,686 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:35,687 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:35,689 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:35,690 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:35,693 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:35,763 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:35,764 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:35,766 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:35,768 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:35,769 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:35,771 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:35,771 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:35,772 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:35,780 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:35,781 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:35,782 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:35,782 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:35,783 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:35,784 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:35,784 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:35,785 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:35,799 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:36,286 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:36,288 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:36,289 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:36,290 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:36,291 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:36,291 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:36,292 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:36,293 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:36,294 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:36,295 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:36,295 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:36,296 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:36,300 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:36,300 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:36,301 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:36,301 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:36,305 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:36,305 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:36,305 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:36,306 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:36,308 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:36,309 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:36,309 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:36,309 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:36,312 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:36,313 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:36,313 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:36,313 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:36,314 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:36,314 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:36,315 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:36,315 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:36,315 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:36,316 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:36,318 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:36,318 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:36,322 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:36,322 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:36,323 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:36,324 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:36,330 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:36,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:36,362 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:36,362 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:36,363 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:36,363 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:36,364 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:36,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:36,365 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:36,365 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:36,365 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:36,366 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:36,366 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:36,366 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:36,367 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:36,368 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:36,368 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:36,369 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:36,369 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:36,370 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:36,370 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:36,371 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:36,371 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:36,371 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:36,372 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:36,372 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:36,373 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:36,373 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:36,373 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:36,374 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:36,374 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:36,375 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:36,375 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:36,376 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:36,376 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:36,377 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:36,377 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:36,377 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:36,378 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:36,378 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:36,379 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:36,379 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,379 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:36,380 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:36,380 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:36,380 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:36,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:36,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:36,382 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:36,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:36,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:36,384 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:36,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:36,387 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:36,388 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:36,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:36,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:36,431 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:36,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:36,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:36,434 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:36,434 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:36,435 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:36,436 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:36,437 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:36,438 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:36,443 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:36,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:36,448 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:36,449 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:36,450 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,451 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:36,451 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:36,451 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:36,452 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:36,454 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:36,457 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:36,458 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:36,458 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:36,459 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:36,459 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:36,460 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:36,460 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:36,460 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:36,461 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:36,461 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:36,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:36,463 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:36,463 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,464 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:36,464 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:36,465 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:36,465 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:36,466 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:36,467 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:36,469 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:36,472 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,473 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:36,516 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:36,517 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:36,517 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:36,521 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:36,522 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:36,523 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:36,524 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,524 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:36,525 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,526 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:36,526 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:36,527 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:36,527 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:36,528 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:36,528 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:36,529 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.76s
2025-10-12 11:03:36,537 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:36,538 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:36,539 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:36,543 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:36,547 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:36,769 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:36,771 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:36,773 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:36,774 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:36,775 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:36,777 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:36,777 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:36,778 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:36,788 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:36,788 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:36,789 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:36,790 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:36,790 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:36,791 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:36,791 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:36,792 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:36,903 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:37,293 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:37,295 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:37,296 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:37,296 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:37,297 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:37,297 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:37,298 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:37,298 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:37,301 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:37,301 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:37,301 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:37,302 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:37,305 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:37,306 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:37,307 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:37,308 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:37,314 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:37,315 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:37,315 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:37,316 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:37,318 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:37,319 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:37,319 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:37,319 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:37,323 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:37,324 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:37,324 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:37,325 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:37,360 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:37,361 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:37,361 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:37,362 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:37,363 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:37,364 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:37,366 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:37,366 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:37,370 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:37,371 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:37,372 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:37,372 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:37,373 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:37,373 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:37,374 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:37,374 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:37,374 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:37,375 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:37,375 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:37,375 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:37,376 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:37,377 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:37,378 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:37,378 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:37,378 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:37,379 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:37,379 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:37,380 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:37,380 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:37,381 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:37,381 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:37,382 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:37,383 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:37,385 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:37,386 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:37,386 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:37,437 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:37,438 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:37,439 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:37,439 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:37,440 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:37,440 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:37,441 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:37,442 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:37,444 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:37,446 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:37,446 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:37,446 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:37,447 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:37,447 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:37,448 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:37,448 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:37,449 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:37,449 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,451 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:37,452 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:37,452 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:37,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,453 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:37,454 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:37,455 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:37,456 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:37,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:37,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:37,460 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:37,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:37,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:37,461 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:37,462 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:37,464 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:37,466 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:37,520 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:37,524 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:37,525 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:37,526 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:37,527 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:37,528 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:37,528 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:37,529 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:37,530 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:37,531 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:37,533 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:37,533 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:37,534 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,534 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:37,535 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:37,535 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:37,536 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:37,537 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:37,537 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:37,538 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:37,540 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:37,540 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:37,541 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:37,541 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:37,542 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:37,543 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:37,583 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:37,584 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:37,587 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:37,588 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:37,589 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,590 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:37,590 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:37,591 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:37,591 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:37,592 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:37,593 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:37,594 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:37,596 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,597 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:37,597 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:37,598 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:37,599 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:37,599 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:37,599 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,603 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:37,604 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:37,605 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:37,605 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,606 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:37,606 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:37,607 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:37,607 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:37,607 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:37,608 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:37,610 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-12 11:03:37,756 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:37,757 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:37,758 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:37,759 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:37,762 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:37,814 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:37,816 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:37,818 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:37,821 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:37,824 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:37,825 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:37,826 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:37,827 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:37,837 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:37,838 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:37,839 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:37,839 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:37,840 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:37,841 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:37,841 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:37,842 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:37,902 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:38,343 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:38,344 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:38,345 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:38,345 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:38,346 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:38,347 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:38,347 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:38,347 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:38,351 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:38,351 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:38,353 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:38,353 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:38,362 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:38,388 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:38,389 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:38,390 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:38,394 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:38,395 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:38,395 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:38,396 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:38,398 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:38,398 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:38,399 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:38,399 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:38,402 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:38,402 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:38,403 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:38,403 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:38,404 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:38,404 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:38,404 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:38,405 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:38,405 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:38,406 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:38,407 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:38,407 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:38,410 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:38,411 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:38,411 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:38,411 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:38,412 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:38,412 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:38,412 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:38,413 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:38,413 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:38,417 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:38,418 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:38,465 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:38,466 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:38,467 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:38,467 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:38,468 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:38,468 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:38,469 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:38,469 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:38,470 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:38,471 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:38,472 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:38,472 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:38,473 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:38,474 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:38,475 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:38,475 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:38,475 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:38,476 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:38,477 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:38,478 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:38,478 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:38,479 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:38,479 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:38,479 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:38,480 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:38,481 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:38,481 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:38,481 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:38,482 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:38,482 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:38,486 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:38,532 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:38,534 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:38,534 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:38,536 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,536 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:38,537 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:38,538 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:38,538 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,539 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:38,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:38,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:38,541 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:38,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:38,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:38,544 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:38,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:38,545 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:38,546 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:38,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:38,547 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:38,547 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:38,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:38,550 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:38,551 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:38,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:38,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:38,553 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:38,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:38,606 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:38,608 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:38,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:38,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:38,611 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:38,612 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,612 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:38,613 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:38,614 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:38,614 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:38,615 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:38,616 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:38,616 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:38,617 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:38,618 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:38,619 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:38,619 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:38,620 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:38,620 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:38,621 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:38,627 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:38,667 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:38,668 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:38,670 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,671 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:38,672 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:38,672 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:38,713 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:38,715 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:38,717 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:38,719 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:38,720 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:38,721 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,721 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:38,722 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:38,726 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:38,726 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:38,727 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:38,727 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:38,728 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,731 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:38,777 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,779 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:38,779 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:38,780 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:38,782 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:38,783 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:38,783 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:38,784 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.97s
2025-10-12 11:03:38,845 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:38,849 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:38,851 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:38,855 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:38,856 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:38,858 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:38,905 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:38,907 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:38,908 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-12 11:03:38,910 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:38,911 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:38,913 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:38,916 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:38,919 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:39,195 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:39,196 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:39,197 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:39,198 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:39,198 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:39,199 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:39,199 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:39,200 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:39,701 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:39,703 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:39,704 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:39,704 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:39,704 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:39,705 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:39,705 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:39,706 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:39,709 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:39,709 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:39,710 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:39,710 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:39,713 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:39,714 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:39,715 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:39,716 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:39,717 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:39,718 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:39,718 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:39,719 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:39,722 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:39,722 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:39,723 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:39,723 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:39,726 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:39,726 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:39,727 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:39,727 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:39,728 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:39,729 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:39,729 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:39,730 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:39,730 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:39,730 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:39,731 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:39,732 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:39,766 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:39,801 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:39,804 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:39,804 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:39,805 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:39,806 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:39,807 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:39,849 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:39,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:39,850 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:39,851 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:39,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:39,852 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:39,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:39,856 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:39,856 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:39,858 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:39,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:39,859 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:39,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:39,861 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:39,862 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:39,863 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:39,863 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:39,864 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:39,865 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:39,866 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:39,867 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:39,868 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:39,868 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:39,869 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:39,869 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:39,870 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:39,872 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:39,872 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:39,923 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:39,924 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:39,924 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:39,926 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:39,927 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:39,928 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:39,929 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:39,929 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:39,930 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:39,931 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:39,931 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:39,932 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:39,932 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:39,933 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:39,933 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:39,934 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:39,934 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:39,934 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:39,935 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:39,935 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:39,935 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:39,936 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:39,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:39,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:39,937 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:39,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:39,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:39,941 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:39,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:39,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:39,943 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:39,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:39,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:39,945 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:39,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:39,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:39,947 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:39,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:39,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:39,949 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:39,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:39,952 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:39,952 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:39,962 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:39,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:40,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:40,012 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:40,076 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:40,139 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:40,167 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:40,227 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:40,240 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:40,244 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:40,308 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:40,314 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:40,379 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:40,393 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:40,395 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:40,396 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:40,400 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:40,403 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:40,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:40,465 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:40,466 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:40,468 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:40,481 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:40,487 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:40,589 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:40,600 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:40,607 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:40,609 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:40,612 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:40,618 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:40,621 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:40,622 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:40,623 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:40,625 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:40,723 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:40,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:40,725 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:40,727 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:40,732 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:40,734 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:40,735 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:40,737 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:40,739 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:40,743 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:40,746 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:40,748 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:40,748 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:40,750 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.90s
2025-10-12 11:03:40,806 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:40,809 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:40,809 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:40,812 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:40,817 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:40,885 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:40,887 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:40,889 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:40,892 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:40,893 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:40,895 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:40,895 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:40,896 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:40,908 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:40,909 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:40,910 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:40,911 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:40,912 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:40,912 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:40,913 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:40,913 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:40,960 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:41,415 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:41,417 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:41,418 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:41,418 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:41,419 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:41,419 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:41,420 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:41,420 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:41,423 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:41,423 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:41,423 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:41,424 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:41,427 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:41,428 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:41,428 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:41,429 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:41,431 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:41,431 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:41,431 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:41,432 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:41,435 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:41,435 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:41,435 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:41,436 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:41,439 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:41,440 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:41,440 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:41,441 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:41,441 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:41,442 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:41,442 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:41,443 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:41,443 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:41,443 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:41,445 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:41,445 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:41,449 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:41,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:41,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:41,457 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:41,481 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:41,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:41,485 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:41,487 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:41,488 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:41,489 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:41,489 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:41,490 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:41,490 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:41,491 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:41,491 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:41,492 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:41,492 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:41,493 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:41,494 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:41,495 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:41,495 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:41,496 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:41,496 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:41,497 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:41,497 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:41,498 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:41,498 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:41,500 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:41,501 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:41,501 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:41,502 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:41,503 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:41,503 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:41,504 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:41,505 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:41,505 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:41,506 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:41,507 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:41,507 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:41,508 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:41,509 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:41,511 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:41,512 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:41,546 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:41,551 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:41,552 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,554 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:41,555 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:41,555 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:41,556 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,557 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:41,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:41,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:41,559 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:41,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:41,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:41,561 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:41,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:41,563 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:41,564 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:41,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:41,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:41,566 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:41,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:41,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:41,568 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:41,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:41,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:41,571 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:41,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:41,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:41,573 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:41,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:41,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:41,577 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:41,578 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,578 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:41,579 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:41,580 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:41,580 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:41,581 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:41,581 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:41,581 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:41,582 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:41,583 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:41,583 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:41,583 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:41,584 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:41,584 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:41,585 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:41,588 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:41,589 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:41,638 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:41,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,640 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:41,641 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:41,642 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:41,643 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:41,643 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:41,644 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:41,646 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:41,647 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:41,648 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:41,648 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,652 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:41,652 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:41,653 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:41,653 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:41,654 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:41,655 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,656 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:41,657 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,657 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:41,657 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:41,658 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:41,658 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:41,659 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:41,659 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:41,661 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.77s
2025-10-12 11:03:41,786 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:41,787 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:41,789 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:41,794 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:41,797 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:41,890 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:41,891 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:41,893 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:41,895 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:41,896 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:41,897 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:41,898 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:41,898 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:41,901 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:42,144 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:42,144 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:42,145 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:42,146 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:42,146 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:42,147 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:42,147 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:42,148 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:42,649 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:42,650 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:42,651 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:42,651 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:42,652 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:42,652 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:42,652 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:42,653 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:42,655 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:42,655 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:42,656 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:42,657 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:42,662 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:42,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:42,664 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:42,664 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:42,667 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:42,667 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:42,668 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:42,669 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:42,678 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:42,694 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:42,695 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:42,695 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:42,699 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:42,700 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:42,701 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:42,702 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:42,702 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:42,702 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:42,703 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:42,703 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:42,704 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:42,704 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:42,711 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:42,731 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:42,735 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:42,737 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:42,737 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:42,738 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:42,738 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:42,739 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:42,739 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:42,739 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:42,740 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:42,741 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:42,742 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:42,742 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:42,743 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:42,744 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:42,744 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:42,745 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:42,745 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:42,746 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:42,746 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:42,747 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:42,747 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:42,748 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:42,750 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:42,751 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:42,751 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:42,752 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:42,752 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:42,753 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:42,753 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:42,754 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:42,754 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:42,755 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:42,756 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:42,756 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:42,757 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:42,757 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:42,758 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:42,759 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:42,759 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:42,760 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:42,761 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:42,761 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:42,762 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:42,762 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:42,762 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:42,763 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,763 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:42,764 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:42,765 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:42,766 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,808 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:42,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:42,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:42,813 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:42,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:42,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:42,816 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:42,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:42,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:42,818 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:42,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:42,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:42,820 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:42,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:42,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:42,824 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:42,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:42,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:42,826 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:42,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:42,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:42,828 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:42,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:42,830 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:42,831 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:42,831 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,833 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:42,833 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:42,834 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:42,887 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:42,891 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:42,892 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:42,893 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:42,894 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:42,894 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:42,896 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:42,897 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:42,897 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:42,898 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:42,899 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:42,900 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:42,900 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:42,901 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:42,949 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:42,950 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,951 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:42,952 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:42,952 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:42,953 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:42,954 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:42,955 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:42,955 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:42,955 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:42,956 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:03:42,957 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:42,958 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:42,959 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:42,960 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,961 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:42,962 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:42,962 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:42,963 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:42,965 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:42,966 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:42,967 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:42,967 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,968 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:42,968 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,969 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:42,969 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:42,970 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:42,970 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:42,970 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:42,971 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:42,972 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.08s
2025-10-12 11:03:43,029 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:43,161 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:43,162 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:43,162 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:43,163 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:43,167 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:43,902 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:43,903 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:43,904 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:43,906 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:43,907 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:43,908 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:43,909 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:43,910 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:43,918 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:43,950 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:43,952 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:43,953 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:43,954 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:43,955 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:43,955 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:43,956 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:43,966 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:44,457 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:44,459 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:44,460 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:44,460 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:44,461 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:44,461 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:44,462 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:44,462 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:44,465 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:44,465 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:44,465 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:44,466 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:44,470 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:44,471 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:44,471 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:44,472 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:44,474 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:44,475 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:44,475 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:44,475 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:44,478 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:44,478 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:44,479 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:44,480 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:44,489 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:44,515 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:44,516 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:44,516 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:44,517 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:44,517 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:44,517 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:44,518 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:44,518 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:44,519 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:44,520 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:44,521 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:44,524 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:44,525 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:44,525 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:44,526 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:44,526 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:44,526 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:44,527 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:44,527 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:44,527 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:44,528 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:44,528 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:44,529 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:44,529 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:44,529 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:44,530 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:44,530 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:44,531 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:44,532 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:44,532 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:44,533 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:44,533 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:44,534 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:44,534 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:44,535 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:44,535 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:44,536 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:44,536 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:44,536 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:44,537 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:44,537 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:44,538 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:44,538 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:44,539 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:44,539 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:44,539 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:44,543 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:44,544 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:44,590 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:44,591 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:44,593 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:44,594 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:44,595 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:44,596 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:44,596 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:44,597 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:44,597 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,598 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:44,598 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:44,599 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:44,599 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,600 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:44,600 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:44,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:44,603 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:44,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:44,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:44,604 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:44,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:44,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:44,606 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:44,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:44,608 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:44,609 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:44,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:44,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:44,611 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:44,611 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:44,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:44,614 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:44,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:44,616 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:44,617 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:44,617 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:44,619 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:44,621 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:44,621 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,622 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:44,622 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:44,623 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:44,623 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:44,624 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:44,624 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:44,624 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:44,625 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:44,626 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:44,626 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:44,629 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:44,630 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:44,630 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:44,630 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:44,631 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:44,680 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:44,681 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:44,683 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,684 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:44,685 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:44,685 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:44,686 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:44,686 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:44,687 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:44,688 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:44,691 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,692 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:44,692 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:44,692 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:44,696 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:44,699 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:44,700 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:44,700 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:44,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,702 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:44,702 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,703 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:44,703 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:44,703 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:44,704 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:44,705 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:44,706 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:44,708 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.80s
2025-10-12 11:03:44,778 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:44,779 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:44,780 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:44,782 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:44,830 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:44,907 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:44,908 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:44,909 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:44,912 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:44,913 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:44,915 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:44,916 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:44,917 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:44,932 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:45,272 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:45,273 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:45,273 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:45,274 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:45,274 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:45,275 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:45,275 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:45,276 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:45,777 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:45,779 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:45,779 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:45,780 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:45,780 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:45,781 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:45,781 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:45,781 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:45,784 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:45,784 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:45,785 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:45,786 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:45,789 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:45,789 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:45,791 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:45,792 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:45,794 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:45,794 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:45,824 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:45,825 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:45,828 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:45,829 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:45,829 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:45,829 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:45,832 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:45,832 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:45,833 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:45,834 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:45,834 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:45,834 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:45,835 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:45,835 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:45,836 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:45,836 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:45,838 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:45,838 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:45,841 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:45,842 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:45,842 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:45,843 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:45,843 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:45,844 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:45,844 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:45,844 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:45,845 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:45,845 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:45,845 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:45,846 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:45,846 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:45,846 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:45,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:45,847 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:45,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:45,848 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:45,848 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:45,849 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:45,849 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:45,849 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:45,850 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:45,850 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:45,851 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:45,852 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:45,855 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:45,856 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:45,906 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:45,908 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:45,909 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:45,911 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:45,914 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:45,914 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:45,917 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:45,917 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:45,918 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:45,919 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:45,920 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:45,921 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:45,921 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:45,922 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:45,923 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:45,923 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:45,924 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:45,924 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:45,925 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:45,925 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:45,925 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:45,926 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:45,926 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:45,927 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:45,927 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:45,928 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:45,929 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:45,930 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:45,930 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:45,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:45,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:45,976 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:45,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:45,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:45,980 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:45,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:45,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:45,982 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:45,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:45,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:45,984 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:45,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:45,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:45,987 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:45,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:45,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:45,988 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:45,989 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:45,989 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:45,990 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:45,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:45,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:45,994 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:45,994 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:45,995 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:45,995 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:45,998 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:45,998 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:46,052 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:46,055 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:46,067 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:46,121 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:46,135 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:46,186 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:46,192 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:46,263 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:46,281 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:46,382 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:46,396 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:46,398 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:46,398 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:46,399 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:46,399 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:46,409 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:46,427 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:46,484 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:46,493 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:46,495 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:46,500 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:46,503 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:46,510 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:46,554 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:46,561 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:46,567 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:46,628 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:46,633 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:46,639 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:46,641 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:46,698 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:46,705 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:46,708 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:46,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:46,712 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:46,768 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:46,772 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:46,774 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:46,775 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:46,778 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.87s
2025-10-12 11:03:46,846 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:46,847 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:46,848 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:46,851 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:46,855 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:46,916 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:46,917 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:46,919 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:46,920 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:46,921 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:46,923 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:46,923 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:46,924 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:46,973 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:46,974 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:46,976 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:46,976 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:46,977 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:46,978 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:46,978 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:46,979 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:47,067 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:47,475 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:47,476 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:03:47,480 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:47,482 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:47,483 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.01s
2025-10-12 11:03:47,483 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:47,484 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:47,484 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:47,485 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:47,485 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:47,486 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:47,488 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:47,488 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:47,488 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:47,489 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:47,492 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:47,492 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:47,494 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:47,495 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:47,501 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:47,501 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:47,501 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:47,502 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:47,504 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:47,504 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:47,505 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:47,505 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:47,508 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:47,509 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:47,509 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:47,510 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:47,510 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:47,511 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:47,511 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:47,511 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:47,512 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:47,512 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:47,518 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:47,545 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:47,546 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:03:47,550 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:47,552 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:47,552 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:47,553 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:47,553 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:47,554 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:47,554 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:47,554 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:47,555 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:47,555 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:47,555 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:47,556 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:47,556 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:47,557 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:47,558 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:47,558 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:47,558 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:47,559 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:47,559 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:47,560 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:47,560 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:47,561 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:47,561 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:47,562 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:47,562 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:47,563 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:47,563 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:47,564 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:47,565 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:47,565 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:47,565 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:47,566 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:47,566 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:47,566 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:47,567 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:47,568 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:47,568 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:47,569 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:47,569 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:47,570 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:47,570 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:47,571 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:47,571 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:47,571 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:47,572 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:47,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:47,575 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:47,614 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:47,616 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,617 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:47,617 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:47,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:47,672 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:47,674 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:47,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:47,676 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:47,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:47,677 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:47,679 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:47,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:47,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:47,682 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:47,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:47,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:47,684 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:47,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:47,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:47,686 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:47,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:47,687 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:47,688 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:47,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:47,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:47,691 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:47,691 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,692 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:47,692 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:47,693 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:47,693 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:47,694 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:47,696 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:47,696 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:47,698 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:47,698 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:47,699 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:47,699 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:47,700 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:47,736 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:47,738 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:47,739 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:47,739 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:47,739 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:47,740 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,740 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:47,741 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:47,741 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:47,742 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:47,742 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:47,745 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:47,746 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:47,748 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,749 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:47,749 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:47,752 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:47,755 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:47,756 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:47,757 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:47,757 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:47,758 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,759 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:47,760 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,760 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:47,760 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:47,761 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:47,761 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:47,762 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:47,763 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:47,764 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-12 11:03:47,774 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:47,827 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:47,828 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:47,829 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:47,831 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:47,923 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:47,924 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:47,926 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:47,928 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:47,928 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:47,930 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:47,931 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:47,932 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:47,935 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:48,185 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:48,185 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:48,186 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:48,186 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:48,187 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:48,187 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:48,188 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:48,188 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:48,690 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:48,691 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:48,692 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:48,692 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:48,693 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:48,694 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:48,694 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:48,695 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:48,697 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:48,697 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:48,698 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:48,699 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:48,709 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:48,733 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:48,734 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:48,735 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:48,737 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:48,738 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:48,738 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:48,739 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:48,741 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:48,742 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:48,742 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:48,742 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:48,745 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:48,746 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:48,746 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:48,747 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:48,747 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:48,748 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:48,748 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:48,748 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:48,749 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:48,749 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:48,750 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:48,750 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:48,753 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:48,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:48,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:48,755 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:48,756 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:48,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:48,756 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:48,757 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:48,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:48,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:48,758 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:48,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:48,759 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:48,760 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:48,760 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:48,761 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:48,761 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:48,762 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:48,762 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:48,763 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:48,763 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:48,806 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:48,809 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:48,811 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:48,812 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:48,812 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:48,813 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:48,813 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:48,814 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:48,814 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:48,815 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:48,815 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:48,815 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:48,816 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:48,816 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:48,817 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:48,818 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:48,819 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:48,819 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:48,819 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:48,820 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:48,820 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:48,820 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:48,821 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:48,821 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:48,822 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,822 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:48,823 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:48,823 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:48,823 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,824 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:48,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:48,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:48,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:48,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:48,827 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:48,828 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:48,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:48,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:48,829 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:48,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:48,830 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:48,831 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:48,831 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:48,832 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:48,832 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:48,833 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:48,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:48,834 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:48,835 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:48,835 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:48,836 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:48,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:48,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:48,839 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:48,840 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,840 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:48,841 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:48,841 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:48,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:48,850 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:48,898 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:48,900 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:48,902 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:48,903 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:48,903 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:48,904 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:48,904 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:48,904 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:48,905 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:48,905 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:48,906 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:48,906 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:48,907 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,908 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:48,909 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:48,909 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:48,909 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:48,910 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:48,911 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:48,912 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:48,913 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,914 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:48,914 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:48,915 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:48,916 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:48,917 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:48,927 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:48,954 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,956 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:48,957 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:48,958 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,959 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:48,959 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:48,960 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:48,960 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:48,961 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:48,962 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:48,963 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.04s
2025-10-12 11:03:49,030 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:49,031 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:49,033 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:49,036 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:49,036 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:49,036 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:49,037 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:49,038 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:49,038 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:49,039 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:49,040 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:49,041 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:49,045 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:49,048 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:49,304 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:49,304 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:49,305 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:49,305 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:49,306 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:49,307 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:49,307 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:49,308 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:49,809 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:49,811 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:49,811 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:49,812 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:49,812 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:49,813 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:49,813 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:49,813 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:49,815 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:49,816 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:49,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:49,817 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:49,820 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:49,820 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:49,821 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:49,821 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:49,824 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:49,824 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:49,825 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:49,825 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:49,833 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:49,858 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:49,859 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:49,860 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:49,863 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:49,863 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:49,864 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:49,864 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:49,865 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:49,865 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:49,866 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:49,866 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:49,866 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:49,867 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:49,868 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:49,868 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:49,871 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:49,872 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:49,872 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:49,872 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:49,873 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:49,873 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:49,874 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:49,874 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:49,874 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:49,875 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:49,875 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:49,875 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:49,876 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:49,876 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:49,877 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:49,877 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:49,877 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:49,878 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:49,878 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:49,879 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:49,879 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:49,880 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:49,880 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:49,880 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:49,881 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:49,881 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:49,882 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:49,882 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:49,882 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:49,883 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:49,883 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:49,883 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:49,884 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:49,885 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:49,885 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:49,885 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:49,887 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:49,888 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:49,888 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:49,924 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:49,926 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:49,926 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:49,927 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:49,928 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:49,928 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:49,929 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:49,929 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:49,930 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:49,930 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:49,931 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:49,931 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:49,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:49,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:49,933 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:49,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:49,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:49,935 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:49,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:49,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:49,938 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:49,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:49,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:49,939 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:49,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:49,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:49,941 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:49,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:49,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:49,944 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:49,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:49,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:49,945 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:49,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:49,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:49,948 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:49,948 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:49,949 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:49,949 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:49,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:49,950 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:49,951 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:49,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:49,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:49,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:49,952 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:49,953 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:49,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:49,954 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:49,954 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:49,955 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:49,955 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:49,956 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:49,956 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:49,957 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:49,957 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:49,957 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:49,958 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:49,959 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:49,962 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:50,015 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:50,016 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:50,018 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,018 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:50,019 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:50,019 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:50,020 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:50,023 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:50,024 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:50,024 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:50,024 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,027 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,028 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,028 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,028 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,029 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:50,030 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:50,030 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:50,031 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:50,032 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.00s
2025-10-12 11:03:50,075 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:50,079 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:50,080 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:50,082 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:50,083 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:50,084 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:50,085 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:50,086 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:50,091 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:50,092 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:50,093 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:50,093 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:50,094 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:50,094 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:50,095 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:50,095 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:50,159 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:50,162 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:50,162 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:50,167 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:50,171 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:50,174 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:50,596 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:50,598 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:50,599 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:50,599 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:50,600 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:50,600 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:50,601 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:50,601 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:50,604 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:50,604 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:50,605 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:50,605 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:50,622 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:50,642 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:50,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:50,644 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:50,646 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:50,647 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:50,648 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:50,648 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:50,650 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:50,651 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:50,651 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:50,652 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:50,655 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:50,656 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:50,656 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:50,657 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:50,657 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:50,658 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:50,658 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:50,659 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:50,659 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:50,660 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:50,661 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:50,662 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:50,665 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:50,666 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:50,669 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:50,669 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:50,670 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:50,712 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:50,714 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:50,715 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:50,716 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:50,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:50,717 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:50,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:50,718 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:50,719 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:50,719 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:50,720 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:50,721 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:50,721 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:50,722 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:50,723 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:50,723 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:50,724 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:50,724 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:50,725 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:50,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:50,726 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:50,726 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:50,727 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:50,728 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:50,729 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:50,730 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:50,730 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:50,730 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:50,731 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:50,731 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:50,732 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:50,733 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:50,735 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:50,736 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:50,737 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:50,779 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:50,780 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:50,781 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:50,782 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:50,782 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:50,783 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,783 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,784 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:50,784 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:50,785 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,785 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:50,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:50,789 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:50,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:50,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:50,790 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:50,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:50,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:50,793 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:50,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:50,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:50,796 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:50,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:50,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:50,799 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:50,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:50,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:50,857 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:50,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:50,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:50,859 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:50,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:50,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:50,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:50,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,864 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,864 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:50,865 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:50,865 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:50,866 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:50,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:50,912 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:50,913 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:50,916 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:50,918 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:50,919 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:50,920 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:50,921 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:50,969 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:50,970 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:50,972 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:50,973 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:50,974 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,974 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,975 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:50,975 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:50,976 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:50,977 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:50,977 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:50,980 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:50,981 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,982 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:50,982 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:50,982 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:50,986 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:50,987 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:50,987 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:50,988 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:50,988 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,989 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,989 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,990 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:50,990 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:50,991 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:50,991 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:50,992 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:50,994 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:50,996 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.92s
2025-10-12 11:03:51,068 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:51,069 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:51,070 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:51,074 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:51,077 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:51,081 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:51,082 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:51,085 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:51,134 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:51,137 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:51,139 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:51,140 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:51,140 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:03:51,151 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:51,152 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:51,153 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:51,154 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:51,155 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:51,156 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:51,156 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:51,157 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:51,194 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:51,658 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:51,660 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:51,660 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:51,661 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:51,661 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:51,662 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:51,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:51,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:51,665 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:51,666 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:51,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:51,667 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:51,671 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:51,707 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:51,708 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:51,708 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:51,710 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:51,711 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:51,711 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:51,712 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:51,714 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:51,715 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:51,715 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:51,715 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:51,718 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:51,719 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:51,719 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:51,720 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:51,720 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:51,721 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:51,721 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:51,721 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:51,722 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:51,722 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:51,723 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:51,724 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:51,728 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:51,730 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:51,731 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:51,732 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:51,732 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:51,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:51,770 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:51,771 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:51,772 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:51,774 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:51,775 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:51,775 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:51,776 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:51,777 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:51,777 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:51,777 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:51,778 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:51,779 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:51,779 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:51,780 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:51,780 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:51,781 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:51,781 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:51,782 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:51,782 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:51,783 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:51,783 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:51,784 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:51,784 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:51,785 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:51,785 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:51,785 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:51,786 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:51,786 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:51,786 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:51,787 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:51,787 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:51,788 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:51,788 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:51,788 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:51,789 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:51,790 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:51,790 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:51,792 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:51,792 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:51,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:51,794 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:51,794 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:51,795 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,796 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:51,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:51,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:51,799 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:51,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:51,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:51,801 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:51,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:51,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:51,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:51,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:51,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:51,806 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:51,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:51,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:51,808 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:51,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:51,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:51,812 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:51,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:51,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:51,867 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:51,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:51,870 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:51,870 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:51,871 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,872 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:51,872 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:51,873 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:51,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:51,875 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:51,875 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:51,876 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:51,876 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:51,877 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:51,877 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:51,878 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:51,878 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:51,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:51,879 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:51,880 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:51,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:51,881 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:51,881 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,881 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:51,882 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:51,884 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:51,884 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:51,885 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:51,886 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:51,888 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:51,890 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:51,890 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:51,905 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,934 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:51,934 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:51,935 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:51,937 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:51,938 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:51,939 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,939 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:51,939 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,940 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:51,940 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:51,941 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:51,941 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:51,941 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:51,942 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:51,943 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-12 11:03:52,029 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:52,030 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:52,031 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:52,033 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:52,036 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:52,136 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:52,137 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:52,139 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:52,140 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:52,141 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:52,143 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:52,143 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:52,144 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:03:52,147 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:52,148 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:52,150 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:52,150 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:52,151 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:52,151 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:52,152 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:52,152 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:52,241 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:52,653 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:52,655 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:52,656 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:52,657 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:52,657 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:52,658 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:52,658 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:52,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:52,662 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:52,662 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:52,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:52,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:52,667 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:52,668 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:52,669 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:52,669 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:52,677 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:52,703 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:52,704 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:52,705 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:52,707 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:52,707 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:52,708 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:52,708 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:52,712 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:52,713 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:52,713 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:52,714 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:52,714 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:52,715 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:52,715 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:52,715 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:52,716 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:52,716 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:52,717 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:52,718 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:03:52,722 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:03:52,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:52,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:03:52,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:52,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:03:52,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:03:52,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:03:52,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:03:52,726 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:03:52,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:03:52,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:03:52,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:03:52,728 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:03:52,728 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:03:52,728 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:03:52,731 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:03:52,732 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:03:52,732 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:03:52,776 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:03:52,777 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:03:52,779 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:52,779 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:03:52,780 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:03:52,781 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:03:52,781 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:03:52,782 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:03:52,783 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:03:52,784 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:03:52,784 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:52,785 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:03:52,785 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:03:52,785 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:03:52,786 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:03:52,786 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:03:52,787 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:52,787 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:03:52,788 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:03:52,789 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:03:52,790 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:03:52,790 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:52,791 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:52,791 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:52,792 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:52,792 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:52,793 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:03:52,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:52,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:52,795 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:03:52,796 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:03:52,796 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:52,797 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:52,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:52,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:52,798 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:52,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:52,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:52,801 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:03:52,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:03:52,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:03:52,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:52,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:03:52,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:52,805 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:03:52,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:03:52,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:03:52,858 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:03:52,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:03:52,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:52,865 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:03:52,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:03:52,867 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:03:52,868 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:03:52,868 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:03:52,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:03:52,869 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:03:52,870 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:52,870 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:52,871 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:52,871 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:52,872 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:52,872 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:52,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:52,873 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:52,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:52,996 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:53,114 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:03:53,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:03:53,215 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:53,339 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:03:53,466 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:03:53,467 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:03:53,467 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:03:53,471 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:03:53,472 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:03:53,472 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:53,473 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:53,474 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:53,476 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:03:53,476 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:03:53,477 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:03:53,478 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:03:53,479 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:53,479 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:53,482 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:53,483 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:53,484 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:03:53,597 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:53,599 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:03:53,616 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:03:53,616 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:03:53,657 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:53,790 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:03:53,847 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:03:53,851 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:03:53,890 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:03:53,935 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:03:53,944 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:53,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:53,945 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-12 11:03:53,945 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:53,946 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.autorun.guard' vào nhóm 'ui.autorun' (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-12 11:03:53,946 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:03:53,947 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.autorun.guard vào group ui.autorun (metadata={'component': 'analysis', 'operation': 'autorun_guard'})
2025-10-12 11:03:53,947 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-12 11:03:53,948 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:03:54,010 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:54,028 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:03:54,085 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:03:54,087 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:03:54,096 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.96s
2025-10-12 11:03:54,295 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-12 11:03:54,295 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:54,296 - APP.utils.threading_utils - DEBUG - Task 'ui.autorun.guard' (group=ui.autorun) hoàn tất sau 0.35s
2025-10-12 11:03:54,298 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:03:54,299 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:03:54,300 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:03:54,303 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:03:54,305 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _request_autorun_start
2025-10-12 11:03:54,306 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:54,307 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:54,308 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:54,309 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:54,310 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:54,311 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:54,312 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:54,312 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:54,313 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API với định dạng key username/password.
2025-10-12 11:03:54,314 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-12 11:03:54,314 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-12 11:03:54,314 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251012-110354' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110354', 'priority': 'autorun'})
2025-10-12 11:03:54,315 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-12 11:03:54,357 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251012-110354 (priority=autorun)
2025-10-12 11:03:54,358 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-12 11:03:54,359 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.te' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'te', 'priority': 'autorun'})
2025-10-12 11:03:54,359 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-12 11:03:54,359 - APP.ui.app_ui - INFO - Autorun autorun-20251012-110354 bắt đầu ngay lập tức.
2025-10-12 11:03:54,360 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-12 11:03:54,361 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-12 11:03:54,369 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:54,371 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:03:54,371 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-12 11:03:54,372 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-12 11:03:54,377 - APP.ui.app_ui - INFO - Phiên autorun-20251012-110354 bắt đầu (priority=autorun, source=autorun).
2025-10-12 11:03:54,378 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-12 11:03:54,382 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-12 11:03:54,383 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-12 11:03:54,384 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (TaskGroup analysis.upload).
2025-10-12 11:03:54,385 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-12 11:03:54,436 - APP.core.trading.conditions - DEBUG - Điều kiện NO-RUN được thỏa mãn. Lý do: Các điều kiện cho phép.
2025-10-12 11:03:54,491 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:54,496 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:54,498 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:03:54,547 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:03:54,547 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:54,574 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:54,577 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:03:54,579 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:54,624 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.08s
2025-10-12 11:03:54,627 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-12 11:03:54,629 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110354.0' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110354', 'index': 0})
2025-10-12 11:03:54,629 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:54,630 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:54,631 - APP.analysis.context_builder - DEBUG - Bắt đầu xây dựng ngữ cảnh lịch sử với budget: 2000 chars.
2025-10-12 11:03:54,631 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110354.1' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110354', 'index': 1})
2025-10-12 11:03:54,633 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 16848:1760267004:1c274ddb3d07f22e
2025-10-12 11:03:54,633 - APP.analysis.context_builder - DEBUG - Parsing last 20 context files from: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\Reports
2025-10-12 11:03:54,637 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110354.2' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110354', 'index': 2})
2025-10-12 11:03:54,638 - APP.services.te_service - WARNING - Trading Economics trả về lỗi 403 - có thể do API key không hợp lệ hoặc hết hạn. Trả về danh sách rỗng để tránh dừng hệ thống.
2025-10-12 11:03:54,639 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:54,692 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png, nhưng chữ ký không khớp.
2025-10-12 11:03:54,695 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:54,695 - APP.analysis.context_builder - WARNING - Thư mục báo cáo không tồn tại: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\Reports
2025-10-12 11:03:54,697 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.upload.autorun-20251012-110354.3' vào nhóm 'analysis.upload' (metadata={'component': 'analysis', 'session_id': 'autorun-20251012-110354', 'index': 3})
2025-10-12 11:03:54,699 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-12 11:03:54,700 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:54,700 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_H1.png, Tối ưu hóa: False
2025-10-12 11:03:54,765 - APP.analysis.context_builder - DEBUG - Bắt đầu tóm tắt xu hướng checklist từ 0 items.
2025-10-12 11:03:54,901 - APP.utils.threading_utils - DEBUG - Task 'news.provider.te' (group=news.polling) hoàn tất sau 0.54s
2025-10-12 11:03:54,917 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:55,054 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:03:55,070 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:55,071 - APP.analysis.context_builder - DEBUG - Không có items, trả về trend 'unknown'.
2025-10-12 11:03:55,073 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11924:1760266989:8fd56fde81c82966
2025-10-12 11:03:55,073 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:03:55,074 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_H1.png' lên Gemini File API...
2025-10-12 11:03:55,075 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 4 tên file.
2025-10-12 11:03:55,117 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png, nhưng chữ ký không khớp.
2025-10-12 11:03:55,123 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:03:55,134 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:55,192 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 16567:1760266999:734f880feb046a76
2025-10-12 11:03:55,204 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_H1.png
2025-10-12 11:03:55,205 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M1.png, Tối ưu hóa: False
2025-10-12 11:03:55,222 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:03:55,234 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:55,256 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png, nhưng chữ ký không khớp.
2025-10-12 11:03:55,281 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'H1' cho 'XAUUSD_H1.png' bằng pattern đã biên dịch.
2025-10-12 11:03:55,338 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M1.png
2025-10-12 11:03:55,347 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:03:55,363 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:55,484 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:55,486 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M15.png, Tối ưu hóa: False
2025-10-12 11:03:55,491 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:03:55,492 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M1' cho 'XAUUSD_M1.png' bằng pattern đã biên dịch.
2025-10-12 11:03:55,495 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:03:55,557 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:55,563 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:03:55,564 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:03:55,565 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M1.png' lên Gemini File API...
2025-10-12 11:03:55,625 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M15.png
2025-10-12 11:03:55,629 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M15.png' lên Gemini File API...
2025-10-12 11:03:55,633 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M15' cho 'XAUUSD_M15.png' bằng pattern đã biên dịch.
2025-10-12 11:03:55,704 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:55,845 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M5.png
2025-10-12 11:03:55,945 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M5' cho 'XAUUSD_M5.png' bằng pattern đã biên dịch.
2025-10-12 11:03:56,052 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:56,061 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {'XAUUSD_H1.png': 'H1', 'XAUUSD_M1.png': 'M1', 'XAUUSD_M15.png': 'M15', 'XAUUSD_M5.png': 'M5'}
2025-10-12 11:03:56,160 - APP.analysis.context_builder - DEBUG - Ngữ cảnh lịch sử có kích thước 606 chars (trong budget).
2025-10-12 11:03:56,166 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:03:56,242 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:56,262 - APP.utils.threading_utils - DEBUG - Task song song 'build_historical_context_async' hoàn tất thành công.
2025-10-12 11:03:56,336 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:03:56,336 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:56,509 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:03:56,584 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:03:56,604 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:56,638 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:03:56,770 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:56,870 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:03:56,942 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:56,947 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:03:56,989 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:57,018 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:03:57,159 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:57,183 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:03:57,269 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:57,281 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:03:57,286 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:57,351 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:57,373 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:57,431 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:03:57,432 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:57,432 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:03:57,519 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:57,664 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:03:57,711 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:57,776 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:57,795 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:57,933 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:03:58,016 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:58,068 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:03:58,071 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:03:58,086 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:03:58,086 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:58,277 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:03:58,291 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:03:58,384 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:58,540 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:58,635 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:58,653 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:03:58,669 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:58,724 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:03:58,826 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:58,859 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:03:58,881 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:03:58,889 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:59,033 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:03:59,057 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:59,203 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:03:59,230 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:59,231 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:03:59,241 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:59,249 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:03:59,319 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:59,320 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:03:59,321 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:59,321 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:03:59,342 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:59,410 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:03:59,411 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:03:59,426 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:59,612 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:03:59,625 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:59,626 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:03:59,634 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:59,635 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:03:59,761 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:03:59,803 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:03:59,871 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:03:59,944 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:03:59,965 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:00,090 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:00,163 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:00,178 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:00,179 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:00,181 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:00,182 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:00,186 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:00,193 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:00,194 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:00,268 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:00,354 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:00,373 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:00,408 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:00,498 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:00,502 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:00,599 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:00,609 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:00,699 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:00,803 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:00,879 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:00,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:00,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:00,951 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:00,952 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:00,953 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:00,953 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:01,036 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:01,123 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:01,201 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:01,210 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:01,224 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:01,372 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:01,408 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:01,432 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:01,517 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:01,607 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:01,614 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:01,640 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:01,641 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:01,713 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:01,718 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:01,798 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:01,875 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:01,880 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:01,951 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:01,959 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:01,967 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:01,968 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:02,027 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:02,030 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:02,031 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:02,032 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:02,034 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:02,036 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:02,039 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:02,042 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:02,098 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:02,108 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:02,112 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:02,112 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:02,115 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:02,116 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:02,116 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:02,160 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:02,198 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:04:02,210 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:02,214 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:02,267 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:02,275 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:02,284 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:02,287 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:02,343 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:02,344 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:02,346 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:02,347 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:02,350 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:02,360 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:02,361 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:04:02,362 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:02,363 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:02,411 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:02,411 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:02,426 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:02,477 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:02,484 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:04:02,486 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:02,486 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:02,500 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:04:02,546 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/2mdkpis1l8kn. Đang chờ trạng thái ACTIVE.
2025-10-12 11:04:02,554 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:02,556 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:02,560 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:02,562 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:02,570 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:02,571 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:02,572 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:02,573 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:02,618 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:02,620 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:02,621 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:02,622 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:02,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:02,623 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:02,625 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:02,625 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:02,626 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:02,626 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:02,628 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:02,629 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:02,629 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:02,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:02,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:02,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:02,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:02,635 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:02,635 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:02,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:02,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:02,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:02,700 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:02,701 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:02,702 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:02,702 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:02,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:02,704 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:02,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:02,763 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/d1s4k8nquemc. Đang chờ trạng thái ACTIVE.
2025-10-12 11:04:02,765 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:02,768 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:02,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:02,773 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:02,779 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:02,880 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:02,945 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:02,949 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:02,954 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:02,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:03,014 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:03,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:03,434 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:03,536 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:03,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:03,549 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:03,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:03,551 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:03,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:03,556 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_H1.png': ACTIVE. Thời gian đã trôi qua: 1.0s
2025-10-12 11:04:03,560 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:03,659 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:03,661 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M1.png': ACTIVE. Thời gian đã trôi qua: 0.9s
2025-10-12 11:04:03,693 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/a6txo9w2c252. Đang chờ trạng thái ACTIVE.
2025-10-12 11:04:03,735 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_H1.png'.
2025-10-12 11:04:03,737 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:03,738 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:03,740 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M1.png'.
2025-10-12 11:04:03,742 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:03,742 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 16848:1760267004:1c274ddb3d07f22e
2025-10-12 11:04:03,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:03,745 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 11924:1760266989:8fd56fde81c82966
2025-10-12 11:04:03,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:03,749 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:03,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:03,803 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M1.png trong cache với tên từ xa files/d1s4k8nquemc.
2025-10-12 11:04:03,803 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_H1.png trong cache với tên từ xa files/2mdkpis1l8kn.
2025-10-12 11:04:03,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:03,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:03,806 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110354.1' (group=analysis.upload) hoàn tất sau 8.73s
2025-10-12 11:04:03,806 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110354.0' (group=analysis.upload) hoàn tất sau 9.17s
2025-10-12 11:04:03,807 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:03,808 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:03,810 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 12112:1760266994:9c602a62c841301a
2025-10-12 11:04:03,812 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:03,813 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:03,813 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:03,814 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png, nhưng chữ ký không khớp.
2025-10-12 11:04:03,814 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:03,815 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:03,815 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:03,817 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M5.png, Tối ưu hóa: False
2025-10-12 11:04:03,819 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:03,820 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:03,820 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:03,824 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-12 11:04:03,824 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:03,825 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:03,826 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M5.png' lên Gemini File API...
2025-10-12 11:04:03,827 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:04:03,827 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:03,842 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:03,881 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:03,885 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:03,885 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:03,886 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:03,887 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:03,887 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:03,891 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:03,892 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:03,900 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:03,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:03,954 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:03,954 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:03,958 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:03,979 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:03,980 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.15s
2025-10-12 11:04:03,981 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:04,037 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:04,038 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:04,039 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:04,039 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:04,040 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:04,041 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:04,041 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,041 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:04,044 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:04,045 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:04,051 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:04,066 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:04,128 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,136 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:04,138 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:04,139 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,147 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:04,148 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:04,149 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:04,152 - APP.utils.threading_utils - DEBUG - Task song song 'get_market_data_async' hoàn tất thành công.
2025-10-12 11:04:04,152 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:04,154 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:04,155 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:04,156 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:04:04,157 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,158 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:04:04,158 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:04,256 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:04:04,258 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,261 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:04,267 - APP.utils.safe_data - DEBUG - Get top-level key 'symbol': XAUUSD
2025-10-12 11:04:04,280 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,280 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:04,281 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:04,283 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:04,288 - APP.utils.safe_data - DEBUG - Get top-level key 'volatility_regime': trending
2025-10-12 11:04:04,292 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:04,295 - APP.utils.safe_data - DEBUG - Get top-level key 'ict_patterns': {'liquidity_h1': {'swing_highs_BSL': [{'price': 4059.382, 'bar_index': -11}, {'price': 4058.033, 'bar_index': 9}, {'price': 4049.726, 'bar_index': -17}, {'price': 4043.805, 'bar_index': 1}, {'price': 4036.362, 'bar_index': -3}], 'swing_lows_SSL': [{'price': 3922.438, 'bar_index': -67}, {'price': 3926.534, 'bar_index': -61}, {'price': 3940.881, 'bar_index': -42}, {'price': 3944.632, 'bar_index': 13}, {'price': 3947.001, 'bar_index': 23}]}, 'fvgs_h1': [{'type': 'Bullish', 'top': 4008.953, 'bottom': 4000.903}, {'type': 'Bearish', 'top': 4037.43, 'bottom': 4029.14}], 'order_blocks_h1': [{'type': 'Bearish', 'top': 4053.838, 'bottom': 4037.43, 'bar_index': 88}], 'liquidity_voids_h1': [{'type': 'Bullish', 'top': 3994.894, 'bottom': 3970.215, 'bar_index': 77}, {'type': 'Bearish', 'top': 3979.339, 'bottom': 3960.856, 'bar_index': 72}, {'type': 'Bearish', 'top': 3992.47, 'bottom': 3969.968, 'bar_index': 70}], 'premium_discount_h1': {'high': 4058.033, 'low': 3947.001, 'equilibrium': 4002.517, 'status': 'Premium'}, 'mss_h1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 3947.001, 'break_bar_index': 10}, 'liquidity_m15': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': -30}, {'price': 4021.448, 'bar_index': -13}, {'price': 4009.139, 'bar_index': -19}, {'price': 4006.822, 'bar_index': -53}, {'price': 4000.153, 'bar_index': -50}], 'swing_lows_SSL': [{'price': 3947.001, 'bar_index': -76}, {'price': 3952.655, 'bar_index': -64}, {'price': 3958.576, 'bar_index': -100}, {'price': 3965.671, 'bar_index': -70}, {'price': 3969.968, 'bar_index': -86}]}, 'fvgs_m15': [{'type': 'Bullish', 'top': 4005.302, 'bottom': 4005.203}], 'order_blocks_m15': [], 'liquidity_voids_m15': [{'type': 'Bullish', 'top': 4013.091, 'bottom': 4005.731, 'bar_index': 39}, {'type': 'Bullish', 'top': 4017.929, 'bottom': 4005.302, 'bar_index': 36}, {'type': 'Bearish', 'top': 4007.945, 'bottom': 3994.604, 'bar_index': 21}], 'premium_discount_m15': {'high': 4021.448, 'low': 3952.655, 'equilibrium': 3987.0515, 'status': 'Premium'}, 'mss_m15': None, 'liquidity_m5': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': 94}, {'price': 4021.448, 'bar_index': 147}, {'price': 4013.091, 'bar_index': 153}, {'price': 4009.139, 'bar_index': 128}, {'price': 4006.822, 'bar_index': 25}], 'swing_lows_SSL': [{'price': 3952.655, 'bar_index': -7}, {'price': 3967.683, 'bar_index': -18}, {'price': 3968.37, 'bar_index': -13}, {'price': 3970.666, 'bar_index': 77}, {'price': 3975.036, 'bar_index': 114}]}, 'fvgs_m5': [{'type': 'Bullish', 'top': 3995.454, 'bottom': 3994.286}], 'order_blocks_m5': [{'type': 'Bullish', 'top': 3997.645, 'bottom': 3993.04, 'bar_index': 152}], 'liquidity_voids_m5': [{'type': 'Bullish', 'top': 4009.556, 'bottom': 4005.302, 'bar_index': 162}, {'type': 'Bullish', 'top': 4005.203, 'bottom': 4000.209, 'bar_index': 158}, {'type': 'Bullish', 'top': 3999.818, 'bottom': 3994.595, 'bar_index': 153}], 'premium_discount_m5': {'high': 4013.091, 'low': 3975.036, 'equilibrium': 3994.0635, 'status': 'Premium'}, 'mss_m5': None, 'liquidity_m1': {'swing_highs_BSL': [{'price': 4021.448, 'bar_index': -22}, {'price': 4020.939, 'bar_index': 37}, {'price': 4018.51, 'bar_index': -33}, {'price': 4018.008, 'bar_index': -30}, {'price': 4015.696, 'bar_index': -15}], 'swing_lows_SSL': [{'price': 3995.782, 'bar_index': -70}, {'price': 3997.946, 'bar_index': -75}, {'price': 4002.278, 'bar_index': -60}, {'price': 4004.779, 'bar_index': -50}, {'price': 4005.731, 'bar_index': -3}]}, 'fvgs_m1': [{'type': 'Bullish', 'top': 4009.818, 'bottom': 4009.616}, {'type': 'Bearish', 'top': 4011.981, 'bottom': 4010.544}], 'order_blocks_m1': [], 'liquidity_voids_m1': [{'type': 'Bullish', 'top': 4016.499, 'bottom': 4012.638, 'bar_index': 83}, {'type': 'Bullish', 'top': 4012.165, 'bottom': 4009.678, 'bar_index': 75}, {'type': 'Bullish', 'top': 4009.971, 'bottom': 4008.033, 'bar_index': 73}], 'premium_discount_m1': {'high': 4020.939, 'low': 4005.731, 'equilibrium': 4013.335, 'status': 'Discount'}, 'mss_m1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 4005.731, 'break_bar_index': 0}}
2025-10-12 11:04:04,296 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:04,299 - APP.utils.safe_data - DEBUG - Get top-level key 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_14/10/2025_11:00_NFIB Small Business Optimism  (Sep)', 'when_utc': datetime.datetime(2025, 10, 14, 11, 0, tzinfo=<UTC>), 'title': 'NFIB Small Business Optimism  (Sep)', 'country': 'united states', 'impact': 'low', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 18, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '47h 55m'}, {'id': 'investpy_14/10/2025_17:20_Fed Chair Powell Speaks', 'when_utc': datetime.datetime(2025, 10, 14, 17, 20, tzinfo=<UTC>), 'title': 'Fed Chair Powell Speaks', 'country': 'united states', 'impact': 'high', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 0, 20, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '54h 15m'}, {'id': 'investpy_15/10/2025_13:30_Core CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 15, 13, 30, tzinfo=<UTC>), 'title': 'Core CPI (YoY)  (Sep)', 'country': 'united states', 'impact': 'medium', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 20, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '74h 25m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 12, 11, 1, 38, 692966, tzinfo=<UTC>), 'latency_sec': 17.558238200028427}
2025-10-12 11:04:04,339 - APP.utils.safe_data - DEBUG - Get top-level key 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_14/10/2025_11:00_NFIB Small Business Optimism  (Sep)', 'when_utc': datetime.datetime(2025, 10, 14, 11, 0, tzinfo=<UTC>), 'title': 'NFIB Small Business Optimism  (Sep)', 'country': 'united states', 'impact': 'low', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 18, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '47h 55m'}, {'id': 'investpy_14/10/2025_17:20_Fed Chair Powell Speaks', 'when_utc': datetime.datetime(2025, 10, 14, 17, 20, tzinfo=<UTC>), 'title': 'Fed Chair Powell Speaks', 'country': 'united states', 'impact': 'high', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 0, 20, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '54h 15m'}, {'id': 'investpy_15/10/2025_13:30_Core CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 15, 13, 30, tzinfo=<UTC>), 'title': 'Core CPI (YoY)  (Sep)', 'country': 'united states', 'impact': 'medium', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 20, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '74h 25m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 12, 11, 1, 38, 692966, tzinfo=<UTC>), 'latency_sec': 17.558238200028427}
2025-10-12 11:04:04,358 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:04,377 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:04:04,432 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,446 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:04,447 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,447 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:04,448 - APP.utils.safe_data - DEBUG - Truy cập raw data.
2025-10-12 11:04:04,459 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:04,462 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:04,464 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:04,490 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M15.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-12 11:04:04,519 - APP.utils.threading_utils - WARNING - Task 'chart.info' (group=chart.refresh) vượt timeout 10.00s → cancel
2025-10-12 11:04:04,522 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:04,537 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:04,538 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,553 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M15.png'.
2025-10-12 11:04:04,607 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,609 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:04,613 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:04,614 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 16567:1760266999:734f880feb046a76
2025-10-12 11:04:04,771 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,822 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:04,843 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M15.png trong cache với tên từ xa files/a6txo9w2c252.
2025-10-12 11:04:04,857 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:04,893 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:04:04,897 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,898 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110354.2' (group=analysis.upload) hoàn tất sau 9.77s
2025-10-12 11:04:04,898 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:04,899 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,899 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,901 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,902 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:04,903 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:04,904 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:04,904 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,905 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,906 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:04,909 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:04,909 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:04,910 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:04,911 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:04,911 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:04,913 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:04,914 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:04,916 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:04,976 - APP.utils.threading_utils - INFO - Task 'chart.info' (group=chart.refresh) bị hủy sau 10.48s
2025-10-12 11:04:05,057 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:05,077 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:05,079 - APP.ui.controllers.chart_controller - DEBUG - Future chart.info bị cancel, không cập nhật UI.
2025-10-12 11:04:05,084 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:05,096 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:05,104 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_2_logic' hoàn tất thành công.
2025-10-12 11:04:05,232 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:05,331 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.42s
2025-10-12 11:04:05,537 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:05,560 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:04:05,595 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-12 11:04:05,936 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:05,938 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:05,939 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:05,942 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:05,944 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:05,945 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:05,947 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:05,948 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:05,989 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:05,990 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:05,991 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:05,991 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:05,992 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:05,993 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:05,994 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:05,995 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:06,081 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:06,194 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-12 11:04:06,496 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:06,498 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:06,500 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:06,500 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:06,501 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:06,502 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:06,503 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:06,504 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:06,507 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:06,508 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:06,508 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:06,509 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:06,514 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:06,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:06,550 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:06,551 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:06,554 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:06,554 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:06,555 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:06,557 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:06,561 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:06,563 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:06,564 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:06,564 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:06,567 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:06,568 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:06,570 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:06,571 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:06,572 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:06,572 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:06,573 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:06,573 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:06,574 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:06,574 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:06,578 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:06,623 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:06,633 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:06,636 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:06,638 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:06,700 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:06,703 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:06,764 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:06,840 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:06,841 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:06,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:06,848 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:06,849 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:06,850 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:06,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:06,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:06,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:06,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:06,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:06,913 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:06,915 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:06,916 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:06,918 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:06,921 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:06,922 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:06,923 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:06,923 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:06,985 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:06,987 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:06,989 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:06,991 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:06,992 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:06,993 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:06,994 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:06,995 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:06,995 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:06,996 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:07,002 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:07,003 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:07,055 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:07,103 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:07,145 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:07,146 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:07,147 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:07,148 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:07,149 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:07,149 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:07,149 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:07,150 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:07,155 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:07,181 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:07,230 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:07,345 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:07,409 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:07,411 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:07,411 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:07,412 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:07,528 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:07,588 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:07,594 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:07,597 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:07,622 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:07,697 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-12 11:04:07,697 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:07,708 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:07,713 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:07,735 - APP.services.fmp_service - INFO - Lấy thành công 418 sự kiện từ investpy cho 7 ngày tới.
2025-10-12 11:04:07,771 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:07,772 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 13.41s
2025-10-12 11:04:07,774 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:07,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:07,788 - APP.ui.app_ui - DEBUG - Callback nhận được 141 sự kiện tin tức mới.
2025-10-12 11:04:07,792 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:07,849 - APP.services.news_service - INFO - NewsService làm mới cache (141 sự kiện, priority=autorun, source=network, latency=13.47s)
2025-10-12 11:04:07,863 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:07,922 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 13.61s
2025-10-12 11:04:07,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:07,925 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:07,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:07,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:07,929 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:07,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:07,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:07,931 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:07,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:07,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:07,933 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:07,936 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:04:07,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:07,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:07,941 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:07,942 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:07,943 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:07,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:07,948 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:07,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:07,952 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:07,952 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:07,953 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:07,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:07,953 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:07,954 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:07,956 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:07,957 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:07,958 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:08,001 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:08,002 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:08,007 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:08,007 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:08,008 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:08,008 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:08,009 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:08,010 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:08,011 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:08,011 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:08,013 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:08,014 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:08,015 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:08,015 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:08,016 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:08,016 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:08,017 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:08,018 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:08,020 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:08,021 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:08,022 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:08,022 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:08,023 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:08,023 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:08,024 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:08,024 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:08,025 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:08,026 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:08,027 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:08,056 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:08,080 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:08,081 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:08,114 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:08,115 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:08,150 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:08,201 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:08,293 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:08,295 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.36s
2025-10-12 11:04:08,473 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:08,474 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:08,474 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:08,476 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:08,479 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:09,006 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:09,007 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:09,009 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:09,010 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:09,011 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:09,013 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:09,014 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:09,015 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:09,021 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:09,021 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:09,022 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:09,023 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:09,023 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:09,024 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:09,024 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:09,025 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:09,088 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:09,351 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/9fd445lmufei. Đang chờ trạng thái ACTIVE.
2025-10-12 11:04:09,526 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:09,527 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:09,528 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:09,528 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:09,529 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:09,529 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:09,530 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:09,530 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:09,533 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:09,533 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:09,534 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:09,534 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:09,537 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:09,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:09,538 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:09,539 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:09,541 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:09,541 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:09,542 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:09,542 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:09,545 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:09,546 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:09,546 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:09,546 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:09,556 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:09,580 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:09,581 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:09,582 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:09,583 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:09,583 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:09,584 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:09,584 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:09,584 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:09,585 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:09,586 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:09,587 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:09,591 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:09,592 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:09,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:09,593 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:09,593 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:09,594 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:09,594 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:09,594 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:09,595 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:09,595 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:09,596 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:09,596 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:09,596 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:09,597 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:09,597 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:09,598 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:09,598 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:09,599 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:09,599 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:09,600 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:09,600 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:09,601 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:09,601 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:09,602 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:09,603 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:09,603 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:09,604 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:09,604 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:09,604 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:09,605 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:09,605 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:09,606 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:09,609 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:09,610 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:09,661 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:09,665 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:09,666 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:09,668 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:09,669 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:09,669 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:09,670 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:09,671 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:09,672 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:09,672 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:09,674 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:09,674 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,675 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:09,675 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:09,676 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:09,676 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,678 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:09,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:09,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:09,722 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:09,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:09,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:09,725 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:09,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:09,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:09,727 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:09,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:09,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:09,730 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:09,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:09,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:09,733 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:09,733 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:09,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:09,735 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:09,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:09,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:09,738 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:09,738 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:09,739 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:09,739 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:09,740 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,740 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:09,741 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:09,741 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:09,742 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:09,742 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:09,742 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:09,744 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:09,745 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:09,745 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:09,745 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:09,746 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:09,746 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:09,746 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:09,747 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:09,747 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:09,747 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:09,748 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:09,749 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,749 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:09,750 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:09,751 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:09,751 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:09,753 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:09,754 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:09,807 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:09,809 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,810 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:09,811 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:09,811 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:09,815 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:09,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:09,816 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:09,817 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:09,817 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,818 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:09,818 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,819 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:09,819 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:09,820 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:09,820 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:09,823 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:09,824 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:09,867 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-12 11:04:09,936 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:09,937 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:09,938 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:09,944 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:09,948 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:10,008 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M5.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-12 11:04:10,009 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M5.png'.
2025-10-12 11:04:10,010 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 12112:1760266994:9c602a62c841301a
2025-10-12 11:04:10,011 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M5.png trong cache với tên từ xa files/9fd445lmufei.
2025-10-12 11:04:10,011 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:10,011 - APP.utils.threading_utils - DEBUG - Task 'analysis.upload.autorun-20251012-110354.3' (group=analysis.upload) hoàn tất sau 6.20s
2025-10-12 11:04:10,013 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:10,014 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:10,015 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-12 11:04:10,017 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:10,019 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:10,019 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-12 11:04:10,021 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:10,022 - APP.utils.threading_utils - DEBUG - Task song song '_execute_stage_3_logic' hoàn tất thành công.
2025-10-12 11:04:10,022 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:10,024 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 4: Gọi Model AI
2025-10-12 11:04:10,025 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:10,026 - APP.ui.components.prompt_manager - DEBUG - Đang lấy nội dung prompts từ UI.
2025-10-12 11:04:10,028 - APP.ui.components.prompt_manager - DEBUG - Đang lấy nội dung prompts từ UI.
2025-10-12 11:04:10,031 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:10,032 - APP.analysis.prompt_builder - DEBUG - Không có vị thế, chọn prompt 'no_entry' để tìm kiếm setup.
2025-10-12 11:04:10,032 - APP.analysis.prompt_builder - DEBUG - Bắt đầu xây dựng prompt cuối cùng.
2025-10-12 11:04:10,036 - APP.analysis.prompt_builder - DEBUG - Đã xây dựng xong prompt cuối cùng.
2025-10-12 11:04:10,038 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:10,038 - APP.core.analysis_worker - DEBUG - --- PROMPT FINAL GỬI ĐẾN AI ---
VAI TRÒ & BỐI CẢNH
- Bạn là một nhà giao dịch ICT chuyên nghiệp và một nhà quản lý rủi ro.
- Nhiệm vụ của bạn là phân tích thị trường theo phương pháp Top-Down VÀ quản lý các lệnh đang mở một cách hiệu quả.
- Bạn phải suy luận logic, dựa trên bằng chứng từ dữ liệu thị trường.

---
### NHIỆM VỤ 1: XÁC ĐỊNH BỐI CẢNH VÀ HÀNH ĐỘNG CẦN THIẾT

**DỰA VÀO `CONTEXT.HAS_ACTIVE_POSITIONS`, HÃY CHỌN MỘT TRONG HAI LUỒNG SAU:**

---
#### LUỒNG A: CHƯA CÓ LỆNH (HAS_ACTIVE_POSITIONS = false)

**A1. QUY TRÌNH PHÂN TÍCH TOP-DOWN 4 BƯỚC**
   - Thực hiện phân tích Top-Down (H1 -> M15 -> M5) để tìm kiếm cơ hội giao dịch chất lượng cao.
   - **Bằng chứng**: Luôn trích dẫn dữ liệu cụ thể từ `EXTRACT_JSON` và `CONCEPT_VALUE_TABLE`.
   - **Kết quả**: Xây dựng một "câu chuyện thị trường", xếp hạng setup (`A+`, `B`, `C`), và lập kế hoạch giao dịch chi tiết nếu phù hợp.

**A2. TẠO ĐỐI TƯỢNG JSON - ĐÁNH GIÁ SETUP**
   - Tổng hợp kết quả phân tích vào đối tượng JSON sau. **Đây phải là phần đầu tiên trong phản hồi của bạn.**
   ```json
   {
     "cycle": "[ĐIỀN THỜI GIAN HIỆN TẠI]",
     "symbol": "[LẤY TỪ DỮ LIỆU]",
     "mode": "expert_setup_evaluation",
     "market_narrative": "[CÂU CHUYỆN THỊ TRƯỜNG TỪ BƯỚC A1]",
     "setup_grade": "[A+/B/C/Không có]",
     "reasoning_summary": "[GIẢI THÍCH NGẮN GỌN VÌ SAO XẾP HẠNG SETUP NHƯ VẬY]",
     "top_down_analysis": {
       "h1_context": { "order_flow": "[...]", "draw_on_liquidity": "[...]" },
       "m15_poi": { "type": "[...]", "price_zone": "[...]", "quality_assessment": "[...]" },
       "m5_m1_confirmation": { "status": "[...]", "signal": "[...]" }
     },
     "proposed_plan": {
       "direction": "[long/short hoặc null]",
       "entry": "[Giá hoặc 0.0]",
       "sl": "[Giá hoặc 0.0]",
       "tp1": "[Giá hoặc 0.0]",
       "tp2": "[Giá hoặc 0.0]",
       "risk_multiplier": "[1.0 cho A+, 0.5 cho B, 0.0 cho các trường hợp khác]"
     }
   }
   ```

---
#### LUỒNG B: ĐANG CÓ LỆNH (HAS_ACTIVE_POSITIONS = true)

**B1. PHÂN TÍCH BỐI CẢNH ĐỂ QUẢN LÝ LỆNH**
   - **Đánh giá lại Draw on Liquidity (H1)**: Mục tiêu giá ban đầu còn hợp lệ không? Có mục tiêu nào mới xuất hiện không?
   - **Phân tích cấu trúc M5/M1**: Cấu trúc thị trường gần nhất (`EXTRACT_JSON.tf.M5.mss_bos`) đang ủng hộ hay chống lại lệnh hiện tại?
   - **Tìm kiếm các vùng cản/hỗ trợ mới**: Có FVG hoặc Order Block nào mới hình thành có thể ảnh hưởng đến lệnh không?

**B2. TẠO ĐỐI TƯỢNG JSON - KẾ HOẠCH QUẢN LÝ**
   - Dựa trên phân tích ở B1, hãy tạo kế hoạch quản lý cho TỪNG lệnh đang mở.
   - **Đây phải là phần đầu tiên trong phản hồi của bạn.**
   ```json
   {
     "cycle": "[ĐIỀN THỜI GIAN HIỆN TẠI]",
     "symbol": "[LẤY TỪ DỮ LIỆU]",
     "mode": "trade_management",
     "market_narrative": "[TÓM TẮT BỐI CẢNH THỊ TRƯỜNG HIỆN TẠI ẢNH HƯỞNG ĐẾN LỆNH]",
     "reasoning_summary": "[GIẢI THÍCH NGẮN GỌN CHO CÁC HÀNH ĐỘNG QUẢN LÝ]",
     "management_plan": {
       "[TICKET_LỆNH_1]": {
         "action": "[HOLD/CLOSE_PARTIAL/MOVE_SL_TO_ENTRY/TRAIL_SL]",
         "percentage": "[50 nếu CLOSE_PARTIAL, ngược lại 0]",
         "sl": "[Giá SL mới, 'entry', 'last_swing_low_m5', 'last_swing_high_m5' hoặc null nếu không đổi]",
         "tp": "[Giá TP mới hoặc null nếu không đổi]",
         "reason": "[Lý do ngắn gọn cho hành động này]"
       },
       "[TICKET_LỆNH_2]": {
         "...": "..."
       },
       "ALL": {
         "action": "[HOLD/CLOSE_ALL]",
         "reason": "[Áp dụng nếu muốn thực hiện hành động cho tất cả lệnh]"
       }
     }
   }
   ```

---
### NHIỆM VỤ 2: VIẾT BÁO CÁO PHÂN TÍCH CHI TIẾT

Dựa vào đối tượng JSON bạn vừa tạo (từ Luồng A hoặc B), hãy viết một báo cáo chuyên nghiệp.

A) **TÓM TẮT NHANH (7 DÒNG):**
   - **(Luồng A)**: Trình bày tóm tắt về cơ hội giao dịch như prompt cũ.
   - **(Luồng B)**: Trình bày tóm tắt về các hành động quản lý được đề xuất cho mỗi lệnh.

B) **PHÂN TÍCH CHUYÊN SÂU:**
   - Diễn giải chi tiết về `market_narrative`.
   - Giải thích lý do đằng sau `setup_grade` (Luồng A) hoặc các quyết định trong `management_plan` (Luồng B), luôn sử dụng bằng chứng từ dữ liệu.

---
**Dữ liệu thị trường và tài khoản (MT5):**
```json
{'symbol': 'XAUUSD', 'generated_at': '2025-10-12 18:04:03', 'broker_time': '2025-10-11T03:57:58+07:00', 'timezone': 'Asia/Ho_Chi_Minh', 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}, 'positions': [], 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}, 'symbol_rules': {'volume_min': 0.01, 'volume_max': 200.0, 'volume_step': 0.01, 'trade_tick_value': 0.1, 'trade_tick_size': 0.001, 'stop_level_points': 0, 'freeze_level_points': 0, 'margin_initial': 0.0, 'margin_maintenance': 0.0}, 'pip': {'points_per_pip': 10, 'value_per_point': 0.1, 'pip_value_per_lot': 1.0}, 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}, 'tick_stats_5m': {}, 'tick_stats_30m': {}, 'levels': {'daily': {}, 'prev_day': {'high': 4058.033, 'low': 3944.632}, 'weekly': {'open': 3909.548, 'high': 4059.382, 'low': 3898.998}, 'prev_week': {'high': 3897.216, 'low': 3763.408}, 'monthly': {'open': 3863.002, 'high': 4059.382, 'low': 3819.397}}, 'day_open': None, 'prev_day_close': 3989.994, 'adr': {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}, 'day_range': None, 'day_range_pct_of_adr20': None, 'position_in_day_range': None, 'sessions_today': {'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, 'session_liquidity': {}, 'volatility': {'ATR': {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}}, 'volatility_regime': 'trending', 'trend_refs': {'EMA': {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}}, 'vwap': {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}, 'kills': {'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, 'is_silver_bullet_window': False, 'killzone_active': None, 'mins_to_next_killzone': 123, 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}], 'round_levels': [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}], 'atr_norm': {'spread_as_pct_of_atr_m5': 0.6349797540000889}, 'ict_patterns': {'liquidity_h1': {'swing_highs_BSL': [{'price': 4059.382, 'bar_index': -11}, {'price': 4058.033, 'bar_index': 9}, {'price': 4049.726, 'bar_index': -17}, {'price': 4043.805, 'bar_index': 1}, {'price': 4036.362, 'bar_index': -3}], 'swing_lows_SSL': [{'price': 3922.438, 'bar_index': -67}, {'price': 3926.534, 'bar_index': -61}, {'price': 3940.881, 'bar_index': -42}, {'price': 3944.632, 'bar_index': 13}, {'price': 3947.001, 'bar_index': 23}]}, 'fvgs_h1': [{'type': 'Bullish', 'top': 4008.953, 'bottom': 4000.903}, {'type': 'Bearish', 'top': 4037.43, 'bottom': 4029.14}], 'order_blocks_h1': [{'type': 'Bearish', 'top': 4053.838, 'bottom': 4037.43, 'bar_index': 88}], 'liquidity_voids_h1': [{'type': 'Bullish', 'top': 3994.894, 'bottom': 3970.215, 'bar_index': 77}, {'type': 'Bearish', 'top': 3979.339, 'bottom': 3960.856, 'bar_index': 72}, {'type': 'Bearish', 'top': 3992.47, 'bottom': 3969.968, 'bar_index': 70}], 'premium_discount_h1': {'high': 4058.033, 'low': 3947.001, 'equilibrium': 4002.517, 'status': 'Premium'}, 'mss_h1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 3947.001, 'break_bar_index': 10}, 'liquidity_m15': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': -30}, {'price': 4021.448, 'bar_index': -13}, {'price': 4009.139, 'bar_index': -19}, {'price': 4006.822, 'bar_index': -53}, {'price': 4000.153, 'bar_index': -50}], 'swing_lows_SSL': [{'price': 3947.001, 'bar_index': -76}, {'price': 3952.655, 'bar_index': -64}, {'price': 3958.576, 'bar_index': -100}, {'price': 3965.671, 'bar_index': -70}, {'price': 3969.968, 'bar_index': -86}]}, 'fvgs_m15': [{'type': 'Bullish', 'top': 4005.302, 'bottom': 4005.203}], 'order_blocks_m15': [], 'liquidity_voids_m15': [{'type': 'Bullish', 'top': 4013.091, 'bottom': 4005.731, 'bar_index': 39}, {'type': 'Bullish', 'top': 4017.929, 'bottom': 4005.302, 'bar_index': 36}, {'type': 'Bearish', 'top': 4007.945, 'bottom': 3994.604, 'bar_index': 21}], 'premium_discount_m15': {'high': 4021.448, 'low': 3952.655, 'equilibrium': 3987.0515, 'status': 'Premium'}, 'mss_m15': None, 'liquidity_m5': {'swing_highs_BSL': [{'price': 4022.887, 'bar_index': 94}, {'price': 4021.448, 'bar_index': 147}, {'price': 4013.091, 'bar_index': 153}, {'price': 4009.139, 'bar_index': 128}, {'price': 4006.822, 'bar_index': 25}], 'swing_lows_SSL': [{'price': 3952.655, 'bar_index': -7}, {'price': 3967.683, 'bar_index': -18}, {'price': 3968.37, 'bar_index': -13}, {'price': 3970.666, 'bar_index': 77}, {'price': 3975.036, 'bar_index': 114}]}, 'fvgs_m5': [{'type': 'Bullish', 'top': 3995.454, 'bottom': 3994.286}], 'order_blocks_m5': [{'type': 'Bullish', 'top': 3997.645, 'bottom': 3993.04, 'bar_index': 152}], 'liquidity_voids_m5': [{'type': 'Bullish', 'top': 4009.556, 'bottom': 4005.302, 'bar_index': 162}, {'type': 'Bullish', 'top': 4005.203, 'bottom': 4000.209, 'bar_index': 158}, {'type': 'Bullish', 'top': 3999.818, 'bottom': 3994.595, 'bar_index': 153}], 'premium_discount_m5': {'high': 4013.091, 'low': 3975.036, 'equilibrium': 3994.0635, 'status': 'Premium'}, 'mss_m5': None, 'liquidity_m1': {'swing_highs_BSL': [{'price': 4021.448, 'bar_index': -22}, {'price': 4020.939, 'bar_index': 37}, {'price': 4018.51, 'bar_index': -33}, {'price': 4018.008, 'bar_index': -30}, {'price': 4015.696, 'bar_index': -15}], 'swing_lows_SSL': [{'price': 3995.782, 'bar_index': -70}, {'price': 3997.946, 'bar_index': -75}, {'price': 4002.278, 'bar_index': -60}, {'price': 4004.779, 'bar_index': -50}, {'price': 4005.731, 'bar_index': -3}]}, 'fvgs_m1': [{'type': 'Bullish', 'top': 4009.818, 'bottom': 4009.616}, {'type': 'Bearish', 'top': 4011.981, 'bottom': 4010.544}], 'order_blocks_m1': [], 'liquidity_voids_m1': [{'type': 'Bullish', 'top': 4016.499, 'bottom': 4012.638, 'bar_index': 83}, {'type': 'Bullish', 'top': 4012.165, 'bottom': 4009.678, 'bar_index': 75}, {'type': 'Bullish', 'top': 4009.971, 'bottom': 4008.033, 'bar_index': 73}], 'premium_discount_m1': {'high': 4020.939, 'low': 4005.731, 'equilibrium': 4013.335, 'status': 'Discount'}, 'mss_m1': {'type': 'Bearish', 'event': 'CHoCH', 'price_level': 4005.731, 'break_bar_index': 0}}, 'risk_model': {}, 'rr_projection': {}, 'news_analysis': {'is_in_news_window': False, 'reason': None, 'upcoming_events': [{'id': 'investpy_14/10/2025_11:00_NFIB Small Business Optimism  (Sep)', 'when_utc': datetime.datetime(2025, 10, 14, 11, 0, tzinfo=<UTC>), 'title': 'NFIB Small Business Optimism  (Sep)', 'country': 'united states', 'impact': 'low', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 14, 18, 0, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '47h 55m'}, {'id': 'investpy_14/10/2025_17:20_Fed Chair Powell Speaks', 'when_utc': datetime.datetime(2025, 10, 14, 17, 20, tzinfo=<UTC>), 'title': 'Fed Chair Powell Speaks', 'country': 'united states', 'impact': 'high', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 0, 20, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '54h 15m'}, {'id': 'investpy_15/10/2025_13:30_Core CPI (YoY)  (Sep)', 'when_utc': datetime.datetime(2025, 10, 15, 13, 30, tzinfo=<UTC>), 'title': 'Core CPI (YoY)  (Sep)', 'country': 'united states', 'impact': 'medium', 'source': 'investpy', 'when_local': datetime.datetime(2025, 10, 15, 20, 30, tzinfo=<DstTzInfo 'Asia/Ho_Chi_Minh' +07+7:00:00 STD>), 'time_remaining': '74h 25m'}], 'last_refresh_utc': datetime.datetime(2025, 10, 12, 11, 1, 38, 692966, tzinfo=<UTC>), 'latency_sec': 17.558238200028427}, 'concept_value_table': '| Khái niệm (Concept) | Giá trị (Value) |\n|---|---|\n| Symbol | XAUUSD |\n| Chế độ Biến động | trending |\n| H1 Order Flow | Bearish |\n| M15 Structure | Không rõ |\n| Trong Cửa sổ Tin tức | False |\n| Tin tức Sắp tới | 47h 55m - NFIB Small Business Optimism  (Sep) |\n'}
```

---
**Bối cảnh bổ sung từ các báo cáo trước:**


[CONTEXT_COMPOSED]
{"CONTEXT_COMPOSED": {"cycle": "2025-10-12 11:03:56", "trend_checklist": {"trend": "unknown", "enough_ratio": null}, "latest_plan": null, "latest_summary_lines": null, "recent_history_summary": null, "run_meta": {"analysis_id": "2025-10-12T11:03:55Z", "folder_signature": "sha1:49c2e050742d71fcee49851b6f2172d1f5ebc9b1", "images_tf_map": {"XAUUSD_H1.png": "H1", "XAUUSD_M1.png": "M1", "XAUUSD_M15.png": "M15", "XAUUSD_M5.png": "M5"}}, "running_stats": {"backtest_results": {"status": "not_implemented"}}, "risk_rules": {"max_risk_per_trade_pct": 1.0, "daily_loss_limit_pct": 3.0, "max_trades_per_day": 3}}}

---
**Phân tích các hình ảnh được cung cấp.**
--- KẾT THÚC PROMPT ---
2025-10-12 11:04:10,085 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:10,087 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:10,091 - APP.services.gemini_service - DEBUG - Bắt đầu stream tới Gemini API với 5 lần thử.
2025-10-12 11:04:10,097 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:10,101 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:10,102 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:10,104 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:10,110 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:10,112 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:10,113 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:10,223 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:10,226 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:10,227 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:10,373 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:10,655 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:10,657 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:10,658 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:10,659 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:10,659 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:10,660 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:10,660 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:10,660 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:10,663 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:10,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:10,664 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:10,664 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:10,668 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:10,668 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:10,670 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:10,671 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:10,673 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:10,673 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:10,704 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:10,705 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:10,708 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:10,709 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:10,709 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:10,710 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:10,712 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:10,713 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:10,713 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:10,714 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:10,715 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:10,715 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:10,716 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:10,716 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:10,717 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:10,717 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:10,718 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:10,718 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:10,722 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:10,722 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:10,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:10,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:10,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:10,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:10,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:10,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:10,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:10,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:10,726 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:10,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:10,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:10,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:10,728 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:10,728 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:10,729 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:10,729 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:10,729 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:10,730 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:10,730 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:10,731 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:10,734 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:10,734 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:10,735 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:10,786 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:10,787 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:10,788 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:10,789 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:10,791 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:10,792 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:10,792 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:10,793 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:10,793 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:10,794 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:10,794 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:10,795 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:10,796 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:10,796 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:10,796 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:10,797 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:10,797 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:10,798 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:10,798 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:10,799 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:10,799 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:10,800 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:10,800 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:10,801 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:10,801 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:10,801 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:10,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:10,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:10,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:10,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:10,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:10,806 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:10,847 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:10,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:10,849 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:10,850 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:10,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:10,851 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:10,852 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:10,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:10,854 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:10,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:10,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:10,858 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:10,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:10,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:10,861 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:10,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:10,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:10,863 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:10,864 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:10,865 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:10,866 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:10,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:10,867 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:10,868 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:10,868 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:10,868 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:10,869 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:10,869 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:10,870 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:10,871 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:10,872 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:10,872 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:10,926 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:10,930 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:10,931 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:10,932 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:10,932 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:10,933 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:10,936 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:10,936 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:10,938 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:10,938 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:10,975 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:10,977 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:11,027 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:11,029 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:11,029 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:11,029 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:11,030 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:11,034 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:11,036 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:11,036 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:11,038 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:11,038 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:11,039 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:11,039 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:11,041 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:11,042 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:11,043 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:11,043 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:11,052 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:04:11,091 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:11,091 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:11,093 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:11,093 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:11,094 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:11,135 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:11,145 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.13s
2025-10-12 11:04:11,184 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:11,376 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:11,380 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:11,381 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:11,382 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:11,387 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:12,035 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:12,036 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:12,037 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:12,039 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:12,041 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:12,042 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:12,042 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:12,043 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:04:12,083 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:12,342 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:12,343 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:12,344 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:12,344 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:12,344 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:12,345 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:12,345 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:12,346 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:12,847 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:12,849 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:12,849 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:12,850 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:12,850 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:12,851 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:12,851 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:12,851 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:12,854 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:12,854 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:12,855 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:12,855 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:12,860 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:12,860 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:12,860 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:12,894 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:12,897 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:12,898 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:12,899 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:12,899 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:12,902 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:12,902 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:12,902 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:12,903 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:12,907 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:12,907 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:12,908 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:12,908 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:12,909 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:12,909 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:12,909 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:12,910 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:12,910 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:12,910 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:12,911 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:12,912 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:12,915 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:12,915 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:12,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:12,916 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:12,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:12,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:12,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:12,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:12,918 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:12,918 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:12,918 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:12,919 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:12,920 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:12,921 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:12,922 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:12,971 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:12,972 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:12,973 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:12,973 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:12,974 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:12,974 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:12,975 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:12,975 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:12,975 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:12,976 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:12,976 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:12,977 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:12,978 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:12,979 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:12,979 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:12,979 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:12,980 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:12,980 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:12,981 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:12,981 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:12,982 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:12,983 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:12,983 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:12,985 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:12,986 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:12,986 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:12,986 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:12,987 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:12,987 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:12,988 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:12,988 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:12,988 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:12,989 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:12,989 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:12,990 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:12,991 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:12,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:12,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:12,993 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:12,994 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:12,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:12,995 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:12,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:12,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:12,999 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:13,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:13,057 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:13,058 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:13,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:13,059 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:13,060 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:13,061 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:13,061 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:13,062 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:13,063 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:13,064 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:13,064 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:13,065 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:13,066 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:13,066 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:13,067 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:13,067 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:13,068 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:13,068 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:13,068 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:13,069 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:13,069 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:13,069 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:13,070 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:13,071 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:13,072 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:13,073 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:13,073 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:13,074 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:13,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:13,074 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:13,075 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:13,077 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:13,077 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:13,078 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:13,078 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:13,078 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:13,079 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:13,119 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:13,120 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:13,124 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:13,127 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:13,127 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:13,130 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:13,130 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:13,131 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:13,132 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:13,133 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:13,133 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:13,133 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:13,134 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:13,138 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:13,138 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:13,139 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:13,139 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:13,140 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:13,141 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:13,141 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:13,142 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:13,142 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:13,143 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:13,143 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:13,144 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:13,144 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:13,146 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.11s
2025-10-12 11:04:13,226 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:13,404 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:13,406 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:13,407 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:13,408 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:13,415 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:14,128 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:14,129 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:14,131 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:14,132 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:14,133 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:14,135 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:14,135 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:14,136 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:04:14,141 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:14,439 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:14,440 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:14,441 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:14,441 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:14,442 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:14,442 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:14,443 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:14,443 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:14,944 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:14,946 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:14,947 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:14,947 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:14,948 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:14,948 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:14,949 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:14,949 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:14,952 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:14,952 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:14,952 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:14,953 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:14,962 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:14,986 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:14,988 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:14,989 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:14,992 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:14,992 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:14,993 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:14,993 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:14,995 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:14,996 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:14,996 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:14,996 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:14,999 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:15,000 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:15,000 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:15,001 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:15,001 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:15,001 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:15,002 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:15,002 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:15,002 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:15,003 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:15,004 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:15,004 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:15,008 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:15,009 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:15,009 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:15,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:15,010 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:15,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:15,011 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:15,011 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:15,011 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:15,012 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:15,012 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:15,013 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:15,013 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:15,014 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:15,015 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:15,015 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:15,016 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:15,017 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:15,062 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:15,065 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:15,066 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:15,067 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:15,068 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:15,069 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:15,069 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:15,069 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:15,070 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:15,070 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:15,071 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:15,071 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:15,071 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:15,072 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:15,072 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:15,073 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:15,074 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:15,074 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:15,075 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:15,076 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:15,076 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:15,076 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:15,078 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:15,078 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:15,079 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:15,079 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:15,080 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:15,081 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,081 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:15,082 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:15,082 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:15,082 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,083 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:15,083 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:15,084 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:15,084 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:15,085 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:15,086 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:15,086 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:15,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:15,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:15,088 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:15,088 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:15,089 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:15,090 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:15,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:15,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:15,092 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:15,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:15,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:15,094 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:15,094 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:15,094 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:15,095 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:15,096 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:15,097 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:15,097 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:15,098 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,098 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:15,099 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:15,099 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:15,099 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:15,100 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:15,100 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:15,152 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:15,155 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:15,156 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:15,157 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:15,159 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:15,160 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:15,160 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:15,161 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:15,161 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:15,162 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:15,162 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:15,162 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:15,163 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:15,164 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,164 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:15,165 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:15,166 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:15,166 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:15,167 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:15,167 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:15,168 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:15,168 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:15,170 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:15,171 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:15,173 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:15,174 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,175 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:15,175 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:15,175 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:15,176 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:15,179 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:15,180 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:15,181 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:15,182 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,182 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:15,183 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,183 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:15,184 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:15,184 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:15,184 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:15,185 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:15,188 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:15,189 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:15,353 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.22s
2025-10-12 11:04:15,476 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:15,480 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:15,481 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:15,486 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:15,491 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:16,159 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:16,160 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:16,161 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:16,163 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:16,164 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:16,165 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:16,166 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:16,166 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:04:16,209 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:16,209 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:16,210 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:16,211 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:16,212 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:16,212 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:16,213 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:16,213 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:16,284 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:16,715 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:16,716 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:16,717 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:16,717 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:16,718 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:16,718 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:16,719 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:16,719 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:16,721 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:16,722 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:16,722 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:16,723 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:16,727 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:16,727 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:16,728 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:16,729 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:16,731 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:16,731 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:16,731 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:16,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:16,736 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:16,736 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:16,764 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:16,766 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:16,770 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:16,770 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:16,771 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:16,771 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:16,772 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:16,772 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:16,772 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:16,773 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:16,773 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:16,773 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:16,774 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:16,775 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:16,780 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:16,781 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:16,781 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:16,781 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:16,782 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:16,782 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:16,783 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:16,783 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:16,784 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:16,784 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:16,784 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:16,785 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:16,785 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:16,786 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:16,786 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:16,787 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:16,787 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:16,788 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:16,788 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:16,789 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:16,789 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:16,790 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:16,790 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:16,791 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:16,791 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:16,792 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:16,792 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:16,793 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:16,793 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:16,794 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:16,794 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:16,795 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:16,796 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:16,796 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:16,797 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:16,798 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:16,798 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:16,806 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:16,848 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:16,850 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:16,850 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:16,851 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:16,853 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:16,856 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:16,857 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:16,858 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:16,858 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:16,858 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:16,859 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:16,860 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:16,860 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:16,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:16,863 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:16,864 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:16,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:16,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:16,865 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:16,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:16,866 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:16,867 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:16,867 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:16,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:16,869 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:16,870 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:16,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:16,871 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:16,872 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:16,874 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:16,875 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:16,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:16,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:16,933 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:16,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:16,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:16,935 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:16,936 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:16,936 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:16,938 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:16,938 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:16,939 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:16,939 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:16,939 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:16,940 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:16,940 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:16,941 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:16,941 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:16,941 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:16,942 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:16,942 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:16,942 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:16,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:16,944 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:16,945 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:16,946 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:16,946 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:16,947 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:16,947 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:16,948 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:16,948 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:16,950 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:16,951 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:16,953 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:16,954 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:16,955 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:16,997 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:17,002 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:17,003 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:17,003 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:17,004 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:17,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:17,005 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:17,006 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:17,007 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:17,008 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:17,009 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:17,009 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:17,009 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:17,010 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:17,011 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.85s
2025-10-12 11:04:17,031 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:17,032 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:17,033 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:17,034 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:17,037 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:17,162 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:17,163 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:17,164 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:17,166 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:17,167 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:17,168 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:17,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:17,170 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:17,181 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:17,182 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:17,182 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:17,183 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:17,184 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:17,234 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:17,287 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:17,372 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:17,390 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:17,669 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:04:17,671 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:04:17,914 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:17,915 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:17,917 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.25s
2025-10-12 11:04:17,917 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:17,918 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:17,918 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:17,919 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:17,919 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:17,920 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:17,924 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:17,924 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:17,925 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:17,925 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:17,929 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:17,929 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:17,930 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:17,930 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:17,933 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:17,933 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:17,934 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:17,934 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:17,936 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:17,937 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:17,937 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:17,937 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:17,940 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:17,940 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:17,941 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:17,941 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:17,942 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:17,942 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:17,943 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:17,943 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:17,943 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:17,944 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:17,945 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:17,945 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:17,948 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:17,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:17,949 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:17,949 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:17,949 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:17,950 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:17,950 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:17,951 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:17,952 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:17,952 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:17,953 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:17,953 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:17,954 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:17,954 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:17,954 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:17,955 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:17,955 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:17,989 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:17,990 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:04:17,990 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:17,992 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:17,993 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:17,994 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:17,994 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:17,995 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:17,995 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:17,996 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:17,996 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:17,997 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:17,997 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:17,997 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:17,998 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:17,999 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:17,999 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:17,999 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:18,000 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:18,000 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:18,001 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:18,001 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:18,001 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:18,002 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:18,002 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:18,003 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:18,003 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:18,003 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:18,004 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:18,004 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,004 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:18,005 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:18,005 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:18,006 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,006 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:18,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:18,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:18,007 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:18,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:18,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:18,009 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:18,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:18,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:18,010 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:18,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:18,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:18,012 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:18,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:18,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:18,013 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:18,017 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:18,018 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:18,071 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:18,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:18,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:18,075 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:18,077 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:18,077 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:18,078 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:18,078 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,079 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:18,079 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:18,079 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:18,080 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:18,080 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:18,081 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:18,081 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:18,082 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:18,083 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:18,083 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:18,083 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:18,084 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:18,084 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:18,084 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:18,085 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:18,086 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:18,086 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:18,087 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,088 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:18,088 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:18,088 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:18,143 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:18,144 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:18,145 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:18,146 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:18,147 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,149 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:18,149 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:18,149 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:18,152 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:18,153 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:18,154 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:18,154 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:18,155 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,155 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:18,193 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:18,199 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,201 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:18,202 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:18,203 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:18,203 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:18,205 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:18,257 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:18,257 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:18,258 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:18,259 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:18,259 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:04:18,260 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:18,262 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.10s
2025-10-12 11:04:18,358 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:18,501 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:18,502 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:18,502 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:18,506 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:18,509 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:19,200 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:19,201 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:19,203 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:19,205 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:19,206 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:19,207 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:19,207 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:19,208 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:04:19,211 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:19,212 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:19,213 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:19,214 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:19,214 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:19,215 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:19,215 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:19,216 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:19,285 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:19,717 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:19,719 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:19,719 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:19,720 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:19,720 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:19,721 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:19,721 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:19,722 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:19,724 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:19,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:19,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:19,725 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:19,729 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:19,730 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:19,731 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:19,731 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:19,734 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:19,734 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:19,734 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:19,735 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:19,740 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:19,762 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:19,763 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:19,764 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:19,774 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:19,796 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:19,799 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:19,800 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:19,835 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:19,837 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:19,838 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:19,839 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:19,839 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:19,840 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:19,842 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:19,842 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:19,846 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:19,847 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:19,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:19,847 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:19,848 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:19,848 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:19,849 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:19,849 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:19,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:19,850 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:19,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:19,851 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:19,851 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:19,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:19,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:19,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:19,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:19,855 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:19,856 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:19,857 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:19,857 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:19,858 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:19,860 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:19,861 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:19,862 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:19,862 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:19,863 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:19,863 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:19,864 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:19,864 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:19,865 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:19,865 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:19,866 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:19,868 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:19,868 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:19,869 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:19,869 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:19,870 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:19,870 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:19,871 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:19,871 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:19,872 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:19,873 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:19,874 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:19,876 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:19,919 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:19,920 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:19,921 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:19,922 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:19,922 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:19,923 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:19,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:19,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:19,925 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:19,925 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:19,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:19,927 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:19,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:19,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:19,929 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:19,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:19,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:19,930 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:19,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:19,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:19,934 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:19,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:19,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:19,936 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:19,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:19,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:19,938 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:19,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:19,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:19,940 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:19,941 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:19,941 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:19,942 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:19,942 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:19,942 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:19,943 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:19,943 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:19,944 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:19,945 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:19,946 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:19,946 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:19,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:19,947 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:19,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:19,948 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:19,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:19,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:19,949 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:19,950 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:19,950 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:19,951 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:19,951 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:19,952 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:19,954 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:19,956 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:20,006 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:20,008 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:20,008 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:20,009 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:20,013 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:20,014 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:20,015 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:20,015 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:20,016 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:20,016 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:20,016 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:20,017 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:20,017 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:20,017 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:20,018 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:20,018 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:20,018 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:20,020 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:20,021 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-12 11:04:20,022 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:20,023 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:20,023 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:20,026 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:20,028 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:20,208 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:20,209 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:20,210 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:20,212 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:20,213 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:20,215 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:20,216 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:20,217 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:20,266 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:20,536 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:20,537 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:20,538 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:20,538 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:20,539 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:20,540 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:20,540 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:20,541 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:21,042 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:21,044 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:21,044 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:21,045 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:21,045 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:21,046 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:21,047 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:21,047 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:21,049 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:21,050 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:21,050 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:21,051 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:21,055 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:21,055 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:21,056 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:21,056 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:21,058 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:21,058 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:21,059 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:21,059 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:21,062 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:21,062 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:21,062 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:21,063 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:21,066 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:21,066 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:21,067 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:21,067 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:21,068 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:21,068 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:21,069 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:21,069 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:21,069 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:21,070 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:21,071 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:21,071 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:21,074 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:21,075 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:21,075 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:21,076 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:21,076 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:21,076 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:21,077 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:21,077 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:21,077 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:21,078 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:21,079 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:21,079 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:21,080 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:21,080 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:21,081 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:21,081 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:21,081 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:21,082 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:21,113 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:21,115 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:21,115 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:21,116 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:21,117 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:21,117 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:21,118 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:21,118 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:21,119 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:21,119 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:21,120 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:21,120 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:21,120 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:21,121 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:21,121 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:21,121 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:21,122 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:21,122 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:21,122 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:21,123 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:21,124 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:21,124 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:21,125 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:21,125 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:21,125 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:21,126 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:21,126 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:21,126 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,127 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:21,127 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:21,127 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:21,128 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,128 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:21,128 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:21,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:21,130 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:21,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:21,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:21,131 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:21,131 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:21,132 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:21,132 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:21,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:21,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:21,134 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:21,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:21,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:21,136 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:21,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:21,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:21,137 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:21,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:21,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:21,139 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:21,141 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:21,143 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:21,143 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:21,144 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,196 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:21,198 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:21,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:21,199 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:21,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:21,200 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:21,253 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:21,254 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:21,255 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:21,256 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:21,256 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:21,263 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:21,264 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:21,313 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:21,369 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:21,370 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:21,371 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:21,371 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:21,372 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:21,373 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,378 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:21,412 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:21,415 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:21,416 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:21,416 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:21,416 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:21,417 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.16s
2025-10-12 11:04:21,418 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:21,421 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:21,422 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:21,423 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:21,424 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,426 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:21,426 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:21,429 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:21,430 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:21,478 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:21,481 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:21,482 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:21,484 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,484 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:21,487 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,488 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:21,489 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:21,490 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:21,491 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:21,550 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:21,551 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:21,551 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:21,552 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.34s
2025-10-12 11:04:21,702 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:21,703 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:21,704 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:21,708 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:21,711 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:22,266 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:22,267 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:22,268 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:22,270 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:22,271 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:22,272 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:22,273 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:22,274 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:04:22,280 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:22,281 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:22,281 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:22,282 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:22,282 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:22,283 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:22,283 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:22,284 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:22,345 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:22,785 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:22,786 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:22,787 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:22,788 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:22,788 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:22,789 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:22,789 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:22,790 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:22,792 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:22,793 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:22,793 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:22,794 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:22,797 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:22,798 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:22,799 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:22,800 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:22,808 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:22,833 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:22,834 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:22,835 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:22,838 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:22,839 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:22,839 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:22,840 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:22,842 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:22,843 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:22,843 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:22,844 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:22,844 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:22,845 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:22,846 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:22,846 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:22,846 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:22,847 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:22,848 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:22,848 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:22,851 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:22,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:22,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:22,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:22,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:22,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:22,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:22,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:22,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:22,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:22,856 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:22,856 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:22,856 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:22,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:22,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:22,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:22,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:22,860 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:22,861 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:22,862 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:22,910 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:22,911 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:22,913 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:22,914 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:22,914 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:22,915 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:22,915 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:22,915 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:22,916 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:22,916 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:22,917 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:22,917 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:22,917 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:22,918 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:22,919 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:22,920 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:22,921 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:22,921 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:22,922 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:22,922 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:22,923 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:22,924 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:22,925 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:22,926 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:22,967 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:22,969 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:22,970 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:22,970 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:22,970 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:22,971 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:22,971 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:22,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:22,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:22,973 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:22,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:22,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:22,976 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:22,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:22,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:22,978 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:22,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:22,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:22,981 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:22,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:22,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:22,984 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:22,985 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:22,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:22,987 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:22,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:22,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:22,988 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:22,989 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:22,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:22,991 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:22,992 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:22,993 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:22,994 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:22,994 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:22,995 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:22,995 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:22,995 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:22,996 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:22,997 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:22,998 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:22,998 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:22,999 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:22,999 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:23,051 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:23,054 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:23,055 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:23,055 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:23,056 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:23,056 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,057 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:23,057 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:23,058 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:23,058 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:23,060 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:23,060 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:23,062 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:23,063 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,065 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:23,065 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:23,065 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:23,069 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:23,071 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:23,071 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:23,072 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:23,072 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,073 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:23,073 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,073 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,074 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:23,074 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:23,075 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:23,075 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:23,076 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:23,079 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.81s
2025-10-12 11:04:23,183 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:23,185 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:23,186 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:23,187 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:23,190 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:23,269 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:23,270 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:23,272 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:23,274 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:23,275 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:23,278 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:23,278 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:23,279 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:23,284 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:23,284 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:23,285 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:23,285 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:23,286 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:23,287 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:23,287 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:23,288 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:23,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:23,789 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:23,791 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:23,792 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:23,792 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:23,793 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:23,793 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:23,793 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:23,794 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:23,797 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:23,797 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:23,798 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:23,798 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:23,808 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:23,832 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:23,834 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:23,835 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:23,837 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:23,838 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:23,838 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:23,839 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:23,841 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:23,842 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:23,842 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:23,842 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:23,845 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:23,845 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:23,846 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:23,846 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:23,847 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:23,847 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:23,848 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:23,848 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:23,848 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:23,849 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:23,850 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:23,850 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:23,853 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:23,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:23,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:23,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:23,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:23,856 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:23,856 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:23,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:23,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:23,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:23,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:23,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:23,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:23,861 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:23,862 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:23,910 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:23,911 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:23,911 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:23,912 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:23,913 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:23,914 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:23,915 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:23,916 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:23,916 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:23,917 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:23,917 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:23,918 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:23,918 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:23,919 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:23,920 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:23,922 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:23,922 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:23,923 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:23,923 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:23,924 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:23,924 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:23,925 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:23,925 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:23,926 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:23,926 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:23,930 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:23,930 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:23,931 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:23,931 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:23,932 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:23,933 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,933 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:23,934 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:23,935 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:23,936 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:23,936 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:23,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:23,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:23,938 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:23,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:23,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:23,943 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:23,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:23,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:23,995 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:23,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:23,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:24,000 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:24,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:24,003 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:24,004 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:24,005 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:24,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:24,006 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:24,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:24,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:24,010 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:24,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:24,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:24,012 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:24,013 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:24,013 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:24,014 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:24,014 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:24,015 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:24,017 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:24,017 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:24,018 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:24,018 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:24,019 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:24,019 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:24,020 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:24,020 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:24,020 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:24,021 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:24,021 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:24,021 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:24,023 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:24,024 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:24,024 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:24,025 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:24,026 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:24,026 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:24,071 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:24,073 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:24,076 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:24,078 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:24,078 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:24,079 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:24,083 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:24,084 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:24,084 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:24,084 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:24,085 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:24,085 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:24,086 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:24,087 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:24,087 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:24,088 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:24,089 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:24,090 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:24,136 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:24,138 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:24,141 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.87s
2025-10-12 11:04:24,244 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:24,245 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:24,245 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:24,246 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:24,249 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:24,308 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:24,313 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:24,314 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:24,316 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:24,317 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:24,318 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:24,319 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:24,319 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-12 11:04:24,331 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:24,370 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:24,375 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:24,388 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:24,396 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:24,463 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:24,540 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:24,623 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:24,673 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:25,179 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:25,181 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:25,182 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:25,183 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:25,183 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:25,183 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:25,184 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:25,184 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:25,187 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:25,188 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:25,188 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:25,189 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:25,193 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:25,193 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:25,194 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:25,195 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:25,197 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:25,198 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:25,198 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:25,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:25,201 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:25,201 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:25,202 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:25,202 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:25,204 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:25,205 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:25,206 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:25,234 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:25,236 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:25,237 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:25,238 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:25,239 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:25,239 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:25,240 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:25,241 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:25,241 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:25,246 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:25,247 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:25,247 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:25,248 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:25,249 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:25,249 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:25,250 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:25,250 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:25,250 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:25,251 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:25,251 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:25,251 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:25,252 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:25,252 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:25,252 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:25,253 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:25,253 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:25,254 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:25,256 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:25,257 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:25,258 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:25,258 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:25,259 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:25,259 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:25,260 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:25,261 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:25,261 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:25,261 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:25,262 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:25,262 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:25,262 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:25,263 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:25,263 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:25,263 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:25,264 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:25,265 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:25,265 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:25,266 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:25,266 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:25,266 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:25,267 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:25,268 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:25,268 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:25,269 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:25,269 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:25,270 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:25,271 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:25,271 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:25,272 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:25,272 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:25,273 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:25,273 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:25,274 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:25,275 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:25,276 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:25,320 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:25,321 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:25,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:25,324 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:25,327 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:25,329 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:25,330 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:25,389 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:25,390 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:25,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:25,707 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:25,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:25,829 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.50s
2025-10-12 11:04:25,830 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:25,831 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:25,832 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:25,832 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:25,833 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:25,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:25,834 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:25,835 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:25,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:25,837 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:25,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:25,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:25,840 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:25,843 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:25,843 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:25,844 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:25,844 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:25,845 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:25,845 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:25,846 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:25,846 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:25,939 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:25,939 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:25,940 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:25,994 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:26,006 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:26,064 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:26,101 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:26,144 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:26,184 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:26,197 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:26,212 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:26,278 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:26,288 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:26,342 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:26,349 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:26,354 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:26,363 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:26,371 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:26,373 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:26,377 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:26,380 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:26,431 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:26,431 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:26,443 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:26,445 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:26,502 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:26,531 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:26,579 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:26,638 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:26,652 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:26,653 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:26,661 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:26,714 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:26,715 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:26,715 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:26,716 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:26,717 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 2.40s
2025-10-12 11:04:26,729 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:26,730 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:26,731 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:26,733 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:26,734 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:26,738 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:26,785 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:26,786 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:26,787 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:26,787 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:26,788 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.06s
2025-10-12 11:04:26,789 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:26,794 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:26,799 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:27,114 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:27,115 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:27,116 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:27,116 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:27,117 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:27,118 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:27,118 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:27,119 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:27,620 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:27,621 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:27,622 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:27,623 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:27,623 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:27,623 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:27,624 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:27,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:27,627 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:27,627 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:27,628 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:27,628 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:27,631 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:27,631 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:27,632 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:27,632 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:27,635 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:27,635 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:27,636 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:27,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:27,639 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:27,639 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:27,640 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:27,641 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:27,644 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:27,645 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:27,669 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:27,670 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:27,671 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:27,673 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:27,674 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:27,675 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:27,675 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:27,675 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:27,683 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:27,713 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:27,719 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:27,720 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:27,720 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:27,722 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:27,722 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:27,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:27,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:27,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:27,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:27,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:27,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:27,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:27,726 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:27,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:27,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:27,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:27,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:27,728 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:27,728 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:27,729 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:27,729 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:27,730 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:27,730 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:27,731 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:27,733 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:27,733 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:27,734 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:27,734 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:27,735 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:27,735 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:27,735 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:27,736 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:27,736 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:27,737 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:27,738 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:27,739 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:27,741 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:27,742 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:27,743 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:27,743 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:27,744 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:27,745 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:27,747 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:27,748 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:27,749 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:27,792 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:27,793 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:27,793 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:27,794 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:27,796 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:27,798 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:27,798 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:27,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:27,799 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:27,800 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:27,800 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:27,801 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:27,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:27,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:27,805 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:27,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:27,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:27,806 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:27,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:27,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:27,808 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:27,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:27,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:27,811 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:27,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:27,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:27,813 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:27,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:27,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:27,815 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:27,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:27,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:27,817 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:27,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:27,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:27,819 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:27,820 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:27,820 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:27,821 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:27,822 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:27,822 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:27,823 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:27,823 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:27,824 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:27,824 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:27,825 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:27,826 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:27,891 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:27,971 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:28,059 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:28,084 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:28,133 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:28,147 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:28,148 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:28,156 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:28,168 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:28,221 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:28,236 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:28,239 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:28,241 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:28,245 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:28,246 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:28,253 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:28,299 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:28,300 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:28,305 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:28,403 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:28,417 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:28,420 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:28,423 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:28,424 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:28,427 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:28,431 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:28,431 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:28,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:28,547 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:28,553 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:28,554 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:28,559 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:28,560 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:28,562 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.83s
2025-10-12 11:04:28,572 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:28,575 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:28,576 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:28,620 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:28,625 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:28,742 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:28,743 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:28,744 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:28,746 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:28,747 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:28,749 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:28,751 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:28,752 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:28,754 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:28,755 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:28,757 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:28,757 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:28,758 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:28,758 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:28,759 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:28,760 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:28,828 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:29,261 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:29,263 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:29,263 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:29,264 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:29,265 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:29,265 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:29,266 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:29,266 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:29,269 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:29,269 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:29,270 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:29,270 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:29,274 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:29,275 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:29,275 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:29,275 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:29,278 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:29,278 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:29,279 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:29,279 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:29,288 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:29,288 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:29,289 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:29,289 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:29,292 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:29,293 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:29,293 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:29,294 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:29,295 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:29,295 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:29,296 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:29,296 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:29,297 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:29,297 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:29,298 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:29,298 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:29,336 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:29,338 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:29,339 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:29,340 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:29,340 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:29,341 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:29,341 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:29,342 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:29,343 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:29,343 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:29,343 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:29,344 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:29,344 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:29,345 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:29,346 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:29,346 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:29,347 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:29,347 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:29,348 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:29,349 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:29,350 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:29,350 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:29,351 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:29,352 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:29,352 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:29,353 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:29,353 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:29,356 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:29,356 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:29,357 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:29,357 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:29,357 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:29,358 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:29,358 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:29,359 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:29,362 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:29,362 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:29,363 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:29,363 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:29,364 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:29,364 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:29,365 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:29,366 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:29,366 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:29,366 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:29,367 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,368 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:29,368 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:29,368 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:29,369 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,369 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:29,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:29,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:29,372 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:29,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:29,373 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:29,374 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:29,375 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:29,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:29,376 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:29,377 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:29,420 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:29,421 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:29,423 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:29,424 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:29,426 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:29,474 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:29,475 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:29,476 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:29,477 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:29,478 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:29,482 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:29,482 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:29,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:29,484 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:29,486 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,486 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:29,487 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:29,488 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:29,489 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:29,489 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:29,489 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:29,490 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:29,490 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:29,490 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:29,491 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:29,491 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:29,491 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:29,492 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:29,492 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:29,493 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:29,495 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:29,495 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:29,496 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,496 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:29,497 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:29,497 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:29,497 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:29,498 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:29,499 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:29,500 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:29,502 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,504 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:29,504 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:29,505 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:29,508 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:29,509 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:29,510 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:29,512 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:29,513 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,513 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:29,514 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,514 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:29,515 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:29,516 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:29,516 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:29,518 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:29,562 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:29,564 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-12 11:04:29,574 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:29,576 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:29,576 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:29,577 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:29,581 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:29,747 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:29,748 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:29,749 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:29,751 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:29,752 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:29,753 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:29,754 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:29,755 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:29,759 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:29,760 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:29,762 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:29,762 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:29,763 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:29,763 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:29,764 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:29,764 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:29,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:30,266 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:30,268 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:30,268 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:30,269 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:30,269 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:30,270 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:30,270 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:30,271 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:30,272 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:30,273 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:30,273 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:30,274 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:30,277 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:30,277 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:30,277 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:30,278 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:30,279 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:30,280 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:30,280 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:30,281 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:30,283 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:30,284 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:30,284 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:30,285 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:30,287 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:30,288 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:30,288 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:30,289 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:30,289 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:30,290 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:30,290 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:30,291 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:30,291 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:30,291 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:30,293 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:30,293 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:30,296 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:30,296 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:30,297 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:30,297 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:30,298 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:30,298 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:30,299 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:30,299 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:30,300 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:30,301 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:30,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:30,301 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:30,332 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:30,334 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:30,334 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:30,335 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:30,335 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:30,335 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:30,336 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:30,337 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:30,337 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:30,338 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:30,338 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:30,339 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:30,339 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:30,339 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:30,340 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:30,340 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:30,341 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:30,341 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:30,341 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:30,342 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:30,342 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:30,342 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:30,343 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:30,343 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:30,344 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:30,345 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:30,345 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:30,345 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:30,346 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:30,346 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:30,347 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:30,347 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:30,347 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:30,347 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,348 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:30,348 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:30,349 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:30,349 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,350 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:30,350 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:30,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:30,352 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:30,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:30,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:30,353 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:30,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:30,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:30,355 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:30,355 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:30,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:30,356 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:30,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:30,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:30,358 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:30,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:30,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:30,360 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:30,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:30,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:30,364 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:30,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:30,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:30,416 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:30,419 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,420 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:30,420 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:30,420 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:30,421 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:30,421 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:30,422 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:30,422 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:30,422 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:30,423 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:30,423 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:30,424 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:30,426 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:30,426 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:30,427 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:30,427 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:30,427 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:30,428 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:30,428 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,429 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:30,429 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:30,429 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:30,430 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:30,431 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:30,433 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:30,434 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:30,479 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,481 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:30,482 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:30,482 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:30,483 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:30,489 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:30,490 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:30,490 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:30,491 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,492 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:30,492 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,493 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:30,493 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:30,493 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:30,494 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:30,494 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:30,496 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:30,497 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.75s
2025-10-12 11:04:30,609 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:30,612 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:30,613 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:30,614 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:30,618 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:30,757 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:30,758 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:30,760 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:30,762 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:30,763 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:30,765 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:30,767 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:30,768 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:30,773 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:30,774 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:30,775 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:30,776 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:30,776 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:30,777 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:30,777 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:30,778 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:30,821 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:31,279 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:31,281 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:31,282 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:31,282 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:31,283 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:31,283 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:31,284 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:31,284 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:31,287 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:31,287 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:31,288 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:31,288 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:31,292 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:31,292 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:31,293 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:31,294 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:31,296 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:31,296 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:31,297 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:31,297 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:31,300 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:31,327 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:31,328 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:31,332 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:31,361 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:31,363 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:31,402 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:31,403 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:31,403 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:31,404 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:31,404 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:31,405 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:31,406 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:31,447 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:31,493 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:31,524 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:31,539 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:31,540 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:31,541 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:31,541 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:31,542 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:31,542 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:31,542 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:31,543 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:31,544 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:31,544 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:31,545 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:31,546 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:31,546 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:31,607 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:31,609 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:31,611 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:31,612 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:31,613 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:31,613 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:31,614 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:31,615 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:31,615 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:31,616 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:31,616 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:31,617 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:31,617 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:31,618 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:31,619 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:31,621 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:31,622 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:31,622 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:31,622 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:31,623 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:31,623 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:31,624 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:31,624 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:31,625 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:31,625 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:31,626 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:31,630 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:31,631 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:31,673 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:31,674 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:31,674 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:31,675 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:31,675 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,675 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:31,676 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:31,676 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:31,677 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,677 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:31,678 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:31,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:31,680 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:31,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:31,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:31,683 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:31,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:31,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:31,687 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:31,687 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:31,688 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:31,689 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:31,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:31,690 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:31,692 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:31,693 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:31,694 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:31,695 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:31,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:31,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:31,697 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:31,697 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:31,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:31,699 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:31,700 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,701 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:31,701 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:31,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:31,702 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:31,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:31,704 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:31,704 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:31,705 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:31,705 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:31,706 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:31,706 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:31,708 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:31,709 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:31,709 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:31,709 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:31,710 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:31,711 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:31,712 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,712 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:31,713 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:31,713 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:31,714 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:31,756 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:31,757 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:31,759 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:31,761 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,762 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:31,762 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:31,762 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:31,766 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:31,766 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:31,767 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:31,768 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:31,770 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:31,770 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:31,771 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:31,772 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,774 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:31,775 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:31,776 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:31,777 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,779 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:31,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:31,833 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:31,849 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:31,857 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:31,949 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:32,020 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:32,085 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:32,133 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.38s
2025-10-12 11:04:32,371 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:32,372 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:32,373 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:32,377 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:32,381 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:32,673 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:04:32,674 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-12 11:04:32,675 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-12 11:04:32,732 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-12 11:04:32,770 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:32,771 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:32,773 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:32,776 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:32,815 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:32,817 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:32,820 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:32,821 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-12 11:04:32,833 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:32,833 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:32,835 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:32,836 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:32,836 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:32,836 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:32,837 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:32,849 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:32,911 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:33,475 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:33,477 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:33,478 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:33,479 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:33,479 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:33,480 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:33,480 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:33,481 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:33,483 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:33,484 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:33,484 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:33,486 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:33,498 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:33,529 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:33,531 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:33,532 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:33,534 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:33,535 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:33,535 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:33,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:33,539 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:33,540 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:33,540 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:33,540 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:33,543 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:33,544 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:33,544 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:33,545 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:33,546 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:33,546 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:33,546 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:33,547 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:33,613 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:33,618 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:33,623 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:33,668 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:33,680 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:33,682 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:33,682 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:33,683 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:33,684 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:33,741 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:33,747 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:33,748 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:33,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:33,750 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:33,750 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:33,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:33,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:33,753 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:33,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:33,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:33,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:33,755 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:33,755 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:33,756 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:33,757 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:33,759 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:33,760 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:33,761 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:33,761 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:33,762 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:33,763 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:33,764 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:33,765 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:33,826 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:33,873 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:33,879 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:33,881 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:33,884 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:33,885 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:33,887 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:33,889 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:33,893 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:33,894 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:33,898 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-12 11:04:33,903 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:33,906 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:33,908 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:33,951 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:33,952 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:33,953 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:33,953 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:33,954 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:33,956 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:33,957 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:33,957 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:33,958 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:33,958 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:33,959 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:33,959 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:33,960 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:33,961 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:33,962 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:33,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:33,966 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:33,966 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:33,967 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:33,968 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:33,968 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:33,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:33,970 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:33,970 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:33,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:33,971 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:33,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:33,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:33,974 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:33,974 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:33,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:33,976 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:33,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:33,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:33,981 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:33,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:34,038 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:34,042 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:34,115 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:34,271 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:34,320 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:34,389 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:34,451 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:34,470 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:34,623 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:34,673 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:34,675 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:34,687 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:34,696 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:34,700 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:34,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:34,711 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:34,712 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:34,761 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:34,810 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:34,820 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:34,827 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:34,832 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:34,898 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:34,961 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:34,968 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:34,975 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:35,029 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:35,150 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:35,191 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:35,424 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:35,850 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:35,850 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:35,947 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:35,951 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:35,951 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:36,003 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:36,088 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:36,106 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:36,194 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:36,199 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.78s
2025-10-12 11:04:36,378 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:36,381 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:36,382 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:36,389 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:36,390 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:36,468 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:36,470 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:36,559 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:36,566 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:36,569 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:36,569 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:36,570 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:36,746 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:36,790 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:37,048 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:37,187 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:37,200 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:37,264 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:37,421 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.86s
2025-10-12 11:04:37,464 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 4.69s
2025-10-12 11:04:37,727 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:38,082 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:38,090 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:38,095 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:38,097 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:38,105 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:38,126 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:38,197 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:38,198 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:38,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:38,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:38,225 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:38,249 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:38,249 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:38,253 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:38,256 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.04s
2025-10-12 11:04:38,264 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:38,507 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:38,603 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:38,657 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:38,677 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:38,813 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:38,827 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:39,463 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:39,494 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:39,521 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:39,546 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:39,560 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:39,629 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:39,633 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:39,660 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:39,661 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:39,662 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:39,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:39,665 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:39,668 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:39,669 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:39,670 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:39,671 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:39,795 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:39,796 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:39,812 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:39,816 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:39,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:39,819 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:39,839 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:39,972 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:40,051 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:40,133 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:40,214 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:40,248 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:40,266 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:40,448 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:40,465 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:40,525 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:40,537 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:40,546 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:40,593 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:40,595 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:40,596 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:40,596 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:40,596 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:40,597 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:40,597 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:40,600 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:40,600 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:40,607 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:40,729 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:40,730 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:40,742 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:40,745 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:40,745 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:40,746 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:40,746 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:40,748 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:40,748 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:40,749 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:40,749 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:40,750 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:40,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:40,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:40,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:40,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:40,755 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:40,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:40,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:40,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:40,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:40,759 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:40,760 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:40,762 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:40,763 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:40,763 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:40,804 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:40,805 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:40,807 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:40,807 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:40,808 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:40,808 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:40,809 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:40,810 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:40,810 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:40,810 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:40,811 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:40,811 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:40,812 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:40,812 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:40,813 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:40,814 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:40,814 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:40,815 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:40,815 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:40,816 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:40,816 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:40,816 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:40,817 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:40,817 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:40,818 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:40,819 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:40,819 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:40,820 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:40,820 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:40,821 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:40,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:40,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:40,823 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:40,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:40,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:40,825 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:40,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:40,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:40,827 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:40,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:40,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:40,829 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:40,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:40,883 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:40,883 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:40,885 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:40,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:40,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:40,950 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:41,017 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:41,069 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:41,076 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:41,122 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:41,129 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:41,201 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:41,282 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:41,287 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:41,288 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:41,288 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:41,289 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:41,290 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:41,347 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:41,359 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:41,421 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:41,482 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:41,484 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:41,546 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:41,616 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:41,623 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:41,624 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:41,626 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:41,628 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:41,630 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:41,634 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:41,634 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:41,635 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:41,686 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:41,695 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:41,698 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:41,701 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:41,766 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:41,859 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:41,860 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:41,860 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:41,861 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:41,861 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:41,879 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:41,883 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:41,885 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:41,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:41,888 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:41,889 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:41,891 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:41,891 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:41,893 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:41,895 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:41,897 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:41,933 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:42,056 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:42,142 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:42,185 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 3.99s
2025-10-12 11:04:42,186 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:42,216 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:42,269 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:42,308 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:42,346 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:42,350 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.21s
2025-10-12 11:04:42,350 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:42,391 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:42,473 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:42,546 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:43,160 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:43,161 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:43,162 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:43,165 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:43,167 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:43,186 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:43,227 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:43,229 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-12 11:04:43,278 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:43,279 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:43,280 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:43,280 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:43,281 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:43,282 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:43,282 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:43,282 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:43,323 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:43,784 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:43,785 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:43,786 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:43,787 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:43,787 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:43,788 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:43,788 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:43,789 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:43,791 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:43,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:43,793 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:43,793 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:43,803 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:43,828 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:43,829 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:43,832 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:43,835 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:43,836 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:43,837 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:43,837 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:43,840 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:43,841 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:43,841 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:43,842 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:43,845 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:43,846 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:43,846 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:43,847 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:43,848 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:43,849 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:43,850 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:43,851 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:43,851 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:43,851 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:43,853 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:43,853 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:43,857 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:43,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:43,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:43,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:43,859 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:43,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:43,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:43,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:43,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:43,861 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:43,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:43,862 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:43,863 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:43,864 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:43,864 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:43,865 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:43,873 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:43,899 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:43,901 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:43,905 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:43,905 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:43,906 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:43,907 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:43,907 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:43,908 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:43,909 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:43,910 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:43,912 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:43,912 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:43,913 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:43,914 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:43,914 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:43,915 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:43,916 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:43,916 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:43,917 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:43,920 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:43,920 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:43,921 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:43,921 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:43,921 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:43,922 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:43,923 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:43,957 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:43,959 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:43,960 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:43,964 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:43,965 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:43,965 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:43,967 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:43,968 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:43,968 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:43,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:43,970 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:43,970 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:43,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:43,972 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:43,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:43,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:43,973 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:43,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:43,974 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:43,974 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:43,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:43,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:43,977 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:43,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:43,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:43,979 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:43,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:43,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:43,981 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:43,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:43,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:43,983 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:43,983 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:43,984 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:43,984 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:43,985 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:43,985 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:43,985 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:43,986 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:43,987 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:43,989 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:43,989 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:43,990 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:44,027 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:44,029 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:44,032 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:44,033 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:44,033 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:44,034 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:44,034 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:44,035 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,035 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,036 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:44,038 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:44,039 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:44,040 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:44,041 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:44,042 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:44,043 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,044 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:44,044 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:44,045 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:44,048 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:44,051 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:44,057 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:44,085 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:44,091 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,092 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,092 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,093 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,093 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,095 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:44,095 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:44,096 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:44,097 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:44,098 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.94s
2025-10-12 11:04:44,139 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:44,152 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:44,156 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:44,159 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:44,163 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:44,166 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:44,167 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:44,168 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:44,170 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:44,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:44,172 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:44,173 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:44,174 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:44,212 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:44,219 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:44,220 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:44,220 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:44,221 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:44,222 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:44,222 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:44,225 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:44,265 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:44,727 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:44,729 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:44,729 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:44,730 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:44,731 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:44,731 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:44,731 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:44,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:44,734 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-12 11:04:44,735 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:44,736 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:44,737 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-12 11:04:44,747 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-12 11:04:44,774 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:44,775 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:44,776 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-12 11:04:44,779 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-12 11:04:44,780 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:44,781 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:44,781 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-12 11:04:44,784 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-12 11:04:44,784 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:44,784 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:44,785 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:44,788 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:44,788 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-12 11:04:44,789 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:44,789 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-11 03:57:58+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-12 11:04:44,790 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:44,790 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:44,792 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:44,792 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:44,792 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:44,793 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-12 11:04:44,794 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:44,795 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:44,798 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:44,807 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:44,833 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4012.0997406540014
2025-10-12 11:04:44,834 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:44,834 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4007.435022430623
2025-10-12 11:04:44,835 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-12 11:04:44,835 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4003.8921387968867
2025-10-12 11:04:44,836 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-12 11:04:44,836 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3991.4296746470377
2025-10-12 11:04:44,837 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-12 11:04:44,838 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.066637447378
2025-10-12 11:04:44,839 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-12 11:04:44,839 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3984.688573709152
2025-10-12 11:04:44,840 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-12 11:04:44,840 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3995.5325531287763
2025-10-12 11:04:44,840 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-12 11:04:44,841 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3958.699079454898
2025-10-12 11:04:44,841 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4012.0997406540014, 'ema200': 4007.435022430623}, 'M5': {'ema50': 4003.8921387968867, 'ema200': 3991.4296746470377}, 'M15': {'ema50': 3995.066637447378, 'ema200': 3984.688573709152}, 'H1': {'ema50': 3995.5325531287763, 'ema200': 3958.699079454898}}
2025-10-12 11:04:44,842 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-12 11:04:44,842 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.826957437174722, TRs count: 179
2025-10-12 11:04:44,843 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:44,844 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.341940748764289, TRs count: 119
2025-10-12 11:04:44,845 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-12 11:04:44,846 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.460326616748858, TRs count: 95
2025-10-12 11:04:44,846 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-12 11:04:44,847 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 19.980595161259576, TRs count: 119
2025-10-12 11:04:44,848 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.826957437174722, 'M1': 3.341940748764289, 'M15': 10.460326616748858, 'H1': 19.980595161259576}
2025-10-12 11:04:44,848 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-12 11:04:44,848 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: {'high': 4058.033, 'low': 3944.632}
2025-10-12 11:04:44,849 - APP.services.mt5_service - DEBUG - Thêm PDH: 4058.033
2025-10-12 11:04:44,849 - APP.services.mt5_service - DEBUG - Thêm PDL: 3944.632
2025-10-12 11:04:44,849 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4058.033, Relation: ABOVE, Distance: 47572.00000000012
2025-10-12 11:04:44,850 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3944.632, Relation: BELOW, Distance: 65828.99999999972
2025-10-12 11:04:44,851 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 2
2025-10-12 11:04:44,852 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:44,852 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:44,853 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 71.51500000000006, 'd10': 67.97180000000003, 'd20': 56.30675000000001}
2025-10-12 11:04:44,853 - APP.services.mt5_service - DEBUG - Prev day close: 3989.994
2025-10-12 11:04:44,853 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:44,854 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:44,854 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:44,854 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:44,855 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:44,855 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:44,856 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:44,856 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,857 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,857 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:44,857 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6349797540000889}
2025-10-12 11:04:44,858 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,858 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:44,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:44,860 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:44,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:44,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:44,864 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-12 11:04:44,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-12 11:04:44,899 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4010.461
2025-10-12 11:04:44,901 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:44,903 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-12 11:04:44,905 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:44,905 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-12 11:04:44,906 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-12 11:04:44,907 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4010.461
2025-10-12 11:04:44,908 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-12 11:04:44,908 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-12 11:04:44,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:44,911 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-12 11:04:44,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-12 11:04:44,913 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4010.461
2025-10-12 11:04:44,914 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-12 11:04:44,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-12 11:04:44,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-12 11:04:44,916 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-12 11:04:44,918 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,918 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,919 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:44,919 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:44,919 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:44,920 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:44,920 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:44,920 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:44,921 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:44,921 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:44,922 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:44,923 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:44,923 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:44,925 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:44,926 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:44,926 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:44,965 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:44,967 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:44,968 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,968 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,969 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:44,970 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:44,971 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:44,971 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:44,973 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:44,974 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:44,976 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:44,976 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:44,977 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,980 - APP.services.mt5_service - DEBUG - Đã định dạng 100 deals cho XAUUSD.
2025-10-12 11:04:44,981 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:44,981 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:44,981 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:44,982 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:44,982 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,983 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,984 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,984 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:44,985 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:44,985 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:44,985 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:44,985 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4058.033, 'relation': 'ABOVE', 'distance_pips': 47572.00000000012}, {'name': 'PDL', 'price': 3944.632, 'relation': 'BELOW', 'distance_pips': 65828.99999999972}]
2025-10-12 11:04:44,987 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:44,989 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.82s
2025-10-12 11:04:45,059 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:45,085 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:45,092 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 116.19, 'equity': 116.19, 'free_margin': 116.19, 'currency': 'USD', 'leverage': 2000}
2025-10-12 11:04:45,093 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-12 11:04:45,096 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:45,171 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:45,172 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-12 11:04:45,173 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-12 11:04:45,175 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-12 11:04:45,178 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-12 11:04:45,181 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-12 11:04:45,182 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:45,182 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-12 11:04:45,188 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:45,188 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:45,189 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:45,189 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-12 11:04:45,190 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-12 11:04:45,191 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-12 11:04:45,191 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-12 11:04:45,192 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-12 11:04:45,201 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-12 11:04:45,387 - APP.ui.app_ui - INFO - Bắt đầu quy trình tắt ứng dụng an toàn.
2025-10-12 11:04:45,576 - APP.ui.app_ui - INFO - Yêu cầu hủy session phân tích autorun-20251012-110354 trong quá trình shutdown.
2025-10-12 11:04:45,576 - APP.utils.threading_utils - INFO - Cancel group 'analysis.session' → task 'analysis.session.autorun-20251012-110354'
2025-10-12 11:04:45,577 - APP.core.analysis_controller - INFO - Đã gửi tín hiệu hủy cho session autorun-20251012-110354
2025-10-12 11:04:45,577 - APP.ui.controllers.chart_controller - INFO - Dừng ChartController stream hiện tại.
2025-10-12 11:04:45,578 - APP.utils.threading_utils - INFO - Cancel group 'chart.refresh' → task 'chart.info'
2025-10-12 11:04:45,578 - APP.ui.components.chart_tab - INFO - ChartTab đã dừng làm mới dữ liệu.
2025-10-12 11:04:45,640 - APP.ui.app_ui - DEBUG - Bắt đầu thu thập dữ liệu cấu hình từ UI.
2025-10-12 11:04:45,641 - APP.configs.workspace_config - DEBUG - Bắt đầu lưu cấu hình vào file.
2025-10-12 11:04:45,641 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-12 11:04:45,642 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-12 11:04:45,642 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-12 11:04:45,674 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-12 11:04:45,676 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-12 11:04:45,677 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'te'.
2025-10-12 11:04:45,677 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-12 11:04:45,678 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-12 11:04:45,678 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-12 11:04:45,679 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-12 11:04:45,679 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-12 11:04:45,680 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'fmp'.
2025-10-12 11:04:45,680 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-12 11:04:45,681 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-12 11:04:45,682 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-12 11:04:45,682 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-12 11:04:45,683 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-12 11:04:45,683 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'token' trong nhóm 'telegram'.
2025-10-12 11:04:45,686 - APP.configs.workspace_config - INFO - Cấu hình đã được lưu thành công vào C:\Users\leanhchi\.gemini_folder_analyze\workspace.json
2025-10-12 11:04:45,687 - APP.configs.workspace_config - DEBUG - Kết thúc lưu cấu hình vào file.
2025-10-12 11:04:45,688 - APP.ui.app_ui - INFO - Đã lưu cấu hình workspace thành công.
2025-10-12 11:04:45,689 - APP.services.mt5_service - INFO - Đang ngắt kết nối khỏi MetaTrader 5.
2025-10-12 11:04:45,692 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-12 11:04:45,694 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-12 11:04:45,695 - APP.services.mt5_service - INFO - Đã ngắt kết nối MT5 thành công.
2025-10-12 11:04:45,696 - APP.ui.app_ui - INFO - UI queue backlog khi shutdown: 0
2025-10-12 11:04:45,696 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-12 11:04:45,697 - APP.services.mt5_service - DEBUG - Current price (cp): 4010.461
2025-10-12 11:04:45,697 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 5m để tính tick stats.
2025-10-12 11:04:45,697 - APP.services.mt5_service - WARNING - Không đủ dữ liệu tick cho 30m để tính tick stats.
2025-10-12 11:04:45,697 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-12 11:04:45,698 - APP.services.mt5_service - WARNING - Lần thử 1/3: Không lấy được rates từ MT5 cho XAUUSD 1. Chờ 0.2s...
2025-10-12 11:04:45,898 - APP.services.mt5_service - WARNING - Lần thử 2/3: Không lấy được rates từ MT5 cho XAUUSD 1. Chờ 0.2s...
2025-10-12 11:04:46,100 - APP.services.mt5_service - WARNING - Lần thử 3/3: Không lấy được rates từ MT5 cho XAUUSD 1. Chờ 0.2s...
2025-10-12 11:04:46,301 - APP.services.mt5_service - WARNING - Không lấy được rates từ MT5 cho XAUUSD 1.
2025-10-12 11:04:46,302 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:46,302 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-12 11:04:46,303 - APP.services.mt5_service - WARNING - Lần thử 1/3: Không lấy được rates từ MT5 cho XAUUSD 5. Chờ 0.2s...
2025-10-12 11:04:46,504 - APP.services.mt5_service - WARNING - Lần thử 2/3: Không lấy được rates từ MT5 cho XAUUSD 5. Chờ 0.2s...
2025-10-12 11:04:46,705 - APP.services.mt5_service - WARNING - Lần thử 3/3: Không lấy được rates từ MT5 cho XAUUSD 5. Chờ 0.2s...
2025-10-12 11:04:46,906 - APP.services.mt5_service - WARNING - Không lấy được rates từ MT5 cho XAUUSD 5.
2025-10-12 11:04:46,906 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:46,907 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-12 11:04:46,907 - APP.services.mt5_service - WARNING - Lần thử 1/3: Không lấy được rates từ MT5 cho XAUUSD 15. Chờ 0.2s...
2025-10-12 11:04:47,108 - APP.services.mt5_service - WARNING - Lần thử 2/3: Không lấy được rates từ MT5 cho XAUUSD 15. Chờ 0.2s...
2025-10-12 11:04:47,310 - APP.services.mt5_service - WARNING - Lần thử 3/3: Không lấy được rates từ MT5 cho XAUUSD 15. Chờ 0.2s...
2025-10-12 11:04:47,542 - APP.services.mt5_service - WARNING - Không lấy được rates từ MT5 cho XAUUSD 15.
2025-10-12 11:04:47,586 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:47,637 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-12 11:04:47,638 - APP.services.mt5_service - WARNING - Lần thử 1/3: Không lấy được rates từ MT5 cho XAUUSD 16385. Chờ 0.2s...
2025-10-12 11:04:47,840 - APP.services.mt5_service - WARNING - Lần thử 2/3: Không lấy được rates từ MT5 cho XAUUSD 16385. Chờ 0.2s...
2025-10-12 11:04:48,041 - APP.services.mt5_service - WARNING - Lần thử 3/3: Không lấy được rates từ MT5 cho XAUUSD 16385. Chờ 0.2s...
2025-10-12 11:04:48,242 - APP.services.mt5_service - WARNING - Không lấy được rates từ MT5 cho XAUUSD 16385.
2025-10-12 11:04:48,243 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-12 11:04:48,243 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-12 11:04:48,243 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-12 11:04:48,244 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-12 11:04:48,244 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 0 rates.
2025-10-12 11:04:48,244 - APP.services.mt5_service - DEBUG - Rates trống, không thể tính VWAP.
2025-10-12 11:04:48,245 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': None, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-12 11:04:48,245 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': None, 'ema200': None}, 'M5': {'ema50': None, 'ema200': None}, 'M15': {'ema50': None, 'ema200': None}, 'H1': {'ema50': None, 'ema200': None}}
2025-10-12 11:04:48,246 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 0 rates, period: 14
2025-10-12 11:04:48,246 - APP.services.mt5_service - DEBUG - Không đủ rates để tính ATR.
2025-10-12 11:04:48,246 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 0 rates, period: 14
2025-10-12 11:04:48,247 - APP.services.mt5_service - DEBUG - Không đủ rates để tính ATR.
2025-10-12 11:04:48,247 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 0 rates, period: 14
2025-10-12 11:04:48,247 - APP.services.mt5_service - DEBUG - Không đủ rates để tính ATR.
2025-10-12 11:04:48,248 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 0 rates, period: 14
2025-10-12 11:04:48,249 - APP.services.mt5_service - DEBUG - Không đủ rates để tính ATR.
2025-10-12 11:04:48,249 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': None, 'M1': None, 'M15': None, 'H1': None}
2025-10-12 11:04:48,250 - APP.services.mt5_service - DEBUG - Volatility regime: None
2025-10-12 11:04:48,250 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4010.461, daily: {}, prev_day: None
2025-10-12 11:04:48,251 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 0
2025-10-12 11:04:48,251 - APP.services.mt5_service - DEBUG - Key levels nearby: []
2025-10-12 11:04:48,251 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-12 11:04:48,285 - APP.services.mt5_service - WARNING - Không đủ dữ liệu D1 để tính adr_stats cho XAUUSD.
2025-10-12 11:04:48,285 - APP.services.mt5_service - DEBUG - Position in day range: None
2025-10-12 11:04:48,286 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-11 03:57:58+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-12 11:04:48,290 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-11 03:57:58+07:00
2025-10-12 11:04:48,291 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-11 03:57:58+07:00 trong DST: True
2025-10-12 11:04:48,291 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-12 11:04:48,292 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-12 11:04:48,292 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 123
2025-10-12 11:04:48,293 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:48,293 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:48,294 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4600', 'price': 4010.46, 'distance_pips': 0.1}, {'level': '4625', 'price': 4010.463, 'distance_pips': 0.15}, {'level': '4650', 'price': 4010.465, 'distance_pips': 0.4}, {'level': '4675', 'price': 4010.468, 'distance_pips': 0.65}]
2025-10-12 11:04:48,294 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': None}
2025-10-12 11:04:48,294 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:48,295 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:48,296 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:48,297 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:48,298 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:48,298 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:48,298 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:48,299 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:48,300 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:48,301 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:48,302 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:48,302 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:48,305 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-12 11:04:48,305 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-12 11:04:48,306 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-12 11:04:48,354 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-12 11:04:48,354 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-12 11:04:48,355 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-12 11:04:48,355 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-12 11:04:48,356 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-12 11:04:48,357 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:48,357 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:48,358 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-12 11:04:48,358 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-12 11:04:48,359 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-12 11:04:48,360 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-12 11:04:48,361 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-12 11:04:48,362 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-12 11:04:48,363 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:48,364 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-12 11:04:48,364 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-12 11:04:48,364 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4010.461, 'ask': 4010.498, 'last': 0.0, 'time': 1760129878}
2025-10-12 11:04:48,366 - APP.services.mt5_service - WARNING - MT5 chưa kết nối, không thể lấy lịch sử deals.
2025-10-12 11:04:48,366 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-12 11:04:48,367 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-12 11:04:48,367 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-12 11:04:48,399 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -470.0, 'swap_short': 0.0}
2025-10-12 11:04:48,400 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-12 11:04:48,401 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-12 11:04:48,402 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4010.461
2025-10-12 11:04:48,404 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': []
2025-10-12 11:04:48,405 - APP.core.trading.conditions - INFO - Điều kiện NO-TRADE được kích hoạt: Không có dữ liệu ATR M5 để kiểm tra biến động.
2025-10-12 11:04:48,405 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-12 11:04:48,406 - APP.utils.threading_utils - INFO - Task 'chart.info' (group=chart.refresh) bị hủy sau 3.23s
2025-10-12 11:04:48,407 - APP.ui.controllers.chart_controller - DEBUG - Future chart.info bị cancel, không cập nhật UI.
2025-10-12 11:04:55,735 - APP.utils.threading_utils - WARNING - await_idle hết thời gian cho group=analysis.session
2025-10-12 11:04:55,736 - APP.utils.threading_utils - INFO - ThreadingManager.shutdown(wait=True, timeout=5.0, force=False)
2025-10-12 11:05:00,764 - APP.utils.threading_utils - WARNING - await_idle hết thời gian cho group=<all>
2025-10-12 11:05:00,776 - APP.services.gemini_service - INFO - Lần thử 1: Kết nối stream tới Gemini API thành công.
2025-10-12 11:05:00,965 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Dừng bởi người dùng trong khi streaming.
2025-10-12 11:05:00,971 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-12 11:05:00,974 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots
2025-10-12 11:05:00,975 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 4 tên file.
2025-10-12 11:05:00,976 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_H1.png
2025-10-12 11:05:00,976 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'H1' cho 'XAUUSD_H1.png' bằng pattern đã biên dịch.
2025-10-12 11:05:00,978 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M1.png
2025-10-12 11:05:00,979 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M1' cho 'XAUUSD_M1.png' bằng pattern đã biên dịch.
2025-10-12 11:05:00,980 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M15.png
2025-10-12 11:05:00,980 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M15' cho 'XAUUSD_M15.png' bằng pattern đã biên dịch.
2025-10-12 11:05:00,981 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu phát hiện timeframe cho tên file: XAUUSD_M5.png
2025-10-12 11:05:00,981 - APP.ui.utils.timeframe_detector - DEBUG - Đã phát hiện timeframe 'M5' cho 'XAUUSD_M5.png' bằng pattern đã biên dịch.
2025-10-12 11:05:00,982 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {'XAUUSD_H1.png': 'H1', 'XAUUSD_M1.png': 'M1', 'XAUUSD_M15.png': 'M15', 'XAUUSD_M5.png': 'M5'}
2025-10-12 11:05:00,984 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-12 11:05:00,987 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-12 11:05:00,987 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251012_110500.md
2025-10-12 11:05:00,992 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-12 11:05:01,039 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-12 11:05:01,050 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-12 11:05:01,105 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-12 11:05:01,107 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-12 11:05:01,109 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251012_110500.md
2025-10-12 11:05:01,109 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-12 11:05:01,111 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-12 11:05:01,112 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-12 11:05:01,116 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-12 11:05:01,158 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251012_104045.md
2025-10-12 11:05:01,166 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-12 11:05:01,166 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-12 11:05:01,167 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-12 11:05:01,167 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-12 11:05:01,168 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-12 11:05:01,170 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-12 11:05:01,170 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-12 11:05:01,170 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-12 11:05:01,171 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-12 11:05:01,171 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-12 11:05:01,175 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251012_110501.json
2025-10-12 11:05:01,236 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-12 11:05:01,296 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251012_104046.json
2025-10-12 11:05:01,341 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-12 11:05:01,357 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-12 11:05:01,403 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-12 11:05:01,421 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-12 11:05:01,422 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-12 11:05:01,422 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-12 11:05:01,422 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-12 11:05:01,423 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-12 11:05:01,423 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-12 11:05:01,425 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-12 11:05:01,480 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-12 11:05:01,511 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-12 11:05:01,516 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251012-110354' (group=analysis.session) hoàn tất sau 67.15s
2025-10-12 11:05:03,505 - APP.ui.app_ui - INFO - Ứng dụng đã đóng thành công.
2025-10-12 11:05:03,505 - __main__ - INFO - Ứng dụng đã đóng thành công.
