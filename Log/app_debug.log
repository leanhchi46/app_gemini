2025-10-14 12:58:50,737 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:58:51,015 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:58:48+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:58:51,021 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:58:48+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:58:51,036 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:51,037 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:58:48+07:00
2025-10-14 12:58:51,046 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:51,062 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:58:48+07:00 trong DST: True
2025-10-14 12:58:51,072 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:51,097 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:58:51,098 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:51,136 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:58:51,142 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:51,156 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:58:51,160 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:58:51,162 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.12s
2025-10-14 12:58:51,163 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.551010372673
2025-10-14 12:58:51,225 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.551010372673, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:58:51,228 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:58:51,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4115.3744413647755
2025-10-14 12:58:51,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:58:51,230 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.315187371724
2025-10-14 12:58:51,232 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:58:51,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.035274171428
2025-10-14 12:58:51,234 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:58:51,245 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.531389950431
2025-10-14 12:58:51,249 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:51,251 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:58:51,267 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.634635127991
2025-10-14 12:58:51,535 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:58:51,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.612371052877
2025-10-14 12:58:52,109 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:58:52,133 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.672320938675
2025-10-14 12:58:52,162 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:52,162 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:58:52,165 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:52,165 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.8640916245618
2025-10-14 12:58:52,187 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:52,338 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4115.3744413647755, 'ema200': 4125.315187371724}, 'M5': {'ema50': 4127.035274171428, 'ema200': 4129.531389950431}, 'M15': {'ema50': 4128.634635127991, 'ema200': 4105.612371052877}, 'H1': {'ema50': 4085.672320938675, 'ema200': 4018.8640916245618}}
2025-10-14 12:58:52,480 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:52,497 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:58:52,668 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:52,720 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:58:52,767 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.60s
2025-10-14 12:58:52,782 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:58:52,793 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0756458201647203, TRs count: 119
2025-10-14 12:58:52,816 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:58:52,854 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:52,870 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:58:52,963 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:58:52,973 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:58:52,983 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 3.0756458201647203, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:58:52,993 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:58:53,034 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4105.818, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:58:53,081 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:58:53,097 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:58:53,108 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:58:53,129 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:58:53,138 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 26311.999999999898
2025-10-14 12:58:53,139 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 81457.00000000033
2025-10-14 12:58:53,156 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 29386.499999999614
2025-10-14 12:58:53,159 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 22333.999999999833
2025-10-14 12:58:53,163 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:58:53,168 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26311.999999999898}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81457.00000000033}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29386.499999999614}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22333.999999999833}]
2025-10-14 12:58:53,169 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:58:53,171 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:58:53,177 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:58:53,179 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:58:53,196 - APP.services.mt5_service - DEBUG - Position in day range: 0.17055862602437546
2025-10-14 12:58:53,218 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:58:48+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:58:53,221 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:58:48+07:00
2025-10-14 12:58:53,224 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:58:48+07:00 trong DST: True
2025-10-14 12:58:53,230 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:58:53,233 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:58:53,251 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:58:53,257 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:53,260 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:53,292 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8100', 'price': 4105.81, 'distance_pips': 0.8}, {'level': '8125', 'price': 4105.812, 'distance_pips': 0.55}, {'level': '8150', 'price': 4105.815, 'distance_pips': 0.3}, {'level': '8175', 'price': 4105.818, 'distance_pips': 0.05}]
2025-10-14 12:58:53,310 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:58:53,327 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:53,338 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:53,383 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:53,387 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.folder_watch.scan' vào nhóm 'ui.io.folder_watch' (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:58:53,389 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:53,391 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.folder_watch.scan vào group ui.io.folder_watch (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:58:53,394 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:58:53,408 - APP.utils.threading_utils - DEBUG - Task 'ui.io.folder_watch.scan' (group=ui.io.folder_watch) hoàn tất sau 0.02s
2025-10-14 12:58:53,422 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:53,425 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:53,431 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.818
2025-10-14 12:58:53,432 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:58:53,433 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:53,438 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:58:53,439 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.05s
2025-10-14 12:58:53,439 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:53,507 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:58:53,539 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:53,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:58:53,562 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:53,600 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4105.818
2025-10-14 12:58:53,611 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:58:53,662 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:58:53,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:53,829 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:58:53,901 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:58:54,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4105.818
2025-10-14 12:58:54,327 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-14 12:58:54,330 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:58:54,542 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-14 12:58:54,544 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-14 12:58:54,721 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:58:54,832 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-14 12:58:54,879 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:54,881 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:54,884 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:58:54,888 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:58:54,889 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.818
2025-10-14 12:58:54,890 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:58:54,890 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:58:54,900 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:54,901 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:54,916 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:54,917 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:58:54,936 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:54,939 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:54,948 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:54,951 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:54,966 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-14 12:58:55,076 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:58:55,084 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:58:55,088 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:58:55,089 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:58:55,099 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:58:55,113 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:58:55,142 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:55,142 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:58:55,282 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:58:55,360 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:58:55,433 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:58:55,506 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:58:55,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:58:55,664 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:58:55,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:58:55,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:58:55,876 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:58:55,933 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:55,934 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:55,947 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:56,010 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,015 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:56,015 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:58:56,018 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:56,019 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:58:56,033 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:56,035 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:58:56,036 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-14 12:58:56,038 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:58:56,042 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:58:56,076 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:58:56,089 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,091 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:58:56,093 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:58:56,173 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4105.818, 'ask': 4105.855, 'last': 0.0, 'time': 1760446728}
2025-10-14 12:58:56,190 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:56,201 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:58:56,203 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:58:56,246 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:58:56,289 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:58:56,330 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,357 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,365 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 512, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:58:56,370 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 689, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:58:56,397 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,408 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,419 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,514 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,562 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,567 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,624 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,665 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,672 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:58:56,675 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:58:56,700 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:58:56,715 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:58:56,720 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,734 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:58:56,738 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:58:56,746 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:56,758 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:56,763 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26311.999999999898}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81457.00000000033}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29386.499999999614}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22333.999999999833}]
2025-10-14 12:58:56,765 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:58:48+07:00
2025-10-14 12:58:56,766 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:58:56,776 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:58:56,781 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:58:56,784 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 7.81s
2025-10-14 12:58:56,868 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:56,870 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:58:56,871 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 115.01, 'free_margin': 112.95, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:58:56,872 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4105.855, 'profit': 8.94, 'comment': 'AI Trade TP1'}]
2025-10-14 12:58:56,876 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:58:56,955 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:56,971 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:56,973 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-14 12:58:56,978 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:56,980 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:56,981 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:56,982 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:56,984 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-14 12:58:56,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:58:56,988 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:58:57,042 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:58:57,120 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:57,155 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:58:57,309 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:58:57,314 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:58:57,437 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-14 12:58:57,442 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-14 12:58:57,950 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-14 12:58:57,988 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-14 12:58:57,994 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:57,999 - APP.services.mt5_service - DEBUG - Đã lấy 1 lệnh đang mở.
2025-10-14 12:58:58,043 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-14 12:58:58,099 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:58,105 - APP.services.mt5_service - DEBUG - Current price (cp): 4105.318
2025-10-14 12:58:58,105 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:58,108 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:58,139 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:58,152 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 497, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:58:58,165 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.07s
2025-10-14 12:58:58,309 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 688, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:58:58,315 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:58,315 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-14 12:58:58,359 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:58,367 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-14 12:58:58,381 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:58,413 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-14 12:58:58,449 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-14 12:58:58,475 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-14 12:58:58,513 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:58,533 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-14 12:58:58,566 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-14 12:58:58,574 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-14 12:58:58,630 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:58,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-14 12:58:58,674 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-14 12:58:58,702 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-14 12:58:58,706 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:58,759 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-14 12:58:58,766 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-14 12:58:58,806 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.folder_watch.scan' vào nhóm 'ui.io.folder_watch' (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:58:58,853 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:58:58,861 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.folder_watch.scan vào group ui.io.folder_watch (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:58:58,874 - APP.utils.threading_utils - DEBUG - Task 'ui.io.folder_watch.scan' (group=ui.io.folder_watch) hoàn tất sau 0.01s
2025-10-14 12:58:58,891 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-14 12:58:58,894 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:58,910 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-14 12:58:58,916 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:58:58,923 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:58:57+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:58:58,924 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:58:57+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:58:58,925 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:58:57+07:00
2025-10-14 12:58:58,942 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:58:57+07:00 trong DST: True
2025-10-14 12:58:58,953 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:58:58,971 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:58:58,972 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:58:58,976 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:58:58,978 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.53663802112
2025-10-14 12:58:58,983 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.53663802112, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:58:58,985 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:58:58,985 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4115.352755090265
2025-10-14 12:58:58,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:58:58,986 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.309684884162
2025-10-14 12:58:58,987 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:58:58,988 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.013587896918
2025-10-14 12:58:58,988 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:58:58,989 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.525887462869
2025-10-14 12:58:58,995 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:58:59,004 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.612948853481
2025-10-14 12:58:59,005 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:58:59,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.6068685653145
2025-10-14 12:58:59,007 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:58:59,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.6506346641654
2025-10-14 12:58:59,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:58:59,014 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.8585891369994
2025-10-14 12:58:59,015 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4115.352755090265, 'ema200': 4125.309684884162}, 'M5': {'ema50': 4127.013587896918, 'ema200': 4129.525887462869}, 'M15': {'ema50': 4128.612948853481, 'ema200': 4105.6068685653145}, 'H1': {'ema50': 4085.6506346641654, 'ema200': 4018.8585891369994}}
2025-10-14 12:58:59,017 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:58:59,018 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:58:59,047 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:58:59,048 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0756458201647203, TRs count: 119
2025-10-14 12:58:59,094 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:58:59,140 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:58:59,166 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:58:59,174 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:58:59,193 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:58:59,196 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:58:59,201 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:58:59,218 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:58:59,256 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 3.0756458201647203, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:58:59,260 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:58:59,262 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:58:59,264 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-14 12:58:59,285 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4105.318, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:58:59,288 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:58:59,293 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:58:59,380 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:58:59,476 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:58:59,730 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:58:59,810 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 26811.999999999898
2025-10-14 12:58:59,814 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 80957.00000000033
2025-10-14 12:58:59,862 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 29886.499999999614
2025-10-14 12:58:59,871 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 22833.999999999833
2025-10-14 12:58:59,887 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:58:59,894 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26811.999999999898}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 80957.00000000033}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29886.499999999614}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22833.999999999833}]
2025-10-14 12:58:59,910 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:58:59,934 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:58:59,935 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:58:59,936 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:58:59,937 - APP.services.mt5_service - DEBUG - Position in day range: 0.16495330769834776
2025-10-14 12:58:59,937 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:58:57+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:58:59,938 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:58:57+07:00
2025-10-14 12:58:59,939 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:58:57+07:00 trong DST: True
2025-10-14 12:58:59,940 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:58:59,941 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:58:59,941 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:58:59,942 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:59,942 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:59,943 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3100', 'price': 4105.31, 'distance_pips': 0.8}, {'level': '3125', 'price': 4105.312, 'distance_pips': 0.55}, {'level': '3150', 'price': 4105.315, 'distance_pips': 0.3}, {'level': '3175', 'price': 4105.318, 'distance_pips': 0.05}]
2025-10-14 12:58:59,943 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:58:59,943 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:59,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:59,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:58:59,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.318
2025-10-14 12:58:59,946 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:58:59,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:58:59,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:59,949 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:58:59,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:58:59,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4105.318
2025-10-14 12:58:59,952 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:58:59,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:58:59,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:59,956 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:58:59,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:58:59,958 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4105.318
2025-10-14 12:58:59,965 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:58:59,966 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:58:59,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:59,973 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:58:59,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:58:59,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.318
2025-10-14 12:58:59,982 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:58:59,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:58:59,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:58:59,996 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:58:59,997 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:58:59,998 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:58:59,998 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:58:59,999 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:00,000 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:00,001 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:00,003 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:00,004 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:00,005 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:00,006 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:00,008 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:00,009 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:00,010 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:00,011 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:00,013 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:00,018 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:00,025 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:00,028 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:00,039 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,088 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,201 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:59:00,205 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:00,295 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:59:00,373 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:00,392 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:59:00,408 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:00,410 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:00,483 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:59:00,502 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:00,512 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:00,532 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.16s
2025-10-14 12:59:00,536 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:00,538 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,539 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:59:00,540 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:59:00,541 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4105.318, 'ask': 4105.355, 'last': 0.0, 'time': 1760446737}
2025-10-14 12:59:00,544 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:59:00,546 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:59:00,547 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:59:00,547 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:59:00,548 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,549 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,549 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 497, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:00,550 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 688, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:00,550 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,550 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,551 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,564 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,569 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,575 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,575 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,576 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:59:00,577 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:00,577 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:00,578 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:00,578 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,581 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,581 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:00,582 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:00,599 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:00,628 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:00,634 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:00,687 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26811.999999999898}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 80957.00000000033}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29886.499999999614}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22833.999999999833}]
2025-10-14 12:59:00,766 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:58:57+07:00
2025-10-14 12:59:00,872 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:59:01,020 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:01,092 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:59:01,106 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 4.13s
2025-10-14 12:59:01,298 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:01,387 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:01,455 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 115.51, 'free_margin': 113.45, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:59:01,530 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4105.327, 'profit': 9.47, 'comment': 'AI Trade TP1'}]
2025-10-14 12:59:01,611 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:01,732 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:01,822 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:01,824 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-14 12:59:01,913 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:02,069 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:02,071 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:02,109 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:02,186 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:02,283 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:02,364 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:02,448 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.54s
2025-10-14 12:59:02,469 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:02,471 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:02,474 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:02,485 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:02,513 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-14 12:59:02,517 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-14 12:59:03,043 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-14 12:59:03,071 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:03,087 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-14 12:59:03,095 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:03,108 - APP.services.mt5_service - DEBUG - Đã lấy 1 lệnh đang mở.
2025-10-14 12:59:03,133 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-14 12:59:03,133 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:03,173 - APP.services.mt5_service - DEBUG - Current price (cp): 4105.457
2025-10-14 12:59:03,174 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:03,196 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 490, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:03,217 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:03,261 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.17s
2025-10-14 12:59:03,349 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:03,373 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 686, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:03,644 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-14 12:59:03,822 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:03,854 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-14 12:59:03,913 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:03,976 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-14 12:59:04,020 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-14 12:59:04,048 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-14 12:59:04,074 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.folder_watch.scan' vào nhóm 'ui.io.folder_watch' (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:59:04,075 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:04,076 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.folder_watch.scan vào group ui.io.folder_watch (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:59:04,077 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-14 12:59:04,089 - APP.utils.threading_utils - DEBUG - Task 'ui.io.folder_watch.scan' (group=ui.io.folder_watch) hoàn tất sau 0.01s
2025-10-14 12:59:04,095 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-14 12:59:04,098 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:04,100 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-14 12:59:04,104 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:04,110 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:04,112 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:04,113 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-14 12:59:04,121 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:04,124 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-14 12:59:04,126 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:04,129 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-14 12:59:04,130 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.03s
2025-10-14 12:59:04,133 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:04,136 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-14 12:59:04,136 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-14 12:59:04,140 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:04,143 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-14 12:59:04,158 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-14 12:59:04,170 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:59:04,173 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:59:02+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:59:04,175 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:02+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:04,176 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:04,176 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:02+07:00
2025-10-14 12:59:04,176 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:02+07:00 trong DST: True
2025-10-14 12:59:04,180 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:04,181 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:04,187 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:59:04,189 - APP.ui.app_ui - INFO - Phát hiện thư mục ảnh thay đổi, thực hiện quét lại và đoán symbol.
2025-10-14 12:59:04,194 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:59:04,196 - APP.ui.app_ui - DEBUG - Bắt đầu quá trình tải file từ thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots.
2025-10-14 12:59:04,201 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.436585542837
2025-10-14 12:59:04,209 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.436585542837, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:59:04,211 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.scan_folder' vào nhóm 'ui.io.scan' (metadata={'component': 'ui', 'operation': 'scan_folder'})
2025-10-14 12:59:04,220 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:04,224 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.scan_folder vào group ui.io.scan (metadata={'component': 'ui', 'operation': 'scan_folder'})
2025-10-14 12:59:04,224 - APP.ui.app_ui - DEBUG - Luồng quét thư mục bắt đầu cho: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots.
2025-10-14 12:59:04,225 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4114.962107311535
2025-10-14 12:59:04,226 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:04,239 - APP.ui.app_ui - INFO - Luồng quét đã hoàn tất, tìm thấy 4 file.
2025-10-14 12:59:04,284 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:04,338 - APP.utils.threading_utils - DEBUG - Task 'ui.io.scan_folder' (group=ui.io.scan) hoàn tất sau 0.11s
2025-10-14 12:59:04,363 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.1429031552925
2025-10-14 12:59:04,416 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:59:04,527 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.015940838095
2025-10-14 12:59:04,541 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-14 12:59:04,600 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:59:04,670 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-14 12:59:04,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.526484477794
2025-10-14 12:59:04,760 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-14 12:59:04,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:59:04,828 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-14 12:59:04,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.615301794657
2025-10-14 12:59:04,910 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:04,914 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:59:04,921 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: refresh_all_lists
2025-10-14 12:59:04,936 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.60746558024
2025-10-14 12:59:04,944 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-14 12:59:04,956 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:04,958 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-14 12:59:04,973 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.652987605342
2025-10-14 12:59:04,985 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-14 12:59:04,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:04,989 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-14 12:59:04,989 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-14 12:59:04,996 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.859186151925
2025-10-14 12:59:05,005 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-14 12:59:05,012 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4114.962107311535, 'ema200': 4125.1429031552925}, 'M5': {'ema50': 4127.015940838095, 'ema200': 4129.526484477794}, 'M15': {'ema50': 4128.615301794657, 'ema200': 4105.60746558024}, 'H1': {'ema50': 4085.652987605342, 'ema200': 4018.859186151925}}
2025-10-14 12:59:05,015 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.misc._refresh_worker' vào nhóm 'ui.misc' (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-14 12:59:05,018 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:59:05,019 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.misc._refresh_worker vào group ui.misc (metadata={'component': 'ui', 'operation': '_refresh_worker'})
2025-10-14 12:59:05,020 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-14 12:59:05,030 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:59:05,031 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:05,032 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:05,034 - APP.ui.app_ui - INFO - Phát hiện symbol XAUUSD từ ảnh (auto=True, giữ symbol hiện tại XAUUSD).
2025-10-14 12:59:05,035 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 2.858747402661943, TRs count: 119
2025-10-14 12:59:05,038 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:05,039 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:59:05,059 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:59:05,086 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 30 Báo cáo.
2025-10-14 12:59:05,112 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 30 JSON.
2025-10-14 12:59:05,113 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:05,121 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 0.13s
2025-10-14 12:59:05,124 - APP.utils.threading_utils - DEBUG - Task 'ui.misc._refresh_worker' (group=ui.misc) hoàn tất sau 0.10s
2025-10-14 12:59:05,169 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:59:05,282 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:05,283 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 2.858747402661943, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:59:05,294 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:05,294 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:59:05,295 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:05,299 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:05,316 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4105.457, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:05,340 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:05,358 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:05,364 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:59:05,393 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:05,410 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:59:05,421 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.13s
2025-10-14 12:59:05,440 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:59:05,442 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:59:05,443 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 26672.999999999774
2025-10-14 12:59:05,444 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 81096.00000000045
2025-10-14 12:59:05,444 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 29747.49999999949
2025-10-14 12:59:05,444 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 22694.99999999971
2025-10-14 12:59:05,445 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:59:05,446 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26672.999999999774}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81096.00000000045}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29747.49999999949}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22694.99999999971}]
2025-10-14 12:59:05,447 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:59:05,448 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:05,449 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:59:05,452 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:59:05,452 - APP.services.mt5_service - DEBUG - Position in day range: 0.16651158619298484
2025-10-14 12:59:05,453 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:02+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:05,457 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:02+07:00
2025-10-14 12:59:05,473 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:02+07:00 trong DST: True
2025-10-14 12:59:05,474 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:05,475 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:05,476 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:59:05,476 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:05,481 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:05,486 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4500', 'price': 4105.45, 'distance_pips': 0.7}, {'level': '4525', 'price': 4105.452, 'distance_pips': 0.45}, {'level': '4550', 'price': 4105.455, 'distance_pips': 0.2}, {'level': '4575', 'price': 4105.457, 'distance_pips': 0.05}]
2025-10-14 12:59:05,486 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:05,487 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:59:05,513 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:05,542 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:05,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:05,614 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.457
2025-10-14 12:59:05,677 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:05,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:05,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:05,764 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:59:05,781 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:59:05,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4105.457
2025-10-14 12:59:05,819 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:05,889 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:59:05,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:06,042 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:59:06,063 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:59:06,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4105.457
2025-10-14 12:59:06,168 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:06,176 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:59:06,299 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:06,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:06,424 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:06,533 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:59:06,548 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:06,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:06,644 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:06,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.457
2025-10-14 12:59:06,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:06,668 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:59:06,673 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.25s
2025-10-14 12:59:06,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:06,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:06,686 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:59:06,687 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:06,688 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:06,689 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:06,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:06,690 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:06,692 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:06,694 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:06,695 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:06,695 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:06,697 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:06,698 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:06,700 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:06,700 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:06,701 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:06,702 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:06,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:06,703 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:06,720 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:06,727 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:06,732 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:06,732 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:59:06,733 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:59:06,770 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:06,783 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:59:06,820 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:59:06,854 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:06,933 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:06,955 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:06,966 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:59:06,967 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4105.457, 'ask': 4105.494, 'last': 0.0, 'time': 1760446742}
2025-10-14 12:59:06,968 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:59:07,077 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:59:07,096 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:59:07,103 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:59:07,130 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:59:07,136 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,171 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,212 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 490, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:07,251 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 686, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:07,255 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,257 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,290 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,320 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,351 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,426 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,438 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:07,440 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,452 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:07,458 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,481 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:07,507 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:59:07,530 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:07,538 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:07,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:07,539 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:07,580 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.13s
2025-10-14 12:59:07,620 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:07,623 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,670 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:07,705 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,786 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:07,798 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:07,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:07,888 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:07,902 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26672.999999999774}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81096.00000000045}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29747.49999999949}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22694.99999999971}]
2025-10-14 12:59:07,930 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:59:02+07:00
2025-10-14 12:59:07,939 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:59:07,941 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:07,948 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:59:07,976 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 6.15s
2025-10-14 12:59:08,121 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:08,122 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:08,122 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 115.38, 'free_margin': 113.32, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:59:08,123 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4105.494, 'profit': 9.31, 'comment': 'AI Trade TP1'}]
2025-10-14 12:59:08,126 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:08,454 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:08,456 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:08,457 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-14 12:59:08,466 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:08,467 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:08,469 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:08,471 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:08,472 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-14 12:59:08,475 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:08,476 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:08,477 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:08,479 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:08,480 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:08,480 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:08,481 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-14 12:59:08,481 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-14 12:59:08,535 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:08,982 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-14 12:59:09,014 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-14 12:59:09,038 - APP.services.mt5_service - DEBUG - Đã lấy 1 lệnh đang mở.
2025-10-14 12:59:09,083 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-14 12:59:09,103 - APP.services.mt5_service - DEBUG - Current price (cp): 4104.662
2025-10-14 12:59:09,272 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 512, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:09,504 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 687, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:09,508 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:09,509 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-14 12:59:09,573 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:09,574 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:09,578 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:09,583 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-14 12:59:09,596 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:09,611 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:09,644 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:09,664 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-14 12:59:09,665 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-14 12:59:09,666 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-14 12:59:09,699 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-14 12:59:09,715 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:09,734 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:09,795 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-14 12:59:09,840 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-14 12:59:09,860 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-14 12:59:09,882 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:09,894 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-14 12:59:09,918 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-14 12:59:09,935 - APP.utils.threading_utils - DEBUG - Gửi task 'mt5.check' vào nhóm 'mt5.check' (metadata={'component': 'mt5', 'operation': 'check'})
2025-10-14 12:59:09,939 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-14 12:59:09,943 - APP.ui.controllers.mt5_controller - INFO - Đã gửi tác vụ MT5 mt5.check (group=mt5.check, metadata={'component': 'mt5', 'operation': 'check'})
2025-10-14 12:59:09,944 - APP.utils.threading_utils - DEBUG - Task 'mt5.check' (group=mt5.check) hoàn tất sau 0.00s
2025-10-14 12:59:09,945 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:09,964 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-14 12:59:09,980 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-14 12:59:10,000 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:10,005 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-14 12:59:10,019 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-14 12:59:10,028 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:59:10,043 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:59:08+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:59:10,072 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:08+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:10,080 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:08+07:00
2025-10-14 12:59:10,102 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:08+07:00 trong DST: True
2025-10-14 12:59:10,112 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:10,134 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:10,165 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-14 12:59:10,166 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:59:10,258 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:59:10,259 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.folder_watch.scan' vào nhóm 'ui.io.folder_watch' (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:59:10,267 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.436585542837
2025-10-14 12:59:10,286 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.folder_watch.scan vào group ui.io.folder_watch (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:59:10,298 - APP.utils.threading_utils - DEBUG - Task 'ui.io.folder_watch.scan' (group=ui.io.folder_watch) hoàn tất sau 0.01s
2025-10-14 12:59:10,389 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.436585542837, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:59:10,412 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:10,561 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:10,573 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:10,573 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4114.962107311535
2025-10-14 12:59:10,585 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:10,638 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:10,657 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:10,662 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.1429031552925
2025-10-14 12:59:10,667 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:10,673 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:59:10,674 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:10,675 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.015940838095
2025-10-14 12:59:10,686 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.10s
2025-10-14 12:59:10,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:59:10,690 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.526484477794
2025-10-14 12:59:10,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:59:10,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.615301794657
2025-10-14 12:59:10,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:59:10,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.60746558024
2025-10-14 12:59:10,695 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:10,698 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.652987605342
2025-10-14 12:59:10,699 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:10,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.859186151925
2025-10-14 12:59:10,706 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4114.962107311535, 'ema200': 4125.1429031552925}, 'M5': {'ema50': 4127.015940838095, 'ema200': 4129.526484477794}, 'M15': {'ema50': 4128.615301794657, 'ema200': 4105.60746558024}, 'H1': {'ema50': 4085.652987605342, 'ema200': 4018.859186151925}}
2025-10-14 12:59:10,707 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:59:10,707 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:59:10,708 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:10,717 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 2.858747402661943, TRs count: 119
2025-10-14 12:59:10,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:59:10,738 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:59:10,739 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:10,764 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:59:10,765 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 2.858747402661943, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:59:10,766 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:59:10,767 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4104.662, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:10,768 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:59:10,769 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:59:10,770 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:59:10,781 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:59:10,783 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:10,783 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 27467.999999999847
2025-10-14 12:59:10,812 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 80301.00000000038
2025-10-14 12:59:10,859 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 30542.499999999563
2025-10-14 12:59:10,877 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 23489.99999999978
2025-10-14 12:59:10,909 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:59:10,918 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 27467.999999999847}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 80301.00000000038}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 30542.499999999563}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 23489.99999999978}]
2025-10-14 12:59:10,933 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:59:11,079 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:11,095 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:59:11,104 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:59:11,112 - APP.services.mt5_service - DEBUG - Position in day range: 0.15759913005459997
2025-10-14 12:59:11,137 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:08+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:11,145 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:08+07:00
2025-10-14 12:59:11,192 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:08+07:00 trong DST: True
2025-10-14 12:59:11,202 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:11,226 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:11,232 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:59:11,251 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,258 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:11,259 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6600', 'price': 4104.66, 'distance_pips': 0.2}, {'level': '6625', 'price': 4104.662, 'distance_pips': 0.05}, {'level': '6650', 'price': 4104.665, 'distance_pips': 0.3}, {'level': '6675', 'price': 4104.667, 'distance_pips': 0.55}]
2025-10-14 12:59:11,261 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:59:11,262 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,263 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:11,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:11,266 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4104.662
2025-10-14 12:59:11,267 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:11,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:11,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:11,277 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:59:11,281 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:59:11,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4104.662
2025-10-14 12:59:11,285 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:11,286 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:59:11,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:11,288 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:59:11,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:59:11,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4104.662
2025-10-14 12:59:11,292 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:59:11,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:59:11,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:11,296 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:59:11,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:11,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4104.662
2025-10-14 12:59:11,298 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:59:11,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:11,301 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:11,302 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:59:11,313 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,314 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:11,316 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:11,317 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:11,319 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:11,320 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:11,321 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:11,322 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:11,323 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:11,324 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:11,327 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:11,328 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:11,329 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:11,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:11,330 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:11,331 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:11,331 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:11,343 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:11,347 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,350 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:11,350 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:59:11,354 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:59:11,355 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:59:11,362 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:59:11,365 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:11,441 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:11,536 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,538 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:59:11,538 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:59:11,637 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:11,673 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4104.662, 'ask': 4104.699, 'last': 0.0, 'time': 1760446748}
2025-10-14 12:59:11,845 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:59:11,866 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:11,915 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:59:11,926 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:59:11,927 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:11,949 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:59:11,956 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:11,971 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,979 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:11,979 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:11,981 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.12s
2025-10-14 12:59:11,981 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 512, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:11,983 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 687, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:11,984 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:11,988 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:11,996 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:12,014 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:12,022 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:12,107 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:12,159 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:12,186 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:12,294 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:12,351 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.6706700746621574}
2025-10-14 12:59:12,514 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:12,624 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:12,734 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:12,784 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:12,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:12,863 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:12,876 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:12,876 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:12,879 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:12,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:12,883 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:12,885 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:12,887 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:12,890 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 27467.999999999847}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 80301.00000000038}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 30542.499999999563}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 23489.99999999978}]
2025-10-14 12:59:12,891 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:12,893 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:59:08+07:00
2025-10-14 12:59:12,893 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-14 12:59:12,906 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:59:12,921 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:12,923 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:59:12,925 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 4.47s
2025-10-14 12:59:12,971 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:13,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:13,166 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:13,167 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 116.17, 'free_margin': 114.11, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:59:13,168 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4104.699, 'profit': 10.1, 'comment': 'AI Trade TP1'}]
2025-10-14 12:59:13,173 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:13,918 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:14,025 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:14,026 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-14 12:59:14,074 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:14,085 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:14,093 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:14,096 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:14,142 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:14,154 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:14,157 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:14,158 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:14,159 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.09s
2025-10-14 12:59:14,160 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:14,161 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:14,162 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-14 12:59:14,163 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-14 12:59:14,175 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:14,663 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-14 12:59:14,696 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-14 12:59:14,706 - APP.services.mt5_service - DEBUG - Đã lấy 1 lệnh đang mở.
2025-10-14 12:59:14,715 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-14 12:59:14,719 - APP.services.mt5_service - DEBUG - Current price (cp): 4105.615
2025-10-14 12:59:14,730 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 518, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:14,824 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 688, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:14,839 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-14 12:59:14,841 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:14,845 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-14 12:59:14,848 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:14,849 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-14 12:59:14,850 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-14 12:59:14,857 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-14 12:59:14,859 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:14,861 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-14 12:59:14,862 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-14 12:59:14,866 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-14 12:59:14,870 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:14,872 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-14 12:59:14,873 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-14 12:59:14,879 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-14 12:59:14,880 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:14,883 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-14 12:59:14,884 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-14 12:59:14,890 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:14,893 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-14 12:59:14,894 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-14 12:59:14,895 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:59:14,896 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:59:14+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:59:14,899 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:14+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:14,900 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:14+07:00
2025-10-14 12:59:14,901 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:14+07:00 trong DST: True
2025-10-14 12:59:14,903 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:14,904 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:14,904 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:59:14,906 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:59:14,907 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.436585542837
2025-10-14 12:59:14,912 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.436585542837, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:59:14,920 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:14,920 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4114.962107311535
2025-10-14 12:59:14,923 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:14,924 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.1429031552925
2025-10-14 12:59:14,926 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:59:14,929 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.015940838095
2025-10-14 12:59:14,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:59:14,935 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.526484477794
2025-10-14 12:59:14,950 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:59:14,953 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.615301794657
2025-10-14 12:59:14,955 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:59:14,956 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.60746558024
2025-10-14 12:59:14,958 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:14,958 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.652987605342
2025-10-14 12:59:14,959 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:14,959 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.859186151925
2025-10-14 12:59:14,960 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4114.962107311535, 'ema200': 4125.1429031552925}, 'M5': {'ema50': 4127.015940838095, 'ema200': 4129.526484477794}, 'M15': {'ema50': 4128.615301794657, 'ema200': 4105.60746558024}, 'H1': {'ema50': 4085.652987605342, 'ema200': 4018.859186151925}}
2025-10-14 12:59:14,966 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:59:14,967 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:59:14,978 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:14,979 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 2.858747402661943, TRs count: 119
2025-10-14 12:59:14,980 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:59:14,981 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:59:14,982 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:14,983 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:59:14,984 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 2.858747402661943, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:59:14,985 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:59:14,985 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4105.615, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:14,985 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:59:14,986 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:59:14,986 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:59:14,986 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:59:14,987 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 26515.000000000327
2025-10-14 12:59:14,987 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 81253.9999999999
2025-10-14 12:59:14,988 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 29589.500000000044
2025-10-14 12:59:14,988 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 22537.000000000262
2025-10-14 12:59:14,989 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:59:15,014 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26515.000000000327}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81253.9999999999}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29589.500000000044}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22537.000000000262}]
2025-10-14 12:59:15,021 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:59:15,035 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:15,037 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:59:15,038 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:59:15,040 - APP.services.mt5_service - DEBUG - Position in day range: 0.1682828667840034
2025-10-14 12:59:15,040 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:14+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:15,041 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:14+07:00
2025-10-14 12:59:15,041 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:14+07:00 trong DST: True
2025-10-14 12:59:15,042 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:15,042 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:15,042 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:59:15,043 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,043 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,044 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6100', 'price': 4105.61, 'distance_pips': 0.5}, {'level': '6125', 'price': 4105.612, 'distance_pips': 0.25}, {'level': '6150', 'price': 4105.615, 'distance_pips': 0.0}, {'level': '6175', 'price': 4105.617, 'distance_pips': 0.25}]
2025-10-14 12:59:15,044 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.670670074678643}
2025-10-14 12:59:15,044 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,045 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:15,047 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.615
2025-10-14 12:59:15,048 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:15,048 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:15,049 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:15,049 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:59:15,050 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:59:15,050 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4105.615
2025-10-14 12:59:15,051 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:15,052 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:59:15,053 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:15,053 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:59:15,055 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:59:15,056 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4105.615
2025-10-14 12:59:15,060 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:15,061 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:59:15,065 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:15,066 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:59:15,067 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:15,068 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.615
2025-10-14 12:59:15,068 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:59:15,068 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:15,069 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:15,070 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:59:15,071 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,072 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,073 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:15,073 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:15,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:15,074 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:15,075 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:15,075 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:15,075 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:15,077 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:15,077 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:15,078 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:15,079 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:15,079 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:15,080 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:15,080 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:15,081 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:15,081 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:15,081 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:15,082 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:15,082 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,082 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:15,083 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,085 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:15,091 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:59:15,092 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:15,093 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:59:15,094 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.02s
2025-10-14 12:59:15,095 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:59:15,098 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:59:15,100 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:15,103 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:15,106 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,108 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:59:15,108 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:59:15,108 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4105.615, 'ask': 4105.652, 'last': 0.0, 'time': 1760446754}
2025-10-14 12:59:15,112 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:59:15,112 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:59:15,113 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:59:15,113 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:59:15,114 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,114 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,115 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 518, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:15,115 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 688, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:15,123 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,123 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,124 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,125 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,126 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,126 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,129 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,129 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,129 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.670670074678643}
2025-10-14 12:59:15,130 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:15,130 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:15,131 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:15,131 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,132 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,132 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:15,132 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:15,133 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:15,133 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:15,136 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26515.000000000327}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81253.9999999999}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29589.500000000044}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22537.000000000262}]
2025-10-14 12:59:15,136 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:59:14+07:00
2025-10-14 12:59:15,137 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:59:15,138 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:15,138 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:59:15,140 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.11s
2025-10-14 12:59:15,153 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:15,303 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:15,309 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:15,310 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 115.22, 'free_margin': 113.16, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:59:15,312 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4105.652, 'profit': 9.15, 'comment': 'AI Trade TP1'}]
2025-10-14 12:59:15,317 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:15,573 - APP.utils.threading_utils - DEBUG - Gửi task 'ui.io.folder_watch.scan' vào nhóm 'ui.io.folder_watch' (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:59:15,584 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O ui.io.folder_watch.scan vào group ui.io.folder_watch (metadata={'component': 'ui', 'operation': 'folder_watch'})
2025-10-14 12:59:15,596 - APP.utils.threading_utils - DEBUG - Task 'ui.io.folder_watch.scan' (group=ui.io.folder_watch) hoàn tất sau 0.01s
2025-10-14 12:59:15,691 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:16,077 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:16,078 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:16,080 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-14 12:59:16,082 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:16,083 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:16,088 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:16,091 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:16,093 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:16,093 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:16,094 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:16,095 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-14 12:59:16,096 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:16,096 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:16,097 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:16,098 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-14 12:59:16,100 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-14 12:59:16,151 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:16,602 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-14 12:59:16,604 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-14 12:59:16,605 - APP.services.mt5_service - DEBUG - Đã lấy 1 lệnh đang mở.
2025-10-14 12:59:16,606 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-14 12:59:16,607 - APP.services.mt5_service - DEBUG - Current price (cp): 4105.817
2025-10-14 12:59:16,619 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 523, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:16,713 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 688, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:16,714 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-14 12:59:16,715 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:16,718 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-14 12:59:16,718 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:16,719 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-14 12:59:16,719 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-14 12:59:16,724 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-14 12:59:16,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:16,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-14 12:59:16,726 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-14 12:59:16,728 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-14 12:59:16,729 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:16,729 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-14 12:59:16,730 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-14 12:59:16,734 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-14 12:59:16,734 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:16,735 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-14 12:59:16,735 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-14 12:59:16,738 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:16,739 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-14 12:59:16,739 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-14 12:59:16,740 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:59:16,740 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:59:16+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:59:16,746 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:16+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:16,748 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:16+07:00
2025-10-14 12:59:16,748 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:16+07:00 trong DST: True
2025-10-14 12:59:16,749 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:16,750 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:16,752 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:59:16,754 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:59:16,755 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.436585542837
2025-10-14 12:59:16,760 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.436585542837, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:59:16,762 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:16,763 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4114.962107311535
2025-10-14 12:59:16,763 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:16,766 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.1429031552925
2025-10-14 12:59:16,767 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:59:16,768 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.015940838095
2025-10-14 12:59:16,769 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:59:16,769 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.526484477794
2025-10-14 12:59:16,770 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:59:16,771 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.615301794657
2025-10-14 12:59:16,777 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:59:16,778 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.60746558024
2025-10-14 12:59:16,779 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:16,780 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.652987605342
2025-10-14 12:59:16,781 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:16,784 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.859186151925
2025-10-14 12:59:16,785 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4114.962107311535, 'ema200': 4125.1429031552925}, 'M5': {'ema50': 4127.015940838095, 'ema200': 4129.526484477794}, 'M15': {'ema50': 4128.615301794657, 'ema200': 4105.60746558024}, 'H1': {'ema50': 4085.652987605342, 'ema200': 4018.859186151925}}
2025-10-14 12:59:16,786 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:59:16,787 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:59:16,787 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:16,788 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 2.858747402661943, TRs count: 119
2025-10-14 12:59:16,788 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:59:16,789 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:59:16,789 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:16,790 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:59:16,791 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 2.858747402661943, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:59:16,791 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:59:16,791 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4105.817, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:16,792 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:59:16,792 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:59:16,793 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:59:16,793 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:59:16,793 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 26313.000000000102
2025-10-14 12:59:16,794 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 81456.00000000013
2025-10-14 12:59:16,794 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 29387.499999999818
2025-10-14 12:59:16,795 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 22335.000000000036
2025-10-14 12:59:16,795 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:59:16,796 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26313.000000000102}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81456.00000000013}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29387.499999999818}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22335.000000000036}]
2025-10-14 12:59:16,798 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:59:16,799 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:16,800 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:59:16,800 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:59:16,800 - APP.services.mt5_service - DEBUG - Position in day range: 0.1705474153877211
2025-10-14 12:59:16,801 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:16+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:16,801 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:16+07:00
2025-10-14 12:59:16,802 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:16+07:00 trong DST: True
2025-10-14 12:59:16,802 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:16,802 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:16,803 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:59:16,809 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,809 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,810 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8100', 'price': 4105.81, 'distance_pips': 0.7}, {'level': '8125', 'price': 4105.812, 'distance_pips': 0.45}, {'level': '8150', 'price': 4105.815, 'distance_pips': 0.2}, {'level': '8175', 'price': 4105.818, 'distance_pips': 0.05}]
2025-10-14 12:59:16,810 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.670670074678643}
2025-10-14 12:59:16,810 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,812 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:16,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.817
2025-10-14 12:59:16,814 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:16,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:16,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:16,816 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:59:16,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:59:16,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4105.817
2025-10-14 12:59:16,818 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:16,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:59:16,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:16,820 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:59:16,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:59:16,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4105.817
2025-10-14 12:59:16,822 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:16,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:59:16,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:16,824 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:59:16,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:16,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.817
2025-10-14 12:59:16,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:59:16,826 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:16,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:16,830 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:59:16,830 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,831 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,831 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:16,833 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:16,842 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:16,842 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:16,843 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:16,843 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:16,844 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:16,844 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:16,844 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:16,852 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:16,853 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:16,853 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:16,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:16,854 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:16,855 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:16,855 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:16,856 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,856 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,858 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:59:16,859 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:59:16,860 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:59:16,861 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:59:16,862 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:16,872 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:16,874 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,875 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:59:16,875 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:59:16,875 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4105.817, 'ask': 4105.854, 'last': 0.0, 'time': 1760446756}
2025-10-14 12:59:16,879 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:59:16,880 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:59:16,881 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:59:16,881 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:59:16,882 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,883 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,883 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 523, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-14 12:59:16,883 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 688, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:16,884 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,885 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,888 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,889 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,889 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,890 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,892 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,893 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.670670074678643}
2025-10-14 12:59:16,893 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:16,894 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:16,895 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:16,895 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,896 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,897 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:16,905 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:16,906 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:16,907 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:16,907 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26313.000000000102}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81456.00000000013}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29387.499999999818}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22335.000000000036}]
2025-10-14 12:59:16,908 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:59:16+07:00
2025-10-14 12:59:16,910 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:59:16,911 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:16,914 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:59:16,915 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.84s
2025-10-14 12:59:16,980 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:16,981 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:16,982 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 115.02, 'free_margin': 112.96, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:59:16,983 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4105.854, 'profit': 8.95, 'comment': 'AI Trade TP1'}]
2025-10-14 12:59:16,988 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:17,082 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:17,083 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:17,085 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-14 12:59:17,092 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:17,094 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:17,095 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:17,096 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:17,097 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-14 12:59:17,101 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:17,102 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:17,104 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:17,104 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-14 12:59:17,105 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-14 12:59:17,107 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-14 12:59:17,107 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-14 12:59:17,108 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-14 12:59:17,193 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:17,609 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-14 12:59:17,612 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng Asia/Ho_Chi_Minh.
2025-10-14 12:59:17,665 - APP.services.mt5_service - DEBUG - Đã lấy 1 lệnh đang mở.
2025-10-14 12:59:17,770 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-14 12:59:17,856 - APP.services.mt5_service - DEBUG - Current price (cp): 4105.726
2025-10-14 12:59:17,925 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 524, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:18,020 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 688, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:18,021 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-14 12:59:18,023 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:18,026 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-14 12:59:18,027 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:18,028 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-14 12:59:18,028 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-14 12:59:18,032 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-14 12:59:18,033 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:18,033 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-14 12:59:18,034 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-14 12:59:18,037 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-14 12:59:18,038 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:18,038 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-14 12:59:18,039 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-14 12:59:18,042 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-14 12:59:18,042 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:18,043 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-14 12:59:18,043 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-14 12:59:18,047 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:18,047 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 4059.382, 'low': 3884.095}
2025-10-14 12:59:18,048 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-14 12:59:18,048 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}
2025-10-14 12:59:18,049 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120, reference_time: 2025-10-14 19:59:17+07:00, target_tz: Asia/Ho_Chi_Minh
2025-10-14 12:59:18,049 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:17+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:18,050 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:17+07:00
2025-10-14 12:59:18,050 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:17+07:00 trong DST: True
2025-10-14 12:59:18,050 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:18,051 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:18,051 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-14 12:59:18,053 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-14 12:59:18,053 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4122.436585542837
2025-10-14 12:59:18,058 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4122.436585542837, 'asia': None, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-14 12:59:18,059 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:18,059 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4114.962107311535
2025-10-14 12:59:18,060 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:18,060 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4125.1429031552925
2025-10-14 12:59:18,061 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-14 12:59:18,061 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4127.015940838095
2025-10-14 12:59:18,061 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-14 12:59:18,062 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4129.526484477794
2025-10-14 12:59:18,062 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-14 12:59:18,063 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4128.615301794657
2025-10-14 12:59:18,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-14 12:59:18,063 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4105.60746558024
2025-10-14 12:59:18,064 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-14 12:59:18,065 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4085.652987605342
2025-10-14 12:59:18,065 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-14 12:59:18,066 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4018.859186151925
2025-10-14 12:59:18,066 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4114.962107311535, 'ema200': 4125.1429031552925}, 'M5': {'ema50': 4127.015940838095, 'ema200': 4129.526484477794}, 'M15': {'ema50': 4128.615301794657, 'ema200': 4105.60746558024}, 'H1': {'ema50': 4085.652987605342, 'ema200': 4018.859186151925}}
2025-10-14 12:59:18,067 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-14 12:59:18,067 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.516870574252293, TRs count: 179
2025-10-14 12:59:18,068 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:18,068 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 2.858747402661943, TRs count: 119
2025-10-14 12:59:18,069 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-14 12:59:18,069 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 10.88797166560802, TRs count: 95
2025-10-14 12:59:18,070 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-14 12:59:18,070 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 21.41847867150199, TRs count: 119
2025-10-14 12:59:18,071 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 5.516870574252293, 'M1': 2.858747402661943, 'M15': 10.88797166560802, 'H1': 21.41847867150199}
2025-10-14 12:59:18,071 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-14 12:59:18,071 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4105.726, daily: {'open': 4128.152, 'high': 4179.805, 'low': 4090.604, 'eq50': 4135.2045, 'midnight_open': None}, prev_day: {'high': 4132.13, 'low': 4024.361}
2025-10-14 12:59:18,072 - APP.services.mt5_service - DEBUG - Thêm PDH: 4132.13
2025-10-14 12:59:18,072 - APP.services.mt5_service - DEBUG - Thêm PDL: 4024.361
2025-10-14 12:59:18,072 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4135.2045
2025-10-14 12:59:18,073 - APP.services.mt5_service - DEBUG - Thêm DO: 4128.152
2025-10-14 12:59:18,074 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 4132.13, Relation: ABOVE, Distance: 26404.00000000045
2025-10-14 12:59:18,075 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 4024.361, Relation: BELOW, Distance: 81364.99999999978
2025-10-14 12:59:18,076 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4135.2045, Relation: ABOVE, Distance: 29478.500000000167
2025-10-14 12:59:18,077 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 4128.152, Relation: ABOVE, Distance: 22426.000000000386
2025-10-14 12:59:18,077 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-14 12:59:18,077 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26404.00000000045}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81364.99999999978}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29478.500000000167}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22426.000000000386}]
2025-10-14 12:59:18,078 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-14 12:59:18,079 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:18,079 - APP.services.mt5_service - DEBUG - Prev day close: 4128.107
2025-10-14 12:59:18,080 - APP.services.mt5_service - DEBUG - Day range: 89.20100000000048, Day range % of ADR20: 148.4569059564344
2025-10-14 12:59:18,080 - APP.services.mt5_service - DEBUG - Position in day range: 0.16952724745238015
2025-10-14 12:59:18,080 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-14 19:59:17+07:00, Target TZ: Asia/Ho_Chi_Minh
2025-10-14 12:59:18,081 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-14 19:59:17+07:00
2025-10-14 12:59:18,081 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-14 19:59:17+07:00 trong DST: True
2025-10-14 12:59:18,082 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-14 12:59:18,082 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè (có thể có điều chỉnh).
2025-10-14 12:59:18,082 - APP.services.mt5_service - DEBUG - Killzone active: newyork_am, Mins to next killzone: None
2025-10-14 12:59:18,083 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,083 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,084 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7200', 'price': 4105.72, 'distance_pips': 0.6}, {'level': '7225', 'price': 4105.722, 'distance_pips': 0.35}, {'level': '7250', 'price': 4105.725, 'distance_pips': 0.1}, {'level': '7275', 'price': 4105.727, 'distance_pips': 0.15}]
2025-10-14 12:59:18,086 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 0.670670074678643}
2025-10-14 12:59:18,086 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,087 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,087 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:18,088 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.726
2025-10-14 12:59:18,088 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:18,089 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:18,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:18,090 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-14 12:59:18,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-14 12:59:18,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4105.726
2025-10-14 12:59:18,092 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:18,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-14 12:59:18,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:18,093 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'Nến', 'component': 'chart'})
2025-10-14 12:59:18,094 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-14 12:59:18,096 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 50
2025-10-14 12:59:18,097 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-14 12:59:18,097 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-14 12:59:18,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4105.726
2025-10-14 12:59:18,099 - APP.services.mt5_service - DEBUG - Đã lấy 50 bars cho XAUUSD 1.
2025-10-14 12:59:18,100 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-14 12:59:18,101 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-14 12:59:18,101 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-14 12:59:18,102 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-14 12:59:18,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:18,104 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-14 12:59:18,104 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-14 12:59:18,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4105.726
2025-10-14 12:59:18,105 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-14 12:59:18,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-14 12:59:18,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-14 12:59:18,107 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-14 12:59:18,108 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,108 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,108 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:18,109 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:18,109 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:18,110 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:18,110 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:18,110 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:18,111 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:18,111 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:18,111 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-14 12:59:18,112 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:18,112 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-14 12:59:18,112 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-14 12:59:18,113 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-14 12:59:18,113 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-14 12:59:18,114 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-14 12:59:18,114 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-14 12:59:18,115 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,115 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,115 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-14 12:59:18,116 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-14 12:59:18,116 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-14 12:59:18,116 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-14 12:59:18,118 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:18,119 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:18,120 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,121 - APP.utils.threading_utils - DEBUG - Task song song 'get_upcoming_events' hoàn tất thành công.
2025-10-14 12:59:18,121 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-14 12:59:18,121 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4105.726, 'ask': 4105.763, 'last': 0.0, 'time': 1760446757}
2025-10-14 12:59:18,124 - APP.services.mt5_service - DEBUG - Đã định dạng 77 deals cho XAUUSD.
2025-10-14 12:59:18,125 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-14 12:59:18,126 - APP.utils.threading_utils - DEBUG - Task song song 'get_history_deals' hoàn tất thành công.
2025-10-14 12:59:18,126 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-14 12:59:18,127 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,127 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,128 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_5m': {'ticks_per_min': 524, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:18,128 - APP.utils.safe_data - DEBUG - Get top-level key 'tick_stats_30m': {'ticks_per_min': 688, 'median_spread': 37, 'p90_spread': 37}
2025-10-14 12:59:18,129 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,129 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,129 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,130 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,130 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,131 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,131 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,131 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,132 - APP.utils.safe_data - DEBUG - Get top-level key 'atr_norm': {'spread_as_pct_of_atr_m5': 0.670670074678643}
2025-10-14 12:59:18,132 - APP.utils.safe_data - DEBUG - Get top-level key 'adr': {'d5': 84.69719999999998, 'd10': 72.42870000000002, 'd20': 60.08545000000004}
2025-10-14 12:59:18,134 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:18,134 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:18,135 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,135 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,135 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-14 12:59:18,136 - APP.services.mt5_service - DEBUG - Tìm thấy key 'point' trong dict. Giá trị: 0.001
2025-10-14 12:59:18,136 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -435.1, 'swap_short': 0.0}
2025-10-14 12:59:18,136 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-14 12:59:18,137 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 4132.13, 'relation': 'ABOVE', 'distance_pips': 26404.00000000045}, {'name': 'PDL', 'price': 4024.361, 'relation': 'BELOW', 'distance_pips': 81364.99999999978}, {'name': 'EQ50_D', 'price': 4135.2045, 'relation': 'ABOVE', 'distance_pips': 29478.500000000167}, {'name': 'DO', 'price': 4128.152, 'relation': 'ABOVE', 'distance_pips': 22426.000000000386}]
2025-10-14 12:59:18,137 - APP.utils.safe_data - DEBUG - Get top-level key 'broker_time': 2025-10-14T19:59:17+07:00
2025-10-14 12:59:18,138 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-14 12:59:18,139 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
2025-10-14 12:59:18,140 - APP.utils.threading_utils - DEBUG - Task song song 'check_no_trade_conditions' hoàn tất thành công.
2025-10-14 12:59:18,142 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 1.06s
2025-10-14 12:59:18,176 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:18,301 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-14 12:59:18,302 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-14 12:59:18,303 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 106.07, 'equity': 115.11, 'free_margin': 113.05, 'currency': 'USD', 'leverage': 2000}
2025-10-14 12:59:18,304 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': [{'ticket': 2426230401, 'symbol': 'XAUUSD', 'type': 'SELL', 'volume': 0.01, 'price_open': 4114.802, 'sl': 4114.802, 'tp': 4090.604, 'price_current': 4105.763, 'profit': 9.04, 'comment': 'AI Trade TP1'}]
2025-10-14 12:59:18,307 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': newyork_am
